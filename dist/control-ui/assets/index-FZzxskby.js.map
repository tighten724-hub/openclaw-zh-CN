{"version":3,"file":"index-FZzxskby.js","sources":["../../../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/css-tag.js","../../../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/reactive-element.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/lit-html.js","../../../node_modules/.pnpm/lit-element@4.2.2/node_modules/lit-element/lit-element.js","../../../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/custom-element.js","../../../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/property.js","../../../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/state.js","../../../ui/src/ui/controllers/channels.ts","../../../ui/src/ui/views/config-form.shared.ts","../../../ui/src/ui/controllers/config/form-coerce.ts","../../../ui/src/ui/controllers/config/form-utils.ts","../../../ui/src/ui/controllers/config.ts","../../../ui/src/ui/views/channels.nostr-profile-form.ts","../../../ui/src/ui/app-channels.ts","../../../src/sessions/session-key-utils.ts","../../../ui/src/ui/app-scroll.ts","../../../ui/src/ui/controllers/debug.ts","../../../ui/src/ui/controllers/logs.ts","../../../ui/src/ui/controllers/nodes.ts","../../../ui/src/ui/app-polling.ts","../../../ui/src/ui/controllers/agent-identity.ts","../../../ui/src/ui/controllers/agent-skills.ts","../../../ui/src/ui/controllers/agents.ts","../../../src/infra/format-time/format-duration.ts","../../../src/infra/format-time/format-relative.ts","../../../src/shared/text/reasoning-tags.ts","../../../ui/src/ui/format.ts","../../../ui/src/ui/controllers/cron.ts","../../../ui/src/ui/device-auth.ts","../../../node_modules/.pnpm/@noble+ed25519@3.0.0/node_modules/@noble/ed25519/index.js","../../../ui/src/ui/device-identity.ts","../../../ui/src/ui/controllers/devices.ts","../../../ui/src/ui/controllers/exec-approvals.ts","../../../ui/src/ui/controllers/presence.ts","../../../ui/src/ui/controllers/sessions.ts","../../../ui/src/ui/controllers/skills.ts","../../../ui/src/locales/zh-CN.ts","../../../ui/src/locales/en-US.ts","../../../ui/src/i18n.ts","../../../ui/src/ui/navigation.ts","../../../ui/src/ui/storage.ts","../../../ui/src/ui/theme-transition.ts","../../../ui/src/ui/theme.ts","../../../ui/src/ui/app-settings.ts","../../../ui/src/ui/app-tool-stream.ts","../../../ui/src/ui/chat/message-extract.ts","../../../ui/src/ui/uuid.ts","../../../ui/src/ui/controllers/chat.ts","../../../ui/src/ui/app-chat.ts","../../../ui/src/ui/app-defaults.ts","../../../ui/src/ui/assistant-identity.ts","../../../ui/src/ui/controllers/assistant-identity.ts","../../../ui/src/ui/controllers/exec-approval.ts","../../../src/gateway/device-auth.ts","../../../src/gateway/protocol/client-info.ts","../../../ui/src/ui/gateway.ts","../../../ui/src/ui/app-gateway.ts","../../../ui/src/ui/app-lifecycle.ts","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directive.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directive-helpers.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directives/repeat.js","../../../ui/src/ui/icons.ts","../../../ui/src/ui/app-render.helpers.ts","../../../ui/src/ui/controllers/agent-files.ts","../../../ui/src/ui/controllers/usage.ts","../../../src/agents/tool-policy.ts","../../../ui/src/ui/presenter.ts","../../../ui/src/ui/views/agents.ts","../../../ui/src/ui/views/config-form.node.ts","../../../ui/src/ui/views/config-form.render.ts","../../../ui/src/ui/views/config-form.analyze.ts","../../../ui/src/ui/views/channels.config.ts","../../../ui/src/ui/views/channels.discord.ts","../../../ui/src/ui/views/channels.googlechat.ts","../../../ui/src/ui/views/channels.imessage.ts","../../../ui/src/ui/views/channels.nostr.ts","../../../ui/src/ui/views/channels.shared.ts","../../../ui/src/ui/views/channels.signal.ts","../../../ui/src/ui/views/channels.slack.ts","../../../ui/src/ui/views/channels.telegram.ts","../../../ui/src/ui/views/channels.whatsapp.ts","../../../ui/src/ui/views/channels.ts","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/async-directive.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directives/ref.js","../../../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/directives/unsafe-html.js","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/dist/purify.es.mjs","../../../node_modules/.pnpm/marked@17.0.3/node_modules/marked/lib/marked.esm.js","../../../ui/src/ui/markdown.ts","../../../ui/src/ui/text-direction.ts","../../../ui/src/ui/chat/copy-as-markdown.ts","../../../ui/src/ui/chat/message-normalizer.ts","../../../ui/src/ui/tool-display.ts","../../../ui/src/ui/chat/constants.ts","../../../ui/src/ui/chat/tool-helpers.ts","../../../ui/src/ui/chat/tool-cards.ts","../../../ui/src/ui/chat/grouped-render.ts","../../../ui/src/ui/views/markdown-sidebar.ts","../../../ui/src/ui/components/resizable-divider.ts","../../../ui/src/ui/views/chat.ts","../../../ui/src/ui/views/config.ts","../../../ui/src/ui/views/cron.ts","../../../ui/src/ui/views/debug.ts","../../../ui/src/ui/views/exec-approval.ts","../../../ui/src/ui/views/gateway-url-confirmation.ts","../../../ui/src/ui/views/instances.ts","../../../ui/src/ui/views/logs.ts","../../../ui/src/ui/views/nodes.ts","../../../ui/src/ui/views/overview.ts","../../../ui/src/ui/views/sessions.ts","../../../ui/src/ui/views/skills.ts","../../../ui/src/ui/usage-helpers.ts","../../../ui/src/ui/views/usageStyles.ts","../../../ui/src/ui/views/usage.ts","../../../ui/src/ui/app-render.ts","../../../ui/src/ui/app.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class n{constructor(t,e,o){if(this._$cssResult$=!0,o!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=o.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&o.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new n(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const o=1===t.length?t[0]:e.reduce((e,s,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[o+1],t[0]);return new n(o,t,s)},S=(s,o)=>{if(e)s.adoptedStyleSheets=o.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const e of o){const o=document.createElement(\"style\"),n=t.litNonce;void 0!==n&&o.setAttribute(\"nonce\",n),o.textContent=e.cssText,s.appendChild(o)}},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{n as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as s}from\"./css-tag.js\";export{CSSResult,css,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{is:i,defineProperty:e,getOwnPropertyDescriptor:h,getOwnPropertyNames:r,getOwnPropertySymbols:o,getPrototypeOf:n}=Object,a=globalThis,c=a.trustedTypes,l=c?c.emptyScript:\"\",p=a.reactiveElementPolyfillSupport,d=(t,s)=>t,u={toAttribute(t,s){switch(s){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,s){let i=t;switch(s){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},f=(t,s)=>!i(t,s),b={attribute:!0,type:String,converter:u,reflect:!1,useDefault:!1,hasChanged:f};Symbol.metadata??=Symbol(\"metadata\"),a.litPropertyMetadata??=new WeakMap;class y extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,s=b){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(t,s),!s.noAccessor){const i=Symbol(),h=this.getPropertyDescriptor(t,i,s);void 0!==h&&e(this.prototype,t,h)}}static getPropertyDescriptor(t,s,i){const{get:e,set:r}=h(this.prototype,t)??{get(){return this[s]},set(t){this[s]=t}};return{get:e,set(s){const h=e?.call(this);r?.call(this,s),this.requestUpdate(t,h,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??b}static _$Ei(){if(this.hasOwnProperty(d(\"elementProperties\")))return;const t=n(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(d(\"finalized\")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d(\"properties\"))){const t=this.properties,s=[...r(t),...o(t)];for(const i of s)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const s=litPropertyMetadata.get(t);if(void 0!==s)for(const[t,i]of s)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const i=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const s of e)i.unshift(t(s))}else void 0!==s&&i.push(t(s));return i}static _$Eu(t,s){const i=s.attribute;return!1===i?void 0:\"string\"==typeof i?i:\"string\"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,s=this.constructor.elementProperties;for(const i of s.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return s(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,s,i){this._$AK(t,i)}_$ET(t,s){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const h=(void 0!==i.converter?.toAttribute?i.converter:u).toAttribute(s,i.type);this._$Em=t,null==h?this.removeAttribute(e):this.setAttribute(e,h),this._$Em=null}}_$AK(t,s){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),h=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:u;this._$Em=e;const r=h.fromAttribute(s,t.type);this[e]=r??this._$Ej?.get(e)??r,this._$Em=null}}requestUpdate(t,s,i,e=!1,h){if(void 0!==t){const r=this.constructor;if(!1===e&&(h=this[t]),i??=r.getPropertyOptions(t),!((i.hasChanged??f)(h,s)||i.useDefault&&i.reflect&&h===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,s,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,s,{useDefault:i,reflect:e,wrapped:h},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??s??this[t]),!0!==h||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(s=void 0),this._$AL.set(t,s)),!0===e&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,s]of this._$Ep)this[t]=s;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[s,i]of t){const{wrapped:t}=i,e=this[s];!0!==t||this._$AL.has(s)||void 0===e||this.C(s,void 0,i,e)}}let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(s)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(s)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}}y.elementStyles=[],y.shadowRootOptions={mode:\"open\"},y[d(\"elementProperties\")]=new Map,y[d(\"finalized\")]=new Map,p?.({ReactiveElement:y}),(a.reactiveElementVersions??=[]).push(\"2.1.2\");export{y as ReactiveElement,s as adoptStyles,u as defaultConverter,t as getCompatibleStyle,f as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,i=t=>t,s=t.trustedTypes,e=s?s.createPolicy(\"lit-html\",{createHTML:t=>t}):void 0,h=\"$lit$\",o=`lit$${Math.random().toFixed(9).slice(2)}$`,n=\"?\"+o,r=`<${n}>`,l=document,c=()=>l.createComment(\"\"),a=t=>null===t||\"object\"!=typeof t&&\"function\"!=typeof t,u=Array.isArray,d=t=>u(t)||\"function\"==typeof t?.[Symbol.iterator],f=\"[ \\t\\n\\f\\r]\",v=/<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g,_=/-->/g,m=/>/g,p=RegExp(`>|${f}(?:([^\\\\s\"'>=/]+)(${f}*=${f}*(?:[^ \\t\\n\\f\\r\"'\\`<>=]|(\"|')|))|$)`,\"g\"),g=/'/g,$=/\"/g,y=/^(?:script|style|textarea|title)$/i,x=t=>(i,...s)=>({_$litType$:t,strings:i,values:s}),b=x(1),w=x(2),T=x(3),E=Symbol.for(\"lit-noChange\"),A=Symbol.for(\"lit-nothing\"),C=new WeakMap,P=l.createTreeWalker(l,129);function V(t,i){if(!u(t)||!t.hasOwnProperty(\"raw\"))throw Error(\"invalid template strings array\");return void 0!==e?e.createHTML(i):i}const N=(t,i)=>{const s=t.length-1,e=[];let n,l=2===i?\"<svg>\":3===i?\"<math>\":\"\",c=v;for(let i=0;i<s;i++){const s=t[i];let a,u,d=-1,f=0;for(;f<s.length&&(c.lastIndex=f,u=c.exec(s),null!==u);)f=c.lastIndex,c===v?\"!--\"===u[1]?c=_:void 0!==u[1]?c=m:void 0!==u[2]?(y.test(u[2])&&(n=RegExp(\"</\"+u[2],\"g\")),c=p):void 0!==u[3]&&(c=p):c===p?\">\"===u[0]?(c=n??v,d=-1):void 0===u[1]?d=-2:(d=c.lastIndex-u[2].length,a=u[1],c=void 0===u[3]?p:'\"'===u[3]?$:g):c===$||c===g?c=p:c===_||c===m?c=v:(c=p,n=void 0);const x=c===p&&t[i+1].startsWith(\"/>\")?\" \":\"\";l+=c===v?s+r:d>=0?(e.push(a),s.slice(0,d)+h+s.slice(d)+o+x):s+o+(-2===d?i:x)}return[V(t,l+(t[s]||\"<?>\")+(2===i?\"</svg>\":3===i?\"</math>\":\"\")),e]};class S{constructor({strings:t,_$litType$:i},e){let r;this.parts=[];let l=0,a=0;const u=t.length-1,d=this.parts,[f,v]=N(t,i);if(this.el=S.createElement(f,e),P.currentNode=this.el.content,2===i||3===i){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(r=P.nextNode())&&d.length<u;){if(1===r.nodeType){if(r.hasAttributes())for(const t of r.getAttributeNames())if(t.endsWith(h)){const i=v[a++],s=r.getAttribute(t).split(o),e=/([.?@])?(.*)/.exec(i);d.push({type:1,index:l,name:e[2],strings:s,ctor:\".\"===e[1]?I:\"?\"===e[1]?L:\"@\"===e[1]?z:H}),r.removeAttribute(t)}else t.startsWith(o)&&(d.push({type:6,index:l}),r.removeAttribute(t));if(y.test(r.tagName)){const t=r.textContent.split(o),i=t.length-1;if(i>0){r.textContent=s?s.emptyScript:\"\";for(let s=0;s<i;s++)r.append(t[s],c()),P.nextNode(),d.push({type:2,index:++l});r.append(t[i],c())}}}else if(8===r.nodeType)if(r.data===n)d.push({type:2,index:l});else{let t=-1;for(;-1!==(t=r.data.indexOf(o,t+1));)d.push({type:7,index:l}),t+=o.length-1}l++}}static createElement(t,i){const s=l.createElement(\"template\");return s.innerHTML=t,s}}function M(t,i,s=t,e){if(i===E)return i;let h=void 0!==e?s._$Co?.[e]:s._$Cl;const o=a(i)?void 0:i._$litDirective$;return h?.constructor!==o&&(h?._$AO?.(!1),void 0===o?h=void 0:(h=new o(t),h._$AT(t,s,e)),void 0!==e?(s._$Co??=[])[e]=h:s._$Cl=h),void 0!==h&&(i=M(t,h._$AS(t,i.values),h,e)),i}class R{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:i},parts:s}=this._$AD,e=(t?.creationScope??l).importNode(i,!0);P.currentNode=e;let h=P.nextNode(),o=0,n=0,r=s[0];for(;void 0!==r;){if(o===r.index){let i;2===r.type?i=new k(h,h.nextSibling,this,t):1===r.type?i=new r.ctor(h,r.name,r.strings,this,t):6===r.type&&(i=new Z(h,this,t)),this._$AV.push(i),r=s[++n]}o!==r?.index&&(h=P.nextNode(),o++)}return P.currentNode=l,e}p(t){let i=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,i),i+=s.strings.length-2):s._$AI(t[i])),i++}}class k{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,i,s,e){this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=s,this.options=e,this._$Cv=e?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return void 0!==i&&11===t?.nodeType&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=M(this,t,i),a(t)?t===A||null==t||\"\"===t?(this._$AH!==A&&this._$AR(),this._$AH=A):t!==this._$AH&&t!==E&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):d(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==A&&a(this._$AH)?this._$AA.nextSibling.data=t:this.T(l.createTextNode(t)),this._$AH=t}$(t){const{values:i,_$litType$:s}=t,e=\"number\"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=S.createElement(V(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===e)this._$AH.p(i);else{const t=new R(e,this),s=t.u(this.options);t.p(i),this.T(s),this._$AH=t}}_$AC(t){let i=C.get(t.strings);return void 0===i&&C.set(t.strings,i=new S(t)),i}k(t){u(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,e=0;for(const h of t)e===i.length?i.push(s=new k(this.O(c()),this.O(c()),this,this.options)):s=i[e],s._$AI(h),e++;e<i.length&&(this._$AR(s&&s._$AB.nextSibling,e),i.length=e)}_$AR(t=this._$AA.nextSibling,s){for(this._$AP?.(!1,!0,s);t!==this._$AB;){const s=i(t).nextSibling;i(t).remove(),t=s}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class H{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,i,s,e,h){this.type=1,this._$AH=A,this._$AN=void 0,this.element=t,this.name=i,this._$AM=e,this.options=h,s.length>2||\"\"!==s[0]||\"\"!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=A}_$AI(t,i=this,s,e){const h=this.strings;let o=!1;if(void 0===h)t=M(this,t,i,0),o=!a(t)||t!==this._$AH&&t!==E,o&&(this._$AH=t);else{const e=t;let n,r;for(t=h[0],n=0;n<h.length-1;n++)r=M(this,e[s+n],i,n),r===E&&(r=this._$AH[n]),o||=!a(r)||r!==this._$AH[n],r===A?t=A:t!==A&&(t+=(r??\"\")+h[n+1]),this._$AH[n]=r}o&&!e&&this.j(t)}j(t){t===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??\"\")}}class I extends H{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===A?void 0:t}}class L extends H{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==A)}}class z extends H{constructor(t,i,s,e,h){super(t,i,s,e,h),this.type=5}_$AI(t,i=this){if((t=M(this,t,i,0)??A)===E)return;const s=this._$AH,e=t===A&&s!==A||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,h=t!==A&&(s===A||e);e&&this.element.removeEventListener(this.name,this,s),h&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){\"function\"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Z{constructor(t,i,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){M(this,t)}}const j={M:h,P:o,A:n,C:1,L:N,R,D:d,V:M,I:k,H,N:L,U:z,B:I,F:Z},B=t.litHtmlPolyfillSupport;B?.(S,k),(t.litHtmlVersions??=[]).push(\"3.3.2\");const D=(t,i,s)=>{const e=s?.renderBefore??i;let h=e._$litPart$;if(void 0===h){const t=s?.renderBefore??null;e._$litPart$=h=new k(i.insertBefore(c(),t),t,void 0,s??{})}return h._$AI(t),h};export{j as _$LH,b as html,T as mathml,E as noChange,A as nothing,D as render,w as svg};\n//# sourceMappingURL=lit-html.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as r}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=globalThis;class i extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return r}}i._$litElement$=!0,i[\"finalized\"]=!0,s.litElementHydrateSupport?.({LitElement:i});const o=s.litElementPolyfillSupport;o?.({LitElement:i});const n={_$AK:(t,e,r)=>{t._$AK(e,r)},_$AL:t=>t._$AL};(s.litElementVersions??=[]).push(\"4.2.2\");export{i as LitElement,n as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=t=>(e,o)=>{void 0!==o?o.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)};export{t as customElement};\n//# sourceMappingURL=custom-element.js.map\n","import{notEqual as t,defaultConverter as e}from\"../reactive-element.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o={attribute:!0,type:String,converter:e,reflect:!1,hasChanged:t},r=(t=o,e,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(void 0===s&&globalThis.litPropertyMetadata.set(i,s=new Map),\"setter\"===n&&((t=Object.create(t)).wrapped=!0),s.set(r.name,t),\"accessor\"===n){const{name:o}=r;return{set(r){const n=e.get.call(this);e.set.call(this,r),this.requestUpdate(o,n,t,!0,r)},init(e){return void 0!==e&&this.C(o,void 0,t,e),e}}}if(\"setter\"===n){const{name:o}=r;return function(r){const n=this[o];e.call(this,r),this.requestUpdate(o,n,t,!0,r)}}throw Error(\"Unsupported decorator location: \"+n)};function n(t){return(e,o)=>\"object\"==typeof o?r(t,e,o):((t,e,o)=>{const r=e.hasOwnProperty(o);return e.constructor.createProperty(o,t),r?Object.getOwnPropertyDescriptor(e,o):void 0})(t,e,o)}export{n as property,r as standardProperty};\n//# sourceMappingURL=property.js.map\n","import{property as t}from\"./property.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function r(r){return t({...r,state:!0,attribute:!1})}export{r as state};\n//# sourceMappingURL=state.js.map\n","import type { ChannelsState } from \"./channels.types.ts\";\r\nimport { ChannelsStatusSnapshot } from \"../types.ts\";\r\n\r\nexport type { ChannelsState };\r\n\r\nexport async function loadChannels(state: ChannelsState, probe: boolean) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.channelsLoading) {\r\n    return;\r\n  }\r\n  state.channelsLoading = true;\r\n  state.channelsError = null;\r\n  try {\r\n    const res = await state.client.request<ChannelsStatusSnapshot | null>(\"channels.status\", {\r\n      probe,\r\n      timeoutMs: 8000,\r\n    });\r\n    state.channelsSnapshot = res;\r\n    state.channelsLastSuccess = Date.now();\r\n  } catch (err) {\r\n    state.channelsError = String(err);\r\n  } finally {\r\n    state.channelsLoading = false;\r\n  }\r\n}\r\n\r\nexport async function startWhatsAppLogin(state: ChannelsState, force: boolean) {\r\n  if (!state.client || !state.connected || state.whatsappBusy) {\r\n    return;\r\n  }\r\n  state.whatsappBusy = true;\r\n  try {\r\n    const res = await state.client.request<{ message?: string; qrDataUrl?: string }>(\r\n      \"web.login.start\",\r\n      {\r\n        force,\r\n        timeoutMs: 30000,\r\n      },\r\n    );\r\n    state.whatsappLoginMessage = res.message ?? null;\r\n    state.whatsappLoginQrDataUrl = res.qrDataUrl ?? null;\r\n    state.whatsappLoginConnected = null;\r\n  } catch (err) {\r\n    state.whatsappLoginMessage = String(err);\r\n    state.whatsappLoginQrDataUrl = null;\r\n    state.whatsappLoginConnected = null;\r\n  } finally {\r\n    state.whatsappBusy = false;\r\n  }\r\n}\r\n\r\nexport async function waitWhatsAppLogin(state: ChannelsState) {\r\n  if (!state.client || !state.connected || state.whatsappBusy) {\r\n    return;\r\n  }\r\n  state.whatsappBusy = true;\r\n  try {\r\n    const res = await state.client.request<{ message?: string; connected?: boolean }>(\r\n      \"web.login.wait\",\r\n      {\r\n        timeoutMs: 120000,\r\n      },\r\n    );\r\n    state.whatsappLoginMessage = res.message ?? null;\r\n    state.whatsappLoginConnected = res.connected ?? null;\r\n    if (res.connected) {\r\n      state.whatsappLoginQrDataUrl = null;\r\n    }\r\n  } catch (err) {\r\n    state.whatsappLoginMessage = String(err);\r\n    state.whatsappLoginConnected = null;\r\n  } finally {\r\n    state.whatsappBusy = false;\r\n  }\r\n}\r\n\r\nexport async function logoutWhatsApp(state: ChannelsState) {\r\n  if (!state.client || !state.connected || state.whatsappBusy) {\r\n    return;\r\n  }\r\n  state.whatsappBusy = true;\r\n  try {\r\n    await state.client.request(\"channels.logout\", { channel: \"whatsapp\" });\r\n    state.whatsappLoginMessage = \"Logged out.\";\r\n    state.whatsappLoginQrDataUrl = null;\r\n    state.whatsappLoginConnected = null;\r\n  } catch (err) {\r\n    state.whatsappLoginMessage = String(err);\r\n  } finally {\r\n    state.whatsappBusy = false;\r\n  }\r\n}\r\n","import type { ConfigUiHints } from \"../types.ts\";\r\n\r\nexport type JsonSchema = {\r\n  type?: string | string[];\r\n  title?: string;\r\n  description?: string;\r\n  properties?: Record<string, JsonSchema>;\r\n  items?: JsonSchema | JsonSchema[];\r\n  additionalProperties?: JsonSchema | boolean;\r\n  enum?: unknown[];\r\n  const?: unknown;\r\n  default?: unknown;\r\n  anyOf?: JsonSchema[];\r\n  oneOf?: JsonSchema[];\r\n  allOf?: JsonSchema[];\r\n  nullable?: boolean;\r\n};\r\n\r\nexport function schemaType(schema: JsonSchema): string | undefined {\r\n  if (!schema) {\r\n    return undefined;\r\n  }\r\n  if (Array.isArray(schema.type)) {\r\n    const filtered = schema.type.filter((t) => t !== \"null\");\r\n    return filtered[0] ?? schema.type[0];\r\n  }\r\n  return schema.type;\r\n}\r\n\r\nexport function defaultValue(schema?: JsonSchema): unknown {\r\n  if (!schema) {\r\n    return \"\";\r\n  }\r\n  if (schema.default !== undefined) {\r\n    return schema.default;\r\n  }\r\n  const type = schemaType(schema);\r\n  switch (type) {\r\n    case \"object\":\r\n      return {};\r\n    case \"array\":\r\n      return [];\r\n    case \"boolean\":\r\n      return false;\r\n    case \"number\":\r\n    case \"integer\":\r\n      return 0;\r\n    case \"string\":\r\n      return \"\";\r\n    default:\r\n      return \"\";\r\n  }\r\n}\r\n\r\nexport function pathKey(path: Array<string | number>): string {\r\n  return path.filter((segment) => typeof segment === \"string\").join(\".\");\r\n}\r\n\r\nexport function hintForPath(path: Array<string | number>, hints: ConfigUiHints) {\r\n  const key = pathKey(path);\r\n  const direct = hints[key];\r\n  if (direct) {\r\n    return direct;\r\n  }\r\n  const segments = key.split(\".\");\r\n  for (const [hintKey, hint] of Object.entries(hints)) {\r\n    if (!hintKey.includes(\"*\")) {\r\n      continue;\r\n    }\r\n    const hintSegments = hintKey.split(\".\");\r\n    if (hintSegments.length !== segments.length) {\r\n      continue;\r\n    }\r\n    let match = true;\r\n    for (let i = 0; i < segments.length; i += 1) {\r\n      if (hintSegments[i] !== \"*\" && hintSegments[i] !== segments[i]) {\r\n        match = false;\r\n        break;\r\n      }\r\n    }\r\n    if (match) {\r\n      return hint;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function humanize(raw: string) {\r\n  return raw\r\n    .replace(/_/g, \" \")\r\n    .replace(/([a-z0-9])([A-Z])/g, \"$1 $2\")\r\n    .replace(/\\s+/g, \" \")\r\n    .replace(/^./, (m) => m.toUpperCase());\r\n}\r\n","import { schemaType, type JsonSchema } from \"../../views/config-form.shared.ts\";\r\n\r\nfunction coerceNumberString(value: string, integer: boolean): number | undefined | string {\r\n  const trimmed = value.trim();\r\n  if (trimmed === \"\") {\r\n    return undefined;\r\n  }\r\n  const parsed = Number(trimmed);\r\n  if (!Number.isFinite(parsed)) {\r\n    return value;\r\n  }\r\n  if (integer && !Number.isInteger(parsed)) {\r\n    return value;\r\n  }\r\n  return parsed;\r\n}\r\n\r\nfunction coerceBooleanString(value: string): boolean | string {\r\n  const trimmed = value.trim();\r\n  if (trimmed === \"true\") {\r\n    return true;\r\n  }\r\n  if (trimmed === \"false\") {\r\n    return false;\r\n  }\r\n  return value;\r\n}\r\n\r\n/**\r\n * Walk a form value tree alongside its JSON Schema and coerce string values\r\n * to their schema-defined types (number, boolean).\r\n *\r\n * HTML `<input>` elements always produce string `.value` properties.  Even\r\n * though the form rendering code converts values correctly for most paths,\r\n * some interactions (map-field repopulation, re-renders, paste, etc.) can\r\n * leak raw strings into the config form state.  This utility acts as a\r\n * safety net before serialization so that `config.set` always receives\r\n * correctly typed JSON.\r\n */\r\nexport function coerceFormValues(value: unknown, schema: JsonSchema): unknown {\r\n  if (value === null || value === undefined) {\r\n    return value;\r\n  }\r\n\r\n  if (schema.allOf && schema.allOf.length > 0) {\r\n    let next: unknown = value;\r\n    for (const segment of schema.allOf) {\r\n      next = coerceFormValues(next, segment);\r\n    }\r\n    return next;\r\n  }\r\n\r\n  const type = schemaType(schema);\r\n\r\n  // Handle anyOf/oneOf — try to match the value against a variant\r\n  if (schema.anyOf || schema.oneOf) {\r\n    const variants = (schema.anyOf ?? schema.oneOf ?? []).filter(\r\n      (v) => !(v.type === \"null\" || (Array.isArray(v.type) && v.type.includes(\"null\"))),\r\n    );\r\n\r\n    if (variants.length === 1) {\r\n      return coerceFormValues(value, variants[0]);\r\n    }\r\n\r\n    // Try number/boolean coercion for string values\r\n    if (typeof value === \"string\") {\r\n      for (const variant of variants) {\r\n        const variantType = schemaType(variant);\r\n        if (variantType === \"number\" || variantType === \"integer\") {\r\n          const coerced = coerceNumberString(value, variantType === \"integer\");\r\n          if (coerced === undefined || typeof coerced === \"number\") {\r\n            return coerced;\r\n          }\r\n        }\r\n        if (variantType === \"boolean\") {\r\n          const coerced = coerceBooleanString(value);\r\n          if (typeof coerced === \"boolean\") {\r\n            return coerced;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // For non-string values (objects, arrays), try to recurse into matching variant\r\n    for (const variant of variants) {\r\n      const variantType = schemaType(variant);\r\n      if (variantType === \"object\" && typeof value === \"object\" && !Array.isArray(value)) {\r\n        return coerceFormValues(value, variant);\r\n      }\r\n      if (variantType === \"array\" && Array.isArray(value)) {\r\n        return coerceFormValues(value, variant);\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  if (type === \"number\" || type === \"integer\") {\r\n    if (typeof value === \"string\") {\r\n      const coerced = coerceNumberString(value, type === \"integer\");\r\n      if (coerced === undefined || typeof coerced === \"number\") {\r\n        return coerced;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n\r\n  if (type === \"boolean\") {\r\n    if (typeof value === \"string\") {\r\n      const coerced = coerceBooleanString(value);\r\n      if (typeof coerced === \"boolean\") {\r\n        return coerced;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n\r\n  if (type === \"object\") {\r\n    if (typeof value !== \"object\" || Array.isArray(value)) {\r\n      return value;\r\n    }\r\n    const obj = value as Record<string, unknown>;\r\n    const props = schema.properties ?? {};\r\n    const additional =\r\n      schema.additionalProperties && typeof schema.additionalProperties === \"object\"\r\n        ? schema.additionalProperties\r\n        : null;\r\n    const result: Record<string, unknown> = {};\r\n    for (const [key, val] of Object.entries(obj)) {\r\n      const propSchema = props[key] ?? additional;\r\n      const coerced = propSchema ? coerceFormValues(val, propSchema) : val;\r\n      // Omit undefined — \"clear field = unset\" for optional properties\r\n      if (coerced !== undefined) {\r\n        result[key] = coerced;\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  if (type === \"array\") {\r\n    if (!Array.isArray(value)) {\r\n      return value;\r\n    }\r\n    if (Array.isArray(schema.items)) {\r\n      // Tuple form: each index has its own schema\r\n      const tuple = schema.items;\r\n      return value.map((item, i) => {\r\n        const s = i < tuple.length ? tuple[i] : undefined;\r\n        return s ? coerceFormValues(item, s) : item;\r\n      });\r\n    }\r\n    const itemsSchema = schema.items;\r\n    if (!itemsSchema) {\r\n      return value;\r\n    }\r\n    return value.map((item) => coerceFormValues(item, itemsSchema)).filter((v) => v !== undefined);\r\n  }\r\n\r\n  return value;\r\n}\r\n","export function cloneConfigObject<T>(value: T): T {\r\n  if (typeof structuredClone === \"function\") {\r\n    return structuredClone(value);\r\n  }\r\n  return JSON.parse(JSON.stringify(value)) as T;\r\n}\r\n\r\nexport function serializeConfigForm(form: Record<string, unknown>): string {\r\n  return `${JSON.stringify(form, null, 2).trimEnd()}\\n`;\r\n}\r\n\r\nexport function setPathValue(\r\n  obj: Record<string, unknown> | unknown[],\r\n  path: Array<string | number>,\r\n  value: unknown,\r\n) {\r\n  if (path.length === 0) {\r\n    return;\r\n  }\r\n  let current: Record<string, unknown> | unknown[] = obj;\r\n  for (let i = 0; i < path.length - 1; i += 1) {\r\n    const key = path[i];\r\n    const nextKey = path[i + 1];\r\n    if (typeof key === \"number\") {\r\n      if (!Array.isArray(current)) {\r\n        return;\r\n      }\r\n      if (current[key] == null) {\r\n        current[key] = typeof nextKey === \"number\" ? [] : ({} as Record<string, unknown>);\r\n      }\r\n      current = current[key] as Record<string, unknown> | unknown[];\r\n    } else {\r\n      if (typeof current !== \"object\" || current == null) {\r\n        return;\r\n      }\r\n      const record = current as Record<string, unknown>;\r\n      if (record[key] == null) {\r\n        record[key] = typeof nextKey === \"number\" ? [] : ({} as Record<string, unknown>);\r\n      }\r\n      current = record[key] as Record<string, unknown> | unknown[];\r\n    }\r\n  }\r\n  const lastKey = path[path.length - 1];\r\n  if (typeof lastKey === \"number\") {\r\n    if (Array.isArray(current)) {\r\n      current[lastKey] = value;\r\n    }\r\n    return;\r\n  }\r\n  if (typeof current === \"object\" && current != null) {\r\n    (current as Record<string, unknown>)[lastKey] = value;\r\n  }\r\n}\r\n\r\nexport function removePathValue(\r\n  obj: Record<string, unknown> | unknown[],\r\n  path: Array<string | number>,\r\n) {\r\n  if (path.length === 0) {\r\n    return;\r\n  }\r\n  let current: Record<string, unknown> | unknown[] = obj;\r\n  for (let i = 0; i < path.length - 1; i += 1) {\r\n    const key = path[i];\r\n    if (typeof key === \"number\") {\r\n      if (!Array.isArray(current)) {\r\n        return;\r\n      }\r\n      current = current[key] as Record<string, unknown> | unknown[];\r\n    } else {\r\n      if (typeof current !== \"object\" || current == null) {\r\n        return;\r\n      }\r\n      current = (current as Record<string, unknown>)[key] as Record<string, unknown> | unknown[];\r\n    }\r\n    if (current == null) {\r\n      return;\r\n    }\r\n  }\r\n  const lastKey = path[path.length - 1];\r\n  if (typeof lastKey === \"number\") {\r\n    if (Array.isArray(current)) {\r\n      current.splice(lastKey, 1);\r\n    }\r\n    return;\r\n  }\r\n  if (typeof current === \"object\" && current != null) {\r\n    delete (current as Record<string, unknown>)[lastKey];\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { ConfigSchemaResponse, ConfigSnapshot, ConfigUiHints } from \"../types.ts\";\r\nimport type { JsonSchema } from \"../views/config-form.shared.ts\";\r\nimport { coerceFormValues } from \"./config/form-coerce.ts\";\r\nimport {\r\n  cloneConfigObject,\r\n  removePathValue,\r\n  serializeConfigForm,\r\n  setPathValue,\r\n} from \"./config/form-utils.ts\";\r\n\r\nexport type ConfigState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  applySessionKey: string;\r\n  configLoading: boolean;\r\n  configRaw: string;\r\n  configRawOriginal: string;\r\n  configValid: boolean | null;\r\n  configIssues: unknown[];\r\n  configSaving: boolean;\r\n  configApplying: boolean;\r\n  updateRunning: boolean;\r\n  configSnapshot: ConfigSnapshot | null;\r\n  configSchema: unknown;\r\n  configSchemaVersion: string | null;\r\n  configSchemaLoading: boolean;\r\n  configUiHints: ConfigUiHints;\r\n  configForm: Record<string, unknown> | null;\r\n  configFormOriginal: Record<string, unknown> | null;\r\n  configFormDirty: boolean;\r\n  configFormMode: \"form\" | \"raw\";\r\n  configSearchQuery: string;\r\n  configActiveSection: string | null;\r\n  configActiveSubsection: string | null;\r\n  lastError: string | null;\r\n};\r\n\r\nexport async function loadConfig(state: ConfigState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.configLoading = true;\r\n  state.lastError = null;\r\n  try {\r\n    const res = await state.client.request<ConfigSnapshot>(\"config.get\", {});\r\n    applyConfigSnapshot(state, res);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.configLoading = false;\r\n  }\r\n}\r\n\r\nexport async function loadConfigSchema(state: ConfigState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.configSchemaLoading) {\r\n    return;\r\n  }\r\n  state.configSchemaLoading = true;\r\n  try {\r\n    const res = await state.client.request<ConfigSchemaResponse>(\"config.schema\", {});\r\n    applyConfigSchema(state, res);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.configSchemaLoading = false;\r\n  }\r\n}\r\n\r\nexport function applyConfigSchema(state: ConfigState, res: ConfigSchemaResponse) {\r\n  state.configSchema = res.schema ?? null;\r\n  state.configUiHints = res.uiHints ?? {};\r\n  state.configSchemaVersion = res.version ?? null;\r\n}\r\n\r\nexport function applyConfigSnapshot(state: ConfigState, snapshot: ConfigSnapshot) {\r\n  state.configSnapshot = snapshot;\r\n  const rawFromSnapshot =\r\n    typeof snapshot.raw === \"string\"\r\n      ? snapshot.raw\r\n      : snapshot.config && typeof snapshot.config === \"object\"\r\n        ? serializeConfigForm(snapshot.config)\r\n        : state.configRaw;\r\n  if (!state.configFormDirty || state.configFormMode === \"raw\") {\r\n    state.configRaw = rawFromSnapshot;\r\n  } else if (state.configForm) {\r\n    state.configRaw = serializeConfigForm(state.configForm);\r\n  } else {\r\n    state.configRaw = rawFromSnapshot;\r\n  }\r\n  state.configValid = typeof snapshot.valid === \"boolean\" ? snapshot.valid : null;\r\n  state.configIssues = Array.isArray(snapshot.issues) ? snapshot.issues : [];\r\n\r\n  if (!state.configFormDirty) {\r\n    state.configForm = cloneConfigObject(snapshot.config ?? {});\r\n    state.configFormOriginal = cloneConfigObject(snapshot.config ?? {});\r\n    state.configRawOriginal = rawFromSnapshot;\r\n  }\r\n}\r\n\r\nfunction asJsonSchema(value: unknown): JsonSchema | null {\r\n  if (!value || typeof value !== \"object\" || Array.isArray(value)) {\r\n    return null;\r\n  }\r\n  return value as JsonSchema;\r\n}\r\n\r\n/**\r\n * Serialize the form state for submission to `config.set` / `config.apply`.\r\n *\r\n * HTML `<input>` elements produce string `.value` properties, so numeric and\r\n * boolean config fields can leak into `configForm` as strings.  We coerce\r\n * them back to their schema-defined types before JSON serialization so the\r\n * gateway's Zod validation always sees correctly typed values.\r\n */\r\nfunction serializeFormForSubmit(state: ConfigState): string {\r\n  if (state.configFormMode !== \"form\" || !state.configForm) {\r\n    return state.configRaw;\r\n  }\r\n  const schema = asJsonSchema(state.configSchema);\r\n  const form = schema\r\n    ? (coerceFormValues(state.configForm, schema) as Record<string, unknown>)\r\n    : state.configForm;\r\n  return serializeConfigForm(form);\r\n}\r\n\r\nexport async function saveConfig(state: ConfigState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.configSaving = true;\r\n  state.lastError = null;\r\n  try {\r\n    const raw = serializeFormForSubmit(state);\r\n    const baseHash = state.configSnapshot?.hash;\r\n    if (!baseHash) {\r\n      state.lastError = \"Config hash missing; reload and retry.\";\r\n      return;\r\n    }\r\n    await state.client.request(\"config.set\", { raw, baseHash });\r\n    state.configFormDirty = false;\r\n    await loadConfig(state);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.configSaving = false;\r\n  }\r\n}\r\n\r\nexport async function applyConfig(state: ConfigState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.configApplying = true;\r\n  state.lastError = null;\r\n  try {\r\n    const raw = serializeFormForSubmit(state);\r\n    const baseHash = state.configSnapshot?.hash;\r\n    if (!baseHash) {\r\n      state.lastError = \"Config hash missing; reload and retry.\";\r\n      return;\r\n    }\r\n    await state.client.request(\"config.apply\", {\r\n      raw,\r\n      baseHash,\r\n      sessionKey: state.applySessionKey,\r\n    });\r\n    state.configFormDirty = false;\r\n    await loadConfig(state);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.configApplying = false;\r\n  }\r\n}\r\n\r\nexport async function runUpdate(state: ConfigState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.updateRunning = true;\r\n  state.lastError = null;\r\n  try {\r\n    await state.client.request(\"update.run\", {\r\n      sessionKey: state.applySessionKey,\r\n    });\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.updateRunning = false;\r\n  }\r\n}\r\n\r\nexport function updateConfigFormValue(\r\n  state: ConfigState,\r\n  path: Array<string | number>,\r\n  value: unknown,\r\n) {\r\n  const base = cloneConfigObject(state.configForm ?? state.configSnapshot?.config ?? {});\r\n  setPathValue(base, path, value);\r\n  state.configForm = base;\r\n  state.configFormDirty = true;\r\n  if (state.configFormMode === \"form\") {\r\n    state.configRaw = serializeConfigForm(base);\r\n  }\r\n}\r\n\r\nexport function removeConfigFormValue(state: ConfigState, path: Array<string | number>) {\r\n  const base = cloneConfigObject(state.configForm ?? state.configSnapshot?.config ?? {});\r\n  removePathValue(base, path);\r\n  state.configForm = base;\r\n  state.configFormDirty = true;\r\n  if (state.configFormMode === \"form\") {\r\n    state.configRaw = serializeConfigForm(base);\r\n  }\r\n}\r\n","/**\r\n * Nostr Profile Edit Form\r\n *\r\n * Provides UI for editing and publishing Nostr profile (kind:0).\r\n */\r\n\r\nimport { html, nothing, type TemplateResult } from \"lit\";\r\nimport type { NostrProfile as NostrProfileType } from \"../types.ts\";\r\n\r\n// ============================================================================\r\n// Types\r\n// ============================================================================\r\n\r\nexport interface NostrProfileFormState {\r\n  /** Current form values */\r\n  values: NostrProfileType;\r\n  /** Original values for dirty detection */\r\n  original: NostrProfileType;\r\n  /** Whether the form is currently submitting */\r\n  saving: boolean;\r\n  /** Whether import is in progress */\r\n  importing: boolean;\r\n  /** Last error message */\r\n  error: string | null;\r\n  /** Last success message */\r\n  success: string | null;\r\n  /** Validation errors per field */\r\n  fieldErrors: Record<string, string>;\r\n  /** Whether to show advanced fields */\r\n  showAdvanced: boolean;\r\n}\r\n\r\nexport interface NostrProfileFormCallbacks {\r\n  /** Called when a field value changes */\r\n  onFieldChange: (field: keyof NostrProfileType, value: string) => void;\r\n  /** Called when save is clicked */\r\n  onSave: () => void;\r\n  /** Called when import is clicked */\r\n  onImport: () => void;\r\n  /** Called when cancel is clicked */\r\n  onCancel: () => void;\r\n  /** Called when toggle advanced is clicked */\r\n  onToggleAdvanced: () => void;\r\n}\r\n\r\n// ============================================================================\r\n// Helpers\r\n// ============================================================================\r\n\r\nfunction isFormDirty(state: NostrProfileFormState): boolean {\r\n  const { values, original } = state;\r\n  return (\r\n    values.name !== original.name ||\r\n    values.displayName !== original.displayName ||\r\n    values.about !== original.about ||\r\n    values.picture !== original.picture ||\r\n    values.banner !== original.banner ||\r\n    values.website !== original.website ||\r\n    values.nip05 !== original.nip05 ||\r\n    values.lud16 !== original.lud16\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// Form Rendering\r\n// ============================================================================\r\n\r\nexport function renderNostrProfileForm(params: {\r\n  state: NostrProfileFormState;\r\n  callbacks: NostrProfileFormCallbacks;\r\n  accountId: string;\r\n}): TemplateResult {\r\n  const { state, callbacks, accountId } = params;\r\n  const isDirty = isFormDirty(state);\r\n\r\n  const renderField = (\r\n    field: keyof NostrProfileType,\r\n    label: string,\r\n    opts: {\r\n      type?: \"text\" | \"url\" | \"textarea\";\r\n      placeholder?: string;\r\n      maxLength?: number;\r\n      help?: string;\r\n    } = {},\r\n  ) => {\r\n    const { type = \"text\", placeholder, maxLength, help } = opts;\r\n    const value = state.values[field] ?? \"\";\r\n    const error = state.fieldErrors[field];\r\n\r\n    const inputId = `nostr-profile-${field}`;\r\n\r\n    if (type === \"textarea\") {\r\n      return html`\r\n        <div class=\"form-field\" style=\"margin-bottom: 12px;\">\r\n          <label for=\"${inputId}\" style=\"display: block; margin-bottom: 4px; font-weight: 500;\">\r\n            ${label}\r\n          </label>\r\n          <textarea\r\n            id=\"${inputId}\"\r\n            .value=${value}\r\n            placeholder=${placeholder ?? \"\"}\r\n            maxlength=${maxLength ?? 2000}\r\n            rows=\"3\"\r\n            style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; font-family: inherit;\"\r\n            @input=${(e: InputEvent) => {\r\n              const target = e.target as HTMLTextAreaElement;\r\n              callbacks.onFieldChange(field, target.value);\r\n            }}\r\n            ?disabled=${state.saving}\r\n          ></textarea>\r\n          ${help ? html`<div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px;\">${help}</div>` : nothing}\r\n          ${error ? html`<div style=\"font-size: 12px; color: var(--danger-color); margin-top: 2px;\">${error}</div>` : nothing}\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    return html`\r\n      <div class=\"form-field\" style=\"margin-bottom: 12px;\">\r\n        <label for=\"${inputId}\" style=\"display: block; margin-bottom: 4px; font-weight: 500;\">\r\n          ${label}\r\n        </label>\r\n        <input\r\n          id=\"${inputId}\"\r\n          type=${type}\r\n          .value=${value}\r\n          placeholder=${placeholder ?? \"\"}\r\n          maxlength=${maxLength ?? 256}\r\n          style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;\"\r\n          @input=${(e: InputEvent) => {\r\n            const target = e.target as HTMLInputElement;\r\n            callbacks.onFieldChange(field, target.value);\r\n          }}\r\n          ?disabled=${state.saving}\r\n        />\r\n        ${help ? html`<div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px;\">${help}</div>` : nothing}\r\n        ${error ? html`<div style=\"font-size: 12px; color: var(--danger-color); margin-top: 2px;\">${error}</div>` : nothing}\r\n      </div>\r\n    `;\r\n  };\r\n\r\n  const renderPicturePreview = () => {\r\n    const picture = state.values.picture;\r\n    if (!picture) {\r\n      return nothing;\r\n    }\r\n\r\n    return html`\r\n      <div style=\"margin-bottom: 12px;\">\r\n        <img\r\n          src=${picture}\r\n          alt=\"Profile picture preview\"\r\n          style=\"max-width: 80px; max-height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color);\"\r\n          @error=${(e: Event) => {\r\n            const img = e.target as HTMLImageElement;\r\n            img.style.display = \"none\";\r\n          }}\r\n          @load=${(e: Event) => {\r\n            const img = e.target as HTMLImageElement;\r\n            img.style.display = \"block\";\r\n          }}\r\n        />\r\n      </div>\r\n    `;\r\n  };\r\n\r\n  return html`\r\n    <div class=\"nostr-profile-form\" style=\"padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-top: 12px;\">\r\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n        <div style=\"font-weight: 600; font-size: 16px;\">Edit Profile</div>\r\n        <div style=\"font-size: 12px; color: var(--text-muted);\">Account: ${accountId}</div>\r\n      </div>\r\n\r\n      ${\r\n        state.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-bottom: 12px;\">${state.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        state.success\r\n          ? html`<div class=\"callout success\" style=\"margin-bottom: 12px;\">${state.success}</div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderPicturePreview()}\r\n\r\n      ${renderField(\"name\", \"Username\", {\r\n        placeholder: \"satoshi\",\r\n        maxLength: 256,\r\n        help: \"Short username (e.g., satoshi)\",\r\n      })}\r\n\r\n      ${renderField(\"displayName\", \"Display Name\", {\r\n        placeholder: \"Satoshi Nakamoto\",\r\n        maxLength: 256,\r\n        help: \"Your full display name\",\r\n      })}\r\n\r\n      ${renderField(\"about\", \"Bio\", {\r\n        type: \"textarea\",\r\n        placeholder: \"Tell people about yourself...\",\r\n        maxLength: 2000,\r\n        help: \"A brief bio or description\",\r\n      })}\r\n\r\n      ${renderField(\"picture\", \"Avatar URL\", {\r\n        type: \"url\",\r\n        placeholder: \"https://example.com/avatar.jpg\",\r\n        help: \"HTTPS URL to your profile picture\",\r\n      })}\r\n\r\n      ${\r\n        state.showAdvanced\r\n          ? html`\r\n            <div style=\"border-top: 1px solid var(--border-color); padding-top: 12px; margin-top: 12px;\">\r\n              <div style=\"font-weight: 500; margin-bottom: 12px; color: var(--text-muted);\">Advanced</div>\r\n\r\n              ${renderField(\"banner\", \"Banner URL\", {\r\n                type: \"url\",\r\n                placeholder: \"https://example.com/banner.jpg\",\r\n                help: \"HTTPS URL to a banner image\",\r\n              })}\r\n\r\n              ${renderField(\"website\", \"Website\", {\r\n                type: \"url\",\r\n                placeholder: \"https://example.com\",\r\n                help: \"Your personal website\",\r\n              })}\r\n\r\n              ${renderField(\"nip05\", \"NIP-05 Identifier\", {\r\n                placeholder: \"you@example.com\",\r\n                help: \"Verifiable identifier (e.g., you@domain.com)\",\r\n              })}\r\n\r\n              ${renderField(\"lud16\", \"Lightning Address\", {\r\n                placeholder: \"you@getalby.com\",\r\n                help: \"Lightning address for tips (LUD-16)\",\r\n              })}\r\n            </div>\r\n          `\r\n          : nothing\r\n      }\r\n\r\n      <div style=\"display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;\">\r\n        <button\r\n          class=\"btn primary\"\r\n          @click=${callbacks.onSave}\r\n          ?disabled=${state.saving || !isDirty}\r\n        >\r\n          ${state.saving ? \"Saving...\" : \"Save & Publish\"}\r\n        </button>\r\n\r\n        <button\r\n          class=\"btn\"\r\n          @click=${callbacks.onImport}\r\n          ?disabled=${state.importing || state.saving}\r\n        >\r\n          ${state.importing ? \"Importing...\" : \"Import from Relays\"}\r\n        </button>\r\n\r\n        <button\r\n          class=\"btn\"\r\n          @click=${callbacks.onToggleAdvanced}\r\n        >\r\n          ${state.showAdvanced ? \"Hide Advanced\" : \"Show Advanced\"}\r\n        </button>\r\n\r\n        <button\r\n          class=\"btn\"\r\n          @click=${callbacks.onCancel}\r\n          ?disabled=${state.saving}\r\n        >\r\n          Cancel\r\n        </button>\r\n      </div>\r\n\r\n      ${\r\n        isDirty\r\n          ? html`\r\n              <div style=\"font-size: 12px; color: var(--warning-color); margin-top: 8px\">\r\n                You have unsaved changes\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\n// ============================================================================\r\n// Factory\r\n// ============================================================================\r\n\r\n/**\r\n * Create initial form state from existing profile\r\n */\r\nexport function createNostrProfileFormState(\r\n  profile: NostrProfileType | undefined,\r\n): NostrProfileFormState {\r\n  const values: NostrProfileType = {\r\n    name: profile?.name ?? \"\",\r\n    displayName: profile?.displayName ?? \"\",\r\n    about: profile?.about ?? \"\",\r\n    picture: profile?.picture ?? \"\",\r\n    banner: profile?.banner ?? \"\",\r\n    website: profile?.website ?? \"\",\r\n    nip05: profile?.nip05 ?? \"\",\r\n    lud16: profile?.lud16 ?? \"\",\r\n  };\r\n\r\n  return {\r\n    values,\r\n    original: { ...values },\r\n    saving: false,\r\n    importing: false,\r\n    error: null,\r\n    success: null,\r\n    fieldErrors: {},\r\n    showAdvanced: Boolean(profile?.banner || profile?.website || profile?.nip05 || profile?.lud16),\r\n  };\r\n}\r\n","import type { OpenClawApp } from \"./app.ts\";\r\nimport type { NostrProfile } from \"./types.ts\";\r\nimport {\r\n  loadChannels,\r\n  logoutWhatsApp,\r\n  startWhatsAppLogin,\r\n  waitWhatsAppLogin,\r\n} from \"./controllers/channels.ts\";\r\nimport { loadConfig, saveConfig } from \"./controllers/config.ts\";\r\nimport { createNostrProfileFormState } from \"./views/channels.nostr-profile-form.ts\";\r\n\r\nexport async function handleWhatsAppStart(host: OpenClawApp, force: boolean) {\r\n  await startWhatsAppLogin(host, force);\r\n  await loadChannels(host, true);\r\n}\r\n\r\nexport async function handleWhatsAppWait(host: OpenClawApp) {\r\n  await waitWhatsAppLogin(host);\r\n  await loadChannels(host, true);\r\n}\r\n\r\nexport async function handleWhatsAppLogout(host: OpenClawApp) {\r\n  await logoutWhatsApp(host);\r\n  await loadChannels(host, true);\r\n}\r\n\r\nexport async function handleChannelConfigSave(host: OpenClawApp) {\r\n  await saveConfig(host);\r\n  await loadConfig(host);\r\n  await loadChannels(host, true);\r\n}\r\n\r\nexport async function handleChannelConfigReload(host: OpenClawApp) {\r\n  await loadConfig(host);\r\n  await loadChannels(host, true);\r\n}\r\n\r\nfunction parseValidationErrors(details: unknown): Record<string, string> {\r\n  if (!Array.isArray(details)) {\r\n    return {};\r\n  }\r\n  const errors: Record<string, string> = {};\r\n  for (const entry of details) {\r\n    if (typeof entry !== \"string\") {\r\n      continue;\r\n    }\r\n    const [rawField, ...rest] = entry.split(\":\");\r\n    if (!rawField || rest.length === 0) {\r\n      continue;\r\n    }\r\n    const field = rawField.trim();\r\n    const message = rest.join(\":\").trim();\r\n    if (field && message) {\r\n      errors[field] = message;\r\n    }\r\n  }\r\n  return errors;\r\n}\r\n\r\nfunction resolveNostrAccountId(host: OpenClawApp): string {\r\n  const accounts = host.channelsSnapshot?.channelAccounts?.nostr ?? [];\r\n  return accounts[0]?.accountId ?? host.nostrProfileAccountId ?? \"default\";\r\n}\r\n\r\nfunction buildNostrProfileUrl(accountId: string, suffix = \"\"): string {\r\n  return `/api/channels/nostr/${encodeURIComponent(accountId)}/profile${suffix}`;\r\n}\r\n\r\nfunction resolveGatewayHttpAuthHeader(host: OpenClawApp): string | null {\r\n  const deviceToken = host.hello?.auth?.deviceToken?.trim();\r\n  if (deviceToken) {\r\n    return `Bearer ${deviceToken}`;\r\n  }\r\n  const token = host.settings.token.trim();\r\n  if (token) {\r\n    return `Bearer ${token}`;\r\n  }\r\n  const password = host.password.trim();\r\n  if (password) {\r\n    return `Bearer ${password}`;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction buildGatewayHttpHeaders(host: OpenClawApp): Record<string, string> {\r\n  const authorization = resolveGatewayHttpAuthHeader(host);\r\n  return authorization ? { Authorization: authorization } : {};\r\n}\r\n\r\nexport function handleNostrProfileEdit(\r\n  host: OpenClawApp,\r\n  accountId: string,\r\n  profile: NostrProfile | null,\r\n) {\r\n  host.nostrProfileAccountId = accountId;\r\n  host.nostrProfileFormState = createNostrProfileFormState(profile ?? undefined);\r\n}\r\n\r\nexport function handleNostrProfileCancel(host: OpenClawApp) {\r\n  host.nostrProfileFormState = null;\r\n  host.nostrProfileAccountId = null;\r\n}\r\n\r\nexport function handleNostrProfileFieldChange(\r\n  host: OpenClawApp,\r\n  field: keyof NostrProfile,\r\n  value: string,\r\n) {\r\n  const state = host.nostrProfileFormState;\r\n  if (!state) {\r\n    return;\r\n  }\r\n  host.nostrProfileFormState = {\r\n    ...state,\r\n    values: {\r\n      ...state.values,\r\n      [field]: value,\r\n    },\r\n    fieldErrors: {\r\n      ...state.fieldErrors,\r\n      [field]: \"\",\r\n    },\r\n  };\r\n}\r\n\r\nexport function handleNostrProfileToggleAdvanced(host: OpenClawApp) {\r\n  const state = host.nostrProfileFormState;\r\n  if (!state) {\r\n    return;\r\n  }\r\n  host.nostrProfileFormState = {\r\n    ...state,\r\n    showAdvanced: !state.showAdvanced,\r\n  };\r\n}\r\n\r\nexport async function handleNostrProfileSave(host: OpenClawApp) {\r\n  const state = host.nostrProfileFormState;\r\n  if (!state || state.saving) {\r\n    return;\r\n  }\r\n  const accountId = resolveNostrAccountId(host);\r\n\r\n  host.nostrProfileFormState = {\r\n    ...state,\r\n    saving: true,\r\n    error: null,\r\n    success: null,\r\n    fieldErrors: {},\r\n  };\r\n\r\n  try {\r\n    const response = await fetch(buildNostrProfileUrl(accountId), {\r\n      method: \"PUT\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...buildGatewayHttpHeaders(host),\r\n      },\r\n      body: JSON.stringify(state.values),\r\n    });\r\n    const data = (await response.json().catch(() => null)) as {\r\n      ok?: boolean;\r\n      error?: string;\r\n      details?: unknown;\r\n      persisted?: boolean;\r\n    } | null;\r\n\r\n    if (!response.ok || data?.ok === false || !data) {\r\n      const errorMessage = data?.error ?? `Profile update failed (${response.status})`;\r\n      host.nostrProfileFormState = {\r\n        ...state,\r\n        saving: false,\r\n        error: errorMessage,\r\n        success: null,\r\n        fieldErrors: parseValidationErrors(data?.details),\r\n      };\r\n      return;\r\n    }\r\n\r\n    if (!data.persisted) {\r\n      host.nostrProfileFormState = {\r\n        ...state,\r\n        saving: false,\r\n        error: \"Profile publish failed on all relays.\",\r\n        success: null,\r\n      };\r\n      return;\r\n    }\r\n\r\n    host.nostrProfileFormState = {\r\n      ...state,\r\n      saving: false,\r\n      error: null,\r\n      success: \"Profile published to relays.\",\r\n      fieldErrors: {},\r\n      original: { ...state.values },\r\n    };\r\n    await loadChannels(host, true);\r\n  } catch (err) {\r\n    host.nostrProfileFormState = {\r\n      ...state,\r\n      saving: false,\r\n      error: `Profile update failed: ${String(err)}`,\r\n      success: null,\r\n    };\r\n  }\r\n}\r\n\r\nexport async function handleNostrProfileImport(host: OpenClawApp) {\r\n  const state = host.nostrProfileFormState;\r\n  if (!state || state.importing) {\r\n    return;\r\n  }\r\n  const accountId = resolveNostrAccountId(host);\r\n\r\n  host.nostrProfileFormState = {\r\n    ...state,\r\n    importing: true,\r\n    error: null,\r\n    success: null,\r\n  };\r\n\r\n  try {\r\n    const response = await fetch(buildNostrProfileUrl(accountId, \"/import\"), {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...buildGatewayHttpHeaders(host),\r\n      },\r\n      body: JSON.stringify({ autoMerge: true }),\r\n    });\r\n    const data = (await response.json().catch(() => null)) as {\r\n      ok?: boolean;\r\n      error?: string;\r\n      imported?: NostrProfile;\r\n      merged?: NostrProfile;\r\n      saved?: boolean;\r\n    } | null;\r\n\r\n    if (!response.ok || data?.ok === false || !data) {\r\n      const errorMessage = data?.error ?? `Profile import failed (${response.status})`;\r\n      host.nostrProfileFormState = {\r\n        ...state,\r\n        importing: false,\r\n        error: errorMessage,\r\n        success: null,\r\n      };\r\n      return;\r\n    }\r\n\r\n    const merged = data.merged ?? data.imported ?? null;\r\n    const nextValues = merged ? { ...state.values, ...merged } : state.values;\r\n    const showAdvanced = Boolean(\r\n      nextValues.banner || nextValues.website || nextValues.nip05 || nextValues.lud16,\r\n    );\r\n\r\n    host.nostrProfileFormState = {\r\n      ...state,\r\n      importing: false,\r\n      values: nextValues,\r\n      error: null,\r\n      success: data.saved\r\n        ? \"Profile imported from relays. Review and publish.\"\r\n        : \"Profile imported. Review and publish.\",\r\n      showAdvanced,\r\n    };\r\n\r\n    if (data.saved) {\r\n      await loadChannels(host, true);\r\n    }\r\n  } catch (err) {\r\n    host.nostrProfileFormState = {\r\n      ...state,\r\n      importing: false,\r\n      error: `Profile import failed: ${String(err)}`,\r\n      success: null,\r\n    };\r\n  }\r\n}\r\n","export type ParsedAgentSessionKey = {\n  agentId: string;\n  rest: string;\n};\n\nexport function parseAgentSessionKey(\n  sessionKey: string | undefined | null,\n): ParsedAgentSessionKey | null {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return null;\n  }\n  const parts = raw.split(\":\").filter(Boolean);\n  if (parts.length < 3) {\n    return null;\n  }\n  if (parts[0] !== \"agent\") {\n    return null;\n  }\n  const agentId = parts[1]?.trim();\n  const rest = parts.slice(2).join(\":\");\n  if (!agentId || !rest) {\n    return null;\n  }\n  return { agentId, rest };\n}\n\nexport function isCronRunSessionKey(sessionKey: string | undefined | null): boolean {\n  const parsed = parseAgentSessionKey(sessionKey);\n  if (!parsed) {\n    return false;\n  }\n  return /^cron:[^:]+:run:[^:]+$/.test(parsed.rest);\n}\n\nexport function isCronSessionKey(sessionKey: string | undefined | null): boolean {\n  const parsed = parseAgentSessionKey(sessionKey);\n  if (!parsed) {\n    return false;\n  }\n  return parsed.rest.toLowerCase().startsWith(\"cron:\");\n}\n\nexport function isSubagentSessionKey(sessionKey: string | undefined | null): boolean {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return false;\n  }\n  if (raw.toLowerCase().startsWith(\"subagent:\")) {\n    return true;\n  }\n  const parsed = parseAgentSessionKey(raw);\n  return Boolean((parsed?.rest ?? \"\").toLowerCase().startsWith(\"subagent:\"));\n}\n\nexport function getSubagentDepth(sessionKey: string | undefined | null): number {\n  const raw = (sessionKey ?? \"\").trim().toLowerCase();\n  if (!raw) {\n    return 0;\n  }\n  return raw.split(\":subagent:\").length - 1;\n}\n\nexport function isAcpSessionKey(sessionKey: string | undefined | null): boolean {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return false;\n  }\n  const normalized = raw.toLowerCase();\n  if (normalized.startsWith(\"acp:\")) {\n    return true;\n  }\n  const parsed = parseAgentSessionKey(raw);\n  return Boolean((parsed?.rest ?? \"\").toLowerCase().startsWith(\"acp:\"));\n}\n\nconst THREAD_SESSION_MARKERS = [\":thread:\", \":topic:\"];\n\nexport function resolveThreadParentSessionKey(\n  sessionKey: string | undefined | null,\n): string | null {\n  const raw = (sessionKey ?? \"\").trim();\n  if (!raw) {\n    return null;\n  }\n  const normalized = raw.toLowerCase();\n  let idx = -1;\n  for (const marker of THREAD_SESSION_MARKERS) {\n    const candidate = normalized.lastIndexOf(marker);\n    if (candidate > idx) {\n      idx = candidate;\n    }\n  }\n  if (idx <= 0) {\n    return null;\n  }\n  const parent = raw.slice(0, idx).trim();\n  return parent ? parent : null;\n}\n","/** Distance (px) from the bottom within which we consider the user \"near bottom\". */\r\nconst NEAR_BOTTOM_THRESHOLD = 450;\r\n\r\ntype ScrollHost = {\r\n  updateComplete: Promise<unknown>;\r\n  querySelector: (selectors: string) => Element | null;\r\n  style: CSSStyleDeclaration;\r\n  chatScrollFrame: number | null;\r\n  chatScrollTimeout: number | null;\r\n  chatHasAutoScrolled: boolean;\r\n  chatUserNearBottom: boolean;\r\n  chatNewMessagesBelow: boolean;\r\n  logsScrollFrame: number | null;\r\n  logsAtBottom: boolean;\r\n  topbarObserver: ResizeObserver | null;\r\n};\r\n\r\nexport function scheduleChatScroll(host: ScrollHost, force = false, smooth = false) {\r\n  if (host.chatScrollFrame) {\r\n    cancelAnimationFrame(host.chatScrollFrame);\r\n  }\r\n  if (host.chatScrollTimeout != null) {\r\n    clearTimeout(host.chatScrollTimeout);\r\n    host.chatScrollTimeout = null;\r\n  }\r\n  const pickScrollTarget = () => {\r\n    const container = host.querySelector(\".chat-thread\") as HTMLElement | null;\r\n    if (container) {\r\n      const overflowY = getComputedStyle(container).overflowY;\r\n      const canScroll =\r\n        overflowY === \"auto\" ||\r\n        overflowY === \"scroll\" ||\r\n        container.scrollHeight - container.clientHeight > 1;\r\n      if (canScroll) {\r\n        return container;\r\n      }\r\n    }\r\n    return (document.scrollingElement ?? document.documentElement) as HTMLElement | null;\r\n  };\r\n  // Wait for Lit render to complete, then scroll\r\n  void host.updateComplete.then(() => {\r\n    host.chatScrollFrame = requestAnimationFrame(() => {\r\n      host.chatScrollFrame = null;\r\n      const target = pickScrollTarget();\r\n      if (!target) {\r\n        return;\r\n      }\r\n      const distanceFromBottom = target.scrollHeight - target.scrollTop - target.clientHeight;\r\n\r\n      // force=true only overrides when we haven't auto-scrolled yet (initial load).\r\n      // After initial load, respect the user's scroll position.\r\n      const effectiveForce = force && !host.chatHasAutoScrolled;\r\n      const shouldStick =\r\n        effectiveForce || host.chatUserNearBottom || distanceFromBottom < NEAR_BOTTOM_THRESHOLD;\r\n\r\n      if (!shouldStick) {\r\n        // User is scrolled up — flag that new content arrived below.\r\n        host.chatNewMessagesBelow = true;\r\n        return;\r\n      }\r\n      if (effectiveForce) {\r\n        host.chatHasAutoScrolled = true;\r\n      }\r\n      const smoothEnabled =\r\n        smooth &&\r\n        (typeof window === \"undefined\" ||\r\n          typeof window.matchMedia !== \"function\" ||\r\n          !window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches);\r\n      const scrollTop = target.scrollHeight;\r\n      if (typeof target.scrollTo === \"function\") {\r\n        target.scrollTo({ top: scrollTop, behavior: smoothEnabled ? \"smooth\" : \"auto\" });\r\n      } else {\r\n        target.scrollTop = scrollTop;\r\n      }\r\n      host.chatUserNearBottom = true;\r\n      host.chatNewMessagesBelow = false;\r\n      const retryDelay = effectiveForce ? 150 : 120;\r\n      host.chatScrollTimeout = window.setTimeout(() => {\r\n        host.chatScrollTimeout = null;\r\n        const latest = pickScrollTarget();\r\n        if (!latest) {\r\n          return;\r\n        }\r\n        const latestDistanceFromBottom =\r\n          latest.scrollHeight - latest.scrollTop - latest.clientHeight;\r\n        const shouldStickRetry =\r\n          effectiveForce ||\r\n          host.chatUserNearBottom ||\r\n          latestDistanceFromBottom < NEAR_BOTTOM_THRESHOLD;\r\n        if (!shouldStickRetry) {\r\n          return;\r\n        }\r\n        latest.scrollTop = latest.scrollHeight;\r\n        host.chatUserNearBottom = true;\r\n      }, retryDelay);\r\n    });\r\n  });\r\n}\r\n\r\nexport function scheduleLogsScroll(host: ScrollHost, force = false) {\r\n  if (host.logsScrollFrame) {\r\n    cancelAnimationFrame(host.logsScrollFrame);\r\n  }\r\n  void host.updateComplete.then(() => {\r\n    host.logsScrollFrame = requestAnimationFrame(() => {\r\n      host.logsScrollFrame = null;\r\n      const container = host.querySelector(\".log-stream\") as HTMLElement | null;\r\n      if (!container) {\r\n        return;\r\n      }\r\n      const distanceFromBottom =\r\n        container.scrollHeight - container.scrollTop - container.clientHeight;\r\n      const shouldStick = force || distanceFromBottom < 80;\r\n      if (!shouldStick) {\r\n        return;\r\n      }\r\n      container.scrollTop = container.scrollHeight;\r\n    });\r\n  });\r\n}\r\n\r\nexport function handleChatScroll(host: ScrollHost, event: Event) {\r\n  const container = event.currentTarget as HTMLElement | null;\r\n  if (!container) {\r\n    return;\r\n  }\r\n  const distanceFromBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\r\n  host.chatUserNearBottom = distanceFromBottom < NEAR_BOTTOM_THRESHOLD;\r\n  // Clear the \"new messages below\" indicator when user scrolls back to bottom.\r\n  if (host.chatUserNearBottom) {\r\n    host.chatNewMessagesBelow = false;\r\n  }\r\n}\r\n\r\nexport function handleLogsScroll(host: ScrollHost, event: Event) {\r\n  const container = event.currentTarget as HTMLElement | null;\r\n  if (!container) {\r\n    return;\r\n  }\r\n  const distanceFromBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\r\n  host.logsAtBottom = distanceFromBottom < 80;\r\n}\r\n\r\nexport function resetChatScroll(host: ScrollHost) {\r\n  host.chatHasAutoScrolled = false;\r\n  host.chatUserNearBottom = true;\r\n  host.chatNewMessagesBelow = false;\r\n}\r\n\r\nexport function exportLogs(lines: string[], label: string) {\r\n  if (lines.length === 0) {\r\n    return;\r\n  }\r\n  const blob = new Blob([`${lines.join(\"\\n\")}\\n`], { type: \"text/plain\" });\r\n  const url = URL.createObjectURL(blob);\r\n  const anchor = document.createElement(\"a\");\r\n  const stamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, \"-\");\r\n  anchor.href = url;\r\n  anchor.download = `openclaw-logs-${label}-${stamp}.log`;\r\n  anchor.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nexport function observeTopbar(host: ScrollHost) {\r\n  if (typeof ResizeObserver === \"undefined\") {\r\n    return;\r\n  }\r\n  const topbar = host.querySelector(\".topbar\");\r\n  if (!topbar) {\r\n    return;\r\n  }\r\n  const update = () => {\r\n    const { height } = topbar.getBoundingClientRect();\r\n    host.style.setProperty(\"--topbar-height\", `${height}px`);\r\n  };\r\n  update();\r\n  host.topbarObserver = new ResizeObserver(() => update());\r\n  host.topbarObserver.observe(topbar);\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { HealthSnapshot, StatusSummary } from \"../types.ts\";\r\n\r\nexport type DebugState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  debugLoading: boolean;\r\n  debugStatus: StatusSummary | null;\r\n  debugHealth: HealthSnapshot | null;\r\n  debugModels: unknown[];\r\n  debugHeartbeat: unknown;\r\n  debugCallMethod: string;\r\n  debugCallParams: string;\r\n  debugCallResult: string | null;\r\n  debugCallError: string | null;\r\n};\r\n\r\nexport async function loadDebug(state: DebugState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.debugLoading) {\r\n    return;\r\n  }\r\n  state.debugLoading = true;\r\n  try {\r\n    const [status, health, models, heartbeat] = await Promise.all([\r\n      state.client.request(\"status\", {}),\r\n      state.client.request(\"health\", {}),\r\n      state.client.request(\"models.list\", {}),\r\n      state.client.request(\"last-heartbeat\", {}),\r\n    ]);\r\n    state.debugStatus = status as StatusSummary;\r\n    state.debugHealth = health as HealthSnapshot;\r\n    const modelPayload = models as { models?: unknown[] } | undefined;\r\n    state.debugModels = Array.isArray(modelPayload?.models) ? modelPayload?.models : [];\r\n    state.debugHeartbeat = heartbeat;\r\n  } catch (err) {\r\n    state.debugCallError = String(err);\r\n  } finally {\r\n    state.debugLoading = false;\r\n  }\r\n}\r\n\r\nexport async function callDebugMethod(state: DebugState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.debugCallError = null;\r\n  state.debugCallResult = null;\r\n  try {\r\n    const params = state.debugCallParams.trim()\r\n      ? (JSON.parse(state.debugCallParams) as unknown)\r\n      : {};\r\n    const res = await state.client.request(state.debugCallMethod.trim(), params);\r\n    state.debugCallResult = JSON.stringify(res, null, 2);\r\n  } catch (err) {\r\n    state.debugCallError = String(err);\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { LogEntry, LogLevel } from \"../types.ts\";\r\n\r\nexport type LogsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  logsLoading: boolean;\r\n  logsError: string | null;\r\n  logsCursor: number | null;\r\n  logsFile: string | null;\r\n  logsEntries: LogEntry[];\r\n  logsTruncated: boolean;\r\n  logsLastFetchAt: number | null;\r\n  logsLimit: number;\r\n  logsMaxBytes: number;\r\n};\r\n\r\nconst LOG_BUFFER_LIMIT = 2000;\r\nconst LEVELS = new Set<LogLevel>([\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"fatal\"]);\r\n\r\nfunction parseMaybeJsonString(value: unknown) {\r\n  if (typeof value !== \"string\") {\r\n    return null;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed.startsWith(\"{\") || !trimmed.endsWith(\"}\")) {\r\n    return null;\r\n  }\r\n  try {\r\n    const parsed = JSON.parse(trimmed) as unknown;\r\n    if (!parsed || typeof parsed !== \"object\") {\r\n      return null;\r\n    }\r\n    return parsed as Record<string, unknown>;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction normalizeLevel(value: unknown): LogLevel | null {\r\n  if (typeof value !== \"string\") {\r\n    return null;\r\n  }\r\n  const lowered = value.toLowerCase() as LogLevel;\r\n  return LEVELS.has(lowered) ? lowered : null;\r\n}\r\n\r\nexport function parseLogLine(line: string): LogEntry {\r\n  if (!line.trim()) {\r\n    return { raw: line, message: line };\r\n  }\r\n  try {\r\n    const obj = JSON.parse(line) as Record<string, unknown>;\r\n    const meta =\r\n      obj && typeof obj._meta === \"object\" && obj._meta !== null\r\n        ? (obj._meta as Record<string, unknown>)\r\n        : null;\r\n    const time =\r\n      typeof obj.time === \"string\" ? obj.time : typeof meta?.date === \"string\" ? meta?.date : null;\r\n    const level = normalizeLevel(meta?.logLevelName ?? meta?.level);\r\n\r\n    const contextCandidate =\r\n      typeof obj[\"0\"] === \"string\" ? obj[\"0\"] : typeof meta?.name === \"string\" ? meta?.name : null;\r\n    const contextObj = parseMaybeJsonString(contextCandidate);\r\n    let subsystem: string | null = null;\r\n    if (contextObj) {\r\n      if (typeof contextObj.subsystem === \"string\") {\r\n        subsystem = contextObj.subsystem;\r\n      } else if (typeof contextObj.module === \"string\") {\r\n        subsystem = contextObj.module;\r\n      }\r\n    }\r\n    if (!subsystem && contextCandidate && contextCandidate.length < 120) {\r\n      subsystem = contextCandidate;\r\n    }\r\n\r\n    let message: string | null = null;\r\n    if (typeof obj[\"1\"] === \"string\") {\r\n      message = obj[\"1\"];\r\n    } else if (!contextObj && typeof obj[\"0\"] === \"string\") {\r\n      message = obj[\"0\"];\r\n    } else if (typeof obj.message === \"string\") {\r\n      message = obj.message;\r\n    }\r\n\r\n    return {\r\n      raw: line,\r\n      time,\r\n      level,\r\n      subsystem,\r\n      message: message ?? line,\r\n      meta: meta ?? undefined,\r\n    };\r\n  } catch {\r\n    return { raw: line, message: line };\r\n  }\r\n}\r\n\r\nexport async function loadLogs(state: LogsState, opts?: { reset?: boolean; quiet?: boolean }) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.logsLoading && !opts?.quiet) {\r\n    return;\r\n  }\r\n  if (!opts?.quiet) {\r\n    state.logsLoading = true;\r\n  }\r\n  state.logsError = null;\r\n  try {\r\n    const res = await state.client.request(\"logs.tail\", {\r\n      cursor: opts?.reset ? undefined : (state.logsCursor ?? undefined),\r\n      limit: state.logsLimit,\r\n      maxBytes: state.logsMaxBytes,\r\n    });\r\n    const payload = res as {\r\n      file?: string;\r\n      cursor?: number;\r\n      size?: number;\r\n      lines?: unknown;\r\n      truncated?: boolean;\r\n      reset?: boolean;\r\n    };\r\n    const lines = Array.isArray(payload.lines)\r\n      ? payload.lines.filter((line) => typeof line === \"string\")\r\n      : [];\r\n    const entries = lines.map(parseLogLine);\r\n    const shouldReset = Boolean(opts?.reset || payload.reset || state.logsCursor == null);\r\n    state.logsEntries = shouldReset\r\n      ? entries\r\n      : [...state.logsEntries, ...entries].slice(-LOG_BUFFER_LIMIT);\r\n    if (typeof payload.cursor === \"number\") {\r\n      state.logsCursor = payload.cursor;\r\n    }\r\n    if (typeof payload.file === \"string\") {\r\n      state.logsFile = payload.file;\r\n    }\r\n    state.logsTruncated = Boolean(payload.truncated);\r\n    state.logsLastFetchAt = Date.now();\r\n  } catch (err) {\r\n    state.logsError = String(err);\r\n  } finally {\r\n    if (!opts?.quiet) {\r\n      state.logsLoading = false;\r\n    }\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\n\r\nexport type NodesState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  nodesLoading: boolean;\r\n  nodes: Array<Record<string, unknown>>;\r\n  lastError: string | null;\r\n};\r\n\r\nexport async function loadNodes(state: NodesState, opts?: { quiet?: boolean }) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.nodesLoading) {\r\n    return;\r\n  }\r\n  state.nodesLoading = true;\r\n  if (!opts?.quiet) {\r\n    state.lastError = null;\r\n  }\r\n  try {\r\n    const res = await state.client.request<{ nodes?: Record<string, unknown> }>(\"node.list\", {});\r\n    state.nodes = Array.isArray(res.nodes) ? res.nodes : [];\r\n  } catch (err) {\r\n    if (!opts?.quiet) {\r\n      state.lastError = String(err);\r\n    }\r\n  } finally {\r\n    state.nodesLoading = false;\r\n  }\r\n}\r\n","import type { OpenClawApp } from \"./app.ts\";\r\nimport { loadDebug } from \"./controllers/debug.ts\";\r\nimport { loadLogs } from \"./controllers/logs.ts\";\r\nimport { loadNodes } from \"./controllers/nodes.ts\";\r\n\r\ntype PollingHost = {\r\n  nodesPollInterval: number | null;\r\n  logsPollInterval: number | null;\r\n  debugPollInterval: number | null;\r\n  tab: string;\r\n};\r\n\r\nexport function startNodesPolling(host: PollingHost) {\r\n  if (host.nodesPollInterval != null) {\r\n    return;\r\n  }\r\n  host.nodesPollInterval = window.setInterval(\r\n    () => void loadNodes(host as unknown as OpenClawApp, { quiet: true }),\r\n    5000,\r\n  );\r\n}\r\n\r\nexport function stopNodesPolling(host: PollingHost) {\r\n  if (host.nodesPollInterval == null) {\r\n    return;\r\n  }\r\n  clearInterval(host.nodesPollInterval);\r\n  host.nodesPollInterval = null;\r\n}\r\n\r\nexport function startLogsPolling(host: PollingHost) {\r\n  if (host.logsPollInterval != null) {\r\n    return;\r\n  }\r\n  host.logsPollInterval = window.setInterval(() => {\r\n    if (host.tab !== \"logs\") {\r\n      return;\r\n    }\r\n    void loadLogs(host as unknown as OpenClawApp, { quiet: true });\r\n  }, 2000);\r\n}\r\n\r\nexport function stopLogsPolling(host: PollingHost) {\r\n  if (host.logsPollInterval == null) {\r\n    return;\r\n  }\r\n  clearInterval(host.logsPollInterval);\r\n  host.logsPollInterval = null;\r\n}\r\n\r\nexport function startDebugPolling(host: PollingHost) {\r\n  if (host.debugPollInterval != null) {\r\n    return;\r\n  }\r\n  host.debugPollInterval = window.setInterval(() => {\r\n    if (host.tab !== \"debug\") {\r\n      return;\r\n    }\r\n    void loadDebug(host as unknown as OpenClawApp);\r\n  }, 3000);\r\n}\r\n\r\nexport function stopDebugPolling(host: PollingHost) {\r\n  if (host.debugPollInterval == null) {\r\n    return;\r\n  }\r\n  clearInterval(host.debugPollInterval);\r\n  host.debugPollInterval = null;\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { AgentIdentityResult } from \"../types.ts\";\r\n\r\nexport type AgentIdentityState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  agentIdentityLoading: boolean;\r\n  agentIdentityError: string | null;\r\n  agentIdentityById: Record<string, AgentIdentityResult>;\r\n};\r\n\r\nexport async function loadAgentIdentity(state: AgentIdentityState, agentId: string) {\r\n  if (!state.client || !state.connected || state.agentIdentityLoading) {\r\n    return;\r\n  }\r\n  if (state.agentIdentityById[agentId]) {\r\n    return;\r\n  }\r\n  state.agentIdentityLoading = true;\r\n  state.agentIdentityError = null;\r\n  try {\r\n    const res = await state.client.request<AgentIdentityResult | null>(\"agent.identity.get\", {\r\n      agentId,\r\n    });\r\n    if (res) {\r\n      state.agentIdentityById = { ...state.agentIdentityById, [agentId]: res };\r\n    }\r\n  } catch (err) {\r\n    state.agentIdentityError = String(err);\r\n  } finally {\r\n    state.agentIdentityLoading = false;\r\n  }\r\n}\r\n\r\nexport async function loadAgentIdentities(state: AgentIdentityState, agentIds: string[]) {\r\n  if (!state.client || !state.connected || state.agentIdentityLoading) {\r\n    return;\r\n  }\r\n  const missing = agentIds.filter((id) => !state.agentIdentityById[id]);\r\n  if (missing.length === 0) {\r\n    return;\r\n  }\r\n  state.agentIdentityLoading = true;\r\n  state.agentIdentityError = null;\r\n  try {\r\n    for (const agentId of missing) {\r\n      const res = await state.client.request<AgentIdentityResult | null>(\"agent.identity.get\", {\r\n        agentId,\r\n      });\r\n      if (res) {\r\n        state.agentIdentityById = { ...state.agentIdentityById, [agentId]: res };\r\n      }\r\n    }\r\n  } catch (err) {\r\n    state.agentIdentityError = String(err);\r\n  } finally {\r\n    state.agentIdentityLoading = false;\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { SkillStatusReport } from \"../types.ts\";\r\n\r\nexport type AgentSkillsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  agentSkillsLoading: boolean;\r\n  agentSkillsError: string | null;\r\n  agentSkillsReport: SkillStatusReport | null;\r\n  agentSkillsAgentId: string | null;\r\n};\r\n\r\nexport async function loadAgentSkills(state: AgentSkillsState, agentId: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.agentSkillsLoading) {\r\n    return;\r\n  }\r\n  state.agentSkillsLoading = true;\r\n  state.agentSkillsError = null;\r\n  try {\r\n    const res = await state.client.request(\"skills.status\", { agentId });\r\n    if (res) {\r\n      state.agentSkillsReport = res as SkillStatusReport;\r\n      state.agentSkillsAgentId = agentId;\r\n    }\r\n  } catch (err) {\r\n    state.agentSkillsError = String(err);\r\n  } finally {\r\n    state.agentSkillsLoading = false;\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { AgentsListResult } from \"../types.ts\";\r\n\r\nexport type AgentsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  agentsLoading: boolean;\r\n  agentsError: string | null;\r\n  agentsList: AgentsListResult | null;\r\n  agentsSelectedId: string | null;\r\n};\r\n\r\nexport async function loadAgents(state: AgentsState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.agentsLoading) {\r\n    return;\r\n  }\r\n  state.agentsLoading = true;\r\n  state.agentsError = null;\r\n  try {\r\n    const res = await state.client.request<AgentsListResult>(\"agents.list\", {});\r\n    if (res) {\r\n      state.agentsList = res;\r\n      const selected = state.agentsSelectedId;\r\n      const known = res.agents.some((entry) => entry.id === selected);\r\n      if (!selected || !known) {\r\n        state.agentsSelectedId = res.defaultId ?? res.agents[0]?.id ?? null;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    state.agentsError = String(err);\r\n  } finally {\r\n    state.agentsLoading = false;\r\n  }\r\n}\r\n","export type FormatDurationSecondsOptions = {\n  decimals?: number;\n  unit?: \"s\" | \"seconds\";\n};\n\nexport type FormatDurationCompactOptions = {\n  /** Add space between units: \"2m 5s\" instead of \"2m5s\". Default: false */\n  spaced?: boolean;\n};\n\nexport function formatDurationSeconds(\n  ms: number,\n  options: FormatDurationSecondsOptions = {},\n): string {\n  if (!Number.isFinite(ms)) {\n    return \"unknown\";\n  }\n  const decimals = options.decimals ?? 1;\n  const unit = options.unit ?? \"s\";\n  const seconds = Math.max(0, ms) / 1000;\n  const fixed = seconds.toFixed(Math.max(0, decimals));\n  const trimmed = fixed.replace(/\\.0+$/, \"\").replace(/(\\.\\d*[1-9])0+$/, \"$1\");\n  return unit === \"seconds\" ? `${trimmed} seconds` : `${trimmed}s`;\n}\n\n/** Precise decimal-seconds output: \"500ms\" or \"1.23s\". Input is milliseconds. */\nexport function formatDurationPrecise(\n  ms: number,\n  options: FormatDurationSecondsOptions = {},\n): string {\n  if (!Number.isFinite(ms)) {\n    return \"unknown\";\n  }\n  if (ms < 1000) {\n    return `${ms}ms`;\n  }\n  return formatDurationSeconds(ms, {\n    decimals: options.decimals ?? 2,\n    unit: options.unit ?? \"s\",\n  });\n}\n\n/**\n * Compact compound duration: \"500ms\", \"45s\", \"2m5s\", \"1h30m\".\n * With `spaced`: \"45s\", \"2m 5s\", \"1h 30m\".\n * Omits trailing zero components: \"1m\" not \"1m 0s\", \"2h\" not \"2h 0m\".\n * Returns undefined for null/undefined/non-finite/non-positive input.\n */\nexport function formatDurationCompact(\n  ms?: number | null,\n  options?: FormatDurationCompactOptions,\n): string | undefined {\n  if (ms == null || !Number.isFinite(ms) || ms <= 0) {\n    return undefined;\n  }\n  if (ms < 1000) {\n    return `${Math.round(ms)}ms`;\n  }\n  const sep = options?.spaced ? \" \" : \"\";\n  const totalSeconds = Math.round(ms / 1000);\n  const hours = Math.floor(totalSeconds / 3600);\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\n  const seconds = totalSeconds % 60;\n  if (hours >= 24) {\n    const days = Math.floor(hours / 24);\n    const remainingHours = hours % 24;\n    return remainingHours > 0 ? `${days}d${sep}${remainingHours}h` : `${days}d`;\n  }\n  if (hours > 0) {\n    return minutes > 0 ? `${hours}h${sep}${minutes}m` : `${hours}h`;\n  }\n  if (minutes > 0) {\n    return seconds > 0 ? `${minutes}m${sep}${seconds}s` : `${minutes}m`;\n  }\n  return `${seconds}s`;\n}\n\n/**\n * Rounded single-unit duration for display: \"500ms\", \"5s\", \"3m\", \"2h\", \"5d\".\n * Returns fallback string for null/undefined/non-finite input.\n */\nexport function formatDurationHuman(ms?: number | null, fallback = \"n/a\"): string {\n  if (ms == null || !Number.isFinite(ms) || ms < 0) {\n    return fallback;\n  }\n  if (ms < 1000) {\n    return `${Math.round(ms)}ms`;\n  }\n  const sec = Math.round(ms / 1000);\n  if (sec < 60) {\n    return `${sec}s`;\n  }\n  const min = Math.round(sec / 60);\n  if (min < 60) {\n    return `${min}m`;\n  }\n  const hr = Math.round(min / 60);\n  if (hr < 24) {\n    return `${hr}h`;\n  }\n  const day = Math.round(hr / 24);\n  return `${day}d`;\n}\n","/**\n * Centralized relative-time formatting utilities.\n *\n * Consolidates 7+ scattered implementations (formatAge, formatAgeShort, formatAgo,\n * formatRelativeTime, formatElapsedTime) into two functions:\n *\n * - `formatTimeAgo(durationMs)` — format a duration as \"5m ago\" / \"5m\" (for known elapsed time)\n * - `formatRelativeTimestamp(epochMs)` — format an epoch timestamp relative to now (handles future)\n */\n\nexport type FormatTimeAgoOptions = {\n  /** Append \"ago\" suffix. Default: true. When false, returns bare unit: \"5m\", \"2h\" */\n  suffix?: boolean;\n  /** Return value for invalid/null/negative input. Default: \"unknown\" */\n  fallback?: string;\n};\n\n/**\n * Format a duration (in ms) as a human-readable relative time.\n *\n * Input: how many milliseconds ago something happened.\n *\n * With suffix (default):  \"just now\", \"5m ago\", \"3h ago\", \"2d ago\"\n * Without suffix:         \"0s\", \"5m\", \"3h\", \"2d\"\n */\nexport function formatTimeAgo(\n  durationMs: number | null | undefined,\n  options?: FormatTimeAgoOptions,\n): string {\n  const suffix = options?.suffix !== false;\n  const fallback = options?.fallback ?? \"unknown\";\n\n  if (durationMs == null || !Number.isFinite(durationMs) || durationMs < 0) {\n    return fallback;\n  }\n\n  const totalSeconds = Math.round(durationMs / 1000);\n  const minutes = Math.round(totalSeconds / 60);\n\n  if (minutes < 1) {\n    return suffix ? \"just now\" : `${totalSeconds}s`;\n  }\n  if (minutes < 60) {\n    return suffix ? `${minutes}m ago` : `${minutes}m`;\n  }\n  const hours = Math.round(minutes / 60);\n  if (hours < 48) {\n    return suffix ? `${hours}h ago` : `${hours}h`;\n  }\n  const days = Math.round(hours / 24);\n  return suffix ? `${days}d ago` : `${days}d`;\n}\n\nexport type FormatRelativeTimestampOptions = {\n  /** If true, fall back to short date (e.g. \"Oct 5\") for timestamps >7 days. Default: false */\n  dateFallback?: boolean;\n  /** IANA timezone for date fallback display */\n  timezone?: string;\n  /** Return value for invalid/null input. Default: \"n/a\" */\n  fallback?: string;\n};\n\n/**\n * Format an epoch timestamp relative to now.\n *\n * Handles both past (\"5m ago\") and future (\"in 5m\") timestamps.\n * Optionally falls back to a short date for timestamps older than 7 days.\n */\nexport function formatRelativeTimestamp(\n  timestampMs: number | null | undefined,\n  options?: FormatRelativeTimestampOptions,\n): string {\n  const fallback = options?.fallback ?? \"n/a\";\n  if (timestampMs == null || !Number.isFinite(timestampMs)) {\n    return fallback;\n  }\n\n  const diff = Date.now() - timestampMs;\n  const absDiff = Math.abs(diff);\n  const isPast = diff >= 0;\n\n  const sec = Math.round(absDiff / 1000);\n  if (sec < 60) {\n    return isPast ? \"just now\" : \"in <1m\";\n  }\n\n  const min = Math.round(sec / 60);\n  if (min < 60) {\n    return isPast ? `${min}m ago` : `in ${min}m`;\n  }\n\n  const hr = Math.round(min / 60);\n  if (hr < 48) {\n    return isPast ? `${hr}h ago` : `in ${hr}h`;\n  }\n\n  const day = Math.round(hr / 24);\n  if (!options?.dateFallback || day <= 7) {\n    return isPast ? `${day}d ago` : `in ${day}d`;\n  }\n\n  // Fall back to short date display for old timestamps\n  try {\n    return new Intl.DateTimeFormat(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      ...(options.timezone ? { timeZone: options.timezone } : {}),\n    }).format(new Date(timestampMs));\n  } catch {\n    return `${day}d ago`;\n  }\n}\n","export type ReasoningTagMode = \"strict\" | \"preserve\";\nexport type ReasoningTagTrim = \"none\" | \"start\" | \"both\";\n\nconst QUICK_TAG_RE = /<\\s*\\/?\\s*(?:think(?:ing)?|thought|antthinking|final)\\b/i;\nconst FINAL_TAG_RE = /<\\s*\\/?\\s*final\\b[^<>]*>/gi;\nconst THINKING_TAG_RE = /<\\s*(\\/?)\\s*(?:think(?:ing)?|thought|antthinking)\\b[^<>]*>/gi;\n\ninterface CodeRegion {\n  start: number;\n  end: number;\n}\n\nfunction findCodeRegions(text: string): CodeRegion[] {\n  const regions: CodeRegion[] = [];\n\n  const fencedRe = /(^|\\n)(```|~~~)[^\\n]*\\n[\\s\\S]*?(?:\\n\\2(?:\\n|$)|$)/g;\n  for (const match of text.matchAll(fencedRe)) {\n    const start = (match.index ?? 0) + match[1].length;\n    regions.push({ start, end: start + match[0].length - match[1].length });\n  }\n\n  const inlineRe = /`+[^`]+`+/g;\n  for (const match of text.matchAll(inlineRe)) {\n    const start = match.index ?? 0;\n    const end = start + match[0].length;\n    const insideFenced = regions.some((r) => start >= r.start && end <= r.end);\n    if (!insideFenced) {\n      regions.push({ start, end });\n    }\n  }\n\n  regions.sort((a, b) => a.start - b.start);\n  return regions;\n}\n\nfunction isInsideCode(pos: number, regions: CodeRegion[]): boolean {\n  return regions.some((r) => pos >= r.start && pos < r.end);\n}\n\nfunction applyTrim(value: string, mode: ReasoningTagTrim): string {\n  if (mode === \"none\") {\n    return value;\n  }\n  if (mode === \"start\") {\n    return value.trimStart();\n  }\n  return value.trim();\n}\n\nexport function stripReasoningTagsFromText(\n  text: string,\n  options?: {\n    mode?: ReasoningTagMode;\n    trim?: ReasoningTagTrim;\n  },\n): string {\n  if (!text) {\n    return text;\n  }\n  if (!QUICK_TAG_RE.test(text)) {\n    return text;\n  }\n\n  const mode = options?.mode ?? \"strict\";\n  const trimMode = options?.trim ?? \"both\";\n\n  let cleaned = text;\n  if (FINAL_TAG_RE.test(cleaned)) {\n    FINAL_TAG_RE.lastIndex = 0;\n    const finalMatches: Array<{ start: number; length: number; inCode: boolean }> = [];\n    const preCodeRegions = findCodeRegions(cleaned);\n    for (const match of cleaned.matchAll(FINAL_TAG_RE)) {\n      const start = match.index ?? 0;\n      finalMatches.push({\n        start,\n        length: match[0].length,\n        inCode: isInsideCode(start, preCodeRegions),\n      });\n    }\n\n    for (let i = finalMatches.length - 1; i >= 0; i--) {\n      const m = finalMatches[i];\n      if (!m.inCode) {\n        cleaned = cleaned.slice(0, m.start) + cleaned.slice(m.start + m.length);\n      }\n    }\n  } else {\n    FINAL_TAG_RE.lastIndex = 0;\n  }\n\n  const codeRegions = findCodeRegions(cleaned);\n\n  THINKING_TAG_RE.lastIndex = 0;\n  let result = \"\";\n  let lastIndex = 0;\n  let inThinking = false;\n\n  for (const match of cleaned.matchAll(THINKING_TAG_RE)) {\n    const idx = match.index ?? 0;\n    const isClose = match[1] === \"/\";\n\n    if (isInsideCode(idx, codeRegions)) {\n      continue;\n    }\n\n    if (!inThinking) {\n      result += cleaned.slice(lastIndex, idx);\n      if (!isClose) {\n        inThinking = true;\n      }\n    } else if (isClose) {\n      inThinking = false;\n    }\n\n    lastIndex = idx + match[0].length;\n  }\n\n  if (!inThinking || mode === \"preserve\") {\n    result += cleaned.slice(lastIndex);\n  }\n\n  return applyTrim(result, trimMode);\n}\n","import { formatDurationHuman } from \"../../../src/infra/format-time/format-duration.ts\";\r\nimport { formatRelativeTimestamp } from \"../../../src/infra/format-time/format-relative.ts\";\r\nimport { stripReasoningTagsFromText } from \"../../../src/shared/text/reasoning-tags.js\";\r\n\r\nexport { formatRelativeTimestamp, formatDurationHuman };\r\n\r\nexport function formatMs(ms?: number | null): string {\r\n  if (!ms && ms !== 0) {\r\n    return \"n/a\";\r\n  }\r\n  return new Date(ms).toLocaleString();\r\n}\r\n\r\nexport function formatList(values?: Array<string | null | undefined>): string {\r\n  if (!values || values.length === 0) {\r\n    return \"none\";\r\n  }\r\n  return values.filter((v): v is string => Boolean(v && v.trim())).join(\", \");\r\n}\r\n\r\nexport function clampText(value: string, max = 120): string {\r\n  if (value.length <= max) {\r\n    return value;\r\n  }\r\n  return `${value.slice(0, Math.max(0, max - 1))}…`;\r\n}\r\n\r\nexport function truncateText(\r\n  value: string,\r\n  max: number,\r\n): {\r\n  text: string;\r\n  truncated: boolean;\r\n  total: number;\r\n} {\r\n  if (value.length <= max) {\r\n    return { text: value, truncated: false, total: value.length };\r\n  }\r\n  return {\r\n    text: value.slice(0, Math.max(0, max)),\r\n    truncated: true,\r\n    total: value.length,\r\n  };\r\n}\r\n\r\nexport function toNumber(value: string, fallback: number): number {\r\n  const n = Number(value);\r\n  return Number.isFinite(n) ? n : fallback;\r\n}\r\n\r\nexport function parseList(input: string): string[] {\r\n  return input\r\n    .split(/[,\\n]/)\r\n    .map((v) => v.trim())\r\n    .filter((v) => v.length > 0);\r\n}\r\n\r\nexport function stripThinkingTags(value: string): string {\r\n  return stripReasoningTagsFromText(value, { mode: \"preserve\", trim: \"start\" });\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { CronJob, CronRunLogEntry, CronStatus } from \"../types.ts\";\r\nimport type { CronFormState } from \"../ui-types.ts\";\r\nimport { toNumber } from \"../format.ts\";\r\n\r\nexport type CronState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  cronLoading: boolean;\r\n  cronJobs: CronJob[];\r\n  cronStatus: CronStatus | null;\r\n  cronError: string | null;\r\n  cronForm: CronFormState;\r\n  cronRunsJobId: string | null;\r\n  cronRuns: CronRunLogEntry[];\r\n  cronBusy: boolean;\r\n};\r\n\r\nexport async function loadCronStatus(state: CronState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  try {\r\n    const res = await state.client.request<CronStatus>(\"cron.status\", {});\r\n    state.cronStatus = res;\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  }\r\n}\r\n\r\nexport async function loadCronJobs(state: CronState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.cronLoading) {\r\n    return;\r\n  }\r\n  state.cronLoading = true;\r\n  state.cronError = null;\r\n  try {\r\n    const res = await state.client.request<{ jobs?: Array<CronJob> }>(\"cron.list\", {\r\n      includeDisabled: true,\r\n    });\r\n    state.cronJobs = Array.isArray(res.jobs) ? res.jobs : [];\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  } finally {\r\n    state.cronLoading = false;\r\n  }\r\n}\r\n\r\nexport function buildCronSchedule(form: CronFormState) {\r\n  if (form.scheduleKind === \"at\") {\r\n    const ms = Date.parse(form.scheduleAt);\r\n    if (!Number.isFinite(ms)) {\r\n      throw new Error(\"Invalid run time.\");\r\n    }\r\n    return { kind: \"at\" as const, at: new Date(ms).toISOString() };\r\n  }\r\n  if (form.scheduleKind === \"every\") {\r\n    const amount = toNumber(form.everyAmount, 0);\r\n    if (amount <= 0) {\r\n      throw new Error(\"Invalid interval amount.\");\r\n    }\r\n    const unit = form.everyUnit;\r\n    const mult = unit === \"minutes\" ? 60_000 : unit === \"hours\" ? 3_600_000 : 86_400_000;\r\n    return { kind: \"every\" as const, everyMs: amount * mult };\r\n  }\r\n  const expr = form.cronExpr.trim();\r\n  if (!expr) {\r\n    throw new Error(\"Cron expression required.\");\r\n  }\r\n  return { kind: \"cron\" as const, expr, tz: form.cronTz.trim() || undefined };\r\n}\r\n\r\nexport function buildCronPayload(form: CronFormState) {\r\n  if (form.payloadKind === \"systemEvent\") {\r\n    const text = form.payloadText.trim();\r\n    if (!text) {\r\n      throw new Error(\"System event text required.\");\r\n    }\r\n    return { kind: \"systemEvent\" as const, text };\r\n  }\r\n  const message = form.payloadText.trim();\r\n  if (!message) {\r\n    throw new Error(\"Agent message required.\");\r\n  }\r\n  const payload: {\r\n    kind: \"agentTurn\";\r\n    message: string;\r\n    timeoutSeconds?: number;\r\n  } = { kind: \"agentTurn\", message };\r\n  const timeoutSeconds = toNumber(form.timeoutSeconds, 0);\r\n  if (timeoutSeconds > 0) {\r\n    payload.timeoutSeconds = timeoutSeconds;\r\n  }\r\n  return payload;\r\n}\r\n\r\nexport async function addCronJob(state: CronState) {\r\n  if (!state.client || !state.connected || state.cronBusy) {\r\n    return;\r\n  }\r\n  state.cronBusy = true;\r\n  state.cronError = null;\r\n  try {\r\n    const schedule = buildCronSchedule(state.cronForm);\r\n    const payload = buildCronPayload(state.cronForm);\r\n    const delivery =\r\n      state.cronForm.sessionTarget === \"isolated\" &&\r\n      state.cronForm.payloadKind === \"agentTurn\" &&\r\n      state.cronForm.deliveryMode\r\n        ? {\r\n            mode: state.cronForm.deliveryMode === \"announce\" ? \"announce\" : \"none\",\r\n            channel: state.cronForm.deliveryChannel.trim() || \"last\",\r\n            to: state.cronForm.deliveryTo.trim() || undefined,\r\n          }\r\n        : undefined;\r\n    const agentId = state.cronForm.agentId.trim();\r\n    const job = {\r\n      name: state.cronForm.name.trim(),\r\n      description: state.cronForm.description.trim() || undefined,\r\n      agentId: agentId || undefined,\r\n      enabled: state.cronForm.enabled,\r\n      schedule,\r\n      sessionTarget: state.cronForm.sessionTarget,\r\n      wakeMode: state.cronForm.wakeMode,\r\n      payload,\r\n      delivery,\r\n    };\r\n    if (!job.name) {\r\n      throw new Error(\"Name required.\");\r\n    }\r\n    await state.client.request(\"cron.add\", job);\r\n    state.cronForm = {\r\n      ...state.cronForm,\r\n      name: \"\",\r\n      description: \"\",\r\n      payloadText: \"\",\r\n    };\r\n    await loadCronJobs(state);\r\n    await loadCronStatus(state);\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  } finally {\r\n    state.cronBusy = false;\r\n  }\r\n}\r\n\r\nexport async function toggleCronJob(state: CronState, job: CronJob, enabled: boolean) {\r\n  if (!state.client || !state.connected || state.cronBusy) {\r\n    return;\r\n  }\r\n  state.cronBusy = true;\r\n  state.cronError = null;\r\n  try {\r\n    await state.client.request(\"cron.update\", { id: job.id, patch: { enabled } });\r\n    await loadCronJobs(state);\r\n    await loadCronStatus(state);\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  } finally {\r\n    state.cronBusy = false;\r\n  }\r\n}\r\n\r\nexport async function runCronJob(state: CronState, job: CronJob) {\r\n  if (!state.client || !state.connected || state.cronBusy) {\r\n    return;\r\n  }\r\n  state.cronBusy = true;\r\n  state.cronError = null;\r\n  try {\r\n    await state.client.request(\"cron.run\", { id: job.id, mode: \"force\" });\r\n    await loadCronRuns(state, job.id);\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  } finally {\r\n    state.cronBusy = false;\r\n  }\r\n}\r\n\r\nexport async function removeCronJob(state: CronState, job: CronJob) {\r\n  if (!state.client || !state.connected || state.cronBusy) {\r\n    return;\r\n  }\r\n  state.cronBusy = true;\r\n  state.cronError = null;\r\n  try {\r\n    await state.client.request(\"cron.remove\", { id: job.id });\r\n    if (state.cronRunsJobId === job.id) {\r\n      state.cronRunsJobId = null;\r\n      state.cronRuns = [];\r\n    }\r\n    await loadCronJobs(state);\r\n    await loadCronStatus(state);\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  } finally {\r\n    state.cronBusy = false;\r\n  }\r\n}\r\n\r\nexport async function loadCronRuns(state: CronState, jobId: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  try {\r\n    const res = await state.client.request<{ entries?: Array<CronRunLogEntry> }>(\"cron.runs\", {\r\n      id: jobId,\r\n      limit: 50,\r\n    });\r\n    state.cronRunsJobId = jobId;\r\n    state.cronRuns = Array.isArray(res.entries) ? res.entries : [];\r\n  } catch (err) {\r\n    state.cronError = String(err);\r\n  }\r\n}\r\n","export type DeviceAuthEntry = {\r\n  token: string;\r\n  role: string;\r\n  scopes: string[];\r\n  updatedAtMs: number;\r\n};\r\n\r\ntype DeviceAuthStore = {\r\n  version: 1;\r\n  deviceId: string;\r\n  tokens: Record<string, DeviceAuthEntry>;\r\n};\r\n\r\nconst STORAGE_KEY = \"openclaw.device.auth.v1\";\r\n\r\nfunction normalizeRole(role: string): string {\r\n  return role.trim();\r\n}\r\n\r\nfunction normalizeScopes(scopes: string[] | undefined): string[] {\r\n  if (!Array.isArray(scopes)) {\r\n    return [];\r\n  }\r\n  const out = new Set<string>();\r\n  for (const scope of scopes) {\r\n    const trimmed = scope.trim();\r\n    if (trimmed) {\r\n      out.add(trimmed);\r\n    }\r\n  }\r\n  return [...out].toSorted();\r\n}\r\n\r\nfunction readStore(): DeviceAuthStore | null {\r\n  try {\r\n    const raw = window.localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) {\r\n      return null;\r\n    }\r\n    const parsed = JSON.parse(raw) as DeviceAuthStore;\r\n    if (!parsed || parsed.version !== 1) {\r\n      return null;\r\n    }\r\n    if (!parsed.deviceId || typeof parsed.deviceId !== \"string\") {\r\n      return null;\r\n    }\r\n    if (!parsed.tokens || typeof parsed.tokens !== \"object\") {\r\n      return null;\r\n    }\r\n    return parsed;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction writeStore(store: DeviceAuthStore) {\r\n  try {\r\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(store));\r\n  } catch {\r\n    // best-effort\r\n  }\r\n}\r\n\r\nexport function loadDeviceAuthToken(params: {\r\n  deviceId: string;\r\n  role: string;\r\n}): DeviceAuthEntry | null {\r\n  const store = readStore();\r\n  if (!store || store.deviceId !== params.deviceId) {\r\n    return null;\r\n  }\r\n  const role = normalizeRole(params.role);\r\n  const entry = store.tokens[role];\r\n  if (!entry || typeof entry.token !== \"string\") {\r\n    return null;\r\n  }\r\n  return entry;\r\n}\r\n\r\nexport function storeDeviceAuthToken(params: {\r\n  deviceId: string;\r\n  role: string;\r\n  token: string;\r\n  scopes?: string[];\r\n}): DeviceAuthEntry {\r\n  const role = normalizeRole(params.role);\r\n  const next: DeviceAuthStore = {\r\n    version: 1,\r\n    deviceId: params.deviceId,\r\n    tokens: {},\r\n  };\r\n  const existing = readStore();\r\n  if (existing && existing.deviceId === params.deviceId) {\r\n    next.tokens = { ...existing.tokens };\r\n  }\r\n  const entry: DeviceAuthEntry = {\r\n    token: params.token,\r\n    role,\r\n    scopes: normalizeScopes(params.scopes),\r\n    updatedAtMs: Date.now(),\r\n  };\r\n  next.tokens[role] = entry;\r\n  writeStore(next);\r\n  return entry;\r\n}\r\n\r\nexport function clearDeviceAuthToken(params: { deviceId: string; role: string }) {\r\n  const store = readStore();\r\n  if (!store || store.deviceId !== params.deviceId) {\r\n    return;\r\n  }\r\n  const role = normalizeRole(params.role);\r\n  if (!store.tokens[role]) {\r\n    return;\r\n  }\r\n  const next = { ...store, tokens: { ...store.tokens } };\r\n  delete next.tokens[role];\r\n  writeStore(next);\r\n}\r\n","/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */\n/**\n * 5KB JS implementation of ed25519 EdDSA signatures.\n * Compliant with RFC8032, FIPS 186-5 & ZIP215.\n * @module\n * @example\n * ```js\nimport * as ed from '@noble/ed25519';\n(async () => {\n  const secretKey = ed.utils.randomSecretKey();\n  const message = Uint8Array.from([0xab, 0xbc, 0xcd, 0xde]);\n  const pubKey = await ed.getPublicKeyAsync(secretKey); // Sync methods are also present\n  const signature = await ed.signAsync(message, secretKey);\n  const isValid = await ed.verifyAsync(signature, message, pubKey);\n})();\n```\n */\n/**\n * Curve params. ed25519 is twisted edwards curve. Equation is −x² + y² = -a + dx²y².\n * * P = `2n**255n - 19n` // field over which calculations are done\n * * N = `2n**252n + 27742317777372353535851937790883648493n` // group order, amount of curve points\n * * h = 8 // cofactor\n * * a = `Fp.create(BigInt(-1))` // equation param\n * * d = -121665/121666 a.k.a. `Fp.neg(121665 * Fp.inv(121666))` // equation param\n * * Gx, Gy are coordinates of Generator / base point\n */\nconst ed25519_CURVE = {\n    p: 0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedn,\n    n: 0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3edn,\n    h: 8n,\n    a: 0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecn,\n    d: 0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3n,\n    Gx: 0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,\n    Gy: 0x6666666666666666666666666666666666666666666666666666666666666658n,\n};\nconst { p: P, n: N, Gx, Gy, a: _a, d: _d, h } = ed25519_CURVE;\nconst L = 32; // field / group byte length\nconst L2 = 64;\n// Helpers and Precomputes sections are reused between libraries\n// ## Helpers\n// ----------\nconst captureTrace = (...args) => {\n    if ('captureStackTrace' in Error && typeof Error.captureStackTrace === 'function') {\n        Error.captureStackTrace(...args);\n    }\n};\nconst err = (message = '') => {\n    const e = new Error(message);\n    captureTrace(e, err);\n    throw e;\n};\nconst isBig = (n) => typeof n === 'bigint'; // is big integer\nconst isStr = (s) => typeof s === 'string'; // is string\nconst isBytes = (a) => a instanceof Uint8Array || (ArrayBuffer.isView(a) && a.constructor.name === 'Uint8Array');\n/** Asserts something is Uint8Array. */\nconst abytes = (value, length, title = '') => {\n    const bytes = isBytes(value);\n    const len = value?.length;\n    const needsLen = length !== undefined;\n    if (!bytes || (needsLen && len !== length)) {\n        const prefix = title && `\"${title}\" `;\n        const ofLen = needsLen ? ` of length ${length}` : '';\n        const got = bytes ? `length=${len}` : `type=${typeof value}`;\n        err(prefix + 'expected Uint8Array' + ofLen + ', got ' + got);\n    }\n    return value;\n};\n/** create Uint8Array */\nconst u8n = (len) => new Uint8Array(len);\nconst u8fr = (buf) => Uint8Array.from(buf);\nconst padh = (n, pad) => n.toString(16).padStart(pad, '0');\nconst bytesToHex = (b) => Array.from(abytes(b))\n    .map((e) => padh(e, 2))\n    .join('');\nconst C = { _0: 48, _9: 57, A: 65, F: 70, a: 97, f: 102 }; // ASCII characters\nconst _ch = (ch) => {\n    if (ch >= C._0 && ch <= C._9)\n        return ch - C._0; // '2' => 50-48\n    if (ch >= C.A && ch <= C.F)\n        return ch - (C.A - 10); // 'B' => 66-(65-10)\n    if (ch >= C.a && ch <= C.f)\n        return ch - (C.a - 10); // 'b' => 98-(97-10)\n    return;\n};\nconst hexToBytes = (hex) => {\n    const e = 'hex invalid';\n    if (!isStr(hex))\n        return err(e);\n    const hl = hex.length;\n    const al = hl / 2;\n    if (hl % 2)\n        return err(e);\n    const array = u8n(al);\n    for (let ai = 0, hi = 0; ai < al; ai++, hi += 2) {\n        // treat each char as ASCII\n        const n1 = _ch(hex.charCodeAt(hi)); // parse first char, multiply it by 16\n        const n2 = _ch(hex.charCodeAt(hi + 1)); // parse second char\n        if (n1 === undefined || n2 === undefined)\n            return err(e);\n        array[ai] = n1 * 16 + n2; // example: 'A9' => 10*16 + 9\n    }\n    return array;\n};\nconst cr = () => globalThis?.crypto; // WebCrypto is available in all modern environments\nconst subtle = () => cr()?.subtle ?? err('crypto.subtle must be defined, consider polyfill');\n// prettier-ignore\nconst concatBytes = (...arrs) => {\n    const r = u8n(arrs.reduce((sum, a) => sum + abytes(a).length, 0)); // create u8a of summed length\n    let pad = 0; // walk through each array,\n    arrs.forEach(a => { r.set(a, pad); pad += a.length; }); // ensure they have proper type\n    return r;\n};\n/** WebCrypto OS-level CSPRNG (random number generator). Will throw when not available. */\nconst randomBytes = (len = L) => {\n    const c = cr();\n    return c.getRandomValues(u8n(len));\n};\nconst big = BigInt;\nconst assertRange = (n, min, max, msg = 'bad number: out of range') => (isBig(n) && min <= n && n < max ? n : err(msg));\n/** modular division */\nconst M = (a, b = P) => {\n    const r = a % b;\n    return r >= 0n ? r : b + r;\n};\nconst modN = (a) => M(a, N);\n/** Modular inversion using euclidean GCD (non-CT). No negative exponent for now. */\n// prettier-ignore\nconst invert = (num, md) => {\n    if (num === 0n || md <= 0n)\n        err('no inverse n=' + num + ' mod=' + md);\n    let a = M(num, md), b = md, x = 0n, y = 1n, u = 1n, v = 0n;\n    while (a !== 0n) {\n        const q = b / a, r = b % a;\n        const m = x - u * q, n = y - v * q;\n        b = a, a = r, x = u, y = v, u = m, v = n;\n    }\n    return b === 1n ? M(x, md) : err('no inverse'); // b is gcd at this point\n};\nconst callHash = (name) => {\n    // @ts-ignore\n    const fn = hashes[name];\n    if (typeof fn !== 'function')\n        err('hashes.' + name + ' not set');\n    return fn;\n};\nconst hash = (msg) => callHash('sha512')(msg);\nconst apoint = (p) => (p instanceof Point ? p : err('Point expected'));\n// ## End of Helpers\n// -----------------\nconst B256 = 2n ** 256n;\n/** Point in XYZT extended coordinates. */\nclass Point {\n    static BASE;\n    static ZERO;\n    X;\n    Y;\n    Z;\n    T;\n    constructor(X, Y, Z, T) {\n        const max = B256;\n        this.X = assertRange(X, 0n, max);\n        this.Y = assertRange(Y, 0n, max);\n        this.Z = assertRange(Z, 1n, max);\n        this.T = assertRange(T, 0n, max);\n        Object.freeze(this);\n    }\n    static CURVE() {\n        return ed25519_CURVE;\n    }\n    static fromAffine(p) {\n        return new Point(p.x, p.y, 1n, M(p.x * p.y));\n    }\n    /** RFC8032 5.1.3: Uint8Array to Point. */\n    static fromBytes(hex, zip215 = false) {\n        const d = _d;\n        // Copy array to not mess it up.\n        const normed = u8fr(abytes(hex, L));\n        // adjust first LE byte = last BE byte\n        const lastByte = hex[31];\n        normed[31] = lastByte & ~0x80;\n        const y = bytesToNumLE(normed);\n        // zip215=true:           0 <= y < 2^256\n        // zip215=false, RFC8032: 0 <= y < 2^255-19\n        const max = zip215 ? B256 : P;\n        assertRange(y, 0n, max);\n        const y2 = M(y * y); // y²\n        const u = M(y2 - 1n); // u=y²-1\n        const v = M(d * y2 + 1n); // v=dy²+1\n        let { isValid, value: x } = uvRatio(u, v); // (uv³)(uv⁷)^(p-5)/8; square root\n        if (!isValid)\n            err('bad point: y not sqrt'); // not square root: bad point\n        const isXOdd = (x & 1n) === 1n; // adjust sign of x coordinate\n        const isLastByteOdd = (lastByte & 0x80) !== 0; // x_0, last bit\n        if (!zip215 && x === 0n && isLastByteOdd)\n            err('bad point: x==0, isLastByteOdd'); // x=0, x_0=1\n        if (isLastByteOdd !== isXOdd)\n            x = M(-x);\n        return new Point(x, y, 1n, M(x * y)); // Z=1, T=xy\n    }\n    static fromHex(hex, zip215) {\n        return Point.fromBytes(hexToBytes(hex), zip215);\n    }\n    get x() {\n        return this.toAffine().x;\n    }\n    get y() {\n        return this.toAffine().y;\n    }\n    /** Checks if the point is valid and on-curve. */\n    assertValidity() {\n        const a = _a;\n        const d = _d;\n        const p = this;\n        if (p.is0())\n            return err('bad point: ZERO'); // TODO: optimize, with vars below?\n        // Equation in affine coordinates: ax² + y² = 1 + dx²y²\n        // Equation in projective coordinates (X/Z, Y/Z, Z):  (aX² + Y²)Z² = Z⁴ + dX²Y²\n        const { X, Y, Z, T } = p;\n        const X2 = M(X * X); // X²\n        const Y2 = M(Y * Y); // Y²\n        const Z2 = M(Z * Z); // Z²\n        const Z4 = M(Z2 * Z2); // Z⁴\n        const aX2 = M(X2 * a); // aX²\n        const left = M(Z2 * M(aX2 + Y2)); // (aX² + Y²)Z²\n        const right = M(Z4 + M(d * M(X2 * Y2))); // Z⁴ + dX²Y²\n        if (left !== right)\n            return err('bad point: equation left != right (1)');\n        // In Extended coordinates we also have T, which is x*y=T/Z: check X*Y == Z*T\n        const XY = M(X * Y);\n        const ZT = M(Z * T);\n        if (XY !== ZT)\n            return err('bad point: equation left != right (2)');\n        return this;\n    }\n    /** Equality check: compare points P&Q. */\n    equals(other) {\n        const { X: X1, Y: Y1, Z: Z1 } = this;\n        const { X: X2, Y: Y2, Z: Z2 } = apoint(other); // checks class equality\n        const X1Z2 = M(X1 * Z2);\n        const X2Z1 = M(X2 * Z1);\n        const Y1Z2 = M(Y1 * Z2);\n        const Y2Z1 = M(Y2 * Z1);\n        return X1Z2 === X2Z1 && Y1Z2 === Y2Z1;\n    }\n    is0() {\n        return this.equals(I);\n    }\n    /** Flip point over y coordinate. */\n    negate() {\n        return new Point(M(-this.X), this.Y, this.Z, M(-this.T));\n    }\n    /** Point doubling. Complete formula. Cost: `4M + 4S + 1*a + 6add + 1*2`. */\n    double() {\n        const { X: X1, Y: Y1, Z: Z1 } = this;\n        const a = _a;\n        // https://hyperelliptic.org/EFD/g1p/auto-twisted-extended.html#doubling-dbl-2008-hwcd\n        const A = M(X1 * X1);\n        const B = M(Y1 * Y1);\n        const C = M(2n * M(Z1 * Z1));\n        const D = M(a * A);\n        const x1y1 = X1 + Y1;\n        const E = M(M(x1y1 * x1y1) - A - B);\n        const G = D + B;\n        const F = G - C;\n        const H = D - B;\n        const X3 = M(E * F);\n        const Y3 = M(G * H);\n        const T3 = M(E * H);\n        const Z3 = M(F * G);\n        return new Point(X3, Y3, Z3, T3);\n    }\n    /** Point addition. Complete formula. Cost: `8M + 1*k + 8add + 1*2`. */\n    add(other) {\n        const { X: X1, Y: Y1, Z: Z1, T: T1 } = this;\n        const { X: X2, Y: Y2, Z: Z2, T: T2 } = apoint(other); // doesn't check if other on-curve\n        const a = _a;\n        const d = _d;\n        // https://hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html#addition-add-2008-hwcd-3\n        const A = M(X1 * X2);\n        const B = M(Y1 * Y2);\n        const C = M(T1 * d * T2);\n        const D = M(Z1 * Z2);\n        const E = M((X1 + Y1) * (X2 + Y2) - A - B);\n        const F = M(D - C);\n        const G = M(D + C);\n        const H = M(B - a * A);\n        const X3 = M(E * F);\n        const Y3 = M(G * H);\n        const T3 = M(E * H);\n        const Z3 = M(F * G);\n        return new Point(X3, Y3, Z3, T3);\n    }\n    subtract(other) {\n        return this.add(apoint(other).negate());\n    }\n    /**\n     * Point-by-scalar multiplication. Scalar must be in range 1 <= n < CURVE.n.\n     * Uses {@link wNAF} for base point.\n     * Uses fake point to mitigate side-channel leakage.\n     * @param n scalar by which point is multiplied\n     * @param safe safe mode guards against timing attacks; unsafe mode is faster\n     */\n    multiply(n, safe = true) {\n        if (!safe && (n === 0n || this.is0()))\n            return I;\n        assertRange(n, 1n, N);\n        if (n === 1n)\n            return this;\n        if (this.equals(G))\n            return wNAF(n).p;\n        // init result point & fake point\n        let p = I;\n        let f = G;\n        for (let d = this; n > 0n; d = d.double(), n >>= 1n) {\n            // if bit is present, add to point\n            // if not present, add to fake, for timing safety\n            if (n & 1n)\n                p = p.add(d);\n            else if (safe)\n                f = f.add(d);\n        }\n        return p;\n    }\n    multiplyUnsafe(scalar) {\n        return this.multiply(scalar, false);\n    }\n    /** Convert point to 2d xy affine point. (X, Y, Z) ∋ (x=X/Z, y=Y/Z) */\n    toAffine() {\n        const { X, Y, Z } = this;\n        // fast-paths for ZERO point OR Z=1\n        if (this.equals(I))\n            return { x: 0n, y: 1n };\n        const iz = invert(Z, P);\n        // (Z * Z^-1) must be 1, otherwise bad math\n        if (M(Z * iz) !== 1n)\n            err('invalid inverse');\n        // x = X*Z^-1; y = Y*Z^-1\n        const x = M(X * iz);\n        const y = M(Y * iz);\n        return { x, y };\n    }\n    toBytes() {\n        const { x, y } = this.assertValidity().toAffine();\n        const b = numTo32bLE(y);\n        // store sign in first LE byte\n        b[31] |= x & 1n ? 0x80 : 0;\n        return b;\n    }\n    toHex() {\n        return bytesToHex(this.toBytes());\n    }\n    clearCofactor() {\n        return this.multiply(big(h), false);\n    }\n    isSmallOrder() {\n        return this.clearCofactor().is0();\n    }\n    isTorsionFree() {\n        // Multiply by big number N. We can't `mul(N)` because of checks. Instead, we `mul(N/2)*2+1`\n        let p = this.multiply(N / 2n, false).double();\n        if (N % 2n)\n            p = p.add(this);\n        return p.is0();\n    }\n}\n/** Generator / base point */\nconst G = new Point(Gx, Gy, 1n, M(Gx * Gy));\n/** Identity / zero point */\nconst I = new Point(0n, 1n, 1n, 0n);\n// Static aliases\nPoint.BASE = G;\nPoint.ZERO = I;\nconst numTo32bLE = (num) => hexToBytes(padh(assertRange(num, 0n, B256), L2)).reverse();\nconst bytesToNumLE = (b) => big('0x' + bytesToHex(u8fr(abytes(b)).reverse()));\nconst pow2 = (x, power) => {\n    // pow2(x, 4) == x^(2^4)\n    let r = x;\n    while (power-- > 0n) {\n        r *= r;\n        r %= P;\n    }\n    return r;\n};\n// prettier-ignore\nconst pow_2_252_3 = (x) => {\n    const x2 = (x * x) % P; // x^2,       bits 1\n    const b2 = (x2 * x) % P; // x^3,       bits 11\n    const b4 = (pow2(b2, 2n) * b2) % P; // x^(2^4-1), bits 1111\n    const b5 = (pow2(b4, 1n) * x) % P; // x^(2^5-1), bits 11111\n    const b10 = (pow2(b5, 5n) * b5) % P; // x^(2^10)\n    const b20 = (pow2(b10, 10n) * b10) % P; // x^(2^20)\n    const b40 = (pow2(b20, 20n) * b20) % P; // x^(2^40)\n    const b80 = (pow2(b40, 40n) * b40) % P; // x^(2^80)\n    const b160 = (pow2(b80, 80n) * b80) % P; // x^(2^160)\n    const b240 = (pow2(b160, 80n) * b80) % P; // x^(2^240)\n    const b250 = (pow2(b240, 10n) * b10) % P; // x^(2^250)\n    const pow_p_5_8 = (pow2(b250, 2n) * x) % P; // < To pow to (p+3)/8, multiply it by x.\n    return { pow_p_5_8, b2 };\n};\nconst RM1 = 0x2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0n; // √-1\n// for sqrt comp\n// prettier-ignore\nconst uvRatio = (u, v) => {\n    const v3 = M(v * v * v); // v³\n    const v7 = M(v3 * v3 * v); // v⁷\n    const pow = pow_2_252_3(u * v7).pow_p_5_8; // (uv⁷)^(p-5)/8\n    let x = M(u * v3 * pow); // (uv³)(uv⁷)^(p-5)/8\n    const vx2 = M(v * x * x); // vx²\n    const root1 = x; // First root candidate\n    const root2 = M(x * RM1); // Second root candidate; RM1 is √-1\n    const useRoot1 = vx2 === u; // If vx² = u (mod p), x is a square root\n    const useRoot2 = vx2 === M(-u); // If vx² = -u, set x <-- x * 2^((p-1)/4)\n    const noRoot = vx2 === M(-u * RM1); // There is no valid root, vx² = -u√-1\n    if (useRoot1)\n        x = root1;\n    if (useRoot2 || noRoot)\n        x = root2; // We return root2 anyway, for const-time\n    if ((M(x) & 1n) === 1n)\n        x = M(-x); // edIsNegative\n    return { isValid: useRoot1 || useRoot2, value: x };\n};\n// N == L, just weird naming\nconst modL_LE = (hash) => modN(bytesToNumLE(hash)); // modulo L; but little-endian\n/** hashes.sha512 should conform to the interface. */\n// TODO: rename\nconst sha512a = (...m) => hashes.sha512Async(concatBytes(...m)); // Async SHA512\nconst sha512s = (...m) => callHash('sha512')(concatBytes(...m));\n// RFC8032 5.1.5\nconst hash2extK = (hashed) => {\n    // slice creates a copy, unlike subarray\n    const head = hashed.slice(0, L);\n    head[0] &= 248; // Clamp bits: 0b1111_1000\n    head[31] &= 127; // 0b0111_1111\n    head[31] |= 64; // 0b0100_0000\n    const prefix = hashed.slice(L, L2); // secret key \"prefix\"\n    const scalar = modL_LE(head); // modular division over curve order\n    const point = G.multiply(scalar); // public key point\n    const pointBytes = point.toBytes(); // point serialized to Uint8Array\n    return { head, prefix, scalar, point, pointBytes };\n};\n// RFC8032 5.1.5; getPublicKey async, sync. Hash priv key and extract point.\nconst getExtendedPublicKeyAsync = (secretKey) => sha512a(abytes(secretKey, L)).then(hash2extK);\nconst getExtendedPublicKey = (secretKey) => hash2extK(sha512s(abytes(secretKey, L)));\n/** Creates 32-byte ed25519 public key from 32-byte secret key. Async. */\nconst getPublicKeyAsync = (secretKey) => getExtendedPublicKeyAsync(secretKey).then((p) => p.pointBytes);\n/** Creates 32-byte ed25519 public key from 32-byte secret key. To use, set `hashes.sha512` first. */\nconst getPublicKey = (priv) => getExtendedPublicKey(priv).pointBytes;\nconst hashFinishA = (res) => sha512a(res.hashable).then(res.finish);\nconst hashFinishS = (res) => res.finish(sha512s(res.hashable));\n// Code, shared between sync & async sign\nconst _sign = (e, rBytes, msg) => {\n    const { pointBytes: P, scalar: s } = e;\n    const r = modL_LE(rBytes); // r was created outside, reduce it modulo L\n    const R = G.multiply(r).toBytes(); // R = [r]B\n    const hashable = concatBytes(R, P, msg); // dom2(F, C) || R || A || PH(M)\n    const finish = (hashed) => {\n        // k = SHA512(dom2(F, C) || R || A || PH(M))\n        const S = modN(r + modL_LE(hashed) * s); // S = (r + k * s) mod L; 0 <= s < l\n        return abytes(concatBytes(R, numTo32bLE(S)), L2); // 64-byte sig: 32b R.x + 32b LE(S)\n    };\n    return { hashable, finish };\n};\n/**\n * Signs message using secret key. Async.\n * Follows RFC8032 5.1.6.\n */\nconst signAsync = async (message, secretKey) => {\n    const m = abytes(message);\n    const e = await getExtendedPublicKeyAsync(secretKey);\n    const rBytes = await sha512a(e.prefix, m); // r = SHA512(dom2(F, C) || prefix || PH(M))\n    return hashFinishA(_sign(e, rBytes, m)); // gen R, k, S, then 64-byte signature\n};\n/**\n * Signs message using secret key. To use, set `hashes.sha512` first.\n * Follows RFC8032 5.1.6.\n */\nconst sign = (message, secretKey) => {\n    const m = abytes(message);\n    const e = getExtendedPublicKey(secretKey);\n    const rBytes = sha512s(e.prefix, m); // r = SHA512(dom2(F, C) || prefix || PH(M))\n    return hashFinishS(_sign(e, rBytes, m)); // gen R, k, S, then 64-byte signature\n};\nconst defaultVerifyOpts = { zip215: true };\nconst _verify = (sig, msg, pub, opts = defaultVerifyOpts) => {\n    sig = abytes(sig, L2); // Signature hex str/Bytes, must be 64 bytes\n    msg = abytes(msg); // Message hex str/Bytes\n    pub = abytes(pub, L);\n    const { zip215 } = opts; // switch between zip215 and rfc8032 verif\n    let A;\n    let R;\n    let s;\n    let SB;\n    let hashable = Uint8Array.of();\n    try {\n        A = Point.fromBytes(pub, zip215); // public key A decoded\n        R = Point.fromBytes(sig.slice(0, L), zip215); // 0 <= R < 2^256: ZIP215 R can be >= P\n        s = bytesToNumLE(sig.slice(L, L2)); // Decode second half as an integer S\n        SB = G.multiply(s, false); // in the range 0 <= s < L\n        hashable = concatBytes(R.toBytes(), A.toBytes(), msg); // dom2(F, C) || R || A || PH(M)\n    }\n    catch (error) { }\n    const finish = (hashed) => {\n        // k = SHA512(dom2(F, C) || R || A || PH(M))\n        if (SB == null)\n            return false; // false if try-catch catched an error\n        if (!zip215 && A.isSmallOrder())\n            return false; // false for SBS: Strongly Binding Signature\n        const k = modL_LE(hashed); // decode in little-endian, modulo L\n        const RkA = R.add(A.multiply(k, false)); // [8]R + [8][k]A'\n        return RkA.add(SB.negate()).clearCofactor().is0(); // [8][S]B = [8]R + [8][k]A'\n    };\n    return { hashable, finish };\n};\n/** Verifies signature on message and public key. Async. Follows RFC8032 5.1.7. */\nconst verifyAsync = async (signature, message, publicKey, opts = defaultVerifyOpts) => hashFinishA(_verify(signature, message, publicKey, opts));\n/** Verifies signature on message and public key. To use, set `hashes.sha512` first. Follows RFC8032 5.1.7. */\nconst verify = (signature, message, publicKey, opts = defaultVerifyOpts) => hashFinishS(_verify(signature, message, publicKey, opts));\n/** Math, hex, byte helpers. Not in `utils` because utils share API with noble-curves. */\nconst etc = {\n    bytesToHex: bytesToHex,\n    hexToBytes: hexToBytes,\n    concatBytes: concatBytes,\n    mod: M,\n    invert: invert,\n    randomBytes: randomBytes,\n};\nconst hashes = {\n    sha512Async: async (message) => {\n        const s = subtle();\n        const m = concatBytes(message);\n        return u8n(await s.digest('SHA-512', m.buffer));\n    },\n    sha512: undefined,\n};\n// FIPS 186 B.4.1 compliant key generation produces private keys\n// with modulo bias being neglible. takes >N+16 bytes, returns (hash mod n-1)+1\nconst randomSecretKey = (seed = randomBytes(L)) => seed;\nconst keygen = (seed) => {\n    const secretKey = randomSecretKey(seed);\n    const publicKey = getPublicKey(secretKey);\n    return { secretKey, publicKey };\n};\nconst keygenAsync = async (seed) => {\n    const secretKey = randomSecretKey(seed);\n    const publicKey = await getPublicKeyAsync(secretKey);\n    return { secretKey, publicKey };\n};\n/** ed25519-specific key utilities. */\nconst utils = {\n    getExtendedPublicKeyAsync: getExtendedPublicKeyAsync,\n    getExtendedPublicKey: getExtendedPublicKey,\n    randomSecretKey: randomSecretKey,\n};\n// ## Precomputes\n// --------------\nconst W = 8; // W is window size\nconst scalarBits = 256;\nconst pwindows = Math.ceil(scalarBits / W) + 1; // 33 for W=8, NOT 32 - see wNAF loop\nconst pwindowSize = 2 ** (W - 1); // 128 for W=8\nconst precompute = () => {\n    const points = [];\n    let p = G;\n    let b = p;\n    for (let w = 0; w < pwindows; w++) {\n        b = p;\n        points.push(b);\n        for (let i = 1; i < pwindowSize; i++) {\n            b = b.add(p);\n            points.push(b);\n        } // i=1, bc we skip 0\n        p = b.double();\n    }\n    return points;\n};\nlet Gpows = undefined; // precomputes for base point G\n// const-time negate\nconst ctneg = (cnd, p) => {\n    const n = p.negate();\n    return cnd ? n : p;\n};\n/**\n * Precomputes give 12x faster getPublicKey(), 10x sign(), 2x verify() by\n * caching multiples of G (base point). Cache is stored in 32MB of RAM.\n * Any time `G.multiply` is done, precomputes are used.\n * Not used for getSharedSecret, which instead multiplies random pubkey `P.multiply`.\n *\n * w-ary non-adjacent form (wNAF) precomputation method is 10% slower than windowed method,\n * but takes 2x less RAM. RAM reduction is possible by utilizing `.subtract`.\n *\n * !! Precomputes can be disabled by commenting-out call of the wNAF() inside Point#multiply().\n */\nconst wNAF = (n) => {\n    const comp = Gpows || (Gpows = precompute());\n    let p = I;\n    let f = G; // f must be G, or could become I in the end\n    const pow_2_w = 2 ** W; // 256 for W=8\n    const maxNum = pow_2_w; // 256 for W=8\n    const mask = big(pow_2_w - 1); // 255 for W=8 == mask 0b11111111\n    const shiftBy = big(W); // 8 for W=8\n    for (let w = 0; w < pwindows; w++) {\n        let wbits = Number(n & mask); // extract W bits.\n        n >>= shiftBy; // shift number by W bits.\n        // We use negative indexes to reduce size of precomputed table by 2x.\n        // Instead of needing precomputes 0..256, we only calculate them for 0..128.\n        // If an index > 128 is found, we do (256-index) - where 256 is next window.\n        // Naive: index +127 => 127, +224 => 224\n        // Optimized: index +127 => 127, +224 => 256-32\n        if (wbits > pwindowSize) {\n            wbits -= maxNum;\n            n += 1n;\n        }\n        const off = w * pwindowSize;\n        const offF = off; // offsets, evaluate both\n        const offP = off + Math.abs(wbits) - 1;\n        const isEven = w % 2 !== 0; // conditions, evaluate both\n        const isNeg = wbits < 0;\n        if (wbits === 0) {\n            // off == I: can't add it. Adding random offF instead.\n            f = f.add(ctneg(isEven, comp[offF])); // bits are 0: add garbage to fake point\n        }\n        else {\n            p = p.add(ctneg(isNeg, comp[offP])); // bits are 1: add to result point\n        }\n    }\n    if (n !== 0n)\n        err('invalid wnaf');\n    return { p, f }; // return both real and fake points for JIT\n};\n// !! Remove the export to easily use in REPL / browser console\nexport { etc, getPublicKey, getPublicKeyAsync, hash, hashes, keygen, keygenAsync, Point, sign, signAsync, utils, verify, verifyAsync, };\n","import { getPublicKeyAsync, signAsync, utils } from \"@noble/ed25519\";\r\n\r\ntype StoredIdentity = {\r\n  version: 1;\r\n  deviceId: string;\r\n  publicKey: string;\r\n  privateKey: string;\r\n  createdAtMs: number;\r\n};\r\n\r\nexport type DeviceIdentity = {\r\n  deviceId: string;\r\n  publicKey: string;\r\n  privateKey: string;\r\n};\r\n\r\nconst STORAGE_KEY = \"openclaw-device-identity-v1\";\r\n\r\nfunction base64UrlEncode(bytes: Uint8Array): string {\r\n  let binary = \"\";\r\n  for (const byte of bytes) {\r\n    binary += String.fromCharCode(byte);\r\n  }\r\n  return btoa(binary).replaceAll(\"+\", \"-\").replaceAll(\"/\", \"_\").replace(/=+$/g, \"\");\r\n}\r\n\r\nfunction base64UrlDecode(input: string): Uint8Array {\r\n  const normalized = input.replaceAll(\"-\", \"+\").replaceAll(\"_\", \"/\");\r\n  const padded = normalized + \"=\".repeat((4 - (normalized.length % 4)) % 4);\r\n  const binary = atob(padded);\r\n  const out = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i += 1) {\r\n    out[i] = binary.charCodeAt(i);\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction bytesToHex(bytes: Uint8Array): string {\r\n  return Array.from(bytes)\r\n    .map((b) => b.toString(16).padStart(2, \"0\"))\r\n    .join(\"\");\r\n}\r\n\r\nasync function fingerprintPublicKey(publicKey: Uint8Array): Promise<string> {\r\n  const hash = await crypto.subtle.digest(\"SHA-256\", publicKey.slice().buffer);\r\n  return bytesToHex(new Uint8Array(hash));\r\n}\r\n\r\nasync function generateIdentity(): Promise<DeviceIdentity> {\r\n  const privateKey = utils.randomSecretKey();\r\n  const publicKey = await getPublicKeyAsync(privateKey);\r\n  const deviceId = await fingerprintPublicKey(publicKey);\r\n  return {\r\n    deviceId,\r\n    publicKey: base64UrlEncode(publicKey),\r\n    privateKey: base64UrlEncode(privateKey),\r\n  };\r\n}\r\n\r\nexport async function loadOrCreateDeviceIdentity(): Promise<DeviceIdentity> {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (raw) {\r\n      const parsed = JSON.parse(raw) as StoredIdentity;\r\n      if (\r\n        parsed?.version === 1 &&\r\n        typeof parsed.deviceId === \"string\" &&\r\n        typeof parsed.publicKey === \"string\" &&\r\n        typeof parsed.privateKey === \"string\"\r\n      ) {\r\n        const derivedId = await fingerprintPublicKey(base64UrlDecode(parsed.publicKey));\r\n        if (derivedId !== parsed.deviceId) {\r\n          const updated: StoredIdentity = {\r\n            ...parsed,\r\n            deviceId: derivedId,\r\n          };\r\n          localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));\r\n          return {\r\n            deviceId: derivedId,\r\n            publicKey: parsed.publicKey,\r\n            privateKey: parsed.privateKey,\r\n          };\r\n        }\r\n        return {\r\n          deviceId: parsed.deviceId,\r\n          publicKey: parsed.publicKey,\r\n          privateKey: parsed.privateKey,\r\n        };\r\n      }\r\n    }\r\n  } catch {\r\n    // fall through to regenerate\r\n  }\r\n\r\n  const identity = await generateIdentity();\r\n  const stored: StoredIdentity = {\r\n    version: 1,\r\n    deviceId: identity.deviceId,\r\n    publicKey: identity.publicKey,\r\n    privateKey: identity.privateKey,\r\n    createdAtMs: Date.now(),\r\n  };\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(stored));\r\n  return identity;\r\n}\r\n\r\nexport async function signDevicePayload(privateKeyBase64Url: string, payload: string) {\r\n  const key = base64UrlDecode(privateKeyBase64Url);\r\n  const data = new TextEncoder().encode(payload);\r\n  const sig = await signAsync(data, key);\r\n  return base64UrlEncode(sig);\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport { clearDeviceAuthToken, storeDeviceAuthToken } from \"../device-auth.ts\";\r\nimport { loadOrCreateDeviceIdentity } from \"../device-identity.ts\";\r\n\r\nexport type DeviceTokenSummary = {\r\n  role: string;\r\n  scopes?: string[];\r\n  createdAtMs?: number;\r\n  rotatedAtMs?: number;\r\n  revokedAtMs?: number;\r\n  lastUsedAtMs?: number;\r\n};\r\n\r\nexport type PendingDevice = {\r\n  requestId: string;\r\n  deviceId: string;\r\n  displayName?: string;\r\n  role?: string;\r\n  remoteIp?: string;\r\n  isRepair?: boolean;\r\n  ts?: number;\r\n};\r\n\r\nexport type PairedDevice = {\r\n  deviceId: string;\r\n  displayName?: string;\r\n  roles?: string[];\r\n  scopes?: string[];\r\n  remoteIp?: string;\r\n  tokens?: DeviceTokenSummary[];\r\n  createdAtMs?: number;\r\n  approvedAtMs?: number;\r\n};\r\n\r\nexport type DevicePairingList = {\r\n  pending: PendingDevice[];\r\n  paired: PairedDevice[];\r\n};\r\n\r\nexport type DevicesState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  devicesLoading: boolean;\r\n  devicesError: string | null;\r\n  devicesList: DevicePairingList | null;\r\n};\r\n\r\nexport async function loadDevices(state: DevicesState, opts?: { quiet?: boolean }) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.devicesLoading) {\r\n    return;\r\n  }\r\n  state.devicesLoading = true;\r\n  if (!opts?.quiet) {\r\n    state.devicesError = null;\r\n  }\r\n  try {\r\n    const res = await state.client.request<{\r\n      pending?: Array<PendingDevice>;\r\n      paired?: Array<PendingDevice>;\r\n    }>(\"device.pair.list\", {});\r\n    state.devicesList = {\r\n      pending: Array.isArray(res?.pending) ? res.pending : [],\r\n      paired: Array.isArray(res?.paired) ? res.paired : [],\r\n    };\r\n  } catch (err) {\r\n    if (!opts?.quiet) {\r\n      state.devicesError = String(err);\r\n    }\r\n  } finally {\r\n    state.devicesLoading = false;\r\n  }\r\n}\r\n\r\nexport async function approveDevicePairing(state: DevicesState, requestId: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  try {\r\n    await state.client.request(\"device.pair.approve\", { requestId });\r\n    await loadDevices(state);\r\n  } catch (err) {\r\n    state.devicesError = String(err);\r\n  }\r\n}\r\n\r\nexport async function rejectDevicePairing(state: DevicesState, requestId: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  const confirmed = window.confirm(\"Reject this device pairing request?\");\r\n  if (!confirmed) {\r\n    return;\r\n  }\r\n  try {\r\n    await state.client.request(\"device.pair.reject\", { requestId });\r\n    await loadDevices(state);\r\n  } catch (err) {\r\n    state.devicesError = String(err);\r\n  }\r\n}\r\n\r\nexport async function rotateDeviceToken(\r\n  state: DevicesState,\r\n  params: { deviceId: string; role: string; scopes?: string[] },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  try {\r\n    const res = await state.client.request<{\r\n      token: string;\r\n      role?: string;\r\n      deviceId?: string;\r\n      scopes?: Array<string>;\r\n    }>(\"device.token.rotate\", params);\r\n    if (res?.token) {\r\n      const identity = await loadOrCreateDeviceIdentity();\r\n      const role = res.role ?? params.role;\r\n      if (res.deviceId === identity.deviceId || params.deviceId === identity.deviceId) {\r\n        storeDeviceAuthToken({\r\n          deviceId: identity.deviceId,\r\n          role,\r\n          token: res.token,\r\n          scopes: res.scopes ?? params.scopes ?? [],\r\n        });\r\n      }\r\n      window.prompt(\"New device token (copy and store securely):\", res.token);\r\n    }\r\n    await loadDevices(state);\r\n  } catch (err) {\r\n    state.devicesError = String(err);\r\n  }\r\n}\r\n\r\nexport async function revokeDeviceToken(\r\n  state: DevicesState,\r\n  params: { deviceId: string; role: string },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  const confirmed = window.confirm(`Revoke token for ${params.deviceId} (${params.role})?`);\r\n  if (!confirmed) {\r\n    return;\r\n  }\r\n  try {\r\n    await state.client.request(\"device.token.revoke\", params);\r\n    const identity = await loadOrCreateDeviceIdentity();\r\n    if (params.deviceId === identity.deviceId) {\r\n      clearDeviceAuthToken({ deviceId: identity.deviceId, role: params.role });\r\n    }\r\n    await loadDevices(state);\r\n  } catch (err) {\r\n    state.devicesError = String(err);\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport { cloneConfigObject, removePathValue, setPathValue } from \"./config/form-utils.ts\";\r\n\r\nexport type ExecApprovalsDefaults = {\r\n  security?: string;\r\n  ask?: string;\r\n  askFallback?: string;\r\n  autoAllowSkills?: boolean;\r\n};\r\n\r\nexport type ExecApprovalsAllowlistEntry = {\r\n  id?: string;\r\n  pattern: string;\r\n  lastUsedAt?: number;\r\n  lastUsedCommand?: string;\r\n  lastResolvedPath?: string;\r\n};\r\n\r\nexport type ExecApprovalsAgent = ExecApprovalsDefaults & {\r\n  allowlist?: ExecApprovalsAllowlistEntry[];\r\n};\r\n\r\nexport type ExecApprovalsFile = {\r\n  version?: number;\r\n  socket?: { path?: string };\r\n  defaults?: ExecApprovalsDefaults;\r\n  agents?: Record<string, ExecApprovalsAgent>;\r\n};\r\n\r\nexport type ExecApprovalsSnapshot = {\r\n  path: string;\r\n  exists: boolean;\r\n  hash: string;\r\n  file: ExecApprovalsFile;\r\n};\r\n\r\nexport type ExecApprovalsTarget = { kind: \"gateway\" } | { kind: \"node\"; nodeId: string };\r\n\r\nexport type ExecApprovalsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  execApprovalsLoading: boolean;\r\n  execApprovalsSaving: boolean;\r\n  execApprovalsDirty: boolean;\r\n  execApprovalsSnapshot: ExecApprovalsSnapshot | null;\r\n  execApprovalsForm: ExecApprovalsFile | null;\r\n  execApprovalsSelectedAgent: string | null;\r\n  lastError: string | null;\r\n};\r\n\r\nfunction resolveExecApprovalsRpc(target?: ExecApprovalsTarget | null): {\r\n  method: string;\r\n  params: Record<string, unknown>;\r\n} | null {\r\n  if (!target || target.kind === \"gateway\") {\r\n    return { method: \"exec.approvals.get\", params: {} };\r\n  }\r\n  const nodeId = target.nodeId.trim();\r\n  if (!nodeId) {\r\n    return null;\r\n  }\r\n  return { method: \"exec.approvals.node.get\", params: { nodeId } };\r\n}\r\n\r\nfunction resolveExecApprovalsSaveRpc(\r\n  target: ExecApprovalsTarget | null | undefined,\r\n  params: { file: ExecApprovalsFile; baseHash: string },\r\n): { method: string; params: Record<string, unknown> } | null {\r\n  if (!target || target.kind === \"gateway\") {\r\n    return { method: \"exec.approvals.set\", params };\r\n  }\r\n  const nodeId = target.nodeId.trim();\r\n  if (!nodeId) {\r\n    return null;\r\n  }\r\n  return { method: \"exec.approvals.node.set\", params: { ...params, nodeId } };\r\n}\r\n\r\nexport async function loadExecApprovals(\r\n  state: ExecApprovalsState,\r\n  target?: ExecApprovalsTarget | null,\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.execApprovalsLoading) {\r\n    return;\r\n  }\r\n  state.execApprovalsLoading = true;\r\n  state.lastError = null;\r\n  try {\r\n    const rpc = resolveExecApprovalsRpc(target);\r\n    if (!rpc) {\r\n      state.lastError = \"Select a node before loading exec approvals.\";\r\n      return;\r\n    }\r\n    const res = await state.client.request<ExecApprovalsSnapshot>(rpc.method, rpc.params);\r\n    applyExecApprovalsSnapshot(state, res);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.execApprovalsLoading = false;\r\n  }\r\n}\r\n\r\nexport function applyExecApprovalsSnapshot(\r\n  state: ExecApprovalsState,\r\n  snapshot: ExecApprovalsSnapshot,\r\n) {\r\n  state.execApprovalsSnapshot = snapshot;\r\n  if (!state.execApprovalsDirty) {\r\n    state.execApprovalsForm = cloneConfigObject(snapshot.file ?? {});\r\n  }\r\n}\r\n\r\nexport async function saveExecApprovals(\r\n  state: ExecApprovalsState,\r\n  target?: ExecApprovalsTarget | null,\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.execApprovalsSaving = true;\r\n  state.lastError = null;\r\n  try {\r\n    const baseHash = state.execApprovalsSnapshot?.hash;\r\n    if (!baseHash) {\r\n      state.lastError = \"Exec approvals hash missing; reload and retry.\";\r\n      return;\r\n    }\r\n    const file = state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {};\r\n    const rpc = resolveExecApprovalsSaveRpc(target, { file, baseHash });\r\n    if (!rpc) {\r\n      state.lastError = \"Select a node before saving exec approvals.\";\r\n      return;\r\n    }\r\n    await state.client.request(rpc.method, rpc.params);\r\n    state.execApprovalsDirty = false;\r\n    await loadExecApprovals(state, target);\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.execApprovalsSaving = false;\r\n  }\r\n}\r\n\r\nexport function updateExecApprovalsFormValue(\r\n  state: ExecApprovalsState,\r\n  path: Array<string | number>,\r\n  value: unknown,\r\n) {\r\n  const base = cloneConfigObject(\r\n    state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {},\r\n  );\r\n  setPathValue(base, path, value);\r\n  state.execApprovalsForm = base;\r\n  state.execApprovalsDirty = true;\r\n}\r\n\r\nexport function removeExecApprovalsFormValue(\r\n  state: ExecApprovalsState,\r\n  path: Array<string | number>,\r\n) {\r\n  const base = cloneConfigObject(\r\n    state.execApprovalsForm ?? state.execApprovalsSnapshot?.file ?? {},\r\n  );\r\n  removePathValue(base, path);\r\n  state.execApprovalsForm = base;\r\n  state.execApprovalsDirty = true;\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { PresenceEntry } from \"../types.ts\";\r\n\r\nexport type PresenceState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  presenceLoading: boolean;\r\n  presenceEntries: PresenceEntry[];\r\n  presenceError: string | null;\r\n  presenceStatus: string | null;\r\n};\r\n\r\nexport async function loadPresence(state: PresenceState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.presenceLoading) {\r\n    return;\r\n  }\r\n  state.presenceLoading = true;\r\n  state.presenceError = null;\r\n  state.presenceStatus = null;\r\n  try {\r\n    const res = await state.client.request(\"system-presence\", {});\r\n    if (Array.isArray(res)) {\r\n      state.presenceEntries = res;\r\n      state.presenceStatus = res.length === 0 ? \"No instances yet.\" : null;\r\n    } else {\r\n      state.presenceEntries = [];\r\n      state.presenceStatus = \"No presence payload.\";\r\n    }\r\n  } catch (err) {\r\n    state.presenceError = String(err);\r\n  } finally {\r\n    state.presenceLoading = false;\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { SessionsListResult } from \"../types.ts\";\r\nimport { toNumber } from \"../format.ts\";\r\n\r\nexport type SessionsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  sessionsLoading: boolean;\r\n  sessionsResult: SessionsListResult | null;\r\n  sessionsError: string | null;\r\n  sessionsFilterActive: string;\r\n  sessionsFilterLimit: string;\r\n  sessionsIncludeGlobal: boolean;\r\n  sessionsIncludeUnknown: boolean;\r\n};\r\n\r\nexport async function loadSessions(\r\n  state: SessionsState,\r\n  overrides?: {\r\n    activeMinutes?: number;\r\n    limit?: number;\r\n    includeGlobal?: boolean;\r\n    includeUnknown?: boolean;\r\n  },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.sessionsLoading) {\r\n    return;\r\n  }\r\n  state.sessionsLoading = true;\r\n  state.sessionsError = null;\r\n  try {\r\n    const includeGlobal = overrides?.includeGlobal ?? state.sessionsIncludeGlobal;\r\n    const includeUnknown = overrides?.includeUnknown ?? state.sessionsIncludeUnknown;\r\n    const activeMinutes = overrides?.activeMinutes ?? toNumber(state.sessionsFilterActive, 0);\r\n    const limit = overrides?.limit ?? toNumber(state.sessionsFilterLimit, 0);\r\n    const params: Record<string, unknown> = {\r\n      includeGlobal,\r\n      includeUnknown,\r\n    };\r\n    if (activeMinutes > 0) {\r\n      params.activeMinutes = activeMinutes;\r\n    }\r\n    if (limit > 0) {\r\n      params.limit = limit;\r\n    }\r\n    const res = await state.client.request<SessionsListResult | undefined>(\"sessions.list\", params);\r\n    if (res) {\r\n      state.sessionsResult = res;\r\n    }\r\n  } catch (err) {\r\n    state.sessionsError = String(err);\r\n  } finally {\r\n    state.sessionsLoading = false;\r\n  }\r\n}\r\n\r\nexport async function patchSession(\r\n  state: SessionsState,\r\n  key: string,\r\n  patch: {\r\n    label?: string | null;\r\n    thinkingLevel?: string | null;\r\n    verboseLevel?: string | null;\r\n    reasoningLevel?: string | null;\r\n  },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  const params: Record<string, unknown> = { key };\r\n  if (\"label\" in patch) {\r\n    params.label = patch.label;\r\n  }\r\n  if (\"thinkingLevel\" in patch) {\r\n    params.thinkingLevel = patch.thinkingLevel;\r\n  }\r\n  if (\"verboseLevel\" in patch) {\r\n    params.verboseLevel = patch.verboseLevel;\r\n  }\r\n  if (\"reasoningLevel\" in patch) {\r\n    params.reasoningLevel = patch.reasoningLevel;\r\n  }\r\n  try {\r\n    await state.client.request(\"sessions.patch\", params);\r\n    await loadSessions(state);\r\n  } catch (err) {\r\n    state.sessionsError = String(err);\r\n  }\r\n}\r\n\r\nexport async function deleteSession(state: SessionsState, key: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.sessionsLoading) {\r\n    return;\r\n  }\r\n  const confirmed = window.confirm(\r\n    `Delete session \"${key}\"?\\n\\nDeletes the session entry and archives its transcript.`,\r\n  );\r\n  if (!confirmed) {\r\n    return;\r\n  }\r\n  state.sessionsLoading = true;\r\n  state.sessionsError = null;\r\n  try {\r\n    await state.client.request(\"sessions.delete\", { key, deleteTranscript: true });\r\n    await loadSessions(state);\r\n  } catch (err) {\r\n    state.sessionsError = String(err);\r\n  } finally {\r\n    state.sessionsLoading = false;\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { SkillStatusReport } from \"../types.ts\";\r\n\r\nexport type SkillsState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  skillsLoading: boolean;\r\n  skillsReport: SkillStatusReport | null;\r\n  skillsError: string | null;\r\n  skillsBusyKey: string | null;\r\n  skillEdits: Record<string, string>;\r\n  skillMessages: SkillMessageMap;\r\n};\r\n\r\nexport type SkillMessage = {\r\n  kind: \"success\" | \"error\";\r\n  message: string;\r\n};\r\n\r\nexport type SkillMessageMap = Record<string, SkillMessage>;\r\n\r\ntype LoadSkillsOptions = {\r\n  clearMessages?: boolean;\r\n};\r\n\r\nfunction setSkillMessage(state: SkillsState, key: string, message?: SkillMessage) {\r\n  if (!key.trim()) {\r\n    return;\r\n  }\r\n  const next = { ...state.skillMessages };\r\n  if (message) {\r\n    next[key] = message;\r\n  } else {\r\n    delete next[key];\r\n  }\r\n  state.skillMessages = next;\r\n}\r\n\r\nfunction getErrorMessage(err: unknown) {\r\n  if (err instanceof Error) {\r\n    return err.message;\r\n  }\r\n  return String(err);\r\n}\r\n\r\nexport async function loadSkills(state: SkillsState, options?: LoadSkillsOptions) {\r\n  if (options?.clearMessages && Object.keys(state.skillMessages).length > 0) {\r\n    state.skillMessages = {};\r\n  }\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.skillsLoading) {\r\n    return;\r\n  }\r\n  state.skillsLoading = true;\r\n  state.skillsError = null;\r\n  try {\r\n    const res = await state.client.request<SkillStatusReport | undefined>(\"skills.status\", {});\r\n    if (res) {\r\n      state.skillsReport = res;\r\n    }\r\n  } catch (err) {\r\n    state.skillsError = getErrorMessage(err);\r\n  } finally {\r\n    state.skillsLoading = false;\r\n  }\r\n}\r\n\r\nexport function updateSkillEdit(state: SkillsState, skillKey: string, value: string) {\r\n  state.skillEdits = { ...state.skillEdits, [skillKey]: value };\r\n}\r\n\r\nexport async function updateSkillEnabled(state: SkillsState, skillKey: string, enabled: boolean) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.skillsBusyKey = skillKey;\r\n  state.skillsError = null;\r\n  try {\r\n    await state.client.request(\"skills.update\", { skillKey, enabled });\r\n    await loadSkills(state);\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"success\",\r\n      message: enabled ? \"Skill enabled\" : \"Skill disabled\",\r\n    });\r\n  } catch (err) {\r\n    const message = getErrorMessage(err);\r\n    state.skillsError = message;\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"error\",\r\n      message,\r\n    });\r\n  } finally {\r\n    state.skillsBusyKey = null;\r\n  }\r\n}\r\n\r\nexport async function saveSkillApiKey(state: SkillsState, skillKey: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.skillsBusyKey = skillKey;\r\n  state.skillsError = null;\r\n  try {\r\n    const apiKey = state.skillEdits[skillKey] ?? \"\";\r\n    await state.client.request(\"skills.update\", { skillKey, apiKey });\r\n    await loadSkills(state);\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"success\",\r\n      message: \"API key saved\",\r\n    });\r\n  } catch (err) {\r\n    const message = getErrorMessage(err);\r\n    state.skillsError = message;\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"error\",\r\n      message,\r\n    });\r\n  } finally {\r\n    state.skillsBusyKey = null;\r\n  }\r\n}\r\n\r\nexport async function installSkill(\r\n  state: SkillsState,\r\n  skillKey: string,\r\n  name: string,\r\n  installId: string,\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.skillsBusyKey = skillKey;\r\n  state.skillsError = null;\r\n  try {\r\n    const result = await state.client.request<{ message?: string }>(\"skills.install\", {\r\n      name,\r\n      installId,\r\n      timeoutMs: 120000,\r\n    });\r\n    await loadSkills(state);\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"success\",\r\n      message: result?.message ?? \"Installed\",\r\n    });\r\n  } catch (err) {\r\n    const message = getErrorMessage(err);\r\n    state.skillsError = message;\r\n    setSkillMessage(state, skillKey, {\r\n      kind: \"error\",\r\n      message,\r\n    });\r\n  } finally {\r\n    state.skillsBusyKey = null;\r\n  }\r\n}\r\n","/**\r\n * OpenClaw 控制台 UI - 中文翻译映射表\r\n * 翻译范围：仅静态界面文本\r\n */\r\n\r\nexport const zhCN: Record<string, string> = {\r\n  // ============ 通用 ============\r\n  'OpenClaw': 'OpenClaw',\r\n  'Overview': '总览',\r\n  'Settings': '设置',\r\n  'Status': '状态',\r\n  'Dashboard': '仪表板',\r\n  'Connect': '连接',\r\n  'Disconnect': '断开',\r\n  'Connecting...': '连接中...',\r\n  'Connected': '已连接',\r\n  'Disconnected': '已断开',\r\n  'Connecting': '正在连接',\r\n  'n/a': '不可用',\r\n  'seconds': '秒',\r\n  'minutes': '分钟',\r\n  'hours': '小时',\r\n  'days': '天',\r\n  'Uptime': '运行时间',\r\n  'Policy Tick': '策略时钟',\r\n  'Channel': '渠道',\r\n  'Channels': '渠道',\r\n  'Session': '会话',\r\n  'Sessions': '会话',\r\n  'Cron': '定时任务',\r\n  'Cron Jobs': '定时任务',\r\n  'Instance': '实例',\r\n  'Instances': '实例',\r\n  'gateway': '网关',\r\n  'Gateway': '网关',\r\n  'Node': '节点',\r\n  'Nodes': '节点',\r\n  'Skill': '技能',\r\n  'Skills': '技能',\r\n  'Job': '任务',\r\n  'Jobs': '任务',\r\n  'Log': '日志',\r\n  'Logs': '日志',\r\n  'Device': '设备',\r\n  'Devices': '设备',\r\n  'Agent': '代理',\r\n  'Agents': '代理',\r\n  'Files': '文件',\r\n  'Tools': '工具',\r\n\r\n  // ============ 导航栏 ============\r\n  'Control': '控制台',\r\n  'Resources': '资源',\r\n  'Docs': '文档',\r\n\r\n  // ============ 按钮 ============\r\n  'Save': '保存',\r\n  'Cancel': '取消',\r\n  'Edit': '编辑',\r\n  'Delete': '删除',\r\n  'Add': '添加',\r\n  'Search': '搜索',\r\n  'Enable': '启用',\r\n  'Disable': '禁用',\r\n  'Configure': '配置',\r\n  'Unknown': '未知',\r\n  'Ready': '就绪',\r\n  'Install': '安装',\r\n  'Uninstall': '卸载',\r\n  'Update': '更新',\r\n  'Remove': '移除',\r\n  'Clear': '清除',\r\n  'Abort': '中止',\r\n  'Stop': '停止',\r\n  'Retry': '重试',\r\n  'Close': '关闭',\r\n  'Back': '返回',\r\n  'Next': '下一步',\r\n  'Previous': '上一步',\r\n  'Done': '完成',\r\n  'OK': '确定',\r\n  'Yes': '是',\r\n  'No': '否',\r\n  'On': '开',\r\n  'Off': '关',\r\n  'Run': '运行',\r\n  'Call': '调用',\r\n  'Export': '导出',\r\n  'Download': '下载',\r\n  'Copy': '复制',\r\n  'Approve': '批准',\r\n  'Reject': '拒绝',\r\n  'Revoke': '撤销',\r\n  'Allow': '允许',\r\n  'Deny': '拒绝',\r\n\r\n  // ============ chat.ts ============\r\n  'Send': '发送',\r\n  'New session': '新会话',\r\n  'Focus mode': '专注模式',\r\n  'Split ratio': '分割比例',\r\n  'Loading...': '加载中...',\r\n  'Loading chat…': '正在加载聊天…',\r\n  'Compacting context...': '正在压缩上下文...',\r\n  'Context compacted': '上下文已压缩',\r\n  'New message in': '新消息来自',\r\n  'Queue': '队列',\r\n  'Chat': '聊天',\r\n  'Chat history': '聊天历史',\r\n  'Attach file': '附加文件',\r\n  'Send message': '发送消息',\r\n  'Connect to the gateway to start chatting…': '连接到网关以开始聊天…',\r\n  'Add a message or paste more images...': '添加消息或粘贴更多图片...',\r\n\r\n  // ============ config.ts ============\r\n  'Configuration': '配置',\r\n  'Config': '配置',\r\n  'Apply': '应用',\r\n  'Apply & Restart': '应用并重启',\r\n  'Raw JSON': '原始 JSON',\r\n  'Raw': '原始',\r\n  'Form': '表单',\r\n  'Reset': '重置',\r\n  'Generating diff...': '正在生成差异...',\r\n  'Analysis': '分析',\r\n  'Diff': '差异',\r\n  'No changes': '无更改',\r\n  'Loading schema…': '正在加载模式...',\r\n  'Saving...': '正在保存...',\r\n  'Applying...': '正在应用...',\r\n  'Saved': '已保存',\r\n  'Error:': '错误：',\r\n  'Invalid configuration': '无效配置',\r\n  'Configuration saved. Restart the gateway to apply changes.': '配置已保存。重启网关以应用更改。',\r\n  'Restart required': '需要重启',\r\n  'The gateway must be restarted for changes to take effect.': '网关必须重启才能生效。',\r\n  'Restart now': '立即重启',\r\n  'Restart later': '稍后重启',\r\n  'All': '全部',\r\n  'All Settings': '所有设置',\r\n  'Search settings...': '搜索设置...',\r\n  'Unsaved changes': '未保存的更改',\r\n  'Reload': '重新加载',\r\n\r\n  // ============ 配置按钮补充 ============\r\n  'Update': '更新',\r\n  'View': '查看',\r\n  'pending': '待处理',\r\n  'change': '更改',\r\n  'changes': '更改',\r\n\r\n  // ============ 配置子页面 ============\r\n  'Environment': '环境',\r\n  'Updates': '更新',\r\n  'Authentication': '身份验证',\r\n  'Messages': '消息',\r\n  'Commands': '命令',\r\n  'Hooks': '钩子',\r\n  'Skills': '技能',\r\n  'Tools': '工具',\r\n  'Gateway': '网关',\r\n  'Meta': '元信息',\r\n  'Broadcast': '广播',\r\n  'Audio': '音频',\r\n  'Session': '会话',\r\n  'Cron': '定时任务',\r\n  'Discovery': '发现',\r\n  'CanvasHost': '画布主机',\r\n  'Plugins': '插件',\r\n  'Ui': '界面',\r\n  'Models': '模型',\r\n  'Setup Wizard': '设置向导',\r\n  'Diagnostics': '诊断',\r\n  'Logging': '日志',\r\n  'Browser': '浏览器',\r\n  'NodeHost': '节点主机',\r\n  'Bindings': '绑定',\r\n  'Media': '媒体',\r\n  'Approvals': '审批',\r\n  'Web': '网络',\r\n  'Memory': '内存',\r\n  'Talk': '对话',\r\n\r\n  // ============ 概览页 ============\r\n  'This gateway requires auth. Add a token or password, then click Connect.': '此网关需要身份验证。请添加令牌或密码，然后点击连接。',\r\n  'Auth failed. Update the token or password in Control UI settings, then click Connect.': '身份验证失败。请在控制台设置中更新令牌或密码，然后点击连接。',\r\n  'Gateway requires auth.': '网关需要身份验证。',\r\n  'Add a token or password in settings.': '在设置中添加令牌或密码。',\r\n  'Last refresh': '上次刷新',\r\n  'Gateway URL': '网关地址',\r\n  'Token': '令牌',\r\n  'Password': '密码',\r\n  'Version': '版本',\r\n  'Refresh': '刷新',\r\n  'Open Control UI': '打开控制台',\r\n\r\n  // ============ 导航补充 ============\r\n  'Usage': '使用统计',\r\n  'Debug': '调试',\r\n  'Logs': '日志',\r\n  'Instances': '实例',\r\n  'Switch Language': '切换语言',\r\n\r\n  // ============ 配置子页面补充 ============\r\n  'Environment Variables': '环境变量',\r\n  'Auto-update settings and release channel': '自动更新设置和发布渠道',\r\n  'Agent configurations, models, and identities': '代理配置、模型和身份',\r\n  'API keys and authentication profiles': 'API 密钥和身份验证配置',\r\n  'Messaging channels (Telegram, Discord, Slack, etc.)': '消息渠道 (Telegram, Discord, Slack 等)',\r\n  'Message handling and routing settings': '消息处理和路由设置',\r\n  'Custom slash commands': '自定义斜杠命令',\r\n  'Webhooks and event hooks': 'Webhooks 和事件钩子',\r\n  'Skill packs and capabilities': '技能包和能力',\r\n  'Tool configurations (browser, search, etc.)': '工具配置 (浏览器、搜索等)',\r\n  'Gateway server settings (port, auth, binding)': '网关服务器设置 (端口、认证、绑定)',\r\n  'Setup wizard state and history': '设置向导状态和历史',\r\n  'Gateway metadata and version information': '网关元数据和版本信息',\r\n  'Log levels and output configuration': '日志级别和输出配置',\r\n  'Browser automation settings': '浏览器自动化设置',\r\n  'User interface preferences': '用户界面首选项',\r\n  'AI model configurations and providers': 'AI 模型配置和提供商',\r\n  'Key bindings and shortcuts': '键绑定和快捷键',\r\n  'Broadcast and notification settings': '广播和通知设置',\r\n  'Audio input/output settings': '音频输入/输出设置',\r\n  'Session management and persistence': '会话管理和持久化',\r\n  'Scheduled tasks and automation': '计划任务和自动化',\r\n  'Web server and API settings': 'Web 服务器和 API 设置',\r\n  'Service discovery and networking': '服务发现和网络',\r\n  'Canvas rendering and display': '画布渲染和显示',\r\n  'Plugin management and extensions': '插件管理和扩展',\r\n  'Node host settings and management': '节点主机设置和管理',\r\n  'Media processing and storage': '媒体处理和存储',\r\n  'Pending approvals and authorizations': '待批准和授权',\r\n  'Memory management and limits': '内存管理和限制',\r\n  'System diagnostics and troubleshooting': '系统诊断和故障排除',\r\n\r\n  // ============ 配置表单错误 ============\r\n  'No settings in this section': '此部分无设置',\r\n  'No settings match': '无匹配设置',\r\n  'Unsupported schema node. Use Raw mode.': '不支持的架构节点。请使用原始模式。',\r\n  'Unsupported type:': '不支持的类型：',\r\n  'Use Raw mode.': '请使用原始模式。',\r\n  'Unsupported array schema. Use Raw mode.': '不支持的数组架构。请使用原始模式。',\r\n\r\n  // ============ 概览页 ============\r\n  'This gateway requires auth. Add a token or password, then click Connect.': '此网关需要身份验证。请添加令牌或密码，然后点击连接。',\r\n  'Auth failed. Update the token or password in Control UI settings, then click Connect.': '身份验证失败。请在控制台设置中更新令牌或密码，然后点击连接。',\r\n  'This page is HTTP, so the browser blocks device identity.': '此页面是 HTTP，浏览器阻止设备身份验证。',\r\n  'Use HTTPS (Tailscale Serve) or open': '请使用 HTTPS (Tailscale Serve) 或打开',\r\n  'on the gateway host.': '在网关上。',\r\n  'If you must stay on HTTP, set': '如果必须使用 HTTP，请设置',\r\n  '(token-only).': '（仅令牌）。',\r\n  'Docs: Control UI auth': '文档：控制台身份验证',\r\n  'Docs: Tailscale Serve': '文档：Tailscale Serve',\r\n  'Docs: Insecure HTTP': '文档：不安全 HTTP',\r\n  'open the Control UI': '打开控制台',\r\n  'set token': '设置令牌',\r\n\r\n  // ============ Overview 页面 ============\r\n  'Gateway Access': '网关访问',\r\n  'Where the dashboard connects and how it authenticates.': '控制台连接位置和身份验证方式',\r\n  'WebSocket URL': 'WebSocket 地址',\r\n  'Gateway Token': '网关令牌',\r\n  'Password (not stored)': '密码（不存储）',\r\n  'Default Session Key': '默认会话密钥',\r\n  'Click Connect to apply connection changes.': '点击连接以应用连接更改',\r\n  'Snapshot': '快照',\r\n  'Latest gateway handshake information.': '最新的网关握手信息',\r\n  'Tick Interval': '时钟间隔',\r\n  'Last Channels Refresh': '最后渠道刷新',\r\n  'Use Channels to link WhatsApp, Telegram, Discord, Signal, or iMessage.': '使用渠道链接 WhatsApp、Telegram、Discord、Signal 或 iMessage',\r\n  'Presence beacons in the last 5 minutes.': '最近 5 分钟的在线状态信标',\r\n  'Recent session keys tracked by the gateway.': '网关跟踪的最近会话密钥',\r\n  'Enabled': '启用',\r\n  'Disabled': '禁用',\r\n  'Next wake': '下次唤醒',\r\n  'Notes': '备注',\r\n  'Quick reminders for remote control setups.': '远程控制设置的快速提醒',\r\n  'Tailscale serve': 'Tailscale 服务',\r\n  'Prefer serve mode to keep the gateway on loopback with tailnet auth.': '建议使用服务模式，将网关保留在 loopback 并使用 tailnet 认证',\r\n  'Session hygiene': '会话卫生',\r\n  'Use /new or sessions.patch to reset context.': '使用 /new 或 sessions.patch 重置上下文',\r\n  'Cron reminders': 'Cron 提醒',\r\n  'Use isolated sessions for recurring runs.': '对定期运行使用隔离会话',\r\n\r\n  // ============ Instances 页面 ============\r\n  'Connected Instances': '已连接实例',\r\n  'Presence beacons from the gateway and clients.': '来自网关和客户端的存在信标。',\r\n  'No instances reported yet.': '尚未报告任何实例。',\r\n  'unknown host': '未知主机',\r\n  'Last input': '最后输入',\r\n  'Reason': '原因',\r\n  'scopes': '范围',\r\n\r\n  // ============ Sessions 页面 ============\r\n  'Active': '活跃',\r\n  'Inactive': '非活跃',\r\n  'Global': '全局',\r\n  'Unknown': '未知',\r\n  'Include Global': '包含全局',\r\n  'Include Unknown': '包含未知',\r\n  'Thinking Level': '思考级别',\r\n  'Reasoning Level': '推理级别',\r\n  'Verbose Level': '详细级别',\r\n  'minimal': '最小',\r\n  'low': '低',\r\n  'medium': '中',\r\n  'high': '高',\r\n  'xhigh': '极高',\r\n  'full': '完整',\r\n  'inherit': '继承',\r\n  'stream': '流式',\r\n  'on (explicit)': '开启（显式）',\r\n  'Delete Session': '删除会话',\r\n\r\n  // ============ Usage 页面 ============\r\n  'Totals': '总计',\r\n  'Cost': '成本',\r\n  'Messages': '消息',\r\n  'Tokens': '令牌',\r\n  'Cost Daily': '每日成本',\r\n  'Activity': '活动',\r\n  'Error Rate': '错误率',\r\n  'Peak Error Hours': '高峰错误时段',\r\n  'errors': '错误',\r\n  'msgs': '消息',\r\n  'Select date range': '选择日期范围',\r\n  'All Agents': '所有代理',\r\n  'No data': '无数据',\r\n\r\n  // ============ Usage 页面补充 ============\r\n  'Activity by Time': '活动时间',\r\n  'Local': '本地',\r\n  'UTC': 'UTC',\r\n  'Day of Week': '星期',\r\n  'Hours': '小时',\r\n  'Midnight': '午夜',\r\n  '4am': '凌晨4点',\r\n  '8am': '早上8点',\r\n  'Noon': '中午',\r\n  '4pm': '下午4点',\r\n  '8pm': '晚上8点',\r\n  'Low → High token density': '低 → 高令牌密度',\r\n  'Daily Usage': '每日使用',\r\n  'Daily Token': '每日令牌',\r\n  'Daily Cost': '每日成本',\r\n  'Total': '总计',\r\n  'By Type': '按类型',\r\n  'Token': '令牌',\r\n  'Cost': '成本',\r\n  'Token Usage': '令牌使用',\r\n  'Cost Usage': '成本使用',\r\n  'Tokens by Type': '按类型的令牌',\r\n  'Cost by Type': '按类型的成本',\r\n  'Output': '输出',\r\n  'Input': '输入',\r\n  'Cache write': '缓存写入',\r\n  'Cache read': '缓存读取',\r\n  'Total:': '总计：',\r\n  'calls': '调用',\r\n  'messages': '消息',\r\n  'Higher is better': '越高越好',\r\n  'Lower is better': '越低越好',\r\n  'Cache hit rate': '缓存命中率',\r\n  'Cache hit rate = cache read / (input + cache read). Higher is better.': '缓存命中率 = 缓存读取 / (输入 + 缓存读取)。越高越好。',\r\n  'Error rate': '错误率',\r\n  'Error rate = errors / total messages. Lower is better.': '错误率 = 错误 / 总消息数。越低越好。',\r\n  'Throughput': '吞吐量',\r\n  'Throughput shows tokens per minute over active time. Higher is better.': '吞吐量显示活跃时间内的每分钟令牌数。越高越好。',\r\n  'Average tokens per message in this range.': '此范围内的每条消息平均令牌数。',\r\n  'Average cost per message when providers report costs.': '提供商报告成本时的每条消息平均成本。',\r\n  'Cost data is missing for some or all sessions in this range.': '此范围内部分或全部会话缺少成本数据。',\r\n  'Avg tokens/msg': '平均令牌/消息',\r\n  'Avg cost/msg': '平均成本/消息',\r\n  'Cache hit': '缓存命中',\r\n  'Throughput (tok/min)': '吞吐量 (令牌/分钟)',\r\n  'Throughput (/min)': '吞吐量 (/分钟)',\r\n  'Duration': '持续时间',\r\n  'Model': '模型',\r\n  'Provider': '提供商',\r\n  'Agent': '代理',\r\n  'Channel': '渠道',\r\n  'Tool': '工具',\r\n  'Cost per Model': '每模型成本',\r\n  'Cost per Provider': '每提供商成本',\r\n  'Cost per Agent': '每代理成本',\r\n  'Cost per Channel': '每渠道成本',\r\n  'Top Tools': '热门工具',\r\n  'Top Models': '热门模型',\r\n  'Top Providers': '热门提供商',\r\n  'Top Agents': '热门代理',\r\n  'Top Channels': '热门渠道',\r\n  'unknown': '未知',\r\n\r\n  // ============ Cron 页面 ============\r\n  'Scheduler': '调度器',\r\n  'Gateway-owned cron scheduler status.': '网关自有的 cron 调度器状态。',\r\n  'Jobs': '任务',\r\n  'Next wake': '下次唤醒',\r\n  'Refreshing…': '正在刷新...',\r\n  'New Job': '新建任务',\r\n  'Create a scheduled wakeup or agent run.': '创建计划的唤醒或代理运行。',\r\n  'Name': '名称',\r\n  'Schedule': '计划',\r\n  'Delivery Channel': '交付渠道',\r\n  'Payload': '负载',\r\n  'Agent': '代理',\r\n  'Message': '消息',\r\n  'Expression': '表达式',\r\n  'Delete Job': '删除任务',\r\n  'Delete this job?': '确定删除此任务？',\r\n  'Run Now': '立即运行',\r\n  'Runs': '运行记录',\r\n  'Select a job': '选择任务',\r\n  'Error': '错误',\r\n  'Output': '输出',\r\n\r\n  // ============ Channels 页面 ============\r\n  'Add Channel': '添加渠道',\r\n  'Edit Channel': '编辑渠道',\r\n  'Configure Channel': '配置渠道',\r\n  'Channel ID': '渠道 ID',\r\n  'Delete Channel': '删除渠道',\r\n  'No channels configured.': '未配置任何渠道。',\r\n\r\n  // ============ 导航描述 ============\r\n  'Gateway status, entry points, and a fast health read.': '网关状态、入口点和快速健康检查。',\r\n  'Manage channels and settings.': '管理渠道和设置。',\r\n  'Presence beacons from connected clients and nodes.': '来自已连接客户端和节点的在线状态信标。',\r\n  'Inspect active sessions and adjust per-session defaults.': '检查活跃会话并调整每个会话的默认设置。',\r\n  'See where tokens go, when sessions spike, and what drives cost.': '查看令牌使用情况、会话峰值和成本驱动因素。',\r\n  'Schedule wakeups and recurring agent runs.': '计划唤醒和定期代理运行。',\r\n  'Manage agent workspaces, tools, and identities.': '管理代理工作区、工具和身份。',\r\n  'Manage skill availability and API key injection.': '管理技能可用性和 API 密钥注入。',\r\n  'Paired devices, capabilities, and command exposure.': '配对设备、功能和命令暴露。',\r\n  'Direct gateway chat session for quick interventions.': '直接网关聊天会话，快速干预。',\r\n  'Edit ~/.openclaw/openclaw.json safely.': '安全编辑 ~/.openclaw/openclaw.json。',\r\n  'Gateway snapshots, events, and manual RPC calls.': '网关快照、事件和手动 RPC 调用。',\r\n  'Live tail of the gateway file logs.': '实时跟踪网关文件日志。',\r\n};\r\n","/**\r\n * OpenClaw 控制台 UI - 英文翻译映射表\r\n * English translation mapping table\r\n * 用于语言切换，英文作为 key\r\n */\r\n\r\nexport const enUS: Record<string, string> = {\r\n  // ============ 通用 ============\r\n  'OpenClaw': 'OpenClaw',\r\n  'Overview': 'Overview',\r\n  'Settings': 'Settings',\r\n  'Status': 'Status',\r\n  'Dashboard': 'Dashboard',\r\n  'Connect': 'Connect',\r\n  'Disconnect': 'Disconnect',\r\n  'Connecting...': 'Connecting...',\r\n  'Connected': 'Connected',\r\n  'Disconnected': 'Disconnected',\r\n  'Connecting': 'Connecting',\r\n  'n/a': 'n/a',\r\n  'seconds': 'seconds',\r\n  'minutes': 'minutes',\r\n  'hours': 'hours',\r\n  'days': 'days',\r\n  'Uptime': 'Uptime',\r\n  'Policy Tick': 'Policy Tick',\r\n  'Channel': 'Channel',\r\n  'Channels': 'Channels',\r\n  'Session': 'Session',\r\n  'Sessions': 'Sessions',\r\n  'Cron': 'Cron',\r\n  'Cron Jobs': 'Cron Jobs',\r\n  'Instance': 'Instance',\r\n  'Instances': 'Instances',\r\n  'gateway': 'gateway',\r\n  'Gateway': 'Gateway',\r\n  'Node': 'Node',\r\n  'Nodes': 'Nodes',\r\n  'Skill': 'Skill',\r\n  'Skills': 'Skills',\r\n  'Job': 'Job',\r\n  'Jobs': 'Jobs',\r\n  'Log': 'Log',\r\n  'Logs': 'Logs',\r\n  'Device': 'Device',\r\n  'Devices': 'Devices',\r\n  'Agent': 'Agent',\r\n  'Agents': 'Agents',\r\n  'Files': 'Files',\r\n  'Tools': 'Tools',\r\n\r\n  // ============ 导航栏 ============\r\n  'Control': 'Control',\r\n  'Resources': 'Resources',\r\n  'Docs': 'Docs',\r\n\r\n  // ============ 按钮 ============\r\n  'Save': 'Save',\r\n  'Cancel': 'Cancel',\r\n  'Edit': 'Edit',\r\n  'Delete': 'Delete',\r\n  'Add': 'Add',\r\n  'Search': 'Search',\r\n  'Enable': 'Enable',\r\n  'Disable': 'Disable',\r\n  'Configure': 'Configure',\r\n  'Unknown': 'Unknown',\r\n  'Ready': 'Ready',\r\n  'Install': 'Install',\r\n  'Uninstall': 'Uninstall',\r\n  'Update': 'Update',\r\n\r\n  // ============ 配置按钮 ============\r\n  'Reload': 'Reload',\r\n  'View': 'View',\r\n  'pending': 'pending',\r\n  'change': 'change',\r\n  'changes': 'changes',\r\n\r\n  'Remove': 'Remove',\r\n  'Clear': 'Clear',\r\n  'Abort': 'Abort',\r\n  'Stop': 'Stop',\r\n  'Retry': 'Retry',\r\n  'Close': 'Close',\r\n  'Back': 'Back',\r\n  'Next': 'Next',\r\n  'Previous': 'Previous',\r\n  'Done': 'Done',\r\n  'OK': 'OK',\r\n  'Yes': 'Yes',\r\n  'No': 'No',\r\n  'On': 'On',\r\n  'Off': 'Off',\r\n  'Run': 'Run',\r\n  'Call': 'Call',\r\n  'Export': 'Export',\r\n  'Download': 'Download',\r\n  'Copy': 'Copy',\r\n  'Approve': 'Approve',\r\n  'Reject': 'Reject',\r\n  'Revoke': 'Revoke',\r\n  'Allow': 'Allow',\r\n  'Deny': 'Deny',\r\n\r\n  // ============ chat.ts ============\r\n  'Send': 'Send',\r\n  'New session': 'New session',\r\n  'Focus mode': 'Focus mode',\r\n  'Split ratio': 'Split ratio',\r\n  'Loading...': 'Loading...',\r\n  'Loading chat…': 'Loading chat…',\r\n  'Compacting context...': 'Compacting context...',\r\n  'Context compacted': 'Context compacted',\r\n  'New message in': 'New message in',\r\n  'Queue': 'Queue',\r\n  'Chat': 'Chat',\r\n  'Chat history': 'Chat history',\r\n  'Attach file': 'Attach file',\r\n  'Send message': 'Send message',\r\n  'Connect to the gateway to start chatting…': 'Connect to the gateway to start chatting…',\r\n  'Add a message or paste more images...': 'Add a message or paste more images...',\r\n\r\n  // ============ config.ts ============\r\n  'Configuration': 'Configuration',\r\n  'Config': 'Config',\r\n  'Apply': 'Apply',\r\n  'Apply & Restart': 'Apply & Restart',\r\n  'Raw JSON': 'Raw JSON',\r\n  'Raw': 'Raw',\r\n  'Form': 'Form',\r\n  'Reset': 'Reset',\r\n  'Generating diff...': 'Generating diff...',\r\n  'Analysis': 'Analysis',\r\n  'Diff': 'Diff',\r\n  'No changes': 'No changes',\r\n  'Loading schema…': 'Loading schema…',\r\n  'Saving...': 'Saving...',\r\n  'Applying...': 'Applying...',\r\n  'Saved': 'Saved',\r\n  'Error:': 'Error:',\r\n  'Invalid configuration': 'Invalid configuration',\r\n  'Configuration saved. Restart the gateway to apply changes.': 'Configuration saved. Restart the gateway to apply changes.',\r\n  'Restart required': 'Restart required',\r\n  'The gateway must be restarted for changes to take effect.': 'The gateway must be restarted for changes to take effect.',\r\n  'Restart now': 'Restart now',\r\n  'Restart later': 'Restart later',\r\n  'All': 'All',\r\n  'All Settings': 'All Settings',\r\n  'Search settings...': 'Search settings...',\r\n  'Unsaved changes': 'Unsaved changes',\r\n  'Reload': 'Reload',\r\n\r\n  // ============ 配置子页面 ============\r\n  'Environment': 'Environment',\r\n  'Updates': 'Updates',\r\n  'Authentication': 'Authentication',\r\n  'Messages': 'Messages',\r\n  'Commands': 'Commands',\r\n  'Hooks': 'Hooks',\r\n  'Skills': 'Skills',\r\n  'Tools': 'Tools',\r\n  'Gateway': 'Gateway',\r\n  'Meta': 'Metadata',\r\n  'Broadcast': 'Broadcast',\r\n  'Audio': 'Audio',\r\n  'Session': 'Session',\r\n  'Cron': 'Cron',\r\n  'Discovery': 'Discovery',\r\n  'CanvasHost': 'Canvas Host',\r\n  'Plugins': 'Plugins',\r\n  'Ui': 'UI',\r\n  'Models': 'Models',\r\n  'Setup Wizard': 'Setup Wizard',\r\n  'Diagnostics': 'Diagnostics',\r\n  'Logging': 'Logging',\r\n  'Browser': 'Browser',\r\n  'NodeHost': 'Node Host',\r\n  'Bindings': 'Bindings',\r\n  'Media': 'Media',\r\n  'Approvals': 'Approvals',\r\n  'Web': 'Web',\r\n  'Memory': 'Memory',\r\n  'Talk': 'Talk',\r\n\r\n  // ============ 配置表单错误 ============\r\n  'No settings in this section': 'No settings in this section',\r\n  'No settings match': 'No settings match',\r\n  'Unsupported schema node. Use Raw mode.': 'Unsupported schema node. Use Raw mode.',\r\n  'Unsupported type:': 'Unsupported type:',\r\n  'Use Raw mode.': 'Use Raw mode.',\r\n  'Unsupported array schema. Use Raw mode.': 'Unsupported array schema. Use Raw mode.',\r\n\r\n  // ============ 导航补充 ============\r\n  'Usage': 'Usage',\r\n  'Debug': 'Debug',\r\n  'Logs': 'Logs',\r\n  'Instances': 'Instances',\r\n  'Switch Language': 'Switch Language',\r\n\r\n  // ============ 概览页 ============\r\n  'This gateway requires auth. Add a token or password, then click Connect.': 'This gateway requires auth. Add a token or password, then click Connect.',\r\n  'Auth failed. Update the token or password in Control UI settings, then click Connect.': 'Auth failed. Update the token or password in Control UI settings, then click Connect.',\r\n  'Gateway requires auth.': 'Gateway requires auth.',\r\n  'Add a token or password in settings.': 'Add a token or password in settings.',\r\n  'Last refresh': 'Last refresh',\r\n  'Gateway URL': 'Gateway URL',\r\n  'Token': 'Token',\r\n  'Password': 'Password',\r\n  'Version': 'Version',\r\n  'Refresh': 'Refresh',\r\n  'Open Control UI': 'Open Control UI',\r\n\r\n  // ============ Instances 页面 ============\r\n  'Connected Instances': 'Connected Instances',\r\n  'Presence beacons from the gateway and clients.': 'Presence beacons from the gateway and clients.',\r\n  'No instances reported yet.': 'No instances reported yet.',\r\n  'unknown host': 'unknown host',\r\n  'Last input': 'Last input',\r\n  'Reason': 'Reason',\r\n  'scopes': 'scopes',\r\n\r\n  // ============ Sessions 页面 ============\r\n  'Active': 'Active',\r\n  'Inactive': 'Inactive',\r\n  'Global': 'Global',\r\n  'Unknown': 'Unknown',\r\n  'Include Global': 'Include Global',\r\n  'Include Unknown': 'Include Unknown',\r\n  'Thinking Level': 'Thinking Level',\r\n  'Reasoning Level': 'Reasoning Level',\r\n  'Verbose Level': 'Verbose Level',\r\n  'minimal': 'minimal',\r\n  'low': 'low',\r\n  'medium': 'medium',\r\n  'high': 'high',\r\n  'xhigh': 'xhigh',\r\n  'full': 'full',\r\n  'inherit': 'inherit',\r\n  'stream': 'stream',\r\n  'on (explicit)': 'on (explicit)',\r\n  'Delete Session': 'Delete Session',\r\n\r\n  // ============ Usage 页面 ============\r\n  'Totals': 'Totals',\r\n  'Cost': 'Cost',\r\n  'Messages': 'Messages',\r\n  'Tokens': 'Tokens',\r\n  'Cost Daily': 'Cost Daily',\r\n  'Activity': 'Activity',\r\n  'Error Rate': 'Error Rate',\r\n  'Peak Error Hours': 'Peak Error Hours',\r\n  'errors': 'errors',\r\n  'msgs': 'msgs',\r\n  'Select date range': 'Select date range',\r\n  'All Agents': 'All Agents',\r\n  'No data': 'No data',\r\n\r\n  // ============ Cron 页面 ============\r\n  'Scheduler': 'Scheduler',\r\n  'Gateway-owned cron scheduler status.': 'Gateway-owned cron scheduler status.',\r\n  'Jobs': 'Jobs',\r\n  'Next wake': 'Next wake',\r\n  'Refreshing…': 'Refreshing…',\r\n  'New Job': 'New Job',\r\n  'Create a scheduled wakeup or agent run.': 'Create a scheduled wakeup or agent run.',\r\n  'Name': 'Name',\r\n  'Schedule': 'Schedule',\r\n  'Delivery Channel': 'Delivery Channel',\r\n  'Payload': 'Payload',\r\n  'Agent': 'Agent',\r\n  'Message': 'Message',\r\n  'Expression': 'Expression',\r\n  'Delete Job': 'Delete Job',\r\n  'Delete this job?': 'Delete this job?',\r\n  'Run Now': 'Run Now',\r\n  'Runs': 'Runs',\r\n  'Select a job': 'Select a job',\r\n  'Error': 'Error',\r\n  'Output': 'Output',\r\n\r\n  // ============ Channels 页面 ============\r\n  'Add Channel': 'Add Channel',\r\n  'Edit Channel': 'Edit Channel',\r\n  'Configure Channel': 'Configure Channel',\r\n  'Channel ID': 'Channel ID',\r\n  'Delete Channel': 'Delete Channel',\r\n  'No channels configured.': 'No channels configured.',\r\n};\r\n","/**\r\n * 翻译辅助函数 - 支持中英文切换\r\n * 用于在 Lit 模板中翻译静态文本\r\n * 支持 localStorage 持久化语言设置\r\n */\r\n\r\n// 导入翻译映射\r\nimport { zhCN } from \"./locales/zh-CN.ts\";\r\nimport { enUS } from \"./locales/en-US.ts\";\r\n\r\n// 语言映射表\r\nconst TRANSLATIONS: Record<string, Record<string, string>> = {\r\n  'zh-CN': zhCN,\r\n  'zh': zhCN,\r\n  'en': enUS,\r\n  'en-US': enUS,\r\n};\r\n\r\n// ==================== 常量 ====================\r\n\r\nconst STORAGE_KEY = 'openclaw_language';\r\nconst DEFAULT_LANGUAGE = 'en';  // 默认英文\r\n\r\n// ==================== 语言检测 ====================\r\n\r\n/**\r\n * 从 localStorage 读取保存的语言设置\r\n */\r\nfunction loadSavedLanguage(): string | null {\r\n  if (typeof window === \"undefined\") return null;\r\n  try {\r\n    return localStorage.getItem(STORAGE_KEY);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * 保存语言设置到 localStorage\r\n */\r\nfunction saveLanguage(lang: string): void {\r\n  if (typeof window === \"undefined\") return;\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, lang);\r\n  } catch {\r\n    // ignore storage errors\r\n  }\r\n}\r\n\r\n/**\r\n * 自动检测当前语言\r\n */\r\nfunction detectLanguage(): string {\r\n  // 1. 检查 localStorage 保存的语言\r\n  const saved = loadSavedLanguage();\r\n  if (saved && TRANSLATIONS[saved]) {\r\n    return saved;\r\n  }\r\n\r\n  // 2. 检查浏览器语言设置\r\n  if (typeof navigator !== \"undefined\" && navigator.language) {\r\n    const browserLang = navigator.language.toLowerCase();\r\n    if (browserLang.includes('zh')) {\r\n      return 'zh-CN';\r\n    }\r\n  }\r\n\r\n  return DEFAULT_LANGUAGE;\r\n}\r\n\r\n// ==================== 语言设置 ====================\r\n\r\nlet manualLanguage: string | null = null;\r\n\r\nexport function getLanguage(): string {\r\n  return manualLanguage || detectLanguage();\r\n}\r\n\r\nexport function setLanguage(lang: string): void {\r\n  // 验证语言是否支持\r\n  if (!TRANSLATIONS[lang]) {\r\n    console.warn(`[i18n] Unsupported language: ${lang}, falling back to 'en'`);\r\n    lang = DEFAULT_LANGUAGE;\r\n  }\r\n\r\n  manualLanguage = lang;\r\n  saveLanguage(lang);\r\n\r\n  // 触发自定义事件，通知UI刷新\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(new CustomEvent(\"language-change\", { detail: { language: lang } }));\r\n  }\r\n}\r\n\r\nexport function toggleLanguage(): string {\r\n  const current = getLanguage();\r\n  const newLang = (current === 'zh-CN' || current === 'zh') ? 'en' : 'zh-CN';\r\n  setLanguage(newLang);\r\n  return newLang;\r\n}\r\n\r\nexport function isZh(): boolean {\r\n  const lang = getLanguage();\r\n  return lang === 'zh-CN' || lang === 'zh';\r\n}\r\n\r\nexport function isEn(): boolean {\r\n  return !isZh();\r\n}\r\n\r\n// ==================== 核心翻译函数 ====================\r\n\r\n/**\r\n * 同步翻译（用于 Lit 模板）\r\n * 英文直接返回原文，中文才翻译\r\n */\r\nexport function T(text: string): string {\r\n  // 空文本直接返回\r\n  if (!text || !text.trim()) {\r\n    return text;\r\n  }\r\n\r\n  // 英文直接返回原文，不翻译\r\n  const lang = getLanguage();\r\n  if (lang === 'en' || lang === 'en-US') {\r\n    return text;\r\n  }\r\n\r\n  // 中文才查字典\r\n  const dict = TRANSLATIONS['zh-CN'];\r\n\r\n  // 查字典\r\n  if (dict && dict[text]) {\r\n    return dict[text];\r\n  }\r\n\r\n  // 字典没有，返回原文\r\n  return text;\r\n}\r\n\r\n// ==================== 导出支持的语言列表 ====================\r\n\r\nexport function getSupportedLanguages(): Array<{ code: string; name: string }> {\r\n  return [\r\n    { code: 'en', name: 'English' },\r\n    { code: 'zh-CN', name: '中文' },\r\n  ];\r\n}\r\n\r\n// ==================== 全局暴露（用于调试） ====================\r\n\r\nif (typeof window !== \"undefined\") {\r\n  (window as any).T = T;\r\n  (window as any).getLanguage = getLanguage;\r\n  (window as any).setLanguage = setLanguage;\r\n  (window as any).toggleLanguage = toggleLanguage;\r\n  (window as any).isZh = isZh;\r\n  (window as any).isEn = isEn;\r\n  console.log('[i18n] Bilingual translation module loaded');\r\n}\r\n","import type { IconName } from \"./icons.js\";\r\nimport { T } from \"../i18n.ts\";\r\n\r\nexport const TAB_GROUPS = [\r\n  { label: T(\"Chat\"), tabs: [\"chat\"] },\r\n  {\r\n    label: T(\"Control\"),\r\n    tabs: [\"overview\", \"channels\", \"instances\", \"sessions\", \"usage\", \"cron\"],\r\n  },\r\n  { label: T(\"Agent\"), tabs: [\"agents\", \"skills\", \"nodes\"] },\r\n  { label: T(\"Settings\"), tabs: [\"config\", \"debug\", \"logs\"] },\r\n] as const;\r\n\r\nexport type Tab =\r\n  | \"agents\"\r\n  | \"overview\"\r\n  | \"channels\"\r\n  | \"instances\"\r\n  | \"sessions\"\r\n  | \"usage\"\r\n  | \"cron\"\r\n  | \"skills\"\r\n  | \"nodes\"\r\n  | \"chat\"\r\n  | \"config\"\r\n  | \"debug\"\r\n  | \"logs\";\r\n\r\nconst TAB_PATHS: Record<Tab, string> = {\r\n  agents: \"/agents\",\r\n  overview: \"/overview\",\r\n  channels: \"/channels\",\r\n  instances: \"/instances\",\r\n  sessions: \"/sessions\",\r\n  usage: \"/usage\",\r\n  cron: \"/cron\",\r\n  skills: \"/skills\",\r\n  nodes: \"/nodes\",\r\n  chat: \"/chat\",\r\n  config: \"/config\",\r\n  debug: \"/debug\",\r\n  logs: \"/logs\",\r\n};\r\n\r\nconst PATH_TO_TAB = new Map(Object.entries(TAB_PATHS).map(([tab, path]) => [path, tab as Tab]));\r\n\r\nexport function normalizeBasePath(basePath: string): string {\r\n  if (!basePath) {\r\n    return \"\";\r\n  }\r\n  let base = basePath.trim();\r\n  if (!base.startsWith(\"/\")) {\r\n    base = `/${base}`;\r\n  }\r\n  if (base === \"/\") {\r\n    return \"\";\r\n  }\r\n  if (base.endsWith(\"/\")) {\r\n    base = base.slice(0, -1);\r\n  }\r\n  return base;\r\n}\r\n\r\nexport function normalizePath(path: string): string {\r\n  if (!path) {\r\n    return \"/\";\r\n  }\r\n  let normalized = path.trim();\r\n  if (!normalized.startsWith(\"/\")) {\r\n    normalized = `/${normalized}`;\r\n  }\r\n  if (normalized.length > 1 && normalized.endsWith(\"/\")) {\r\n    normalized = normalized.slice(0, -1);\r\n  }\r\n  return normalized;\r\n}\r\n\r\nexport function pathForTab(tab: Tab, basePath = \"\"): string {\r\n  const base = normalizeBasePath(basePath);\r\n  const path = TAB_PATHS[tab];\r\n  return base ? `${base}${path}` : path;\r\n}\r\n\r\nexport function tabFromPath(pathname: string, basePath = \"\"): Tab | null {\r\n  const base = normalizeBasePath(basePath);\r\n  let path = pathname || \"/\";\r\n  if (base) {\r\n    if (path === base) {\r\n      path = \"/\";\r\n    } else if (path.startsWith(`${base}/`)) {\r\n      path = path.slice(base.length);\r\n    }\r\n  }\r\n  let normalized = normalizePath(path).toLowerCase();\r\n  if (normalized.endsWith(\"/index.html\")) {\r\n    normalized = \"/\";\r\n  }\r\n  if (normalized === \"/\") {\r\n    return \"chat\";\r\n  }\r\n  return PATH_TO_TAB.get(normalized) ?? null;\r\n}\r\n\r\nexport function inferBasePathFromPathname(pathname: string): string {\r\n  let normalized = normalizePath(pathname);\r\n  if (normalized.endsWith(\"/index.html\")) {\r\n    normalized = normalizePath(normalized.slice(0, -\"/index.html\".length));\r\n  }\r\n  if (normalized === \"/\") {\r\n    return \"\";\r\n  }\r\n  const segments = normalized.split(\"/\").filter(Boolean);\r\n  if (segments.length === 0) {\r\n    return \"\";\r\n  }\r\n  for (let i = 0; i < segments.length; i++) {\r\n    const candidate = `/${segments.slice(i).join(\"/\")}`.toLowerCase();\r\n    if (PATH_TO_TAB.has(candidate)) {\r\n      const prefix = segments.slice(0, i);\r\n      return prefix.length ? `/${prefix.join(\"/\")}` : \"\";\r\n    }\r\n  }\r\n  return `/${segments.join(\"/\")}`;\r\n}\r\n\r\nexport function iconForTab(tab: Tab): IconName {\r\n  switch (tab) {\r\n    case \"agents\":\r\n      return \"folder\";\r\n    case \"chat\":\r\n      return \"messageSquare\";\r\n    case \"overview\":\r\n      return \"barChart\";\r\n    case \"channels\":\r\n      return \"link\";\r\n    case \"instances\":\r\n      return \"radio\";\r\n    case \"sessions\":\r\n      return \"fileText\";\r\n    case \"usage\":\r\n      return \"barChart\";\r\n    case \"cron\":\r\n      return \"loader\";\r\n    case \"skills\":\r\n      return \"zap\";\r\n    case \"nodes\":\r\n      return \"monitor\";\r\n    case \"config\":\r\n      return \"settings\";\r\n    case \"debug\":\r\n      return \"bug\";\r\n    case \"logs\":\r\n      return \"scrollText\";\r\n    default:\r\n      return \"folder\";\r\n  }\r\n}\r\n\r\nexport function titleForTab(tab: Tab) {\r\n  switch (tab) {\r\n    case \"agents\":\r\n      return T(\"Agents\");\r\n    case \"overview\":\r\n      return T(\"Overview\");\r\n    case \"channels\":\r\n      return T(\"Channels\");\r\n    case \"instances\":\r\n      return T(\"Instances\");\r\n    case \"sessions\":\r\n      return T(\"Sessions\");\r\n    case \"usage\":\r\n      return T(\"Usage\");\r\n    case \"cron\":\r\n      return T(\"Cron Jobs\");\r\n    case \"skills\":\r\n      return T(\"Skills\");\r\n    case \"nodes\":\r\n      return T(\"Nodes\");\r\n    case \"chat\":\r\n      return T(\"Chat\");\r\n    case \"config\":\r\n      return T(\"Config\");\r\n    case \"debug\":\r\n      return T(\"Debug\");\r\n    case \"logs\":\r\n      return T(\"Logs\");\r\n    default:\r\n      return T(\"Control\");\r\n  }\r\n}\r\n\r\nexport function subtitleForTab(tab: Tab) {\r\n  switch (tab) {\r\n    case \"agents\":\r\n      return T(\"Manage agent workspaces, tools, and identities.\");\r\n    case \"overview\":\r\n      return T(\"Gateway status, entry points, and a fast health read.\");\r\n    case \"channels\":\r\n      return T(\"Manage channels and settings.\");\r\n    case \"instances\":\r\n      return T(\"Presence beacons from connected clients and nodes.\");\r\n    case \"sessions\":\r\n      return T(\"Inspect active sessions and adjust per-session defaults.\");\r\n    case \"usage\":\r\n      return T(\"See where tokens go, when sessions spike, and what drives cost.\");\r\n    case \"cron\":\r\n      return T(\"Schedule wakeups and recurring agent runs.\");\r\n    case \"skills\":\r\n      return T(\"Manage skill availability and API key injection.\");\r\n    case \"nodes\":\r\n      return T(\"Paired devices, capabilities, and command exposure.\");\r\n    case \"chat\":\r\n      return T(\"Direct gateway chat session for quick interventions.\");\r\n    case \"config\":\r\n      return T(\"Edit ~/.openclaw/openclaw.json safely.\");\r\n    case \"debug\":\r\n      return T(\"Gateway snapshots, events, and manual RPC calls.\");\r\n    case \"logs\":\r\n      return T(\"Live tail of the gateway file logs.\");\r\n    default:\r\n      return T(\"\");\r\n  }\r\n}\r\n","const KEY = \"openclaw.control.settings.v1\";\r\n\r\nimport type { ThemeMode } from \"./theme.ts\";\r\n\r\nexport type UiSettings = {\r\n  gatewayUrl: string;\r\n  token: string;\r\n  sessionKey: string;\r\n  lastActiveSessionKey: string;\r\n  theme: ThemeMode;\r\n  chatFocusMode: boolean;\r\n  chatShowThinking: boolean;\r\n  splitRatio: number; // Sidebar split ratio (0.4 to 0.7, default 0.6)\r\n  navCollapsed: boolean; // Collapsible sidebar state\r\n  navGroupsCollapsed: Record<string, boolean>; // Which nav groups are collapsed\r\n};\r\n\r\nexport function loadSettings(): UiSettings {\r\n  const defaultUrl = (() => {\r\n    const proto = location.protocol === \"https:\" ? \"wss\" : \"ws\";\r\n    return `${proto}://${location.host}`;\r\n  })();\r\n\r\n  const defaults: UiSettings = {\r\n    gatewayUrl: defaultUrl,\r\n    token: \"\",\r\n    sessionKey: \"main\",\r\n    lastActiveSessionKey: \"main\",\r\n    theme: \"system\",\r\n    chatFocusMode: false,\r\n    chatShowThinking: true,\r\n    splitRatio: 0.6,\r\n    navCollapsed: false,\r\n    navGroupsCollapsed: {},\r\n  };\r\n\r\n  try {\r\n    const raw = localStorage.getItem(KEY);\r\n    if (!raw) {\r\n      return defaults;\r\n    }\r\n    const parsed = JSON.parse(raw) as Partial<UiSettings>;\r\n    return {\r\n      gatewayUrl:\r\n        typeof parsed.gatewayUrl === \"string\" && parsed.gatewayUrl.trim()\r\n          ? parsed.gatewayUrl.trim()\r\n          : defaults.gatewayUrl,\r\n      token: typeof parsed.token === \"string\" ? parsed.token : defaults.token,\r\n      sessionKey:\r\n        typeof parsed.sessionKey === \"string\" && parsed.sessionKey.trim()\r\n          ? parsed.sessionKey.trim()\r\n          : defaults.sessionKey,\r\n      lastActiveSessionKey:\r\n        typeof parsed.lastActiveSessionKey === \"string\" && parsed.lastActiveSessionKey.trim()\r\n          ? parsed.lastActiveSessionKey.trim()\r\n          : (typeof parsed.sessionKey === \"string\" && parsed.sessionKey.trim()) ||\r\n            defaults.lastActiveSessionKey,\r\n      theme:\r\n        parsed.theme === \"light\" || parsed.theme === \"dark\" || parsed.theme === \"system\"\r\n          ? parsed.theme\r\n          : defaults.theme,\r\n      chatFocusMode:\r\n        typeof parsed.chatFocusMode === \"boolean\" ? parsed.chatFocusMode : defaults.chatFocusMode,\r\n      chatShowThinking:\r\n        typeof parsed.chatShowThinking === \"boolean\"\r\n          ? parsed.chatShowThinking\r\n          : defaults.chatShowThinking,\r\n      splitRatio:\r\n        typeof parsed.splitRatio === \"number\" &&\r\n        parsed.splitRatio >= 0.4 &&\r\n        parsed.splitRatio <= 0.7\r\n          ? parsed.splitRatio\r\n          : defaults.splitRatio,\r\n      navCollapsed:\r\n        typeof parsed.navCollapsed === \"boolean\" ? parsed.navCollapsed : defaults.navCollapsed,\r\n      navGroupsCollapsed:\r\n        typeof parsed.navGroupsCollapsed === \"object\" && parsed.navGroupsCollapsed !== null\r\n          ? parsed.navGroupsCollapsed\r\n          : defaults.navGroupsCollapsed,\r\n    };\r\n  } catch {\r\n    return defaults;\r\n  }\r\n}\r\n\r\nexport function saveSettings(next: UiSettings) {\r\n  localStorage.setItem(KEY, JSON.stringify(next));\r\n}\r\n","import type { ThemeMode } from \"./theme.ts\";\r\n\r\nexport type ThemeTransitionContext = {\r\n  element?: HTMLElement | null;\r\n  pointerClientX?: number;\r\n  pointerClientY?: number;\r\n};\r\n\r\nexport type ThemeTransitionOptions = {\r\n  nextTheme: ThemeMode;\r\n  applyTheme: () => void;\r\n  context?: ThemeTransitionContext;\r\n  currentTheme?: ThemeMode | null;\r\n};\r\n\r\ntype DocumentWithViewTransition = Document & {\r\n  startViewTransition?: (callback: () => void) => { finished: Promise<void> };\r\n};\r\n\r\nconst clamp01 = (value: number) => {\r\n  if (Number.isNaN(value)) {\r\n    return 0.5;\r\n  }\r\n  if (value <= 0) {\r\n    return 0;\r\n  }\r\n  if (value >= 1) {\r\n    return 1;\r\n  }\r\n  return value;\r\n};\r\n\r\nconst hasReducedMotionPreference = () => {\r\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\r\n    return false;\r\n  }\r\n  return window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches ?? false;\r\n};\r\n\r\nconst cleanupThemeTransition = (root: HTMLElement) => {\r\n  root.classList.remove(\"theme-transition\");\r\n  root.style.removeProperty(\"--theme-switch-x\");\r\n  root.style.removeProperty(\"--theme-switch-y\");\r\n};\r\n\r\nexport const startThemeTransition = ({\r\n  nextTheme,\r\n  applyTheme,\r\n  context,\r\n  currentTheme,\r\n}: ThemeTransitionOptions) => {\r\n  if (currentTheme === nextTheme) {\r\n    return;\r\n  }\r\n\r\n  const documentReference = globalThis.document ?? null;\r\n  if (!documentReference) {\r\n    applyTheme();\r\n    return;\r\n  }\r\n\r\n  const root = documentReference.documentElement;\r\n  const document_ = documentReference as DocumentWithViewTransition;\r\n  const prefersReducedMotion = hasReducedMotionPreference();\r\n\r\n  const canUseViewTransition = Boolean(document_.startViewTransition) && !prefersReducedMotion;\r\n\r\n  if (canUseViewTransition) {\r\n    let xPercent = 0.5;\r\n    let yPercent = 0.5;\r\n\r\n    if (\r\n      context?.pointerClientX !== undefined &&\r\n      context?.pointerClientY !== undefined &&\r\n      typeof window !== \"undefined\"\r\n    ) {\r\n      xPercent = clamp01(context.pointerClientX / window.innerWidth);\r\n      yPercent = clamp01(context.pointerClientY / window.innerHeight);\r\n    } else if (context?.element) {\r\n      const rect = context.element.getBoundingClientRect();\r\n      if (rect.width > 0 && rect.height > 0 && typeof window !== \"undefined\") {\r\n        xPercent = clamp01((rect.left + rect.width / 2) / window.innerWidth);\r\n        yPercent = clamp01((rect.top + rect.height / 2) / window.innerHeight);\r\n      }\r\n    }\r\n\r\n    root.style.setProperty(\"--theme-switch-x\", `${xPercent * 100}%`);\r\n    root.style.setProperty(\"--theme-switch-y\", `${yPercent * 100}%`);\r\n    root.classList.add(\"theme-transition\");\r\n\r\n    try {\r\n      const transition = document_.startViewTransition?.(() => {\r\n        applyTheme();\r\n      });\r\n      if (transition?.finished) {\r\n        void transition.finished.finally(() => cleanupThemeTransition(root));\r\n      } else {\r\n        cleanupThemeTransition(root);\r\n      }\r\n    } catch {\r\n      cleanupThemeTransition(root);\r\n      applyTheme();\r\n    }\r\n    return;\r\n  }\r\n\r\n  applyTheme();\r\n  cleanupThemeTransition(root);\r\n};\r\n","export type ThemeMode = \"system\" | \"light\" | \"dark\";\r\nexport type ResolvedTheme = \"light\" | \"dark\";\r\n\r\nexport function getSystemTheme(): ResolvedTheme {\r\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\r\n    return \"dark\";\r\n  }\r\n  return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\r\n}\r\n\r\nexport function resolveTheme(mode: ThemeMode): ResolvedTheme {\r\n  if (mode === \"system\") {\r\n    return getSystemTheme();\r\n  }\r\n  return mode;\r\n}\r\n","import type { OpenClawApp } from \"./app.ts\";\r\nimport type { AgentsListResult } from \"./types.ts\";\r\nimport { refreshChat } from \"./app-chat.ts\";\r\nimport {\r\n  startLogsPolling,\r\n  stopLogsPolling,\r\n  startDebugPolling,\r\n  stopDebugPolling,\r\n} from \"./app-polling.ts\";\r\nimport { scheduleChatScroll, scheduleLogsScroll } from \"./app-scroll.ts\";\r\nimport { loadAgentIdentities, loadAgentIdentity } from \"./controllers/agent-identity.ts\";\r\nimport { loadAgentSkills } from \"./controllers/agent-skills.ts\";\r\nimport { loadAgents } from \"./controllers/agents.ts\";\r\nimport { loadChannels } from \"./controllers/channels.ts\";\r\nimport { loadConfig, loadConfigSchema } from \"./controllers/config.ts\";\r\nimport { loadCronJobs, loadCronStatus } from \"./controllers/cron.ts\";\r\nimport { loadDebug } from \"./controllers/debug.ts\";\r\nimport { loadDevices } from \"./controllers/devices.ts\";\r\nimport { loadExecApprovals } from \"./controllers/exec-approvals.ts\";\r\nimport { loadLogs } from \"./controllers/logs.ts\";\r\nimport { loadNodes } from \"./controllers/nodes.ts\";\r\nimport { loadPresence } from \"./controllers/presence.ts\";\r\nimport { loadSessions } from \"./controllers/sessions.ts\";\r\nimport { loadSkills } from \"./controllers/skills.ts\";\r\nimport {\r\n  inferBasePathFromPathname,\r\n  normalizeBasePath,\r\n  normalizePath,\r\n  pathForTab,\r\n  tabFromPath,\r\n  type Tab,\r\n} from \"./navigation.ts\";\r\nimport { saveSettings, type UiSettings } from \"./storage.ts\";\r\nimport { startThemeTransition, type ThemeTransitionContext } from \"./theme-transition.ts\";\r\nimport { resolveTheme, type ResolvedTheme, type ThemeMode } from \"./theme.ts\";\r\n\r\ntype SettingsHost = {\r\n  settings: UiSettings;\r\n  password?: string;\r\n  theme: ThemeMode;\r\n  themeResolved: ResolvedTheme;\r\n  applySessionKey: string;\r\n  sessionKey: string;\r\n  tab: Tab;\r\n  connected: boolean;\r\n  chatHasAutoScrolled: boolean;\r\n  logsAtBottom: boolean;\r\n  eventLog: unknown[];\r\n  eventLogBuffer: unknown[];\r\n  basePath: string;\r\n  agentsList?: AgentsListResult | null;\r\n  agentsSelectedId?: string | null;\r\n  agentsPanel?: \"overview\" | \"files\" | \"tools\" | \"skills\" | \"channels\" | \"cron\";\r\n  themeMedia: MediaQueryList | null;\r\n  themeMediaHandler: ((event: MediaQueryListEvent) => void) | null;\r\n  pendingGatewayUrl?: string | null;\r\n};\r\n\r\nexport function applySettings(host: SettingsHost, next: UiSettings) {\r\n  const normalized = {\r\n    ...next,\r\n    lastActiveSessionKey: next.lastActiveSessionKey?.trim() || next.sessionKey.trim() || \"main\",\r\n  };\r\n  host.settings = normalized;\r\n  saveSettings(normalized);\r\n  if (next.theme !== host.theme) {\r\n    host.theme = next.theme;\r\n    applyResolvedTheme(host, resolveTheme(next.theme));\r\n  }\r\n  host.applySessionKey = host.settings.lastActiveSessionKey;\r\n}\r\n\r\nexport function setLastActiveSessionKey(host: SettingsHost, next: string) {\r\n  const trimmed = next.trim();\r\n  if (!trimmed) {\r\n    return;\r\n  }\r\n  if (host.settings.lastActiveSessionKey === trimmed) {\r\n    return;\r\n  }\r\n  applySettings(host, { ...host.settings, lastActiveSessionKey: trimmed });\r\n}\r\n\r\nexport function applySettingsFromUrl(host: SettingsHost) {\r\n  if (!window.location.search && !window.location.hash) {\r\n    return;\r\n  }\r\n  const url = new URL(window.location.href);\r\n  const params = new URLSearchParams(url.search);\r\n  const hashParams = new URLSearchParams(url.hash.startsWith(\"#\") ? url.hash.slice(1) : url.hash);\r\n\r\n  const tokenRaw = params.get(\"token\") ?? hashParams.get(\"token\");\r\n  const passwordRaw = params.get(\"password\") ?? hashParams.get(\"password\");\r\n  const sessionRaw = params.get(\"session\") ?? hashParams.get(\"session\");\r\n  const gatewayUrlRaw = params.get(\"gatewayUrl\") ?? hashParams.get(\"gatewayUrl\");\r\n  let shouldCleanUrl = false;\r\n\r\n  if (tokenRaw != null) {\r\n    const token = tokenRaw.trim();\r\n    if (token && token !== host.settings.token) {\r\n      applySettings(host, { ...host.settings, token });\r\n    }\r\n    params.delete(\"token\");\r\n    hashParams.delete(\"token\");\r\n    shouldCleanUrl = true;\r\n  }\r\n\r\n  if (passwordRaw != null) {\r\n    const password = passwordRaw.trim();\r\n    if (password) {\r\n      (host as { password: string }).password = password;\r\n    }\r\n    params.delete(\"password\");\r\n    hashParams.delete(\"password\");\r\n    shouldCleanUrl = true;\r\n  }\r\n\r\n  if (sessionRaw != null) {\r\n    const session = sessionRaw.trim();\r\n    if (session) {\r\n      host.sessionKey = session;\r\n      applySettings(host, {\r\n        ...host.settings,\r\n        sessionKey: session,\r\n        lastActiveSessionKey: session,\r\n      });\r\n    }\r\n  }\r\n\r\n  if (gatewayUrlRaw != null) {\r\n    const gatewayUrl = gatewayUrlRaw.trim();\r\n    if (gatewayUrl && gatewayUrl !== host.settings.gatewayUrl) {\r\n      host.pendingGatewayUrl = gatewayUrl;\r\n    }\r\n    params.delete(\"gatewayUrl\");\r\n    hashParams.delete(\"gatewayUrl\");\r\n    shouldCleanUrl = true;\r\n  }\r\n\r\n  if (!shouldCleanUrl) {\r\n    return;\r\n  }\r\n  url.search = params.toString();\r\n  const nextHash = hashParams.toString();\r\n  url.hash = nextHash ? `#${nextHash}` : \"\";\r\n  window.history.replaceState({}, \"\", url.toString());\r\n}\r\n\r\nexport function setTab(host: SettingsHost, next: Tab) {\r\n  if (host.tab !== next) {\r\n    host.tab = next;\r\n  }\r\n  if (next === \"chat\") {\r\n    host.chatHasAutoScrolled = false;\r\n  }\r\n  if (next === \"logs\") {\r\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\r\n  } else {\r\n    stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\r\n  }\r\n  if (next === \"debug\") {\r\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\r\n  } else {\r\n    stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\r\n  }\r\n  void refreshActiveTab(host);\r\n  syncUrlWithTab(host, next, false);\r\n}\r\n\r\nexport function setTheme(host: SettingsHost, next: ThemeMode, context?: ThemeTransitionContext) {\r\n  const applyTheme = () => {\r\n    host.theme = next;\r\n    applySettings(host, { ...host.settings, theme: next });\r\n    applyResolvedTheme(host, resolveTheme(next));\r\n  };\r\n  startThemeTransition({\r\n    nextTheme: next,\r\n    applyTheme,\r\n    context,\r\n    currentTheme: host.theme,\r\n  });\r\n}\r\n\r\nexport async function refreshActiveTab(host: SettingsHost) {\r\n  if (host.tab === \"overview\") {\r\n    await loadOverview(host);\r\n  }\r\n  if (host.tab === \"channels\") {\r\n    await loadChannelsTab(host);\r\n  }\r\n  if (host.tab === \"instances\") {\r\n    await loadPresence(host as unknown as OpenClawApp);\r\n  }\r\n  if (host.tab === \"sessions\") {\r\n    await loadSessions(host as unknown as OpenClawApp);\r\n  }\r\n  if (host.tab === \"cron\") {\r\n    await loadCron(host);\r\n  }\r\n  if (host.tab === \"skills\") {\r\n    await loadSkills(host as unknown as OpenClawApp);\r\n  }\r\n  if (host.tab === \"agents\") {\r\n    await loadAgents(host as unknown as OpenClawApp);\r\n    await loadConfig(host as unknown as OpenClawApp);\r\n    const agentIds = host.agentsList?.agents?.map((entry) => entry.id) ?? [];\r\n    if (agentIds.length > 0) {\r\n      void loadAgentIdentities(host as unknown as OpenClawApp, agentIds);\r\n    }\r\n    const agentId =\r\n      host.agentsSelectedId ?? host.agentsList?.defaultId ?? host.agentsList?.agents?.[0]?.id;\r\n    if (agentId) {\r\n      void loadAgentIdentity(host as unknown as OpenClawApp, agentId);\r\n      if (host.agentsPanel === \"skills\") {\r\n        void loadAgentSkills(host as unknown as OpenClawApp, agentId);\r\n      }\r\n      if (host.agentsPanel === \"channels\") {\r\n        void loadChannels(host as unknown as OpenClawApp, false);\r\n      }\r\n      if (host.agentsPanel === \"cron\") {\r\n        void loadCron(host);\r\n      }\r\n    }\r\n  }\r\n  if (host.tab === \"nodes\") {\r\n    await loadNodes(host as unknown as OpenClawApp);\r\n    await loadDevices(host as unknown as OpenClawApp);\r\n    await loadConfig(host as unknown as OpenClawApp);\r\n    await loadExecApprovals(host as unknown as OpenClawApp);\r\n  }\r\n  if (host.tab === \"chat\") {\r\n    await refreshChat(host as unknown as Parameters<typeof refreshChat>[0]);\r\n    scheduleChatScroll(\r\n      host as unknown as Parameters<typeof scheduleChatScroll>[0],\r\n      !host.chatHasAutoScrolled,\r\n    );\r\n  }\r\n  if (host.tab === \"config\") {\r\n    await loadConfigSchema(host as unknown as OpenClawApp);\r\n    await loadConfig(host as unknown as OpenClawApp);\r\n  }\r\n  if (host.tab === \"debug\") {\r\n    await loadDebug(host as unknown as OpenClawApp);\r\n    host.eventLog = host.eventLogBuffer;\r\n  }\r\n  if (host.tab === \"logs\") {\r\n    host.logsAtBottom = true;\r\n    await loadLogs(host as unknown as OpenClawApp, { reset: true });\r\n    scheduleLogsScroll(host as unknown as Parameters<typeof scheduleLogsScroll>[0], true);\r\n  }\r\n}\r\n\r\nexport function inferBasePath() {\r\n  if (typeof window === \"undefined\") {\r\n    return \"\";\r\n  }\r\n  const configured = window.__OPENCLAW_CONTROL_UI_BASE_PATH__;\r\n  if (typeof configured === \"string\" && configured.trim()) {\r\n    return normalizeBasePath(configured);\r\n  }\r\n  return inferBasePathFromPathname(window.location.pathname);\r\n}\r\n\r\nexport function syncThemeWithSettings(host: SettingsHost) {\r\n  host.theme = host.settings.theme ?? \"system\";\r\n  applyResolvedTheme(host, resolveTheme(host.theme));\r\n}\r\n\r\nexport function applyResolvedTheme(host: SettingsHost, resolved: ResolvedTheme) {\r\n  host.themeResolved = resolved;\r\n  if (typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n  const root = document.documentElement;\r\n  root.dataset.theme = resolved;\r\n  root.style.colorScheme = resolved;\r\n}\r\n\r\nexport function attachThemeListener(host: SettingsHost) {\r\n  if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") {\r\n    return;\r\n  }\r\n  host.themeMedia = window.matchMedia(\"(prefers-color-scheme: dark)\");\r\n  host.themeMediaHandler = (event) => {\r\n    if (host.theme !== \"system\") {\r\n      return;\r\n    }\r\n    applyResolvedTheme(host, event.matches ? \"dark\" : \"light\");\r\n  };\r\n  if (typeof host.themeMedia.addEventListener === \"function\") {\r\n    host.themeMedia.addEventListener(\"change\", host.themeMediaHandler);\r\n    return;\r\n  }\r\n  const legacy = host.themeMedia as MediaQueryList & {\r\n    addListener: (cb: (event: MediaQueryListEvent) => void) => void;\r\n  };\r\n  legacy.addListener(host.themeMediaHandler);\r\n}\r\n\r\nexport function detachThemeListener(host: SettingsHost) {\r\n  if (!host.themeMedia || !host.themeMediaHandler) {\r\n    return;\r\n  }\r\n  if (typeof host.themeMedia.removeEventListener === \"function\") {\r\n    host.themeMedia.removeEventListener(\"change\", host.themeMediaHandler);\r\n    return;\r\n  }\r\n  const legacy = host.themeMedia as MediaQueryList & {\r\n    removeListener: (cb: (event: MediaQueryListEvent) => void) => void;\r\n  };\r\n  legacy.removeListener(host.themeMediaHandler);\r\n  host.themeMedia = null;\r\n  host.themeMediaHandler = null;\r\n}\r\n\r\nexport function syncTabWithLocation(host: SettingsHost, replace: boolean) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  const resolved = tabFromPath(window.location.pathname, host.basePath) ?? \"chat\";\r\n  setTabFromRoute(host, resolved);\r\n  syncUrlWithTab(host, resolved, replace);\r\n}\r\n\r\nexport function onPopState(host: SettingsHost) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  const resolved = tabFromPath(window.location.pathname, host.basePath);\r\n  if (!resolved) {\r\n    return;\r\n  }\r\n\r\n  const url = new URL(window.location.href);\r\n  const session = url.searchParams.get(\"session\")?.trim();\r\n  if (session) {\r\n    host.sessionKey = session;\r\n    applySettings(host, {\r\n      ...host.settings,\r\n      sessionKey: session,\r\n      lastActiveSessionKey: session,\r\n    });\r\n  }\r\n\r\n  setTabFromRoute(host, resolved);\r\n}\r\n\r\nexport function setTabFromRoute(host: SettingsHost, next: Tab) {\r\n  if (host.tab !== next) {\r\n    host.tab = next;\r\n  }\r\n  if (next === \"chat\") {\r\n    host.chatHasAutoScrolled = false;\r\n  }\r\n  if (next === \"logs\") {\r\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\r\n  } else {\r\n    stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\r\n  }\r\n  if (next === \"debug\") {\r\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\r\n  } else {\r\n    stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\r\n  }\r\n  if (host.connected) {\r\n    void refreshActiveTab(host);\r\n  }\r\n}\r\n\r\nexport function syncUrlWithTab(host: SettingsHost, tab: Tab, replace: boolean) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  const targetPath = normalizePath(pathForTab(tab, host.basePath));\r\n  const currentPath = normalizePath(window.location.pathname);\r\n  const url = new URL(window.location.href);\r\n\r\n  if (tab === \"chat\" && host.sessionKey) {\r\n    url.searchParams.set(\"session\", host.sessionKey);\r\n  } else {\r\n    url.searchParams.delete(\"session\");\r\n  }\r\n\r\n  if (currentPath !== targetPath) {\r\n    url.pathname = targetPath;\r\n  }\r\n\r\n  if (replace) {\r\n    window.history.replaceState({}, \"\", url.toString());\r\n  } else {\r\n    window.history.pushState({}, \"\", url.toString());\r\n  }\r\n}\r\n\r\nexport function syncUrlWithSessionKey(host: SettingsHost, sessionKey: string, replace: boolean) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  const url = new URL(window.location.href);\r\n  url.searchParams.set(\"session\", sessionKey);\r\n  if (replace) {\r\n    window.history.replaceState({}, \"\", url.toString());\r\n  } else {\r\n    window.history.pushState({}, \"\", url.toString());\r\n  }\r\n}\r\n\r\nexport async function loadOverview(host: SettingsHost) {\r\n  await Promise.all([\r\n    loadChannels(host as unknown as OpenClawApp, false),\r\n    loadPresence(host as unknown as OpenClawApp),\r\n    loadSessions(host as unknown as OpenClawApp),\r\n    loadCronStatus(host as unknown as OpenClawApp),\r\n    loadDebug(host as unknown as OpenClawApp),\r\n  ]);\r\n}\r\n\r\nexport async function loadChannelsTab(host: SettingsHost) {\r\n  await Promise.all([\r\n    loadChannels(host as unknown as OpenClawApp, true),\r\n    loadConfigSchema(host as unknown as OpenClawApp),\r\n    loadConfig(host as unknown as OpenClawApp),\r\n  ]);\r\n}\r\n\r\nexport async function loadCron(host: SettingsHost) {\r\n  await Promise.all([\r\n    loadChannels(host as unknown as OpenClawApp, false),\r\n    loadCronStatus(host as unknown as OpenClawApp),\r\n    loadCronJobs(host as unknown as OpenClawApp),\r\n  ]);\r\n}\r\n","import { truncateText } from \"./format.ts\";\r\n\r\nconst TOOL_STREAM_LIMIT = 50;\r\nconst TOOL_STREAM_THROTTLE_MS = 80;\r\nconst TOOL_OUTPUT_CHAR_LIMIT = 120_000;\r\n\r\nexport type AgentEventPayload = {\r\n  runId: string;\r\n  seq: number;\r\n  stream: string;\r\n  ts: number;\r\n  sessionKey?: string;\r\n  data: Record<string, unknown>;\r\n};\r\n\r\nexport type ToolStreamEntry = {\r\n  toolCallId: string;\r\n  runId: string;\r\n  sessionKey?: string;\r\n  name: string;\r\n  args?: unknown;\r\n  output?: string;\r\n  startedAt: number;\r\n  updatedAt: number;\r\n  message: Record<string, unknown>;\r\n};\r\n\r\ntype ToolStreamHost = {\r\n  sessionKey: string;\r\n  chatRunId: string | null;\r\n  toolStreamById: Map<string, ToolStreamEntry>;\r\n  toolStreamOrder: string[];\r\n  chatToolMessages: Record<string, unknown>[];\r\n  toolStreamSyncTimer: number | null;\r\n};\r\n\r\nfunction extractToolOutputText(value: unknown): string | null {\r\n  if (!value || typeof value !== \"object\") {\r\n    return null;\r\n  }\r\n  const record = value as Record<string, unknown>;\r\n  if (typeof record.text === \"string\") {\r\n    return record.text;\r\n  }\r\n  const content = record.content;\r\n  if (!Array.isArray(content)) {\r\n    return null;\r\n  }\r\n  const parts = content\r\n    .map((item) => {\r\n      if (!item || typeof item !== \"object\") {\r\n        return null;\r\n      }\r\n      const entry = item as Record<string, unknown>;\r\n      if (entry.type === \"text\" && typeof entry.text === \"string\") {\r\n        return entry.text;\r\n      }\r\n      return null;\r\n    })\r\n    .filter((part): part is string => Boolean(part));\r\n  if (parts.length === 0) {\r\n    return null;\r\n  }\r\n  return parts.join(\"\\n\");\r\n}\r\n\r\nfunction formatToolOutput(value: unknown): string | null {\r\n  if (value === null || value === undefined) {\r\n    return null;\r\n  }\r\n  if (typeof value === \"number\" || typeof value === \"boolean\") {\r\n    return String(value);\r\n  }\r\n  const contentText = extractToolOutputText(value);\r\n  let text: string;\r\n  if (typeof value === \"string\") {\r\n    text = value;\r\n  } else if (contentText) {\r\n    text = contentText;\r\n  } else {\r\n    try {\r\n      text = JSON.stringify(value, null, 2);\r\n    } catch {\r\n      // oxlint-disable typescript/no-base-to-string\r\n      text = String(value);\r\n    }\r\n  }\r\n  const truncated = truncateText(text, TOOL_OUTPUT_CHAR_LIMIT);\r\n  if (!truncated.truncated) {\r\n    return truncated.text;\r\n  }\r\n  return `${truncated.text}\\n\\n… truncated (${truncated.total} chars, showing first ${truncated.text.length}).`;\r\n}\r\n\r\nfunction buildToolStreamMessage(entry: ToolStreamEntry): Record<string, unknown> {\r\n  const content: Array<Record<string, unknown>> = [];\r\n  content.push({\r\n    type: \"toolcall\",\r\n    name: entry.name,\r\n    arguments: entry.args ?? {},\r\n  });\r\n  if (entry.output) {\r\n    content.push({\r\n      type: \"toolresult\",\r\n      name: entry.name,\r\n      text: entry.output,\r\n    });\r\n  }\r\n  return {\r\n    role: \"assistant\",\r\n    toolCallId: entry.toolCallId,\r\n    runId: entry.runId,\r\n    content,\r\n    timestamp: entry.startedAt,\r\n  };\r\n}\r\n\r\nfunction trimToolStream(host: ToolStreamHost) {\r\n  if (host.toolStreamOrder.length <= TOOL_STREAM_LIMIT) {\r\n    return;\r\n  }\r\n  const overflow = host.toolStreamOrder.length - TOOL_STREAM_LIMIT;\r\n  const removed = host.toolStreamOrder.splice(0, overflow);\r\n  for (const id of removed) {\r\n    host.toolStreamById.delete(id);\r\n  }\r\n}\r\n\r\nfunction syncToolStreamMessages(host: ToolStreamHost) {\r\n  host.chatToolMessages = host.toolStreamOrder\r\n    .map((id) => host.toolStreamById.get(id)?.message)\r\n    .filter((msg): msg is Record<string, unknown> => Boolean(msg));\r\n}\r\n\r\nexport function flushToolStreamSync(host: ToolStreamHost) {\r\n  if (host.toolStreamSyncTimer != null) {\r\n    clearTimeout(host.toolStreamSyncTimer);\r\n    host.toolStreamSyncTimer = null;\r\n  }\r\n  syncToolStreamMessages(host);\r\n}\r\n\r\nexport function scheduleToolStreamSync(host: ToolStreamHost, force = false) {\r\n  if (force) {\r\n    flushToolStreamSync(host);\r\n    return;\r\n  }\r\n  if (host.toolStreamSyncTimer != null) {\r\n    return;\r\n  }\r\n  host.toolStreamSyncTimer = window.setTimeout(\r\n    () => flushToolStreamSync(host),\r\n    TOOL_STREAM_THROTTLE_MS,\r\n  );\r\n}\r\n\r\nexport function resetToolStream(host: ToolStreamHost) {\r\n  host.toolStreamById.clear();\r\n  host.toolStreamOrder = [];\r\n  host.chatToolMessages = [];\r\n  flushToolStreamSync(host);\r\n}\r\n\r\nexport type CompactionStatus = {\r\n  active: boolean;\r\n  startedAt: number | null;\r\n  completedAt: number | null;\r\n};\r\n\r\ntype CompactionHost = ToolStreamHost & {\r\n  compactionStatus?: CompactionStatus | null;\r\n  compactionClearTimer?: number | null;\r\n};\r\n\r\nconst COMPACTION_TOAST_DURATION_MS = 5000;\r\n\r\nexport function handleCompactionEvent(host: CompactionHost, payload: AgentEventPayload) {\r\n  const data = payload.data ?? {};\r\n  const phase = typeof data.phase === \"string\" ? data.phase : \"\";\r\n\r\n  // Clear any existing timer\r\n  if (host.compactionClearTimer != null) {\r\n    window.clearTimeout(host.compactionClearTimer);\r\n    host.compactionClearTimer = null;\r\n  }\r\n\r\n  if (phase === \"start\") {\r\n    host.compactionStatus = {\r\n      active: true,\r\n      startedAt: Date.now(),\r\n      completedAt: null,\r\n    };\r\n  } else if (phase === \"end\") {\r\n    host.compactionStatus = {\r\n      active: false,\r\n      startedAt: host.compactionStatus?.startedAt ?? null,\r\n      completedAt: Date.now(),\r\n    };\r\n    // Auto-clear the toast after duration\r\n    host.compactionClearTimer = window.setTimeout(() => {\r\n      host.compactionStatus = null;\r\n      host.compactionClearTimer = null;\r\n    }, COMPACTION_TOAST_DURATION_MS);\r\n  }\r\n}\r\n\r\nexport function handleAgentEvent(host: ToolStreamHost, payload?: AgentEventPayload) {\r\n  if (!payload) {\r\n    return;\r\n  }\r\n\r\n  // Handle compaction events\r\n  if (payload.stream === \"compaction\") {\r\n    handleCompactionEvent(host as CompactionHost, payload);\r\n    return;\r\n  }\r\n\r\n  if (payload.stream !== \"tool\") {\r\n    return;\r\n  }\r\n  const sessionKey = typeof payload.sessionKey === \"string\" ? payload.sessionKey : undefined;\r\n  if (sessionKey && sessionKey !== host.sessionKey) {\r\n    return;\r\n  }\r\n  // Fallback: only accept session-less events for the active run.\r\n  if (!sessionKey && host.chatRunId && payload.runId !== host.chatRunId) {\r\n    return;\r\n  }\r\n  if (host.chatRunId && payload.runId !== host.chatRunId) {\r\n    return;\r\n  }\r\n  if (!host.chatRunId) {\r\n    return;\r\n  }\r\n\r\n  const data = payload.data ?? {};\r\n  const toolCallId = typeof data.toolCallId === \"string\" ? data.toolCallId : \"\";\r\n  if (!toolCallId) {\r\n    return;\r\n  }\r\n  const name = typeof data.name === \"string\" ? data.name : \"tool\";\r\n  const phase = typeof data.phase === \"string\" ? data.phase : \"\";\r\n  const args = phase === \"start\" ? data.args : undefined;\r\n  const output =\r\n    phase === \"update\"\r\n      ? formatToolOutput(data.partialResult)\r\n      : phase === \"result\"\r\n        ? formatToolOutput(data.result)\r\n        : undefined;\r\n\r\n  const now = Date.now();\r\n  let entry = host.toolStreamById.get(toolCallId);\r\n  if (!entry) {\r\n    entry = {\r\n      toolCallId,\r\n      runId: payload.runId,\r\n      sessionKey,\r\n      name,\r\n      args,\r\n      output: output || undefined,\r\n      startedAt: typeof payload.ts === \"number\" ? payload.ts : now,\r\n      updatedAt: now,\r\n      message: {},\r\n    };\r\n    host.toolStreamById.set(toolCallId, entry);\r\n    host.toolStreamOrder.push(toolCallId);\r\n  } else {\r\n    entry.name = name;\r\n    if (args !== undefined) {\r\n      entry.args = args;\r\n    }\r\n    if (output !== undefined) {\r\n      entry.output = output || undefined;\r\n    }\r\n    entry.updatedAt = now;\r\n  }\r\n\r\n  entry.message = buildToolStreamMessage(entry);\r\n  trimToolStream(host);\r\n  scheduleToolStreamSync(host, phase === \"result\");\r\n}\r\n","import { stripThinkingTags } from \"../format.ts\";\r\n\r\nconst ENVELOPE_PREFIX = /^\\[([^\\]]+)\\]\\s*/;\r\nconst ENVELOPE_CHANNELS = [\r\n  \"WebChat\",\r\n  \"WhatsApp\",\r\n  \"Telegram\",\r\n  \"Signal\",\r\n  \"Slack\",\r\n  \"Discord\",\r\n  \"iMessage\",\r\n  \"Teams\",\r\n  \"Matrix\",\r\n  \"Zalo\",\r\n  \"Zalo Personal\",\r\n  \"BlueBubbles\",\r\n];\r\n\r\nconst textCache = new WeakMap<object, string | null>();\r\nconst thinkingCache = new WeakMap<object, string | null>();\r\n\r\nfunction looksLikeEnvelopeHeader(header: string): boolean {\r\n  if (/\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}Z\\b/.test(header)) {\r\n    return true;\r\n  }\r\n  if (/\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}\\b/.test(header)) {\r\n    return true;\r\n  }\r\n  return ENVELOPE_CHANNELS.some((label) => header.startsWith(`${label} `));\r\n}\r\n\r\nexport function stripEnvelope(text: string): string {\r\n  const match = text.match(ENVELOPE_PREFIX);\r\n  if (!match) {\r\n    return text;\r\n  }\r\n  const header = match[1] ?? \"\";\r\n  if (!looksLikeEnvelopeHeader(header)) {\r\n    return text;\r\n  }\r\n  return text.slice(match[0].length);\r\n}\r\n\r\nexport function extractText(message: unknown): string | null {\r\n  const m = message as Record<string, unknown>;\r\n  const role = typeof m.role === \"string\" ? m.role : \"\";\r\n  const content = m.content;\r\n  if (typeof content === \"string\") {\r\n    const processed = role === \"assistant\" ? stripThinkingTags(content) : stripEnvelope(content);\r\n    return processed;\r\n  }\r\n  if (Array.isArray(content)) {\r\n    const parts = content\r\n      .map((p) => {\r\n        const item = p as Record<string, unknown>;\r\n        if (item.type === \"text\" && typeof item.text === \"string\") {\r\n          return item.text;\r\n        }\r\n        return null;\r\n      })\r\n      .filter((v): v is string => typeof v === \"string\");\r\n    if (parts.length > 0) {\r\n      const joined = parts.join(\"\\n\");\r\n      const processed = role === \"assistant\" ? stripThinkingTags(joined) : stripEnvelope(joined);\r\n      return processed;\r\n    }\r\n  }\r\n  if (typeof m.text === \"string\") {\r\n    const processed = role === \"assistant\" ? stripThinkingTags(m.text) : stripEnvelope(m.text);\r\n    return processed;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function extractTextCached(message: unknown): string | null {\r\n  if (!message || typeof message !== \"object\") {\r\n    return extractText(message);\r\n  }\r\n  const obj = message;\r\n  if (textCache.has(obj)) {\r\n    return textCache.get(obj) ?? null;\r\n  }\r\n  const value = extractText(message);\r\n  textCache.set(obj, value);\r\n  return value;\r\n}\r\n\r\nexport function extractThinking(message: unknown): string | null {\r\n  const m = message as Record<string, unknown>;\r\n  const content = m.content;\r\n  const parts: string[] = [];\r\n  if (Array.isArray(content)) {\r\n    for (const p of content) {\r\n      const item = p as Record<string, unknown>;\r\n      if (item.type === \"thinking\" && typeof item.thinking === \"string\") {\r\n        const cleaned = item.thinking.trim();\r\n        if (cleaned) {\r\n          parts.push(cleaned);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  if (parts.length > 0) {\r\n    return parts.join(\"\\n\");\r\n  }\r\n\r\n  // Back-compat: older logs may still have <think> tags inside text blocks.\r\n  const rawText = extractRawText(message);\r\n  if (!rawText) {\r\n    return null;\r\n  }\r\n  const matches = [\r\n    ...rawText.matchAll(/<\\s*think(?:ing)?\\s*>([\\s\\S]*?)<\\s*\\/\\s*think(?:ing)?\\s*>/gi),\r\n  ];\r\n  const extracted = matches.map((m) => (m[1] ?? \"\").trim()).filter(Boolean);\r\n  return extracted.length > 0 ? extracted.join(\"\\n\") : null;\r\n}\r\n\r\nexport function extractThinkingCached(message: unknown): string | null {\r\n  if (!message || typeof message !== \"object\") {\r\n    return extractThinking(message);\r\n  }\r\n  const obj = message;\r\n  if (thinkingCache.has(obj)) {\r\n    return thinkingCache.get(obj) ?? null;\r\n  }\r\n  const value = extractThinking(message);\r\n  thinkingCache.set(obj, value);\r\n  return value;\r\n}\r\n\r\nexport function extractRawText(message: unknown): string | null {\r\n  const m = message as Record<string, unknown>;\r\n  const content = m.content;\r\n  if (typeof content === \"string\") {\r\n    return content;\r\n  }\r\n  if (Array.isArray(content)) {\r\n    const parts = content\r\n      .map((p) => {\r\n        const item = p as Record<string, unknown>;\r\n        if (item.type === \"text\" && typeof item.text === \"string\") {\r\n          return item.text;\r\n        }\r\n        return null;\r\n      })\r\n      .filter((v): v is string => typeof v === \"string\");\r\n    if (parts.length > 0) {\r\n      return parts.join(\"\\n\");\r\n    }\r\n  }\r\n  if (typeof m.text === \"string\") {\r\n    return m.text;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function formatReasoningMarkdown(text: string): string {\r\n  const trimmed = text.trim();\r\n  if (!trimmed) {\r\n    return \"\";\r\n  }\r\n  const lines = trimmed\r\n    .split(/\\r?\\n/)\r\n    .map((line) => line.trim())\r\n    .filter(Boolean)\r\n    .map((line) => `_${line}_`);\r\n  return lines.length ? [\"_Reasoning:_\", ...lines].join(\"\\n\") : \"\";\r\n}\r\n","export type CryptoLike = {\r\n  randomUUID?: (() => string) | undefined;\r\n  getRandomValues?: (<T extends Exclude<BufferSource, ArrayBuffer>>(array: T) => T) | undefined;\r\n};\r\n\r\nlet warnedWeakCrypto = false;\r\n\r\nfunction uuidFromBytes(bytes: Uint8Array): string {\r\n  bytes[6] = (bytes[6] & 0x0f) | 0x40; // version 4\r\n  bytes[8] = (bytes[8] & 0x3f) | 0x80; // variant 1\r\n\r\n  let hex = \"\";\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    hex += bytes[i].toString(16).padStart(2, \"0\");\r\n  }\r\n\r\n  return `${hex.slice(0, 8)}-${hex.slice(8, 12)}-${hex.slice(12, 16)}-${hex.slice(\r\n    16,\r\n    20,\r\n  )}-${hex.slice(20)}`;\r\n}\r\n\r\nfunction weakRandomBytes(): Uint8Array {\r\n  const bytes = new Uint8Array(16);\r\n  const now = Date.now();\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    bytes[i] = Math.floor(Math.random() * 256);\r\n  }\r\n  bytes[0] ^= now & 0xff;\r\n  bytes[1] ^= (now >>> 8) & 0xff;\r\n  bytes[2] ^= (now >>> 16) & 0xff;\r\n  bytes[3] ^= (now >>> 24) & 0xff;\r\n  return bytes;\r\n}\r\n\r\nfunction warnWeakCryptoOnce() {\r\n  if (warnedWeakCrypto) {\r\n    return;\r\n  }\r\n  warnedWeakCrypto = true;\r\n  console.warn(\"[uuid] crypto API missing; falling back to weak randomness\");\r\n}\r\n\r\nexport function generateUUID(cryptoLike: CryptoLike | null = globalThis.crypto): string {\r\n  if (cryptoLike && typeof cryptoLike.randomUUID === \"function\") {\r\n    return cryptoLike.randomUUID();\r\n  }\r\n\r\n  if (cryptoLike && typeof cryptoLike.getRandomValues === \"function\") {\r\n    const bytes = new Uint8Array(16);\r\n    cryptoLike.getRandomValues(bytes);\r\n    return uuidFromBytes(bytes);\r\n  }\r\n\r\n  warnWeakCryptoOnce();\r\n  return uuidFromBytes(weakRandomBytes());\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { ChatAttachment } from \"../ui-types.ts\";\r\nimport { extractText } from \"../chat/message-extract.ts\";\r\nimport { generateUUID } from \"../uuid.ts\";\r\n\r\nexport type ChatState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  sessionKey: string;\r\n  chatLoading: boolean;\r\n  chatMessages: unknown[];\r\n  chatThinkingLevel: string | null;\r\n  chatSending: boolean;\r\n  chatMessage: string;\r\n  chatAttachments: ChatAttachment[];\r\n  chatRunId: string | null;\r\n  chatStream: string | null;\r\n  chatStreamStartedAt: number | null;\r\n  lastError: string | null;\r\n};\r\n\r\nexport type ChatEventPayload = {\r\n  runId: string;\r\n  sessionKey: string;\r\n  state: \"delta\" | \"final\" | \"aborted\" | \"error\";\r\n  message?: unknown;\r\n  errorMessage?: string;\r\n};\r\n\r\nexport async function loadChatHistory(state: ChatState) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  state.chatLoading = true;\r\n  state.lastError = null;\r\n  try {\r\n    const res = await state.client.request<{ messages?: Array<unknown>; thinkingLevel?: string }>(\r\n      \"chat.history\",\r\n      {\r\n        sessionKey: state.sessionKey,\r\n        limit: 200,\r\n      },\r\n    );\r\n    state.chatMessages = Array.isArray(res.messages) ? res.messages : [];\r\n    state.chatThinkingLevel = res.thinkingLevel ?? null;\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n  } finally {\r\n    state.chatLoading = false;\r\n  }\r\n}\r\n\r\nfunction dataUrlToBase64(dataUrl: string): { content: string; mimeType: string } | null {\r\n  const match = /^data:([^;]+);base64,(.+)$/.exec(dataUrl);\r\n  if (!match) {\r\n    return null;\r\n  }\r\n  return { mimeType: match[1], content: match[2] };\r\n}\r\n\r\nexport async function sendChatMessage(\r\n  state: ChatState,\r\n  message: string,\r\n  attachments?: ChatAttachment[],\r\n): Promise<string | null> {\r\n  if (!state.client || !state.connected) {\r\n    return null;\r\n  }\r\n  const msg = message.trim();\r\n  const hasAttachments = attachments && attachments.length > 0;\r\n  if (!msg && !hasAttachments) {\r\n    return null;\r\n  }\r\n\r\n  const now = Date.now();\r\n\r\n  // Build user message content blocks\r\n  const contentBlocks: Array<{ type: string; text?: string; source?: unknown }> = [];\r\n  if (msg) {\r\n    contentBlocks.push({ type: \"text\", text: msg });\r\n  }\r\n  // Add image previews to the message for display\r\n  if (hasAttachments) {\r\n    for (const att of attachments) {\r\n      contentBlocks.push({\r\n        type: \"image\",\r\n        source: { type: \"base64\", media_type: att.mimeType, data: att.dataUrl },\r\n      });\r\n    }\r\n  }\r\n\r\n  state.chatMessages = [\r\n    ...state.chatMessages,\r\n    {\r\n      role: \"user\",\r\n      content: contentBlocks,\r\n      timestamp: now,\r\n    },\r\n  ];\r\n\r\n  state.chatSending = true;\r\n  state.lastError = null;\r\n  const runId = generateUUID();\r\n  state.chatRunId = runId;\r\n  state.chatStream = \"\";\r\n  state.chatStreamStartedAt = now;\r\n\r\n  // Convert attachments to API format\r\n  const apiAttachments = hasAttachments\r\n    ? attachments\r\n        .map((att) => {\r\n          const parsed = dataUrlToBase64(att.dataUrl);\r\n          if (!parsed) {\r\n            return null;\r\n          }\r\n          return {\r\n            type: \"image\",\r\n            mimeType: parsed.mimeType,\r\n            content: parsed.content,\r\n          };\r\n        })\r\n        .filter((a): a is NonNullable<typeof a> => a !== null)\r\n    : undefined;\r\n\r\n  try {\r\n    await state.client.request(\"chat.send\", {\r\n      sessionKey: state.sessionKey,\r\n      message: msg,\r\n      deliver: false,\r\n      idempotencyKey: runId,\r\n      attachments: apiAttachments,\r\n    });\r\n    return runId;\r\n  } catch (err) {\r\n    const error = String(err);\r\n    state.chatRunId = null;\r\n    state.chatStream = null;\r\n    state.chatStreamStartedAt = null;\r\n    state.lastError = error;\r\n    state.chatMessages = [\r\n      ...state.chatMessages,\r\n      {\r\n        role: \"assistant\",\r\n        content: [{ type: \"text\", text: \"Error: \" + error }],\r\n        timestamp: Date.now(),\r\n      },\r\n    ];\r\n    return null;\r\n  } finally {\r\n    state.chatSending = false;\r\n  }\r\n}\r\n\r\nexport async function abortChatRun(state: ChatState): Promise<boolean> {\r\n  if (!state.client || !state.connected) {\r\n    return false;\r\n  }\r\n  const runId = state.chatRunId;\r\n  try {\r\n    await state.client.request(\r\n      \"chat.abort\",\r\n      runId ? { sessionKey: state.sessionKey, runId } : { sessionKey: state.sessionKey },\r\n    );\r\n    return true;\r\n  } catch (err) {\r\n    state.lastError = String(err);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function handleChatEvent(state: ChatState, payload?: ChatEventPayload) {\r\n  if (!payload) {\r\n    return null;\r\n  }\r\n  if (payload.sessionKey !== state.sessionKey) {\r\n    return null;\r\n  }\r\n\r\n  // Final from another run (e.g. sub-agent announce): refresh history to show new message.\r\n  // See https://github.com/openclaw/openclaw/issues/1909\r\n  if (payload.runId && state.chatRunId && payload.runId !== state.chatRunId) {\r\n    if (payload.state === \"final\") {\r\n      return \"final\";\r\n    }\r\n    return null;\r\n  }\r\n\r\n  if (payload.state === \"delta\") {\r\n    const next = extractText(payload.message);\r\n    if (typeof next === \"string\") {\r\n      const current = state.chatStream ?? \"\";\r\n      if (!current || next.length >= current.length) {\r\n        state.chatStream = next;\r\n      }\r\n    }\r\n  } else if (payload.state === \"final\") {\r\n    state.chatStream = null;\r\n    state.chatRunId = null;\r\n    state.chatStreamStartedAt = null;\r\n  } else if (payload.state === \"aborted\") {\r\n    state.chatStream = null;\r\n    state.chatRunId = null;\r\n    state.chatStreamStartedAt = null;\r\n  } else if (payload.state === \"error\") {\r\n    state.chatStream = null;\r\n    state.chatRunId = null;\r\n    state.chatStreamStartedAt = null;\r\n    state.lastError = payload.errorMessage ?? \"chat error\";\r\n  }\r\n  return payload.state;\r\n}\r\n","import type { OpenClawApp } from \"./app.ts\";\r\nimport type { GatewayHelloOk } from \"./gateway.ts\";\r\nimport type { ChatAttachment, ChatQueueItem } from \"./ui-types.ts\";\r\nimport { parseAgentSessionKey } from \"../../../src/sessions/session-key-utils.js\";\r\nimport { scheduleChatScroll } from \"./app-scroll.ts\";\r\nimport { setLastActiveSessionKey } from \"./app-settings.ts\";\r\nimport { resetToolStream } from \"./app-tool-stream.ts\";\r\nimport { abortChatRun, loadChatHistory, sendChatMessage } from \"./controllers/chat.ts\";\r\nimport { loadSessions } from \"./controllers/sessions.ts\";\r\nimport { normalizeBasePath } from \"./navigation.ts\";\r\nimport { generateUUID } from \"./uuid.ts\";\r\n\r\nexport type ChatHost = {\r\n  connected: boolean;\r\n  chatMessage: string;\r\n  chatAttachments: ChatAttachment[];\r\n  chatQueue: ChatQueueItem[];\r\n  chatRunId: string | null;\r\n  chatSending: boolean;\r\n  sessionKey: string;\r\n  basePath: string;\r\n  hello: GatewayHelloOk | null;\r\n  chatAvatarUrl: string | null;\r\n  refreshSessionsAfterChat: Set<string>;\r\n};\r\n\r\nexport const CHAT_SESSIONS_ACTIVE_MINUTES = 120;\r\n\r\nexport function isChatBusy(host: ChatHost) {\r\n  return host.chatSending || Boolean(host.chatRunId);\r\n}\r\n\r\nexport function isChatStopCommand(text: string) {\r\n  const trimmed = text.trim();\r\n  if (!trimmed) {\r\n    return false;\r\n  }\r\n  const normalized = trimmed.toLowerCase();\r\n  if (normalized === \"/stop\") {\r\n    return true;\r\n  }\r\n  return (\r\n    normalized === \"stop\" ||\r\n    normalized === \"esc\" ||\r\n    normalized === \"abort\" ||\r\n    normalized === \"wait\" ||\r\n    normalized === \"exit\"\r\n  );\r\n}\r\n\r\nfunction isChatResetCommand(text: string) {\r\n  const trimmed = text.trim();\r\n  if (!trimmed) {\r\n    return false;\r\n  }\r\n  const normalized = trimmed.toLowerCase();\r\n  if (normalized === \"/new\" || normalized === \"/reset\") {\r\n    return true;\r\n  }\r\n  return normalized.startsWith(\"/new \") || normalized.startsWith(\"/reset \");\r\n}\r\n\r\nexport async function handleAbortChat(host: ChatHost) {\r\n  if (!host.connected) {\r\n    return;\r\n  }\r\n  host.chatMessage = \"\";\r\n  await abortChatRun(host as unknown as OpenClawApp);\r\n}\r\n\r\nfunction enqueueChatMessage(\r\n  host: ChatHost,\r\n  text: string,\r\n  attachments?: ChatAttachment[],\r\n  refreshSessions?: boolean,\r\n) {\r\n  const trimmed = text.trim();\r\n  const hasAttachments = Boolean(attachments && attachments.length > 0);\r\n  if (!trimmed && !hasAttachments) {\r\n    return;\r\n  }\r\n  host.chatQueue = [\r\n    ...host.chatQueue,\r\n    {\r\n      id: generateUUID(),\r\n      text: trimmed,\r\n      createdAt: Date.now(),\r\n      attachments: hasAttachments ? attachments?.map((att) => ({ ...att })) : undefined,\r\n      refreshSessions,\r\n    },\r\n  ];\r\n}\r\n\r\nasync function sendChatMessageNow(\r\n  host: ChatHost,\r\n  message: string,\r\n  opts?: {\r\n    previousDraft?: string;\r\n    restoreDraft?: boolean;\r\n    attachments?: ChatAttachment[];\r\n    previousAttachments?: ChatAttachment[];\r\n    restoreAttachments?: boolean;\r\n    refreshSessions?: boolean;\r\n  },\r\n) {\r\n  resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\r\n  const runId = await sendChatMessage(host as unknown as OpenClawApp, message, opts?.attachments);\r\n  const ok = Boolean(runId);\r\n  if (!ok && opts?.previousDraft != null) {\r\n    host.chatMessage = opts.previousDraft;\r\n  }\r\n  if (!ok && opts?.previousAttachments) {\r\n    host.chatAttachments = opts.previousAttachments;\r\n  }\r\n  if (ok) {\r\n    setLastActiveSessionKey(\r\n      host as unknown as Parameters<typeof setLastActiveSessionKey>[0],\r\n      host.sessionKey,\r\n    );\r\n  }\r\n  if (ok && opts?.restoreDraft && opts.previousDraft?.trim()) {\r\n    host.chatMessage = opts.previousDraft;\r\n  }\r\n  if (ok && opts?.restoreAttachments && opts.previousAttachments?.length) {\r\n    host.chatAttachments = opts.previousAttachments;\r\n  }\r\n  scheduleChatScroll(host as unknown as Parameters<typeof scheduleChatScroll>[0]);\r\n  if (ok && !host.chatRunId) {\r\n    void flushChatQueue(host);\r\n  }\r\n  if (ok && opts?.refreshSessions && runId) {\r\n    host.refreshSessionsAfterChat.add(runId);\r\n  }\r\n  return ok;\r\n}\r\n\r\nasync function flushChatQueue(host: ChatHost) {\r\n  if (!host.connected || isChatBusy(host)) {\r\n    return;\r\n  }\r\n  const [next, ...rest] = host.chatQueue;\r\n  if (!next) {\r\n    return;\r\n  }\r\n  host.chatQueue = rest;\r\n  const ok = await sendChatMessageNow(host, next.text, {\r\n    attachments: next.attachments,\r\n    refreshSessions: next.refreshSessions,\r\n  });\r\n  if (!ok) {\r\n    host.chatQueue = [next, ...host.chatQueue];\r\n  }\r\n}\r\n\r\nexport function removeQueuedMessage(host: ChatHost, id: string) {\r\n  host.chatQueue = host.chatQueue.filter((item) => item.id !== id);\r\n}\r\n\r\nexport async function handleSendChat(\r\n  host: ChatHost,\r\n  messageOverride?: string,\r\n  opts?: { restoreDraft?: boolean },\r\n) {\r\n  if (!host.connected) {\r\n    return;\r\n  }\r\n  const previousDraft = host.chatMessage;\r\n  const message = (messageOverride ?? host.chatMessage).trim();\r\n  const attachments = host.chatAttachments ?? [];\r\n  const attachmentsToSend = messageOverride == null ? attachments : [];\r\n  const hasAttachments = attachmentsToSend.length > 0;\r\n\r\n  // Allow sending with just attachments (no message text required)\r\n  if (!message && !hasAttachments) {\r\n    return;\r\n  }\r\n\r\n  if (isChatStopCommand(message)) {\r\n    await handleAbortChat(host);\r\n    return;\r\n  }\r\n\r\n  const refreshSessions = isChatResetCommand(message);\r\n  if (messageOverride == null) {\r\n    host.chatMessage = \"\";\r\n    // Clear attachments when sending\r\n    host.chatAttachments = [];\r\n  }\r\n\r\n  if (isChatBusy(host)) {\r\n    enqueueChatMessage(host, message, attachmentsToSend, refreshSessions);\r\n    return;\r\n  }\r\n\r\n  await sendChatMessageNow(host, message, {\r\n    previousDraft: messageOverride == null ? previousDraft : undefined,\r\n    restoreDraft: Boolean(messageOverride && opts?.restoreDraft),\r\n    attachments: hasAttachments ? attachmentsToSend : undefined,\r\n    previousAttachments: messageOverride == null ? attachments : undefined,\r\n    restoreAttachments: Boolean(messageOverride && opts?.restoreDraft),\r\n    refreshSessions,\r\n  });\r\n}\r\n\r\nexport async function refreshChat(host: ChatHost, opts?: { scheduleScroll?: boolean }) {\r\n  await Promise.all([\r\n    loadChatHistory(host as unknown as OpenClawApp),\r\n    loadSessions(host as unknown as OpenClawApp, {\r\n      activeMinutes: CHAT_SESSIONS_ACTIVE_MINUTES,\r\n    }),\r\n    refreshChatAvatar(host),\r\n  ]);\r\n  if (opts?.scheduleScroll !== false) {\r\n    scheduleChatScroll(host as unknown as Parameters<typeof scheduleChatScroll>[0]);\r\n  }\r\n}\r\n\r\nexport const flushChatQueueForEvent = flushChatQueue;\r\n\r\ntype SessionDefaultsSnapshot = {\r\n  defaultAgentId?: string;\r\n};\r\n\r\nfunction resolveAgentIdForSession(host: ChatHost): string | null {\r\n  const parsed = parseAgentSessionKey(host.sessionKey);\r\n  if (parsed?.agentId) {\r\n    return parsed.agentId;\r\n  }\r\n  const snapshot = host.hello?.snapshot as\r\n    | { sessionDefaults?: SessionDefaultsSnapshot }\r\n    | undefined;\r\n  const fallback = snapshot?.sessionDefaults?.defaultAgentId?.trim();\r\n  return fallback || \"main\";\r\n}\r\n\r\nfunction buildAvatarMetaUrl(basePath: string, agentId: string): string {\r\n  const base = normalizeBasePath(basePath);\r\n  const encoded = encodeURIComponent(agentId);\r\n  return base ? `${base}/avatar/${encoded}?meta=1` : `/avatar/${encoded}?meta=1`;\r\n}\r\n\r\nexport async function refreshChatAvatar(host: ChatHost) {\r\n  if (!host.connected) {\r\n    host.chatAvatarUrl = null;\r\n    return;\r\n  }\r\n  const agentId = resolveAgentIdForSession(host);\r\n  if (!agentId) {\r\n    host.chatAvatarUrl = null;\r\n    return;\r\n  }\r\n  host.chatAvatarUrl = null;\r\n  const url = buildAvatarMetaUrl(host.basePath, agentId);\r\n  try {\r\n    const res = await fetch(url, { method: \"GET\" });\r\n    if (!res.ok) {\r\n      host.chatAvatarUrl = null;\r\n      return;\r\n    }\r\n    const data = (await res.json()) as { avatarUrl?: unknown };\r\n    const avatarUrl = typeof data.avatarUrl === \"string\" ? data.avatarUrl.trim() : \"\";\r\n    host.chatAvatarUrl = avatarUrl || null;\r\n  } catch {\r\n    host.chatAvatarUrl = null;\r\n  }\r\n}\r\n","import type { LogLevel } from \"./types.ts\";\r\nimport type { CronFormState } from \"./ui-types.ts\";\r\n\r\nexport const DEFAULT_LOG_LEVEL_FILTERS: Record<LogLevel, boolean> = {\r\n  trace: true,\r\n  debug: true,\r\n  info: true,\r\n  warn: true,\r\n  error: true,\r\n  fatal: true,\r\n};\r\n\r\nexport const DEFAULT_CRON_FORM: CronFormState = {\r\n  name: \"\",\r\n  description: \"\",\r\n  agentId: \"\",\r\n  enabled: true,\r\n  scheduleKind: \"every\",\r\n  scheduleAt: \"\",\r\n  everyAmount: \"30\",\r\n  everyUnit: \"minutes\",\r\n  cronExpr: \"0 7 * * *\",\r\n  cronTz: \"\",\r\n  sessionTarget: \"isolated\",\r\n  wakeMode: \"now\",\r\n  payloadKind: \"agentTurn\",\r\n  payloadText: \"\",\r\n  deliveryMode: \"announce\",\r\n  deliveryChannel: \"last\",\r\n  deliveryTo: \"\",\r\n  timeoutSeconds: \"\",\r\n};\r\n","const MAX_ASSISTANT_NAME = 50;\r\nconst MAX_ASSISTANT_AVATAR = 200;\r\n\r\nexport const DEFAULT_ASSISTANT_NAME = \"Assistant\";\r\nexport const DEFAULT_ASSISTANT_AVATAR = \"A\";\r\n\r\nexport type AssistantIdentity = {\r\n  agentId?: string | null;\r\n  name: string;\r\n  avatar: string | null;\r\n};\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __OPENCLAW_ASSISTANT_NAME__?: string;\r\n    __OPENCLAW_ASSISTANT_AVATAR__?: string;\r\n  }\r\n}\r\n\r\nfunction coerceIdentityValue(value: string | undefined, maxLength: number): string | undefined {\r\n  if (typeof value !== \"string\") {\r\n    return undefined;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  if (trimmed.length <= maxLength) {\r\n    return trimmed;\r\n  }\r\n  return trimmed.slice(0, maxLength);\r\n}\r\n\r\nexport function normalizeAssistantIdentity(\r\n  input?: Partial<AssistantIdentity> | null,\r\n): AssistantIdentity {\r\n  const name = coerceIdentityValue(input?.name, MAX_ASSISTANT_NAME) ?? DEFAULT_ASSISTANT_NAME;\r\n  const avatar = coerceIdentityValue(input?.avatar ?? undefined, MAX_ASSISTANT_AVATAR) ?? null;\r\n  const agentId =\r\n    typeof input?.agentId === \"string\" && input.agentId.trim() ? input.agentId.trim() : null;\r\n  return { agentId, name, avatar };\r\n}\r\n\r\nexport function resolveInjectedAssistantIdentity(): AssistantIdentity {\r\n  if (typeof window === \"undefined\") {\r\n    return normalizeAssistantIdentity({});\r\n  }\r\n  return normalizeAssistantIdentity({\r\n    name: window.__OPENCLAW_ASSISTANT_NAME__,\r\n    avatar: window.__OPENCLAW_ASSISTANT_AVATAR__,\r\n  });\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport { normalizeAssistantIdentity } from \"../assistant-identity.ts\";\r\n\r\nexport type AssistantIdentityState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  sessionKey: string;\r\n  assistantName: string;\r\n  assistantAvatar: string | null;\r\n  assistantAgentId: string | null;\r\n};\r\n\r\nexport async function loadAssistantIdentity(\r\n  state: AssistantIdentityState,\r\n  opts?: { sessionKey?: string },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  const sessionKey = opts?.sessionKey?.trim() || state.sessionKey.trim();\r\n  const params = sessionKey ? { sessionKey } : {};\r\n  try {\r\n    const res = await state.client.request(\"agent.identity.get\", params);\r\n    if (!res) {\r\n      return;\r\n    }\r\n    const normalized = normalizeAssistantIdentity(res);\r\n    state.assistantName = normalized.name;\r\n    state.assistantAvatar = normalized.avatar;\r\n    state.assistantAgentId = normalized.agentId ?? null;\r\n  } catch {\r\n    // Ignore errors; keep last known identity.\r\n  }\r\n}\r\n","export type ExecApprovalRequestPayload = {\r\n  command: string;\r\n  cwd?: string | null;\r\n  host?: string | null;\r\n  security?: string | null;\r\n  ask?: string | null;\r\n  agentId?: string | null;\r\n  resolvedPath?: string | null;\r\n  sessionKey?: string | null;\r\n};\r\n\r\nexport type ExecApprovalRequest = {\r\n  id: string;\r\n  request: ExecApprovalRequestPayload;\r\n  createdAtMs: number;\r\n  expiresAtMs: number;\r\n};\r\n\r\nexport type ExecApprovalResolved = {\r\n  id: string;\r\n  decision?: string | null;\r\n  resolvedBy?: string | null;\r\n  ts?: number | null;\r\n};\r\n\r\nfunction isRecord(value: unknown): value is Record<string, unknown> {\r\n  return typeof value === \"object\" && value !== null;\r\n}\r\n\r\nexport function parseExecApprovalRequested(payload: unknown): ExecApprovalRequest | null {\r\n  if (!isRecord(payload)) {\r\n    return null;\r\n  }\r\n  const id = typeof payload.id === \"string\" ? payload.id.trim() : \"\";\r\n  const request = payload.request;\r\n  if (!id || !isRecord(request)) {\r\n    return null;\r\n  }\r\n  const command = typeof request.command === \"string\" ? request.command.trim() : \"\";\r\n  if (!command) {\r\n    return null;\r\n  }\r\n  const createdAtMs = typeof payload.createdAtMs === \"number\" ? payload.createdAtMs : 0;\r\n  const expiresAtMs = typeof payload.expiresAtMs === \"number\" ? payload.expiresAtMs : 0;\r\n  if (!createdAtMs || !expiresAtMs) {\r\n    return null;\r\n  }\r\n  return {\r\n    id,\r\n    request: {\r\n      command,\r\n      cwd: typeof request.cwd === \"string\" ? request.cwd : null,\r\n      host: typeof request.host === \"string\" ? request.host : null,\r\n      security: typeof request.security === \"string\" ? request.security : null,\r\n      ask: typeof request.ask === \"string\" ? request.ask : null,\r\n      agentId: typeof request.agentId === \"string\" ? request.agentId : null,\r\n      resolvedPath: typeof request.resolvedPath === \"string\" ? request.resolvedPath : null,\r\n      sessionKey: typeof request.sessionKey === \"string\" ? request.sessionKey : null,\r\n    },\r\n    createdAtMs,\r\n    expiresAtMs,\r\n  };\r\n}\r\n\r\nexport function parseExecApprovalResolved(payload: unknown): ExecApprovalResolved | null {\r\n  if (!isRecord(payload)) {\r\n    return null;\r\n  }\r\n  const id = typeof payload.id === \"string\" ? payload.id.trim() : \"\";\r\n  if (!id) {\r\n    return null;\r\n  }\r\n  return {\r\n    id,\r\n    decision: typeof payload.decision === \"string\" ? payload.decision : null,\r\n    resolvedBy: typeof payload.resolvedBy === \"string\" ? payload.resolvedBy : null,\r\n    ts: typeof payload.ts === \"number\" ? payload.ts : null,\r\n  };\r\n}\r\n\r\nexport function pruneExecApprovalQueue(queue: ExecApprovalRequest[]): ExecApprovalRequest[] {\r\n  const now = Date.now();\r\n  return queue.filter((entry) => entry.expiresAtMs > now);\r\n}\r\n\r\nexport function addExecApproval(\r\n  queue: ExecApprovalRequest[],\r\n  entry: ExecApprovalRequest,\r\n): ExecApprovalRequest[] {\r\n  const next = pruneExecApprovalQueue(queue).filter((item) => item.id !== entry.id);\r\n  next.push(entry);\r\n  return next;\r\n}\r\n\r\nexport function removeExecApproval(\r\n  queue: ExecApprovalRequest[],\r\n  id: string,\r\n): ExecApprovalRequest[] {\r\n  return pruneExecApprovalQueue(queue).filter((entry) => entry.id !== id);\r\n}\r\n","export type DeviceAuthPayloadParams = {\n  deviceId: string;\n  clientId: string;\n  clientMode: string;\n  role: string;\n  scopes: string[];\n  signedAtMs: number;\n  token?: string | null;\n  nonce?: string | null;\n  version?: \"v1\" | \"v2\";\n};\n\nexport function buildDeviceAuthPayload(params: DeviceAuthPayloadParams): string {\n  const version = params.version ?? (params.nonce ? \"v2\" : \"v1\");\n  const scopes = params.scopes.join(\",\");\n  const token = params.token ?? \"\";\n  const base = [\n    version,\n    params.deviceId,\n    params.clientId,\n    params.clientMode,\n    params.role,\n    scopes,\n    String(params.signedAtMs),\n    token,\n  ];\n  if (version === \"v2\") {\n    base.push(params.nonce ?? \"\");\n  }\n  return base.join(\"|\");\n}\n","export const GATEWAY_CLIENT_IDS = {\n  WEBCHAT_UI: \"webchat-ui\",\n  CONTROL_UI: \"openclaw-control-ui\",\n  WEBCHAT: \"webchat\",\n  CLI: \"cli\",\n  GATEWAY_CLIENT: \"gateway-client\",\n  MACOS_APP: \"openclaw-macos\",\n  IOS_APP: \"openclaw-ios\",\n  ANDROID_APP: \"openclaw-android\",\n  NODE_HOST: \"node-host\",\n  TEST: \"test\",\n  FINGERPRINT: \"fingerprint\",\n  PROBE: \"openclaw-probe\",\n} as const;\n\nexport type GatewayClientId = (typeof GATEWAY_CLIENT_IDS)[keyof typeof GATEWAY_CLIENT_IDS];\n\n// Back-compat naming (internal): these values are IDs, not display names.\nexport const GATEWAY_CLIENT_NAMES = GATEWAY_CLIENT_IDS;\nexport type GatewayClientName = GatewayClientId;\n\nexport const GATEWAY_CLIENT_MODES = {\n  WEBCHAT: \"webchat\",\n  CLI: \"cli\",\n  UI: \"ui\",\n  BACKEND: \"backend\",\n  NODE: \"node\",\n  PROBE: \"probe\",\n  TEST: \"test\",\n} as const;\n\nexport type GatewayClientMode = (typeof GATEWAY_CLIENT_MODES)[keyof typeof GATEWAY_CLIENT_MODES];\n\nexport type GatewayClientInfo = {\n  id: GatewayClientId;\n  displayName?: string;\n  version: string;\n  platform: string;\n  deviceFamily?: string;\n  modelIdentifier?: string;\n  mode: GatewayClientMode;\n  instanceId?: string;\n};\n\nexport const GATEWAY_CLIENT_CAPS = {\n  TOOL_EVENTS: \"tool-events\",\n} as const;\n\nexport type GatewayClientCap = (typeof GATEWAY_CLIENT_CAPS)[keyof typeof GATEWAY_CLIENT_CAPS];\n\nconst GATEWAY_CLIENT_ID_SET = new Set<GatewayClientId>(Object.values(GATEWAY_CLIENT_IDS));\nconst GATEWAY_CLIENT_MODE_SET = new Set<GatewayClientMode>(Object.values(GATEWAY_CLIENT_MODES));\n\nexport function normalizeGatewayClientId(raw?: string | null): GatewayClientId | undefined {\n  const normalized = raw?.trim().toLowerCase();\n  if (!normalized) {\n    return undefined;\n  }\n  return GATEWAY_CLIENT_ID_SET.has(normalized as GatewayClientId)\n    ? (normalized as GatewayClientId)\n    : undefined;\n}\n\nexport function normalizeGatewayClientName(raw?: string | null): GatewayClientName | undefined {\n  return normalizeGatewayClientId(raw);\n}\n\nexport function normalizeGatewayClientMode(raw?: string | null): GatewayClientMode | undefined {\n  const normalized = raw?.trim().toLowerCase();\n  if (!normalized) {\n    return undefined;\n  }\n  return GATEWAY_CLIENT_MODE_SET.has(normalized as GatewayClientMode)\n    ? (normalized as GatewayClientMode)\n    : undefined;\n}\n\nexport function hasGatewayClientCap(\n  caps: string[] | null | undefined,\n  cap: GatewayClientCap,\n): boolean {\n  if (!Array.isArray(caps)) {\n    return false;\n  }\n  return caps.includes(cap);\n}\n","import { buildDeviceAuthPayload } from \"../../../src/gateway/device-auth.js\";\r\nimport {\r\n  GATEWAY_CLIENT_MODES,\r\n  GATEWAY_CLIENT_NAMES,\r\n  type GatewayClientMode,\r\n  type GatewayClientName,\r\n} from \"../../../src/gateway/protocol/client-info.js\";\r\nimport { clearDeviceAuthToken, loadDeviceAuthToken, storeDeviceAuthToken } from \"./device-auth.ts\";\r\nimport { loadOrCreateDeviceIdentity, signDevicePayload } from \"./device-identity.ts\";\r\nimport { generateUUID } from \"./uuid.ts\";\r\n\r\nexport type GatewayEventFrame = {\r\n  type: \"event\";\r\n  event: string;\r\n  payload?: unknown;\r\n  seq?: number;\r\n  stateVersion?: { presence: number; health: number };\r\n};\r\n\r\nexport type GatewayResponseFrame = {\r\n  type: \"res\";\r\n  id: string;\r\n  ok: boolean;\r\n  payload?: unknown;\r\n  error?: { code: string; message: string; details?: unknown };\r\n};\r\n\r\nexport type GatewayHelloOk = {\r\n  type: \"hello-ok\";\r\n  protocol: number;\r\n  features?: { methods?: string[]; events?: string[] };\r\n  snapshot?: unknown;\r\n  auth?: {\r\n    deviceToken?: string;\r\n    role?: string;\r\n    scopes?: string[];\r\n    issuedAtMs?: number;\r\n  };\r\n  policy?: { tickIntervalMs?: number };\r\n};\r\n\r\ntype Pending = {\r\n  resolve: (value: unknown) => void;\r\n  reject: (err: unknown) => void;\r\n};\r\n\r\nexport type GatewayBrowserClientOptions = {\r\n  url: string;\r\n  token?: string;\r\n  password?: string;\r\n  clientName?: GatewayClientName;\r\n  clientVersion?: string;\r\n  platform?: string;\r\n  mode?: GatewayClientMode;\r\n  instanceId?: string;\r\n  onHello?: (hello: GatewayHelloOk) => void;\r\n  onEvent?: (evt: GatewayEventFrame) => void;\r\n  onClose?: (info: { code: number; reason: string }) => void;\r\n  onGap?: (info: { expected: number; received: number }) => void;\r\n};\r\n\r\n// 4008 = application-defined code (browser rejects 1008 \"Policy Violation\")\r\nconst CONNECT_FAILED_CLOSE_CODE = 4008;\r\n\r\nexport class GatewayBrowserClient {\r\n  private ws: WebSocket | null = null;\r\n  private pending = new Map<string, Pending>();\r\n  private closed = false;\r\n  private lastSeq: number | null = null;\r\n  private connectNonce: string | null = null;\r\n  private connectSent = false;\r\n  private connectTimer: number | null = null;\r\n  private backoffMs = 800;\r\n\r\n  constructor(private opts: GatewayBrowserClientOptions) {}\r\n\r\n  start() {\r\n    this.closed = false;\r\n    this.connect();\r\n  }\r\n\r\n  stop() {\r\n    this.closed = true;\r\n    this.ws?.close();\r\n    this.ws = null;\r\n    this.flushPending(new Error(\"gateway client stopped\"));\r\n  }\r\n\r\n  get connected() {\r\n    return this.ws?.readyState === WebSocket.OPEN;\r\n  }\r\n\r\n  private connect() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n    this.ws = new WebSocket(this.opts.url);\r\n    this.ws.addEventListener(\"open\", () => this.queueConnect());\r\n    this.ws.addEventListener(\"message\", (ev) => this.handleMessage(String(ev.data ?? \"\")));\r\n    this.ws.addEventListener(\"close\", (ev) => {\r\n      const reason = String(ev.reason ?? \"\");\r\n      this.ws = null;\r\n      this.flushPending(new Error(`gateway closed (${ev.code}): ${reason}`));\r\n      this.opts.onClose?.({ code: ev.code, reason });\r\n      this.scheduleReconnect();\r\n    });\r\n    this.ws.addEventListener(\"error\", () => {\r\n      // ignored; close handler will fire\r\n    });\r\n  }\r\n\r\n  private scheduleReconnect() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n    const delay = this.backoffMs;\r\n    this.backoffMs = Math.min(this.backoffMs * 1.7, 15_000);\r\n    window.setTimeout(() => this.connect(), delay);\r\n  }\r\n\r\n  private flushPending(err: Error) {\r\n    for (const [, p] of this.pending) {\r\n      p.reject(err);\r\n    }\r\n    this.pending.clear();\r\n  }\r\n\r\n  private async sendConnect() {\r\n    if (this.connectSent) {\r\n      return;\r\n    }\r\n    this.connectSent = true;\r\n    if (this.connectTimer !== null) {\r\n      window.clearTimeout(this.connectTimer);\r\n      this.connectTimer = null;\r\n    }\r\n\r\n    // crypto.subtle is only available in secure contexts (HTTPS, localhost).\r\n    // Over plain HTTP, we skip device identity and fall back to token-only auth.\r\n    // Gateways may reject this unless gateway.controlUi.allowInsecureAuth is enabled.\r\n    const isSecureContext = typeof crypto !== \"undefined\" && !!crypto.subtle;\r\n\r\n    const scopes = [\"operator.admin\", \"operator.approvals\", \"operator.pairing\"];\r\n    const role = \"operator\";\r\n    let deviceIdentity: Awaited<ReturnType<typeof loadOrCreateDeviceIdentity>> | null = null;\r\n    let canFallbackToShared = false;\r\n    let authToken = this.opts.token;\r\n\r\n    if (isSecureContext) {\r\n      deviceIdentity = await loadOrCreateDeviceIdentity();\r\n      const storedToken = loadDeviceAuthToken({\r\n        deviceId: deviceIdentity.deviceId,\r\n        role,\r\n      })?.token;\r\n      authToken = storedToken ?? this.opts.token;\r\n      canFallbackToShared = Boolean(storedToken && this.opts.token);\r\n    }\r\n    const auth =\r\n      authToken || this.opts.password\r\n        ? {\r\n            token: authToken,\r\n            password: this.opts.password,\r\n          }\r\n        : undefined;\r\n\r\n    let device:\r\n      | {\r\n          id: string;\r\n          publicKey: string;\r\n          signature: string;\r\n          signedAt: number;\r\n          nonce: string | undefined;\r\n        }\r\n      | undefined;\r\n\r\n    if (isSecureContext && deviceIdentity) {\r\n      const signedAtMs = Date.now();\r\n      const nonce = this.connectNonce ?? undefined;\r\n      const payload = buildDeviceAuthPayload({\r\n        deviceId: deviceIdentity.deviceId,\r\n        clientId: this.opts.clientName ?? GATEWAY_CLIENT_NAMES.CONTROL_UI,\r\n        clientMode: this.opts.mode ?? GATEWAY_CLIENT_MODES.WEBCHAT,\r\n        role,\r\n        scopes,\r\n        signedAtMs,\r\n        token: authToken ?? null,\r\n        nonce,\r\n      });\r\n      const signature = await signDevicePayload(deviceIdentity.privateKey, payload);\r\n      device = {\r\n        id: deviceIdentity.deviceId,\r\n        publicKey: deviceIdentity.publicKey,\r\n        signature,\r\n        signedAt: signedAtMs,\r\n        nonce,\r\n      };\r\n    }\r\n    const params = {\r\n      minProtocol: 3,\r\n      maxProtocol: 3,\r\n      client: {\r\n        id: this.opts.clientName ?? GATEWAY_CLIENT_NAMES.CONTROL_UI,\r\n        version: this.opts.clientVersion ?? \"dev\",\r\n        platform: this.opts.platform ?? navigator.platform ?? \"web\",\r\n        mode: this.opts.mode ?? GATEWAY_CLIENT_MODES.WEBCHAT,\r\n        instanceId: this.opts.instanceId,\r\n      },\r\n      role,\r\n      scopes,\r\n      device,\r\n      caps: [],\r\n      auth,\r\n      userAgent: navigator.userAgent,\r\n      locale: navigator.language,\r\n    };\r\n\r\n    void this.request<GatewayHelloOk>(\"connect\", params)\r\n      .then((hello) => {\r\n        if (hello?.auth?.deviceToken && deviceIdentity) {\r\n          storeDeviceAuthToken({\r\n            deviceId: deviceIdentity.deviceId,\r\n            role: hello.auth.role ?? role,\r\n            token: hello.auth.deviceToken,\r\n            scopes: hello.auth.scopes ?? [],\r\n          });\r\n        }\r\n        this.backoffMs = 800;\r\n        this.opts.onHello?.(hello);\r\n      })\r\n      .catch(() => {\r\n        if (canFallbackToShared && deviceIdentity) {\r\n          clearDeviceAuthToken({ deviceId: deviceIdentity.deviceId, role });\r\n        }\r\n        this.ws?.close(CONNECT_FAILED_CLOSE_CODE, \"connect failed\");\r\n      });\r\n  }\r\n\r\n  private handleMessage(raw: string) {\r\n    let parsed: unknown;\r\n    try {\r\n      parsed = JSON.parse(raw);\r\n    } catch {\r\n      return;\r\n    }\r\n\r\n    const frame = parsed as { type?: unknown };\r\n    if (frame.type === \"event\") {\r\n      const evt = parsed as GatewayEventFrame;\r\n      if (evt.event === \"connect.challenge\") {\r\n        const payload = evt.payload as { nonce?: unknown } | undefined;\r\n        const nonce = payload && typeof payload.nonce === \"string\" ? payload.nonce : null;\r\n        if (nonce) {\r\n          this.connectNonce = nonce;\r\n          void this.sendConnect();\r\n        }\r\n        return;\r\n      }\r\n      const seq = typeof evt.seq === \"number\" ? evt.seq : null;\r\n      if (seq !== null) {\r\n        if (this.lastSeq !== null && seq > this.lastSeq + 1) {\r\n          this.opts.onGap?.({ expected: this.lastSeq + 1, received: seq });\r\n        }\r\n        this.lastSeq = seq;\r\n      }\r\n      try {\r\n        this.opts.onEvent?.(evt);\r\n      } catch (err) {\r\n        console.error(\"[gateway] event handler error:\", err);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (frame.type === \"res\") {\r\n      const res = parsed as GatewayResponseFrame;\r\n      const pending = this.pending.get(res.id);\r\n      if (!pending) {\r\n        return;\r\n      }\r\n      this.pending.delete(res.id);\r\n      if (res.ok) {\r\n        pending.resolve(res.payload);\r\n      } else {\r\n        pending.reject(new Error(res.error?.message ?? \"request failed\"));\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  request<T = unknown>(method: string, params?: unknown): Promise<T> {\r\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\r\n      return Promise.reject(new Error(\"gateway not connected\"));\r\n    }\r\n    const id = generateUUID();\r\n    const frame = { type: \"req\", id, method, params };\r\n    const p = new Promise<T>((resolve, reject) => {\r\n      this.pending.set(id, { resolve: (v) => resolve(v as T), reject });\r\n    });\r\n    this.ws.send(JSON.stringify(frame));\r\n    return p;\r\n  }\r\n\r\n  private queueConnect() {\r\n    this.connectNonce = null;\r\n    this.connectSent = false;\r\n    if (this.connectTimer !== null) {\r\n      window.clearTimeout(this.connectTimer);\r\n    }\r\n    this.connectTimer = window.setTimeout(() => {\r\n      void this.sendConnect();\r\n    }, 750);\r\n  }\r\n}\r\n","import type { EventLogEntry } from \"./app-events.ts\";\r\nimport type { OpenClawApp } from \"./app.ts\";\r\nimport type { ExecApprovalRequest } from \"./controllers/exec-approval.ts\";\r\nimport type { GatewayEventFrame, GatewayHelloOk } from \"./gateway.ts\";\r\nimport type { Tab } from \"./navigation.ts\";\r\nimport type { UiSettings } from \"./storage.ts\";\r\nimport type { AgentsListResult, PresenceEntry, HealthSnapshot, StatusSummary } from \"./types.ts\";\r\nimport { CHAT_SESSIONS_ACTIVE_MINUTES, flushChatQueueForEvent } from \"./app-chat.ts\";\r\nimport {\r\n  applySettings,\r\n  loadCron,\r\n  refreshActiveTab,\r\n  setLastActiveSessionKey,\r\n} from \"./app-settings.ts\";\r\nimport { handleAgentEvent, resetToolStream, type AgentEventPayload } from \"./app-tool-stream.ts\";\r\nimport { loadAgents } from \"./controllers/agents.ts\";\r\nimport { loadAssistantIdentity } from \"./controllers/assistant-identity.ts\";\r\nimport { loadChatHistory } from \"./controllers/chat.ts\";\r\nimport { handleChatEvent, type ChatEventPayload } from \"./controllers/chat.ts\";\r\nimport { loadDevices } from \"./controllers/devices.ts\";\r\nimport {\r\n  addExecApproval,\r\n  parseExecApprovalRequested,\r\n  parseExecApprovalResolved,\r\n  removeExecApproval,\r\n} from \"./controllers/exec-approval.ts\";\r\nimport { loadNodes } from \"./controllers/nodes.ts\";\r\nimport { loadSessions } from \"./controllers/sessions.ts\";\r\nimport { GatewayBrowserClient } from \"./gateway.ts\";\r\n\r\ntype GatewayHost = {\r\n  settings: UiSettings;\r\n  password: string;\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  hello: GatewayHelloOk | null;\r\n  lastError: string | null;\r\n  onboarding?: boolean;\r\n  eventLogBuffer: EventLogEntry[];\r\n  eventLog: EventLogEntry[];\r\n  tab: Tab;\r\n  presenceEntries: PresenceEntry[];\r\n  presenceError: string | null;\r\n  presenceStatus: StatusSummary | null;\r\n  agentsLoading: boolean;\r\n  agentsList: AgentsListResult | null;\r\n  agentsError: string | null;\r\n  debugHealth: HealthSnapshot | null;\r\n  assistantName: string;\r\n  assistantAvatar: string | null;\r\n  assistantAgentId: string | null;\r\n  sessionKey: string;\r\n  chatRunId: string | null;\r\n  refreshSessionsAfterChat: Set<string>;\r\n  execApprovalQueue: ExecApprovalRequest[];\r\n  execApprovalError: string | null;\r\n};\r\n\r\ntype SessionDefaultsSnapshot = {\r\n  defaultAgentId?: string;\r\n  mainKey?: string;\r\n  mainSessionKey?: string;\r\n  scope?: string;\r\n};\r\n\r\nfunction normalizeSessionKeyForDefaults(\r\n  value: string | undefined,\r\n  defaults: SessionDefaultsSnapshot,\r\n): string {\r\n  const raw = (value ?? \"\").trim();\r\n  const mainSessionKey = defaults.mainSessionKey?.trim();\r\n  if (!mainSessionKey) {\r\n    return raw;\r\n  }\r\n  if (!raw) {\r\n    return mainSessionKey;\r\n  }\r\n  const mainKey = defaults.mainKey?.trim() || \"main\";\r\n  const defaultAgentId = defaults.defaultAgentId?.trim();\r\n  const isAlias =\r\n    raw === \"main\" ||\r\n    raw === mainKey ||\r\n    (defaultAgentId &&\r\n      (raw === `agent:${defaultAgentId}:main` || raw === `agent:${defaultAgentId}:${mainKey}`));\r\n  return isAlias ? mainSessionKey : raw;\r\n}\r\n\r\nfunction applySessionDefaults(host: GatewayHost, defaults?: SessionDefaultsSnapshot) {\r\n  if (!defaults?.mainSessionKey) {\r\n    return;\r\n  }\r\n  const resolvedSessionKey = normalizeSessionKeyForDefaults(host.sessionKey, defaults);\r\n  const resolvedSettingsSessionKey = normalizeSessionKeyForDefaults(\r\n    host.settings.sessionKey,\r\n    defaults,\r\n  );\r\n  const resolvedLastActiveSessionKey = normalizeSessionKeyForDefaults(\r\n    host.settings.lastActiveSessionKey,\r\n    defaults,\r\n  );\r\n  const nextSessionKey = resolvedSessionKey || resolvedSettingsSessionKey || host.sessionKey;\r\n  const nextSettings = {\r\n    ...host.settings,\r\n    sessionKey: resolvedSettingsSessionKey || nextSessionKey,\r\n    lastActiveSessionKey: resolvedLastActiveSessionKey || nextSessionKey,\r\n  };\r\n  const shouldUpdateSettings =\r\n    nextSettings.sessionKey !== host.settings.sessionKey ||\r\n    nextSettings.lastActiveSessionKey !== host.settings.lastActiveSessionKey;\r\n  if (nextSessionKey !== host.sessionKey) {\r\n    host.sessionKey = nextSessionKey;\r\n  }\r\n  if (shouldUpdateSettings) {\r\n    applySettings(host as unknown as Parameters<typeof applySettings>[0], nextSettings);\r\n  }\r\n}\r\n\r\nexport function connectGateway(host: GatewayHost) {\r\n  host.lastError = null;\r\n  host.hello = null;\r\n  host.connected = false;\r\n  host.execApprovalQueue = [];\r\n  host.execApprovalError = null;\r\n\r\n  host.client?.stop();\r\n  host.client = new GatewayBrowserClient({\r\n    url: host.settings.gatewayUrl,\r\n    token: host.settings.token.trim() ? host.settings.token : undefined,\r\n    password: host.password.trim() ? host.password : undefined,\r\n    clientName: \"openclaw-control-ui\",\r\n    mode: \"webchat\",\r\n    onHello: (hello) => {\r\n      host.connected = true;\r\n      host.lastError = null;\r\n      host.hello = hello;\r\n      applySnapshot(host, hello);\r\n      // Reset orphaned chat run state from before disconnect.\r\n      // Any in-flight run's final event was lost during the disconnect window.\r\n      host.chatRunId = null;\r\n      (host as unknown as { chatStream: string | null }).chatStream = null;\r\n      (host as unknown as { chatStreamStartedAt: number | null }).chatStreamStartedAt = null;\r\n      resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\r\n      void loadAssistantIdentity(host as unknown as OpenClawApp);\r\n      void loadAgents(host as unknown as OpenClawApp);\r\n      void loadNodes(host as unknown as OpenClawApp, { quiet: true });\r\n      void loadDevices(host as unknown as OpenClawApp, { quiet: true });\r\n      void refreshActiveTab(host as unknown as Parameters<typeof refreshActiveTab>[0]);\r\n    },\r\n    onClose: ({ code, reason }) => {\r\n      host.connected = false;\r\n      // Code 1012 = Service Restart (expected during config saves, don't show as error)\r\n      if (code !== 1012) {\r\n        host.lastError = `disconnected (${code}): ${reason || \"no reason\"}`;\r\n      }\r\n    },\r\n    onEvent: (evt) => handleGatewayEvent(host, evt),\r\n    onGap: ({ expected, received }) => {\r\n      host.lastError = `event gap detected (expected seq ${expected}, got ${received}); refresh recommended`;\r\n    },\r\n  });\r\n  host.client.start();\r\n}\r\n\r\nexport function handleGatewayEvent(host: GatewayHost, evt: GatewayEventFrame) {\r\n  try {\r\n    handleGatewayEventUnsafe(host, evt);\r\n  } catch (err) {\r\n    console.error(\"[gateway] handleGatewayEvent error:\", evt.event, err);\r\n  }\r\n}\r\n\r\nfunction handleGatewayEventUnsafe(host: GatewayHost, evt: GatewayEventFrame) {\r\n  host.eventLogBuffer = [\r\n    { ts: Date.now(), event: evt.event, payload: evt.payload },\r\n    ...host.eventLogBuffer,\r\n  ].slice(0, 250);\r\n  if (host.tab === \"debug\") {\r\n    host.eventLog = host.eventLogBuffer;\r\n  }\r\n\r\n  if (evt.event === \"agent\") {\r\n    if (host.onboarding) {\r\n      return;\r\n    }\r\n    handleAgentEvent(\r\n      host as unknown as Parameters<typeof handleAgentEvent>[0],\r\n      evt.payload as AgentEventPayload | undefined,\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (evt.event === \"chat\") {\r\n    const payload = evt.payload as ChatEventPayload | undefined;\r\n    if (payload?.sessionKey) {\r\n      setLastActiveSessionKey(\r\n        host as unknown as Parameters<typeof setLastActiveSessionKey>[0],\r\n        payload.sessionKey,\r\n      );\r\n    }\r\n    const state = handleChatEvent(host as unknown as OpenClawApp, payload);\r\n    if (state === \"final\" || state === \"error\" || state === \"aborted\") {\r\n      resetToolStream(host as unknown as Parameters<typeof resetToolStream>[0]);\r\n      void flushChatQueueForEvent(host as unknown as Parameters<typeof flushChatQueueForEvent>[0]);\r\n      const runId = payload?.runId;\r\n      if (runId && host.refreshSessionsAfterChat.has(runId)) {\r\n        host.refreshSessionsAfterChat.delete(runId);\r\n        if (state === \"final\") {\r\n          void loadSessions(host as unknown as OpenClawApp, {\r\n            activeMinutes: CHAT_SESSIONS_ACTIVE_MINUTES,\r\n          });\r\n        }\r\n      }\r\n    }\r\n    if (state === \"final\") {\r\n      void loadChatHistory(host as unknown as OpenClawApp);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (evt.event === \"presence\") {\r\n    const payload = evt.payload as { presence?: PresenceEntry[] } | undefined;\r\n    if (payload?.presence && Array.isArray(payload.presence)) {\r\n      host.presenceEntries = payload.presence;\r\n      host.presenceError = null;\r\n      host.presenceStatus = null;\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (evt.event === \"cron\" && host.tab === \"cron\") {\r\n    void loadCron(host as unknown as Parameters<typeof loadCron>[0]);\r\n  }\r\n\r\n  if (evt.event === \"device.pair.requested\" || evt.event === \"device.pair.resolved\") {\r\n    void loadDevices(host as unknown as OpenClawApp, { quiet: true });\r\n  }\r\n\r\n  if (evt.event === \"exec.approval.requested\") {\r\n    const entry = parseExecApprovalRequested(evt.payload);\r\n    if (entry) {\r\n      host.execApprovalQueue = addExecApproval(host.execApprovalQueue, entry);\r\n      host.execApprovalError = null;\r\n      const delay = Math.max(0, entry.expiresAtMs - Date.now() + 500);\r\n      window.setTimeout(() => {\r\n        host.execApprovalQueue = removeExecApproval(host.execApprovalQueue, entry.id);\r\n      }, delay);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (evt.event === \"exec.approval.resolved\") {\r\n    const resolved = parseExecApprovalResolved(evt.payload);\r\n    if (resolved) {\r\n      host.execApprovalQueue = removeExecApproval(host.execApprovalQueue, resolved.id);\r\n    }\r\n  }\r\n}\r\n\r\nexport function applySnapshot(host: GatewayHost, hello: GatewayHelloOk) {\r\n  const snapshot = hello.snapshot as\r\n    | {\r\n        presence?: PresenceEntry[];\r\n        health?: HealthSnapshot;\r\n        sessionDefaults?: SessionDefaultsSnapshot;\r\n      }\r\n    | undefined;\r\n  if (snapshot?.presence && Array.isArray(snapshot.presence)) {\r\n    host.presenceEntries = snapshot.presence;\r\n  }\r\n  if (snapshot?.health) {\r\n    host.debugHealth = snapshot.health;\r\n  }\r\n  if (snapshot?.sessionDefaults) {\r\n    applySessionDefaults(host, snapshot.sessionDefaults);\r\n  }\r\n}\r\n","import type { Tab } from \"./navigation.ts\";\r\nimport { connectGateway } from \"./app-gateway.ts\";\r\nimport {\r\n  startLogsPolling,\r\n  startNodesPolling,\r\n  stopLogsPolling,\r\n  stopNodesPolling,\r\n  startDebugPolling,\r\n  stopDebugPolling,\r\n} from \"./app-polling.ts\";\r\nimport { observeTopbar, scheduleChatScroll, scheduleLogsScroll } from \"./app-scroll.ts\";\r\nimport {\r\n  applySettingsFromUrl,\r\n  attachThemeListener,\r\n  detachThemeListener,\r\n  inferBasePath,\r\n  syncTabWithLocation,\r\n  syncThemeWithSettings,\r\n} from \"./app-settings.ts\";\r\n\r\ntype LifecycleHost = {\r\n  basePath: string;\r\n  tab: Tab;\r\n  chatHasAutoScrolled: boolean;\r\n  chatManualRefreshInFlight: boolean;\r\n  chatLoading: boolean;\r\n  chatMessages: unknown[];\r\n  chatToolMessages: unknown[];\r\n  chatStream: string;\r\n  logsAutoFollow: boolean;\r\n  logsAtBottom: boolean;\r\n  logsEntries: unknown[];\r\n  popStateHandler: () => void;\r\n  topbarObserver: ResizeObserver | null;\r\n};\r\n\r\nexport function handleConnected(host: LifecycleHost) {\r\n  host.basePath = inferBasePath();\r\n  applySettingsFromUrl(host as unknown as Parameters<typeof applySettingsFromUrl>[0]);\r\n  syncTabWithLocation(host as unknown as Parameters<typeof syncTabWithLocation>[0], true);\r\n  syncThemeWithSettings(host as unknown as Parameters<typeof syncThemeWithSettings>[0]);\r\n  attachThemeListener(host as unknown as Parameters<typeof attachThemeListener>[0]);\r\n  window.addEventListener(\"popstate\", host.popStateHandler);\r\n  connectGateway(host as unknown as Parameters<typeof connectGateway>[0]);\r\n  startNodesPolling(host as unknown as Parameters<typeof startNodesPolling>[0]);\r\n  if (host.tab === \"logs\") {\r\n    startLogsPolling(host as unknown as Parameters<typeof startLogsPolling>[0]);\r\n  }\r\n  if (host.tab === \"debug\") {\r\n    startDebugPolling(host as unknown as Parameters<typeof startDebugPolling>[0]);\r\n  }\r\n}\r\n\r\nexport function handleFirstUpdated(host: LifecycleHost) {\r\n  observeTopbar(host as unknown as Parameters<typeof observeTopbar>[0]);\r\n}\r\n\r\nexport function handleDisconnected(host: LifecycleHost) {\r\n  window.removeEventListener(\"popstate\", host.popStateHandler);\r\n  stopNodesPolling(host as unknown as Parameters<typeof stopNodesPolling>[0]);\r\n  stopLogsPolling(host as unknown as Parameters<typeof stopLogsPolling>[0]);\r\n  stopDebugPolling(host as unknown as Parameters<typeof stopDebugPolling>[0]);\r\n  detachThemeListener(host as unknown as Parameters<typeof detachThemeListener>[0]);\r\n  host.topbarObserver?.disconnect();\r\n  host.topbarObserver = null;\r\n}\r\n\r\nexport function handleUpdated(host: LifecycleHost, changed: Map<PropertyKey, unknown>) {\r\n  if (host.tab === \"chat\" && host.chatManualRefreshInFlight) {\r\n    return;\r\n  }\r\n  if (\r\n    host.tab === \"chat\" &&\r\n    (changed.has(\"chatMessages\") ||\r\n      changed.has(\"chatToolMessages\") ||\r\n      changed.has(\"chatStream\") ||\r\n      changed.has(\"chatLoading\") ||\r\n      changed.has(\"tab\"))\r\n  ) {\r\n    const forcedByTab = changed.has(\"tab\");\r\n    const forcedByLoad =\r\n      changed.has(\"chatLoading\") && changed.get(\"chatLoading\") === true && !host.chatLoading;\r\n    scheduleChatScroll(\r\n      host as unknown as Parameters<typeof scheduleChatScroll>[0],\r\n      forcedByTab || forcedByLoad || !host.chatHasAutoScrolled,\r\n    );\r\n  }\r\n  if (\r\n    host.tab === \"logs\" &&\r\n    (changed.has(\"logsEntries\") || changed.has(\"logsAutoFollow\") || changed.has(\"tab\"))\r\n  ) {\r\n    if (host.logsAutoFollow && host.logsAtBottom) {\r\n      scheduleLogsScroll(\r\n        host as unknown as Parameters<typeof scheduleLogsScroll>[0],\r\n        changed.has(\"tab\") || changed.has(\"logsAutoFollow\"),\r\n      );\r\n    }\r\n  }\r\n}\r\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},e=t=>(...e)=>({_$litDirective$:t,values:e});class i{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}export{i as Directive,t as PartType,e as directive};\n//# sourceMappingURL=directive.js.map\n","import{_$LH as o}from\"./lit-html.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{I:t}=o,i=o=>o,n=o=>null===o||\"object\"!=typeof o&&\"function\"!=typeof o,e={HTML:1,SVG:2,MATHML:3},l=(o,t)=>void 0===t?void 0!==o?._$litType$:o?._$litType$===t,d=o=>null!=o?._$litType$?.h,c=o=>void 0!==o?._$litDirective$,f=o=>o?._$litDirective$,r=o=>void 0===o.strings,s=()=>document.createComment(\"\"),v=(o,n,e)=>{const l=o._$AA.parentNode,d=void 0===n?o._$AB:n._$AA;if(void 0===e){const i=l.insertBefore(s(),d),n=l.insertBefore(s(),d);e=new t(i,n,o,o.options)}else{const t=e._$AB.nextSibling,n=e._$AM,c=n!==o;if(c){let t;e._$AQ?.(o),e._$AM=o,void 0!==e._$AP&&(t=o._$AU)!==n._$AU&&e._$AP(t)}if(t!==d||c){let o=e._$AA;for(;o!==t;){const t=i(o).nextSibling;i(l).insertBefore(o,d),o=t}}}return e},u=(o,t,i=o)=>(o._$AI(t,i),o),m={},p=(o,t=m)=>o._$AH=t,M=o=>o._$AH,h=o=>{o._$AR(),o._$AA.remove()},j=o=>{o._$AR()};export{e as TemplateResultType,j as clearPart,M as getCommittedValue,f as getDirectiveClass,v as insertPart,d as isCompiledTemplateResult,c as isDirectiveResult,n as isPrimitive,r as isSingleExpression,l as isTemplateResult,h as removePart,u as setChildPartValue,p as setCommittedValue};\n//# sourceMappingURL=directive-helpers.js.map\n","import{noChange as e}from\"../lit-html.js\";import{directive as s,Directive as t,PartType as r}from\"../directive.js\";import{getCommittedValue as l,setChildPartValue as o,insertPart as i,removePart as n,setCommittedValue as f}from\"../directive-helpers.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst u=(e,s,t)=>{const r=new Map;for(let l=s;l<=t;l++)r.set(e[l],l);return r},c=s(class extends t{constructor(e){if(super(e),e.type!==r.CHILD)throw Error(\"repeat() can only be used in text expressions\")}dt(e,s,t){let r;void 0===t?t=s:void 0!==s&&(r=s);const l=[],o=[];let i=0;for(const s of e)l[i]=r?r(s,i):i,o[i]=t(s,i),i++;return{values:o,keys:l}}render(e,s,t){return this.dt(e,s,t).values}update(s,[t,r,c]){const d=l(s),{values:p,keys:a}=this.dt(t,r,c);if(!Array.isArray(d))return this.ut=a,p;const h=this.ut??=[],v=[];let m,y,x=0,j=d.length-1,k=0,w=p.length-1;for(;x<=j&&k<=w;)if(null===d[x])x++;else if(null===d[j])j--;else if(h[x]===a[k])v[k]=o(d[x],p[k]),x++,k++;else if(h[j]===a[w])v[w]=o(d[j],p[w]),j--,w--;else if(h[x]===a[w])v[w]=o(d[x],p[w]),i(s,v[w+1],d[x]),x++,w--;else if(h[j]===a[k])v[k]=o(d[j],p[k]),i(s,d[x],d[j]),j--,k++;else if(void 0===m&&(m=u(a,k,w),y=u(h,x,j)),m.has(h[x]))if(m.has(h[j])){const e=y.get(a[k]),t=void 0!==e?d[e]:null;if(null===t){const e=i(s,d[x]);o(e,p[k]),v[k]=e}else v[k]=o(t,p[k]),i(s,d[x],t),d[e]=null;k++}else n(d[j]),j--;else n(d[x]),x++;for(;k<=w;){const e=i(s,v[w+1]);o(e,p[k]),v[k++]=e}for(;x<=j;){const e=d[x++];null!==e&&n(e)}return this.ut=a,f(s,v),e}});export{c as repeat};\n//# sourceMappingURL=repeat.js.map\n","import { html, type TemplateResult } from \"lit\";\r\n\r\n// Lucide-style SVG icons\r\n// All icons use currentColor for stroke\r\n\r\nexport const icons = {\r\n  // Navigation icons\r\n  messageSquare: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\r\n    </svg>\r\n  `,\r\n  barChart: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <line x1=\"12\" x2=\"12\" y1=\"20\" y2=\"10\" />\r\n      <line x1=\"18\" x2=\"18\" y1=\"20\" y2=\"4\" />\r\n      <line x1=\"6\" x2=\"6\" y1=\"20\" y2=\"16\" />\r\n    </svg>\r\n  `,\r\n  link: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\" />\r\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\" />\r\n    </svg>\r\n  `,\r\n  radio: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"2\" />\r\n      <path\r\n        d=\"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14\"\r\n      />\r\n    </svg>\r\n  `,\r\n  fileText: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\r\n      <polyline points=\"14 2 14 8 20 8\" />\r\n      <line x1=\"16\" x2=\"8\" y1=\"13\" y2=\"13\" />\r\n      <line x1=\"16\" x2=\"8\" y1=\"17\" y2=\"17\" />\r\n      <line x1=\"10\" x2=\"8\" y1=\"9\" y2=\"9\" />\r\n    </svg>\r\n  `,\r\n  zap: html`\r\n    <svg viewBox=\"0 0 24 24\"><polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\" /></svg>\r\n  `,\r\n  monitor: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <rect width=\"20\" height=\"14\" x=\"2\" y=\"3\" rx=\"2\" />\r\n      <line x1=\"8\" x2=\"16\" y1=\"21\" y2=\"21\" />\r\n      <line x1=\"12\" x2=\"12\" y1=\"17\" y2=\"21\" />\r\n    </svg>\r\n  `,\r\n  settings: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path\r\n        d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"\r\n      />\r\n      <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n    </svg>\r\n  `,\r\n  bug: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"m8 2 1.88 1.88\" />\r\n      <path d=\"M14.12 3.88 16 2\" />\r\n      <path d=\"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1\" />\r\n      <path d=\"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6\" />\r\n      <path d=\"M12 20v-9\" />\r\n      <path d=\"M6.53 9C4.6 8.8 3 7.1 3 5\" />\r\n      <path d=\"M6 13H2\" />\r\n      <path d=\"M3 21c0-2.1 1.7-3.9 3.8-4\" />\r\n      <path d=\"M20.97 5c0 2.1-1.6 3.8-3.5 4\" />\r\n      <path d=\"M22 13h-4\" />\r\n      <path d=\"M17.2 17c2.1.1 3.8 1.9 3.8 4\" />\r\n    </svg>\r\n  `,\r\n  scrollText: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4\" />\r\n      <path d=\"M19 17V5a2 2 0 0 0-2-2H4\" />\r\n      <path d=\"M15 8h-5\" />\r\n      <path d=\"M15 12h-5\" />\r\n    </svg>\r\n  `,\r\n  folder: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path\r\n        d=\"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z\"\r\n      />\r\n    </svg>\r\n  `,\r\n\r\n  // UI icons\r\n  menu: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <line x1=\"4\" x2=\"20\" y1=\"12\" y2=\"12\" />\r\n      <line x1=\"4\" x2=\"20\" y1=\"6\" y2=\"6\" />\r\n      <line x1=\"4\" x2=\"20\" y1=\"18\" y2=\"18\" />\r\n    </svg>\r\n  `,\r\n  x: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M18 6 6 18\" />\r\n      <path d=\"m6 6 12 12\" />\r\n    </svg>\r\n  `,\r\n  check: html`\r\n    <svg viewBox=\"0 0 24 24\"><path d=\"M20 6 9 17l-5-5\" /></svg>\r\n  `,\r\n  arrowDown: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M12 5v14\" />\r\n      <path d=\"m19 12-7 7-7-7\" />\r\n    </svg>\r\n  `,\r\n  copy: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\" />\r\n      <path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\" />\r\n    </svg>\r\n  `,\r\n  search: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n      <path d=\"m21 21-4.3-4.3\" />\r\n    </svg>\r\n  `,\r\n  brain: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z\" />\r\n      <path d=\"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z\" />\r\n      <path d=\"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4\" />\r\n      <path d=\"M17.599 6.5a3 3 0 0 0 .399-1.375\" />\r\n      <path d=\"M6.003 5.125A3 3 0 0 0 6.401 6.5\" />\r\n      <path d=\"M3.477 10.896a4 4 0 0 1 .585-.396\" />\r\n      <path d=\"M19.938 10.5a4 4 0 0 1 .585.396\" />\r\n      <path d=\"M6 18a4 4 0 0 1-1.967-.516\" />\r\n      <path d=\"M19.967 17.484A4 4 0 0 1 18 18\" />\r\n    </svg>\r\n  `,\r\n  book: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\" />\r\n    </svg>\r\n  `,\r\n  loader: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M12 2v4\" />\r\n      <path d=\"m16.2 7.8 2.9-2.9\" />\r\n      <path d=\"M18 12h4\" />\r\n      <path d=\"m16.2 16.2 2.9 2.9\" />\r\n      <path d=\"M12 18v4\" />\r\n      <path d=\"m4.9 19.1 2.9-2.9\" />\r\n      <path d=\"M2 12h4\" />\r\n      <path d=\"m4.9 4.9 2.9 2.9\" />\r\n    </svg>\r\n  `,\r\n\r\n  // Tool icons\r\n  wrench: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path\r\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\r\n      />\r\n    </svg>\r\n  `,\r\n  fileCode: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\r\n      <polyline points=\"14 2 14 8 20 8\" />\r\n      <path d=\"m10 13-2 2 2 2\" />\r\n      <path d=\"m14 17 2-2-2-2\" />\r\n    </svg>\r\n  `,\r\n  edit: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\r\n      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\" />\r\n    </svg>\r\n  `,\r\n  penLine: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M12 20h9\" />\r\n      <path d=\"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z\" />\r\n    </svg>\r\n  `,\r\n  paperclip: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path\r\n        d=\"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48\"\r\n      />\r\n    </svg>\r\n  `,\r\n  globe: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n      <path d=\"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20\" />\r\n      <path d=\"M2 12h20\" />\r\n    </svg>\r\n  `,\r\n  image: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <rect width=\"18\" height=\"18\" x=\"3\" y=\"3\" rx=\"2\" ry=\"2\" />\r\n      <circle cx=\"9\" cy=\"9\" r=\"2\" />\r\n      <path d=\"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\" />\r\n    </svg>\r\n  `,\r\n  smartphone: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <rect width=\"14\" height=\"20\" x=\"5\" y=\"2\" rx=\"2\" ry=\"2\" />\r\n      <path d=\"M12 18h.01\" />\r\n    </svg>\r\n  `,\r\n  plug: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path d=\"M12 22v-5\" />\r\n      <path d=\"M9 8V2\" />\r\n      <path d=\"M15 8V2\" />\r\n      <path d=\"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z\" />\r\n    </svg>\r\n  `,\r\n  circle: html`\r\n    <svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\" /></svg>\r\n  `,\r\n  puzzle: html`\r\n    <svg viewBox=\"0 0 24 24\">\r\n      <path\r\n        d=\"M19.439 7.85c-.049.322.059.648.289.878l1.568 1.568c.47.47.706 1.087.706 1.704s-.235 1.233-.706 1.704l-1.611 1.611a.98.98 0 0 1-.837.276c-.47-.07-.802-.48-.968-.925a2.501 2.501 0 1 0-3.214 3.214c.446.166.855.497.925.968a.979.979 0 0 1-.276.837l-1.61 1.61a2.404 2.404 0 0 1-1.705.707 2.402 2.402 0 0 1-1.704-.706l-1.568-1.568a1.026 1.026 0 0 0-.877-.29c-.493.074-.84.504-1.02.968a2.5 2.5 0 1 1-3.237-3.237c.464-.18.894-.527.967-1.02a1.026 1.026 0 0 0-.289-.877l-1.568-1.568A2.402 2.402 0 0 1 1.998 12c0-.617.236-1.234.706-1.704L4.23 8.77c.24-.24.581-.353.917-.303.515.076.874.54 1.02 1.02a2.5 2.5 0 1 0 3.237-3.237c-.48-.146-.944-.505-1.02-1.02a.98.98 0 0 1 .303-.917l1.526-1.526A2.402 2.402 0 0 1 11.998 2c.617 0 1.234.236 1.704.706l1.568 1.568c.23.23.556.338.877.29.493-.074.84-.504 1.02-.968a2.5 2.5 0 1 1 3.236 3.236c-.464.18-.894.527-.967 1.02Z\"\r\n      />\r\n    </svg>\r\n  `,\r\n} as const;\r\n\r\nexport type IconName = keyof typeof icons;\r\n\r\nexport function icon(name: IconName): TemplateResult {\r\n  return icons[name];\r\n}\r\n\r\nexport function renderIcon(name: IconName, className = \"nav-item__icon\"): TemplateResult {\r\n  return html`<span class=${className} aria-hidden=\"true\">${icons[name]}</span>`;\r\n}\r\n\r\n// Legacy function for compatibility\r\nexport function renderEmojiIcon(\r\n  iconContent: string | TemplateResult,\r\n  className: string,\r\n): TemplateResult {\r\n  return html`<span class=${className} aria-hidden=\"true\">${iconContent}</span>`;\r\n}\r\n\r\nexport function setEmojiIcon(target: HTMLElement | null, icon: string): void {\r\n  if (!target) {\r\n    return;\r\n  }\r\n  target.textContent = icon;\r\n}\r\n","import { html } from \"lit\";\r\nimport { repeat } from \"lit/directives/repeat.js\";\r\nimport type { AppViewState } from \"./app-view-state.ts\";\r\nimport type { ThemeTransitionContext } from \"./theme-transition.ts\";\r\nimport type { ThemeMode } from \"./theme.ts\";\r\nimport type { SessionsListResult } from \"./types.ts\";\r\nimport { refreshChat } from \"./app-chat.ts\";\r\nimport { syncUrlWithSessionKey } from \"./app-settings.ts\";\r\nimport { OpenClawApp } from \"./app.ts\";\r\nimport { ChatState, loadChatHistory } from \"./controllers/chat.ts\";\r\nimport { icons } from \"./icons.ts\";\r\nimport { iconForTab, pathForTab, titleForTab, type Tab } from \"./navigation.ts\";\r\nimport { T, getLanguage, toggleLanguage } from \"../i18n.ts\";\r\n\r\nexport function renderTab(state: AppViewState, tab: Tab) {\r\n  const href = pathForTab(tab, state.basePath);\r\n  return html`\r\n    <a\r\n      href=${href}\r\n      class=\"nav-item ${state.tab === tab ? \"active\" : \"\"}\"\r\n      @click=${(event: MouseEvent) => {\r\n        if (\r\n          event.defaultPrevented ||\r\n          event.button !== 0 ||\r\n          event.metaKey ||\r\n          event.ctrlKey ||\r\n          event.shiftKey ||\r\n          event.altKey\r\n        ) {\r\n          return;\r\n        }\r\n        event.preventDefault();\r\n        state.setTab(tab);\r\n      }}\r\n      title=${titleForTab(tab)}\r\n    >\r\n      <span class=\"nav-item__icon\" aria-hidden=\"true\">${icons[iconForTab(tab)]}</span>\r\n      <span class=\"nav-item__text\">${titleForTab(tab)}</span>\r\n    </a>\r\n  `;\r\n}\r\n\r\nexport function renderChatControls(state: AppViewState) {\r\n  const mainSessionKey = resolveMainSessionKey(state.hello, state.sessionsResult);\r\n  const sessionOptions = resolveSessionOptions(\r\n    state.sessionKey,\r\n    state.sessionsResult,\r\n    mainSessionKey,\r\n  );\r\n  const disableThinkingToggle = state.onboarding;\r\n  const disableFocusToggle = state.onboarding;\r\n  const showThinking = state.onboarding ? false : state.settings.chatShowThinking;\r\n  const focusActive = state.onboarding ? true : state.settings.chatFocusMode;\r\n  // Refresh icon\r\n  const refreshIcon = html`\r\n    <svg\r\n      width=\"18\"\r\n      height=\"18\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <path d=\"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8\"></path>\r\n      <path d=\"M21 3v5h-5\"></path>\r\n    </svg>\r\n  `;\r\n  const focusIcon = html`\r\n    <svg\r\n      width=\"18\"\r\n      height=\"18\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <path d=\"M4 7V4h3\"></path>\r\n      <path d=\"M20 7V4h-3\"></path>\r\n      <path d=\"M4 17v3h3\"></path>\r\n      <path d=\"M20 17v3h-3\"></path>\r\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n    </svg>\r\n  `;\r\n  return html`\r\n    <div class=\"chat-controls\">\r\n      <label class=\"field chat-controls__session\">\r\n        <select\r\n          .value=${state.sessionKey}\r\n          ?disabled=${!state.connected}\r\n          @change=${(e: Event) => {\r\n            const next = (e.target as HTMLSelectElement).value;\r\n            state.sessionKey = next;\r\n            state.chatMessage = \"\";\r\n            state.chatStream = null;\r\n            (state as unknown as OpenClawApp).chatStreamStartedAt = null;\r\n            state.chatRunId = null;\r\n            (state as unknown as OpenClawApp).resetToolStream();\r\n            (state as unknown as OpenClawApp).resetChatScroll();\r\n            state.applySettings({\r\n              ...state.settings,\r\n              sessionKey: next,\r\n              lastActiveSessionKey: next,\r\n            });\r\n            void state.loadAssistantIdentity();\r\n            syncUrlWithSessionKey(\r\n              state as unknown as Parameters<typeof syncUrlWithSessionKey>[0],\r\n              next,\r\n              true,\r\n            );\r\n            void loadChatHistory(state as unknown as ChatState);\r\n          }}\r\n        >\r\n          ${repeat(\r\n            sessionOptions,\r\n            (entry) => entry.key,\r\n            (entry) =>\r\n              html`<option value=${entry.key}>\r\n                ${entry.displayName ?? entry.key}\r\n              </option>`,\r\n          )}\r\n        </select>\r\n      </label>\r\n      <button\r\n        class=\"btn btn--sm btn--icon\"\r\n        ?disabled=${state.chatLoading || !state.connected}\r\n        @click=${async () => {\r\n          const app = state as unknown as OpenClawApp;\r\n          app.chatManualRefreshInFlight = true;\r\n          app.chatNewMessagesBelow = false;\r\n          await app.updateComplete;\r\n          app.resetToolStream();\r\n          try {\r\n            await refreshChat(state as unknown as Parameters<typeof refreshChat>[0], {\r\n              scheduleScroll: false,\r\n            });\r\n            app.scrollToBottom({ smooth: true });\r\n          } finally {\r\n            requestAnimationFrame(() => {\r\n              app.chatManualRefreshInFlight = false;\r\n              app.chatNewMessagesBelow = false;\r\n            });\r\n          }\r\n        }}\r\n        title=\"Refresh chat data\"\r\n      >\r\n        ${refreshIcon}\r\n      </button>\r\n      <span class=\"chat-controls__separator\">|</span>\r\n      <button\r\n        class=\"btn btn--sm btn--icon ${showThinking ? \"active\" : \"\"}\"\r\n        ?disabled=${disableThinkingToggle}\r\n        @click=${() => {\r\n          if (disableThinkingToggle) {\r\n            return;\r\n          }\r\n          state.applySettings({\r\n            ...state.settings,\r\n            chatShowThinking: !state.settings.chatShowThinking,\r\n          });\r\n        }}\r\n        aria-pressed=${showThinking}\r\n        title=${\r\n          disableThinkingToggle\r\n            ? \"Disabled during onboarding\"\r\n            : \"Toggle assistant thinking/working output\"\r\n        }\r\n      >\r\n        ${icons.brain}\r\n      </button>\r\n      <button\r\n        class=\"btn btn--sm btn--icon ${focusActive ? \"active\" : \"\"}\"\r\n        ?disabled=${disableFocusToggle}\r\n        @click=${() => {\r\n          if (disableFocusToggle) {\r\n            return;\r\n          }\r\n          state.applySettings({\r\n            ...state.settings,\r\n            chatFocusMode: !state.settings.chatFocusMode,\r\n          });\r\n        }}\r\n        aria-pressed=${focusActive}\r\n        title=${\r\n          disableFocusToggle\r\n            ? \"Disabled during onboarding\"\r\n            : \"Toggle focus mode (hide sidebar + page header)\"\r\n        }\r\n      >\r\n        ${focusIcon}\r\n      </button>\r\n    </div>\r\n  `;\r\n}\r\n\r\ntype SessionDefaultsSnapshot = {\r\n  mainSessionKey?: string;\r\n  mainKey?: string;\r\n};\r\n\r\nfunction resolveMainSessionKey(\r\n  hello: AppViewState[\"hello\"],\r\n  sessions: SessionsListResult | null,\r\n): string | null {\r\n  const snapshot = hello?.snapshot as { sessionDefaults?: SessionDefaultsSnapshot } | undefined;\r\n  const mainSessionKey = snapshot?.sessionDefaults?.mainSessionKey?.trim();\r\n  if (mainSessionKey) {\r\n    return mainSessionKey;\r\n  }\r\n  const mainKey = snapshot?.sessionDefaults?.mainKey?.trim();\r\n  if (mainKey) {\r\n    return mainKey;\r\n  }\r\n  if (sessions?.sessions?.some((row) => row.key === \"main\")) {\r\n    return \"main\";\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function resolveSessionDisplayName(\r\n  key: string,\r\n  row?: SessionsListResult[\"sessions\"][number],\r\n) {\r\n  const displayName = row?.displayName?.trim() || \"\";\r\n  const label = row?.label?.trim() || \"\";\r\n  if (displayName && displayName !== key) {\r\n    return `${displayName} (${key})`;\r\n  }\r\n  if (label && label !== key) {\r\n    return `${label} (${key})`;\r\n  }\r\n  return key;\r\n}\r\n\r\nfunction resolveSessionOptions(\r\n  sessionKey: string,\r\n  sessions: SessionsListResult | null,\r\n  mainSessionKey?: string | null,\r\n) {\r\n  const seen = new Set<string>();\r\n  const options: Array<{ key: string; displayName?: string }> = [];\r\n\r\n  const resolvedMain = mainSessionKey && sessions?.sessions?.find((s) => s.key === mainSessionKey);\r\n  const resolvedCurrent = sessions?.sessions?.find((s) => s.key === sessionKey);\r\n\r\n  // Add main session key first\r\n  if (mainSessionKey) {\r\n    seen.add(mainSessionKey);\r\n    options.push({\r\n      key: mainSessionKey,\r\n      displayName: resolveSessionDisplayName(mainSessionKey, resolvedMain || undefined),\r\n    });\r\n  }\r\n\r\n  // Add current session key next\r\n  if (!seen.has(sessionKey)) {\r\n    seen.add(sessionKey);\r\n    options.push({\r\n      key: sessionKey,\r\n      displayName: resolveSessionDisplayName(sessionKey, resolvedCurrent),\r\n    });\r\n  }\r\n\r\n  // Add sessions from the result\r\n  if (sessions?.sessions) {\r\n    for (const s of sessions.sessions) {\r\n      if (!seen.has(s.key)) {\r\n        seen.add(s.key);\r\n        options.push({\r\n          key: s.key,\r\n          displayName: resolveSessionDisplayName(s.key, s),\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return options;\r\n}\r\n\r\nconst THEME_ORDER: ThemeMode[] = [\"system\", \"light\", \"dark\"];\r\n\r\nexport function renderThemeToggle(state: AppViewState) {\r\n  const index = Math.max(0, THEME_ORDER.indexOf(state.theme));\r\n  const applyTheme = (next: ThemeMode) => (event: MouseEvent) => {\r\n    const element = event.currentTarget as HTMLElement;\r\n    const context: ThemeTransitionContext = { element };\r\n    if (event.clientX || event.clientY) {\r\n      context.pointerClientX = event.clientX;\r\n      context.pointerClientY = event.clientY;\r\n    }\r\n    state.setTheme(next, context);\r\n  };\r\n\r\n  return html`\r\n    <div class=\"theme-toggle\" style=\"--theme-index: ${index};\">\r\n      <div class=\"theme-toggle__track\" role=\"group\" aria-label=\"Theme\">\r\n        <span class=\"theme-toggle__indicator\"></span>\r\n        <button\r\n          class=\"theme-toggle__button ${state.theme === \"system\" ? \"active\" : \"\"}\"\r\n          @click=${applyTheme(\"system\")}\r\n          aria-pressed=${state.theme === \"system\"}\r\n          aria-label=\"System theme\"\r\n          title=\"System\"\r\n        >\r\n          ${renderMonitorIcon()}\r\n        </button>\r\n        <button\r\n          class=\"theme-toggle__button ${state.theme === \"light\" ? \"active\" : \"\"}\"\r\n          @click=${applyTheme(\"light\")}\r\n          aria-pressed=${state.theme === \"light\"}\r\n          aria-label=\"Light theme\"\r\n          title=\"Light\"\r\n        >\r\n          ${renderSunIcon()}\r\n        </button>\r\n        <button\r\n          class=\"theme-toggle__button ${state.theme === \"dark\" ? \"active\" : \"\"}\"\r\n          @click=${applyTheme(\"dark\")}\r\n          aria-pressed=${state.theme === \"dark\"}\r\n          aria-label=\"Dark theme\"\r\n          title=\"Dark\"\r\n        >\r\n          ${renderMoonIcon()}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSunIcon() {\r\n  return html`\r\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\r\n      <path d=\"M12 2v2\"></path>\r\n      <path d=\"M12 20v2\"></path>\r\n      <path d=\"m4.93 4.93 1.41 1.41\"></path>\r\n      <path d=\"m17.66 17.66 1.41 1.41\"></path>\r\n      <path d=\"M2 12h2\"></path>\r\n      <path d=\"M20 12h2\"></path>\r\n      <path d=\"m6.34 17.66-1.41 1.41\"></path>\r\n      <path d=\"m19.07 4.93-1.41 1.41\"></path>\r\n    </svg>\r\n  `;\r\n}\r\n\r\nfunction renderMoonIcon() {\r\n  return html`\r\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n      <path\r\n        d=\"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401\"\r\n      ></path>\r\n    </svg>\r\n  `;\r\n}\r\n\r\nfunction renderMonitorIcon() {\r\n  return html`\r\n    <svg class=\"theme-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n      <rect width=\"20\" height=\"14\" x=\"2\" y=\"3\" rx=\"2\"></rect>\r\n      <line x1=\"8\" x2=\"16\" y1=\"21\" y2=\"21\"></line>\r\n      <line x1=\"12\" x2=\"12\" y1=\"17\" y2=\"21\"></line>\r\n    </svg>\r\n  `;\r\n}\r\n\r\n// ==================== 语言切换 ====================\r\n\r\nexport function renderLanguageToggle() {\r\n  const currentLang = getLanguage();\r\n  const isZh = currentLang === 'zh-CN' || currentLang === 'zh';\r\n\r\n  const toggleLang = () => {\r\n    toggleLanguage();\r\n    // 刷新页面以应用新语言\r\n    window.location.reload();\r\n  };\r\n\r\n  return html`\r\n    <div class=\"language-toggle\" style=\"margin-left: 8px;\">\r\n      <button\r\n        class=\"btn btn--sm language-toggle__btn\"\r\n        @click=${toggleLang}\r\n        title=\"${T(\"Switch Language\")}\"\r\n        aria-label=\"${T(\"Switch Language\")}\"\r\n      >\r\n        <span class=\"language-toggle__icon\">🌐</span>\r\n        <span class=\"language-toggle__text\">${isZh ? 'EN' : '中文'}</span>\r\n      </button>\r\n    </div>\r\n  `;\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type {\r\n  AgentFileEntry,\r\n  AgentsFilesGetResult,\r\n  AgentsFilesListResult,\r\n  AgentsFilesSetResult,\r\n} from \"../types.ts\";\r\n\r\nexport type AgentFilesState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  agentFilesLoading: boolean;\r\n  agentFilesError: string | null;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentFileContents: Record<string, string>;\r\n  agentFileDrafts: Record<string, string>;\r\n  agentFileActive: string | null;\r\n  agentFileSaving: boolean;\r\n};\r\n\r\nfunction mergeFileEntry(\r\n  list: AgentsFilesListResult | null,\r\n  entry: AgentFileEntry,\r\n): AgentsFilesListResult | null {\r\n  if (!list) {\r\n    return list;\r\n  }\r\n  const hasEntry = list.files.some((file) => file.name === entry.name);\r\n  const nextFiles = hasEntry\r\n    ? list.files.map((file) => (file.name === entry.name ? entry : file))\r\n    : [...list.files, entry];\r\n  return { ...list, files: nextFiles };\r\n}\r\n\r\nexport async function loadAgentFiles(state: AgentFilesState, agentId: string) {\r\n  if (!state.client || !state.connected || state.agentFilesLoading) {\r\n    return;\r\n  }\r\n  state.agentFilesLoading = true;\r\n  state.agentFilesError = null;\r\n  try {\r\n    const res = await state.client.request<AgentsFilesListResult | null>(\"agents.files.list\", {\r\n      agentId,\r\n    });\r\n    if (res) {\r\n      state.agentFilesList = res;\r\n      if (state.agentFileActive && !res.files.some((file) => file.name === state.agentFileActive)) {\r\n        state.agentFileActive = null;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    state.agentFilesError = String(err);\r\n  } finally {\r\n    state.agentFilesLoading = false;\r\n  }\r\n}\r\n\r\nexport async function loadAgentFileContent(\r\n  state: AgentFilesState,\r\n  agentId: string,\r\n  name: string,\r\n  opts?: { force?: boolean; preserveDraft?: boolean },\r\n) {\r\n  if (!state.client || !state.connected || state.agentFilesLoading) {\r\n    return;\r\n  }\r\n  if (!opts?.force && Object.hasOwn(state.agentFileContents, name)) {\r\n    return;\r\n  }\r\n  state.agentFilesLoading = true;\r\n  state.agentFilesError = null;\r\n  try {\r\n    const res = await state.client.request<AgentsFilesGetResult | null>(\"agents.files.get\", {\r\n      agentId,\r\n      name,\r\n    });\r\n    if (res?.file) {\r\n      const content = res.file.content ?? \"\";\r\n      const previousBase = state.agentFileContents[name] ?? \"\";\r\n      const currentDraft = state.agentFileDrafts[name];\r\n      const preserveDraft = opts?.preserveDraft ?? true;\r\n      state.agentFilesList = mergeFileEntry(state.agentFilesList, res.file);\r\n      state.agentFileContents = { ...state.agentFileContents, [name]: content };\r\n      if (\r\n        !preserveDraft ||\r\n        !Object.hasOwn(state.agentFileDrafts, name) ||\r\n        currentDraft === previousBase\r\n      ) {\r\n        state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\r\n      }\r\n    }\r\n  } catch (err) {\r\n    state.agentFilesError = String(err);\r\n  } finally {\r\n    state.agentFilesLoading = false;\r\n  }\r\n}\r\n\r\nexport async function saveAgentFile(\r\n  state: AgentFilesState,\r\n  agentId: string,\r\n  name: string,\r\n  content: string,\r\n) {\r\n  if (!state.client || !state.connected || state.agentFileSaving) {\r\n    return;\r\n  }\r\n  state.agentFileSaving = true;\r\n  state.agentFilesError = null;\r\n  try {\r\n    const res = await state.client.request<AgentsFilesSetResult | null>(\"agents.files.set\", {\r\n      agentId,\r\n      name,\r\n      content,\r\n    });\r\n    if (res?.file) {\r\n      state.agentFilesList = mergeFileEntry(state.agentFilesList, res.file);\r\n      state.agentFileContents = { ...state.agentFileContents, [name]: content };\r\n      state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\r\n    }\r\n  } catch (err) {\r\n    state.agentFilesError = String(err);\r\n  } finally {\r\n    state.agentFileSaving = false;\r\n  }\r\n}\r\n","import type { GatewayBrowserClient } from \"../gateway.ts\";\r\nimport type { SessionsUsageResult, CostUsageSummary, SessionUsageTimeSeries } from \"../types.ts\";\r\nimport type { SessionLogEntry } from \"../views/usage.ts\";\r\n\r\nexport type UsageState = {\r\n  client: GatewayBrowserClient | null;\r\n  connected: boolean;\r\n  usageLoading: boolean;\r\n  usageResult: SessionsUsageResult | null;\r\n  usageCostSummary: CostUsageSummary | null;\r\n  usageError: string | null;\r\n  usageStartDate: string;\r\n  usageEndDate: string;\r\n  usageSelectedSessions: string[];\r\n  usageSelectedDays: string[];\r\n  usageTimeSeries: SessionUsageTimeSeries | null;\r\n  usageTimeSeriesLoading: boolean;\r\n  usageSessionLogs: SessionLogEntry[] | null;\r\n  usageSessionLogsLoading: boolean;\r\n};\r\n\r\nexport async function loadUsage(\r\n  state: UsageState,\r\n  overrides?: {\r\n    startDate?: string;\r\n    endDate?: string;\r\n  },\r\n) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.usageLoading) {\r\n    return;\r\n  }\r\n  state.usageLoading = true;\r\n  state.usageError = null;\r\n  try {\r\n    const startDate = overrides?.startDate ?? state.usageStartDate;\r\n    const endDate = overrides?.endDate ?? state.usageEndDate;\r\n\r\n    // Load both endpoints in parallel\r\n    const [sessionsRes, costRes] = await Promise.all([\r\n      state.client.request(\"sessions.usage\", {\r\n        startDate,\r\n        endDate,\r\n        limit: 1000, // Cap at 1000 sessions\r\n        includeContextWeight: true,\r\n      }),\r\n      state.client.request(\"usage.cost\", { startDate, endDate }),\r\n    ]);\r\n\r\n    if (sessionsRes) {\r\n      state.usageResult = sessionsRes as SessionsUsageResult;\r\n    }\r\n    if (costRes) {\r\n      state.usageCostSummary = costRes as CostUsageSummary;\r\n    }\r\n  } catch (err) {\r\n    state.usageError = String(err);\r\n  } finally {\r\n    state.usageLoading = false;\r\n  }\r\n}\r\n\r\nexport async function loadSessionTimeSeries(state: UsageState, sessionKey: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.usageTimeSeriesLoading) {\r\n    return;\r\n  }\r\n  state.usageTimeSeriesLoading = true;\r\n  state.usageTimeSeries = null;\r\n  try {\r\n    const res = await state.client.request(\"sessions.usage.timeseries\", { key: sessionKey });\r\n    if (res) {\r\n      state.usageTimeSeries = res as SessionUsageTimeSeries;\r\n    }\r\n  } catch {\r\n    // Silently fail - time series is optional\r\n    state.usageTimeSeries = null;\r\n  } finally {\r\n    state.usageTimeSeriesLoading = false;\r\n  }\r\n}\r\n\r\nexport async function loadSessionLogs(state: UsageState, sessionKey: string) {\r\n  if (!state.client || !state.connected) {\r\n    return;\r\n  }\r\n  if (state.usageSessionLogsLoading) {\r\n    return;\r\n  }\r\n  state.usageSessionLogsLoading = true;\r\n  state.usageSessionLogs = null;\r\n  try {\r\n    const res = await state.client.request(\"sessions.usage.logs\", { key: sessionKey, limit: 500 });\r\n    if (res && Array.isArray((res as { logs: SessionLogEntry[] }).logs)) {\r\n      state.usageSessionLogs = (res as { logs: SessionLogEntry[] }).logs;\r\n    }\r\n  } catch {\r\n    // Silently fail - logs are optional\r\n    state.usageSessionLogs = null;\r\n  } finally {\r\n    state.usageSessionLogsLoading = false;\r\n  }\r\n}\r\n","import type { AnyAgentTool } from \"./tools/common.js\";\n\nexport type ToolProfileId = \"minimal\" | \"coding\" | \"messaging\" | \"full\";\n\ntype ToolProfilePolicy = {\n  allow?: string[];\n  deny?: string[];\n};\n\nconst TOOL_NAME_ALIASES: Record<string, string> = {\n  bash: \"exec\",\n  \"apply-patch\": \"apply_patch\",\n};\n\nexport const TOOL_GROUPS: Record<string, string[]> = {\n  // NOTE: Keep canonical (lowercase) tool names here.\n  \"group:memory\": [\"memory_search\", \"memory_get\"],\n  \"group:web\": [\"web_search\", \"web_fetch\"],\n  // Basic workspace/file tools\n  \"group:fs\": [\"read\", \"write\", \"edit\", \"apply_patch\"],\n  // Host/runtime execution tools\n  \"group:runtime\": [\"exec\", \"process\"],\n  // Session management tools\n  \"group:sessions\": [\n    \"sessions_list\",\n    \"sessions_history\",\n    \"sessions_send\",\n    \"sessions_spawn\",\n    \"subagents\",\n    \"session_status\",\n  ],\n  // UI helpers\n  \"group:ui\": [\"browser\", \"canvas\"],\n  // Automation + infra\n  \"group:automation\": [\"cron\", \"gateway\"],\n  // Messaging surface\n  \"group:messaging\": [\"message\"],\n  // Nodes + device tools\n  \"group:nodes\": [\"nodes\"],\n  // All OpenClaw native tools (excludes provider plugins).\n  \"group:openclaw\": [\n    \"browser\",\n    \"canvas\",\n    \"nodes\",\n    \"cron\",\n    \"message\",\n    \"gateway\",\n    \"agents_list\",\n    \"sessions_list\",\n    \"sessions_history\",\n    \"sessions_send\",\n    \"sessions_spawn\",\n    \"subagents\",\n    \"session_status\",\n    \"memory_search\",\n    \"memory_get\",\n    \"web_search\",\n    \"web_fetch\",\n    \"image\",\n  ],\n};\n\nconst OWNER_ONLY_TOOL_NAMES = new Set<string>([\"whatsapp_login\"]);\n\nconst TOOL_PROFILES: Record<ToolProfileId, ToolProfilePolicy> = {\n  minimal: {\n    allow: [\"session_status\"],\n  },\n  coding: {\n    allow: [\"group:fs\", \"group:runtime\", \"group:sessions\", \"group:memory\", \"image\"],\n  },\n  messaging: {\n    allow: [\n      \"group:messaging\",\n      \"sessions_list\",\n      \"sessions_history\",\n      \"sessions_send\",\n      \"session_status\",\n    ],\n  },\n  full: {},\n};\n\nexport function normalizeToolName(name: string) {\n  const normalized = name.trim().toLowerCase();\n  return TOOL_NAME_ALIASES[normalized] ?? normalized;\n}\n\nexport function isOwnerOnlyToolName(name: string) {\n  return OWNER_ONLY_TOOL_NAMES.has(normalizeToolName(name));\n}\n\nexport function applyOwnerOnlyToolPolicy(tools: AnyAgentTool[], senderIsOwner: boolean) {\n  const withGuard = tools.map((tool) => {\n    if (!isOwnerOnlyToolName(tool.name)) {\n      return tool;\n    }\n    if (senderIsOwner || !tool.execute) {\n      return tool;\n    }\n    return {\n      ...tool,\n      execute: async () => {\n        throw new Error(\"Tool restricted to owner senders.\");\n      },\n    };\n  });\n  if (senderIsOwner) {\n    return withGuard;\n  }\n  return withGuard.filter((tool) => !isOwnerOnlyToolName(tool.name));\n}\n\nexport function normalizeToolList(list?: string[]) {\n  if (!list) {\n    return [];\n  }\n  return list.map(normalizeToolName).filter(Boolean);\n}\n\nexport type ToolPolicyLike = {\n  allow?: string[];\n  deny?: string[];\n};\n\nexport type PluginToolGroups = {\n  all: string[];\n  byPlugin: Map<string, string[]>;\n};\n\nexport type AllowlistResolution = {\n  policy: ToolPolicyLike | undefined;\n  unknownAllowlist: string[];\n  strippedAllowlist: boolean;\n};\n\nexport function expandToolGroups(list?: string[]) {\n  const normalized = normalizeToolList(list);\n  const expanded: string[] = [];\n  for (const value of normalized) {\n    const group = TOOL_GROUPS[value];\n    if (group) {\n      expanded.push(...group);\n      continue;\n    }\n    expanded.push(value);\n  }\n  return Array.from(new Set(expanded));\n}\n\nexport function collectExplicitAllowlist(policies: Array<ToolPolicyLike | undefined>): string[] {\n  const entries: string[] = [];\n  for (const policy of policies) {\n    if (!policy?.allow) {\n      continue;\n    }\n    for (const value of policy.allow) {\n      if (typeof value !== \"string\") {\n        continue;\n      }\n      const trimmed = value.trim();\n      if (trimmed) {\n        entries.push(trimmed);\n      }\n    }\n  }\n  return entries;\n}\n\nexport function buildPluginToolGroups<T extends { name: string }>(params: {\n  tools: T[];\n  toolMeta: (tool: T) => { pluginId: string } | undefined;\n}): PluginToolGroups {\n  const all: string[] = [];\n  const byPlugin = new Map<string, string[]>();\n  for (const tool of params.tools) {\n    const meta = params.toolMeta(tool);\n    if (!meta) {\n      continue;\n    }\n    const name = normalizeToolName(tool.name);\n    all.push(name);\n    const pluginId = meta.pluginId.toLowerCase();\n    const list = byPlugin.get(pluginId) ?? [];\n    list.push(name);\n    byPlugin.set(pluginId, list);\n  }\n  return { all, byPlugin };\n}\n\nexport function expandPluginGroups(\n  list: string[] | undefined,\n  groups: PluginToolGroups,\n): string[] | undefined {\n  if (!list || list.length === 0) {\n    return list;\n  }\n  const expanded: string[] = [];\n  for (const entry of list) {\n    const normalized = normalizeToolName(entry);\n    if (normalized === \"group:plugins\") {\n      if (groups.all.length > 0) {\n        expanded.push(...groups.all);\n      } else {\n        expanded.push(normalized);\n      }\n      continue;\n    }\n    const tools = groups.byPlugin.get(normalized);\n    if (tools && tools.length > 0) {\n      expanded.push(...tools);\n      continue;\n    }\n    expanded.push(normalized);\n  }\n  return Array.from(new Set(expanded));\n}\n\nexport function expandPolicyWithPluginGroups(\n  policy: ToolPolicyLike | undefined,\n  groups: PluginToolGroups,\n): ToolPolicyLike | undefined {\n  if (!policy) {\n    return undefined;\n  }\n  return {\n    allow: expandPluginGroups(policy.allow, groups),\n    deny: expandPluginGroups(policy.deny, groups),\n  };\n}\n\nexport function stripPluginOnlyAllowlist(\n  policy: ToolPolicyLike | undefined,\n  groups: PluginToolGroups,\n  coreTools: Set<string>,\n): AllowlistResolution {\n  if (!policy?.allow || policy.allow.length === 0) {\n    return { policy, unknownAllowlist: [], strippedAllowlist: false };\n  }\n  const normalized = normalizeToolList(policy.allow);\n  if (normalized.length === 0) {\n    return { policy, unknownAllowlist: [], strippedAllowlist: false };\n  }\n  const pluginIds = new Set(groups.byPlugin.keys());\n  const pluginTools = new Set(groups.all);\n  const unknownAllowlist: string[] = [];\n  let hasCoreEntry = false;\n  for (const entry of normalized) {\n    if (entry === \"*\") {\n      hasCoreEntry = true;\n      continue;\n    }\n    const isPluginEntry =\n      entry === \"group:plugins\" || pluginIds.has(entry) || pluginTools.has(entry);\n    const expanded = expandToolGroups([entry]);\n    const isCoreEntry = expanded.some((tool) => coreTools.has(tool));\n    if (isCoreEntry) {\n      hasCoreEntry = true;\n    }\n    if (!isCoreEntry && !isPluginEntry) {\n      unknownAllowlist.push(entry);\n    }\n  }\n  const strippedAllowlist = !hasCoreEntry;\n  // When an allowlist contains only plugin tools, we strip it to avoid accidentally\n  // disabling core tools. Users who want additive behavior should prefer `tools.alsoAllow`.\n  if (strippedAllowlist) {\n    // Note: logging happens in the caller (pi-tools/tools-invoke) after this function returns.\n    // We keep this note here for future maintainers.\n  }\n  return {\n    policy: strippedAllowlist ? { ...policy, allow: undefined } : policy,\n    unknownAllowlist: Array.from(new Set(unknownAllowlist)),\n    strippedAllowlist,\n  };\n}\n\nexport function resolveToolProfilePolicy(profile?: string): ToolProfilePolicy | undefined {\n  if (!profile) {\n    return undefined;\n  }\n  const resolved = TOOL_PROFILES[profile as ToolProfileId];\n  if (!resolved) {\n    return undefined;\n  }\n  if (!resolved.allow && !resolved.deny) {\n    return undefined;\n  }\n  return {\n    allow: resolved.allow ? [...resolved.allow] : undefined,\n    deny: resolved.deny ? [...resolved.deny] : undefined,\n  };\n}\n\nexport function mergeAlsoAllowPolicy<TPolicy extends { allow?: string[] }>(\n  policy: TPolicy | undefined,\n  alsoAllow?: string[],\n): TPolicy | undefined {\n  if (!policy?.allow || !Array.isArray(alsoAllow) || alsoAllow.length === 0) {\n    return policy;\n  }\n  return { ...policy, allow: Array.from(new Set([...policy.allow, ...alsoAllow])) };\n}\n","import type { CronJob, GatewaySessionRow, PresenceEntry } from \"./types.ts\";\r\nimport { formatRelativeTimestamp, formatDurationHuman, formatMs } from \"./format.ts\";\r\n\r\nexport function formatPresenceSummary(entry: PresenceEntry): string {\r\n  const host = entry.host ?? \"unknown\";\r\n  const ip = entry.ip ? `(${entry.ip})` : \"\";\r\n  const mode = entry.mode ?? \"\";\r\n  const version = entry.version ?? \"\";\r\n  return `${host} ${ip} ${mode} ${version}`.trim();\r\n}\r\n\r\nexport function formatPresenceAge(entry: PresenceEntry): string {\r\n  const ts = entry.ts ?? null;\r\n  return ts ? formatRelativeTimestamp(ts) : \"n/a\";\r\n}\r\n\r\nexport function formatNextRun(ms?: number | null) {\r\n  if (!ms) {\r\n    return \"n/a\";\r\n  }\r\n  return `${formatMs(ms)} (${formatRelativeTimestamp(ms)})`;\r\n}\r\n\r\nexport function formatSessionTokens(row: GatewaySessionRow) {\r\n  if (row.totalTokens == null) {\r\n    return \"n/a\";\r\n  }\r\n  const total = row.totalTokens ?? 0;\r\n  const ctx = row.contextTokens ?? 0;\r\n  return ctx ? `${total} / ${ctx}` : String(total);\r\n}\r\n\r\nexport function formatEventPayload(payload: unknown): string {\r\n  if (payload == null) {\r\n    return \"\";\r\n  }\r\n  try {\r\n    return JSON.stringify(payload, null, 2);\r\n  } catch {\r\n    // oxlint-disable typescript/no-base-to-string\r\n    return String(payload);\r\n  }\r\n}\r\n\r\nexport function formatCronState(job: CronJob) {\r\n  const state = job.state ?? {};\r\n  const next = state.nextRunAtMs ? formatMs(state.nextRunAtMs) : \"n/a\";\r\n  const last = state.lastRunAtMs ? formatMs(state.lastRunAtMs) : \"n/a\";\r\n  const status = state.lastStatus ?? \"n/a\";\r\n  return `${status} · next ${next} · last ${last}`;\r\n}\r\n\r\nexport function formatCronSchedule(job: CronJob) {\r\n  const s = job.schedule;\r\n  if (s.kind === \"at\") {\r\n    const atMs = Date.parse(s.at);\r\n    return Number.isFinite(atMs) ? `At ${formatMs(atMs)}` : `At ${s.at}`;\r\n  }\r\n  if (s.kind === \"every\") {\r\n    return `Every ${formatDurationHuman(s.everyMs)}`;\r\n  }\r\n  return `Cron ${s.expr}${s.tz ? ` (${s.tz})` : \"\"}`;\r\n}\r\n\r\nexport function formatCronPayload(job: CronJob) {\r\n  const p = job.payload;\r\n  if (p.kind === \"systemEvent\") {\r\n    return `System: ${p.text}`;\r\n  }\r\n  const base = `Agent: ${p.message}`;\r\n  const delivery = job.delivery;\r\n  if (delivery && delivery.mode !== \"none\") {\r\n    const target =\r\n      delivery.channel || delivery.to\r\n        ? ` (${delivery.channel ?? \"last\"}${delivery.to ? ` -> ${delivery.to}` : \"\"})`\r\n        : \"\";\r\n    return `${base} · ${delivery.mode}${target}`;\r\n  }\r\n  return base;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type {\r\n  AgentFileEntry,\r\n  AgentsFilesListResult,\r\n  AgentsListResult,\r\n  AgentIdentityResult,\r\n  ChannelAccountSnapshot,\r\n  ChannelsStatusSnapshot,\r\n  CronJob,\r\n  CronStatus,\r\n  SkillStatusEntry,\r\n  SkillStatusReport,\r\n} from \"../types.ts\";\r\nimport {\r\n  expandToolGroups,\r\n  normalizeToolName,\r\n  resolveToolProfilePolicy,\r\n} from \"../../../../src/agents/tool-policy.js\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport {\r\n  formatCronPayload,\r\n  formatCronSchedule,\r\n  formatCronState,\r\n  formatNextRun,\r\n} from \"../presenter.ts\";\r\n\r\nexport type AgentsPanel = \"overview\" | \"files\" | \"tools\" | \"skills\" | \"channels\" | \"cron\";\r\n\r\nexport type AgentsProps = {\r\n  loading: boolean;\r\n  error: string | null;\r\n  agentsList: AgentsListResult | null;\r\n  selectedAgentId: string | null;\r\n  activePanel: AgentsPanel;\r\n  configForm: Record<string, unknown> | null;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  configDirty: boolean;\r\n  channelsLoading: boolean;\r\n  channelsError: string | null;\r\n  channelsSnapshot: ChannelsStatusSnapshot | null;\r\n  channelsLastSuccess: number | null;\r\n  cronLoading: boolean;\r\n  cronStatus: CronStatus | null;\r\n  cronJobs: CronJob[];\r\n  cronError: string | null;\r\n  agentFilesLoading: boolean;\r\n  agentFilesError: string | null;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentFileActive: string | null;\r\n  agentFileContents: Record<string, string>;\r\n  agentFileDrafts: Record<string, string>;\r\n  agentFileSaving: boolean;\r\n  agentIdentityLoading: boolean;\r\n  agentIdentityError: string | null;\r\n  agentIdentityById: Record<string, AgentIdentityResult>;\r\n  agentSkillsLoading: boolean;\r\n  agentSkillsReport: SkillStatusReport | null;\r\n  agentSkillsError: string | null;\r\n  agentSkillsAgentId: string | null;\r\n  skillsFilter: string;\r\n  onRefresh: () => void;\r\n  onSelectAgent: (agentId: string) => void;\r\n  onSelectPanel: (panel: AgentsPanel) => void;\r\n  onLoadFiles: (agentId: string) => void;\r\n  onSelectFile: (name: string) => void;\r\n  onFileDraftChange: (name: string, content: string) => void;\r\n  onFileReset: (name: string) => void;\r\n  onFileSave: (name: string) => void;\r\n  onToolsProfileChange: (agentId: string, profile: string | null, clearAllow: boolean) => void;\r\n  onToolsOverridesChange: (agentId: string, alsoAllow: string[], deny: string[]) => void;\r\n  onConfigReload: () => void;\r\n  onConfigSave: () => void;\r\n  onModelChange: (agentId: string, modelId: string | null) => void;\r\n  onModelFallbacksChange: (agentId: string, fallbacks: string[]) => void;\r\n  onChannelsRefresh: () => void;\r\n  onCronRefresh: () => void;\r\n  onSkillsFilterChange: (next: string) => void;\r\n  onSkillsRefresh: () => void;\r\n  onAgentSkillToggle: (agentId: string, skillName: string, enabled: boolean) => void;\r\n  onAgentSkillsClear: (agentId: string) => void;\r\n  onAgentSkillsDisableAll: (agentId: string) => void;\r\n};\r\n\r\nconst TOOL_SECTIONS = [\r\n  {\r\n    id: \"fs\",\r\n    label: \"Files\",\r\n    tools: [\r\n      { id: \"read\", label: \"read\", description: \"Read file contents\" },\r\n      { id: \"write\", label: \"write\", description: \"Create or overwrite files\" },\r\n      { id: \"edit\", label: \"edit\", description: \"Make precise edits\" },\r\n      { id: \"apply_patch\", label: \"apply_patch\", description: \"Patch files (OpenAI)\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"runtime\",\r\n    label: \"Runtime\",\r\n    tools: [\r\n      { id: \"exec\", label: \"exec\", description: \"Run shell commands\" },\r\n      { id: \"process\", label: \"process\", description: \"Manage background processes\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"web\",\r\n    label: \"Web\",\r\n    tools: [\r\n      { id: \"web_search\", label: \"web_search\", description: \"Search the web\" },\r\n      { id: \"web_fetch\", label: \"web_fetch\", description: \"Fetch web content\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"memory\",\r\n    label: \"Memory\",\r\n    tools: [\r\n      { id: \"memory_search\", label: \"memory_search\", description: \"Semantic search\" },\r\n      { id: \"memory_get\", label: \"memory_get\", description: \"Read memory files\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"sessions\",\r\n    label: \"Sessions\",\r\n    tools: [\r\n      { id: \"sessions_list\", label: \"sessions_list\", description: \"List sessions\" },\r\n      { id: \"sessions_history\", label: \"sessions_history\", description: \"Session history\" },\r\n      { id: \"sessions_send\", label: \"sessions_send\", description: \"Send to session\" },\r\n      { id: \"sessions_spawn\", label: \"sessions_spawn\", description: \"Spawn sub-agent\" },\r\n      { id: \"session_status\", label: \"session_status\", description: \"Session status\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"ui\",\r\n    label: \"UI\",\r\n    tools: [\r\n      { id: \"browser\", label: \"browser\", description: \"Control web browser\" },\r\n      { id: \"canvas\", label: \"canvas\", description: \"Control canvases\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"messaging\",\r\n    label: \"Messaging\",\r\n    tools: [{ id: \"message\", label: \"message\", description: \"Send messages\" }],\r\n  },\r\n  {\r\n    id: \"automation\",\r\n    label: \"Automation\",\r\n    tools: [\r\n      { id: \"cron\", label: \"cron\", description: \"Schedule tasks\" },\r\n      { id: \"gateway\", label: \"gateway\", description: \"Gateway control\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"nodes\",\r\n    label: \"Nodes\",\r\n    tools: [{ id: \"nodes\", label: \"nodes\", description: \"Nodes + devices\" }],\r\n  },\r\n  {\r\n    id: \"agents\",\r\n    label: \"Agents\",\r\n    tools: [{ id: \"agents_list\", label: \"agents_list\", description: \"List agents\" }],\r\n  },\r\n  {\r\n    id: \"media\",\r\n    label: \"Media\",\r\n    tools: [{ id: \"image\", label: \"image\", description: \"Image understanding\" }],\r\n  },\r\n];\r\n\r\nconst PROFILE_OPTIONS = [\r\n  { id: \"minimal\", label: \"Minimal\" },\r\n  { id: \"coding\", label: \"Coding\" },\r\n  { id: \"messaging\", label: \"Messaging\" },\r\n  { id: \"full\", label: \"Full\" },\r\n] as const;\r\n\r\ntype ToolPolicy = {\r\n  allow?: string[];\r\n  deny?: string[];\r\n};\r\n\r\ntype AgentConfigEntry = {\r\n  id: string;\r\n  name?: string;\r\n  workspace?: string;\r\n  agentDir?: string;\r\n  model?: unknown;\r\n  skills?: string[];\r\n  tools?: {\r\n    profile?: string;\r\n    allow?: string[];\r\n    alsoAllow?: string[];\r\n    deny?: string[];\r\n  };\r\n};\r\n\r\ntype ConfigSnapshot = {\r\n  agents?: {\r\n    defaults?: { workspace?: string; model?: unknown; models?: Record<string, { alias?: string }> };\r\n    list?: AgentConfigEntry[];\r\n  };\r\n  tools?: {\r\n    profile?: string;\r\n    allow?: string[];\r\n    alsoAllow?: string[];\r\n    deny?: string[];\r\n  };\r\n};\r\n\r\nfunction normalizeAgentLabel(agent: { id: string; name?: string; identity?: { name?: string } }) {\r\n  return agent.name?.trim() || agent.identity?.name?.trim() || agent.id;\r\n}\r\n\r\nfunction isLikelyEmoji(value: string) {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return false;\r\n  }\r\n  if (trimmed.length > 16) {\r\n    return false;\r\n  }\r\n  let hasNonAscii = false;\r\n  for (let i = 0; i < trimmed.length; i += 1) {\r\n    if (trimmed.charCodeAt(i) > 127) {\r\n      hasNonAscii = true;\r\n      break;\r\n    }\r\n  }\r\n  if (!hasNonAscii) {\r\n    return false;\r\n  }\r\n  if (trimmed.includes(\"://\") || trimmed.includes(\"/\") || trimmed.includes(\".\")) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction resolveAgentEmoji(\r\n  agent: { identity?: { emoji?: string; avatar?: string } },\r\n  agentIdentity?: AgentIdentityResult | null,\r\n) {\r\n  const identityEmoji = agentIdentity?.emoji?.trim();\r\n  if (identityEmoji && isLikelyEmoji(identityEmoji)) {\r\n    return identityEmoji;\r\n  }\r\n  const agentEmoji = agent.identity?.emoji?.trim();\r\n  if (agentEmoji && isLikelyEmoji(agentEmoji)) {\r\n    return agentEmoji;\r\n  }\r\n  const identityAvatar = agentIdentity?.avatar?.trim();\r\n  if (identityAvatar && isLikelyEmoji(identityAvatar)) {\r\n    return identityAvatar;\r\n  }\r\n  const avatar = agent.identity?.avatar?.trim();\r\n  if (avatar && isLikelyEmoji(avatar)) {\r\n    return avatar;\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction agentBadgeText(agentId: string, defaultId: string | null) {\r\n  return defaultId && agentId === defaultId ? \"default\" : null;\r\n}\r\n\r\nfunction formatBytes(bytes?: number) {\r\n  if (bytes == null || !Number.isFinite(bytes)) {\r\n    return \"-\";\r\n  }\r\n  if (bytes < 1024) {\r\n    return `${bytes} B`;\r\n  }\r\n  const units = [\"KB\", \"MB\", \"GB\", \"TB\"];\r\n  let size = bytes / 1024;\r\n  let unitIndex = 0;\r\n  while (size >= 1024 && unitIndex < units.length - 1) {\r\n    size /= 1024;\r\n    unitIndex += 1;\r\n  }\r\n  return `${size.toFixed(size < 10 ? 1 : 0)} ${units[unitIndex]}`;\r\n}\r\n\r\nfunction resolveAgentConfig(config: Record<string, unknown> | null, agentId: string) {\r\n  const cfg = config as ConfigSnapshot | null;\r\n  const list = cfg?.agents?.list ?? [];\r\n  const entry = list.find((agent) => agent?.id === agentId);\r\n  return {\r\n    entry,\r\n    defaults: cfg?.agents?.defaults,\r\n    globalTools: cfg?.tools,\r\n  };\r\n}\r\n\r\ntype AgentContext = {\r\n  workspace: string;\r\n  model: string;\r\n  identityName: string;\r\n  identityEmoji: string;\r\n  skillsLabel: string;\r\n  isDefault: boolean;\r\n};\r\n\r\nfunction buildAgentContext(\r\n  agent: AgentsListResult[\"agents\"][number],\r\n  configForm: Record<string, unknown> | null,\r\n  agentFilesList: AgentsFilesListResult | null,\r\n  defaultId: string | null,\r\n  agentIdentity?: AgentIdentityResult | null,\r\n): AgentContext {\r\n  const config = resolveAgentConfig(configForm, agent.id);\r\n  const workspaceFromFiles =\r\n    agentFilesList && agentFilesList.agentId === agent.id ? agentFilesList.workspace : null;\r\n  const workspace =\r\n    workspaceFromFiles || config.entry?.workspace || config.defaults?.workspace || \"default\";\r\n  const modelLabel = config.entry?.model\r\n    ? resolveModelLabel(config.entry?.model)\r\n    : resolveModelLabel(config.defaults?.model);\r\n  const identityName =\r\n    agentIdentity?.name?.trim() ||\r\n    agent.identity?.name?.trim() ||\r\n    agent.name?.trim() ||\r\n    config.entry?.name ||\r\n    agent.id;\r\n  const identityEmoji = resolveAgentEmoji(agent, agentIdentity) || \"-\";\r\n  const skillFilter = Array.isArray(config.entry?.skills) ? config.entry?.skills : null;\r\n  const skillCount = skillFilter?.length ?? null;\r\n  return {\r\n    workspace,\r\n    model: modelLabel,\r\n    identityName,\r\n    identityEmoji,\r\n    skillsLabel: skillFilter ? `${skillCount} selected` : \"all skills\",\r\n    isDefault: Boolean(defaultId && agent.id === defaultId),\r\n  };\r\n}\r\n\r\nfunction resolveModelLabel(model?: unknown): string {\r\n  if (!model) {\r\n    return \"-\";\r\n  }\r\n  if (typeof model === \"string\") {\r\n    return model.trim() || \"-\";\r\n  }\r\n  if (typeof model === \"object\" && model) {\r\n    const record = model as { primary?: string; fallbacks?: string[] };\r\n    const primary = record.primary?.trim();\r\n    if (primary) {\r\n      const fallbackCount = Array.isArray(record.fallbacks) ? record.fallbacks.length : 0;\r\n      return fallbackCount > 0 ? `${primary} (+${fallbackCount} fallback)` : primary;\r\n    }\r\n  }\r\n  return \"-\";\r\n}\r\n\r\nfunction normalizeModelValue(label: string): string {\r\n  const match = label.match(/^(.+) \\(\\+\\d+ fallback\\)$/);\r\n  return match ? match[1] : label;\r\n}\r\n\r\nfunction resolveModelPrimary(model?: unknown): string | null {\r\n  if (!model) {\r\n    return null;\r\n  }\r\n  if (typeof model === \"string\") {\r\n    const trimmed = model.trim();\r\n    return trimmed || null;\r\n  }\r\n  if (typeof model === \"object\" && model) {\r\n    const record = model as Record<string, unknown>;\r\n    const candidate =\r\n      typeof record.primary === \"string\"\r\n        ? record.primary\r\n        : typeof record.model === \"string\"\r\n          ? record.model\r\n          : typeof record.id === \"string\"\r\n            ? record.id\r\n            : typeof record.value === \"string\"\r\n              ? record.value\r\n              : null;\r\n    const primary = candidate?.trim();\r\n    return primary || null;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction resolveModelFallbacks(model?: unknown): string[] | null {\r\n  if (!model || typeof model === \"string\") {\r\n    return null;\r\n  }\r\n  if (typeof model === \"object\" && model) {\r\n    const record = model as Record<string, unknown>;\r\n    const fallbacks = Array.isArray(record.fallbacks)\r\n      ? record.fallbacks\r\n      : Array.isArray(record.fallback)\r\n        ? record.fallback\r\n        : null;\r\n    return fallbacks\r\n      ? fallbacks.filter((entry): entry is string => typeof entry === \"string\")\r\n      : null;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction parseFallbackList(value: string): string[] {\r\n  return value\r\n    .split(\",\")\r\n    .map((entry) => entry.trim())\r\n    .filter(Boolean);\r\n}\r\n\r\ntype ConfiguredModelOption = {\r\n  value: string;\r\n  label: string;\r\n};\r\n\r\nfunction resolveConfiguredModels(\r\n  configForm: Record<string, unknown> | null,\r\n): ConfiguredModelOption[] {\r\n  const cfg = configForm as ConfigSnapshot | null;\r\n  const models = cfg?.agents?.defaults?.models;\r\n  if (!models || typeof models !== \"object\") {\r\n    return [];\r\n  }\r\n  const options: ConfiguredModelOption[] = [];\r\n  for (const [modelId, modelRaw] of Object.entries(models)) {\r\n    const trimmed = modelId.trim();\r\n    if (!trimmed) {\r\n      continue;\r\n    }\r\n    const alias =\r\n      modelRaw && typeof modelRaw === \"object\" && \"alias\" in modelRaw\r\n        ? typeof (modelRaw as { alias?: unknown }).alias === \"string\"\r\n          ? (modelRaw as { alias?: string }).alias?.trim()\r\n          : undefined\r\n        : undefined;\r\n    const label = alias && alias !== trimmed ? `${alias} (${trimmed})` : trimmed;\r\n    options.push({ value: trimmed, label });\r\n  }\r\n  return options;\r\n}\r\n\r\nfunction buildModelOptions(configForm: Record<string, unknown> | null, current?: string | null) {\r\n  const options = resolveConfiguredModels(configForm);\r\n  const hasCurrent = current ? options.some((option) => option.value === current) : false;\r\n  if (current && !hasCurrent) {\r\n    options.unshift({ value: current, label: `Current (${current})` });\r\n  }\r\n  if (options.length === 0) {\r\n    return html`\r\n      <option value=\"\" disabled>No configured models</option>\r\n    `;\r\n  }\r\n  return options.map((option) => html`<option value=${option.value}>${option.label}</option>`);\r\n}\r\n\r\ntype CompiledPattern =\r\n  | { kind: \"all\" }\r\n  | { kind: \"exact\"; value: string }\r\n  | { kind: \"regex\"; value: RegExp };\r\n\r\nfunction compilePattern(pattern: string): CompiledPattern {\r\n  const normalized = normalizeToolName(pattern);\r\n  if (!normalized) {\r\n    return { kind: \"exact\", value: \"\" };\r\n  }\r\n  if (normalized === \"*\") {\r\n    return { kind: \"all\" };\r\n  }\r\n  if (!normalized.includes(\"*\")) {\r\n    return { kind: \"exact\", value: normalized };\r\n  }\r\n  const escaped = normalized.replace(/[.*+?^${}()|[\\\\]\\\\]/g, \"\\\\$&\");\r\n  return { kind: \"regex\", value: new RegExp(`^${escaped.replaceAll(\"\\\\*\", \".*\")}$`) };\r\n}\r\n\r\nfunction compilePatterns(patterns?: string[]): CompiledPattern[] {\r\n  if (!Array.isArray(patterns)) {\r\n    return [];\r\n  }\r\n  return expandToolGroups(patterns)\r\n    .map(compilePattern)\r\n    .filter((pattern) => {\r\n      return pattern.kind !== \"exact\" || pattern.value.length > 0;\r\n    });\r\n}\r\n\r\nfunction matchesAny(name: string, patterns: CompiledPattern[]) {\r\n  for (const pattern of patterns) {\r\n    if (pattern.kind === \"all\") {\r\n      return true;\r\n    }\r\n    if (pattern.kind === \"exact\" && name === pattern.value) {\r\n      return true;\r\n    }\r\n    if (pattern.kind === \"regex\" && pattern.value.test(name)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isAllowedByPolicy(name: string, policy?: ToolPolicy) {\r\n  if (!policy) {\r\n    return true;\r\n  }\r\n  const normalized = normalizeToolName(name);\r\n  const deny = compilePatterns(policy.deny);\r\n  if (matchesAny(normalized, deny)) {\r\n    return false;\r\n  }\r\n  const allow = compilePatterns(policy.allow);\r\n  if (allow.length === 0) {\r\n    return true;\r\n  }\r\n  if (matchesAny(normalized, allow)) {\r\n    return true;\r\n  }\r\n  if (normalized === \"apply_patch\" && matchesAny(\"exec\", allow)) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction matchesList(name: string, list?: string[]) {\r\n  if (!Array.isArray(list) || list.length === 0) {\r\n    return false;\r\n  }\r\n  const normalized = normalizeToolName(name);\r\n  const patterns = compilePatterns(list);\r\n  if (matchesAny(normalized, patterns)) {\r\n    return true;\r\n  }\r\n  if (normalized === \"apply_patch\" && matchesAny(\"exec\", patterns)) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function renderAgents(props: AgentsProps) {\r\n  const agents = props.agentsList?.agents ?? [];\r\n  const defaultId = props.agentsList?.defaultId ?? null;\r\n  const selectedId = props.selectedAgentId ?? defaultId ?? agents[0]?.id ?? null;\r\n  const selectedAgent = selectedId\r\n    ? (agents.find((agent) => agent.id === selectedId) ?? null)\r\n    : null;\r\n\r\n  return html`\r\n    <div class=\"agents-layout\">\r\n      <section class=\"card agents-sidebar\">\r\n        <div class=\"row\" style=\"justify-content: space-between;\">\r\n          <div>\r\n            <div class=\"card-title\">Agents</div>\r\n            <div class=\"card-sub\">${agents.length} configured.</div>\r\n          </div>\r\n          <button class=\"btn btn--sm\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n            ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n        ${\r\n          props.error\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\r\n            : nothing\r\n        }\r\n        <div class=\"agent-list\" style=\"margin-top: 12px;\">\r\n          ${\r\n            agents.length === 0\r\n              ? html`\r\n                  <div class=\"muted\">No agents found.</div>\r\n                `\r\n              : agents.map((agent) => {\r\n                  const badge = agentBadgeText(agent.id, defaultId);\r\n                  const emoji = resolveAgentEmoji(agent, props.agentIdentityById[agent.id] ?? null);\r\n                  return html`\r\n                    <button\r\n                      type=\"button\"\r\n                      class=\"agent-row ${selectedId === agent.id ? \"active\" : \"\"}\"\r\n                      @click=${() => props.onSelectAgent(agent.id)}\r\n                    >\r\n                      <div class=\"agent-avatar\">\r\n                        ${emoji || normalizeAgentLabel(agent).slice(0, 1)}\r\n                      </div>\r\n                      <div class=\"agent-info\">\r\n                        <div class=\"agent-title\">${normalizeAgentLabel(agent)}</div>\r\n                        <div class=\"agent-sub mono\">${agent.id}</div>\r\n                      </div>\r\n                      ${badge ? html`<span class=\"agent-pill\">${badge}</span>` : nothing}\r\n                    </button>\r\n                  `;\r\n                })\r\n          }\r\n        </div>\r\n      </section>\r\n      <section class=\"agents-main\">\r\n        ${\r\n          !selectedAgent\r\n            ? html`\r\n                <div class=\"card\">\r\n                  <div class=\"card-title\">Select an agent</div>\r\n                  <div class=\"card-sub\">Pick an agent to inspect its workspace and tools.</div>\r\n                </div>\r\n              `\r\n            : html`\r\n              ${renderAgentHeader(\r\n                selectedAgent,\r\n                defaultId,\r\n                props.agentIdentityById[selectedAgent.id] ?? null,\r\n              )}\r\n              ${renderAgentTabs(props.activePanel, (panel) => props.onSelectPanel(panel))}\r\n              ${\r\n                props.activePanel === \"overview\"\r\n                  ? renderAgentOverview({\r\n                      agent: selectedAgent,\r\n                      defaultId,\r\n                      configForm: props.configForm,\r\n                      agentFilesList: props.agentFilesList,\r\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\r\n                      agentIdentityError: props.agentIdentityError,\r\n                      agentIdentityLoading: props.agentIdentityLoading,\r\n                      configLoading: props.configLoading,\r\n                      configSaving: props.configSaving,\r\n                      configDirty: props.configDirty,\r\n                      onConfigReload: props.onConfigReload,\r\n                      onConfigSave: props.onConfigSave,\r\n                      onModelChange: props.onModelChange,\r\n                      onModelFallbacksChange: props.onModelFallbacksChange,\r\n                    })\r\n                  : nothing\r\n              }\r\n              ${\r\n                props.activePanel === \"files\"\r\n                  ? renderAgentFiles({\r\n                      agentId: selectedAgent.id,\r\n                      agentFilesList: props.agentFilesList,\r\n                      agentFilesLoading: props.agentFilesLoading,\r\n                      agentFilesError: props.agentFilesError,\r\n                      agentFileActive: props.agentFileActive,\r\n                      agentFileContents: props.agentFileContents,\r\n                      agentFileDrafts: props.agentFileDrafts,\r\n                      agentFileSaving: props.agentFileSaving,\r\n                      onLoadFiles: props.onLoadFiles,\r\n                      onSelectFile: props.onSelectFile,\r\n                      onFileDraftChange: props.onFileDraftChange,\r\n                      onFileReset: props.onFileReset,\r\n                      onFileSave: props.onFileSave,\r\n                    })\r\n                  : nothing\r\n              }\r\n              ${\r\n                props.activePanel === \"tools\"\r\n                  ? renderAgentTools({\r\n                      agentId: selectedAgent.id,\r\n                      configForm: props.configForm,\r\n                      configLoading: props.configLoading,\r\n                      configSaving: props.configSaving,\r\n                      configDirty: props.configDirty,\r\n                      onProfileChange: props.onToolsProfileChange,\r\n                      onOverridesChange: props.onToolsOverridesChange,\r\n                      onConfigReload: props.onConfigReload,\r\n                      onConfigSave: props.onConfigSave,\r\n                    })\r\n                  : nothing\r\n              }\r\n              ${\r\n                props.activePanel === \"skills\"\r\n                  ? renderAgentSkills({\r\n                      agentId: selectedAgent.id,\r\n                      report: props.agentSkillsReport,\r\n                      loading: props.agentSkillsLoading,\r\n                      error: props.agentSkillsError,\r\n                      activeAgentId: props.agentSkillsAgentId,\r\n                      configForm: props.configForm,\r\n                      configLoading: props.configLoading,\r\n                      configSaving: props.configSaving,\r\n                      configDirty: props.configDirty,\r\n                      filter: props.skillsFilter,\r\n                      onFilterChange: props.onSkillsFilterChange,\r\n                      onRefresh: props.onSkillsRefresh,\r\n                      onToggle: props.onAgentSkillToggle,\r\n                      onClear: props.onAgentSkillsClear,\r\n                      onDisableAll: props.onAgentSkillsDisableAll,\r\n                      onConfigReload: props.onConfigReload,\r\n                      onConfigSave: props.onConfigSave,\r\n                    })\r\n                  : nothing\r\n              }\r\n              ${\r\n                props.activePanel === \"channels\"\r\n                  ? renderAgentChannels({\r\n                      agent: selectedAgent,\r\n                      defaultId,\r\n                      configForm: props.configForm,\r\n                      agentFilesList: props.agentFilesList,\r\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\r\n                      snapshot: props.channelsSnapshot,\r\n                      loading: props.channelsLoading,\r\n                      error: props.channelsError,\r\n                      lastSuccess: props.channelsLastSuccess,\r\n                      onRefresh: props.onChannelsRefresh,\r\n                    })\r\n                  : nothing\r\n              }\r\n              ${\r\n                props.activePanel === \"cron\"\r\n                  ? renderAgentCron({\r\n                      agent: selectedAgent,\r\n                      defaultId,\r\n                      configForm: props.configForm,\r\n                      agentFilesList: props.agentFilesList,\r\n                      agentIdentity: props.agentIdentityById[selectedAgent.id] ?? null,\r\n                      jobs: props.cronJobs,\r\n                      status: props.cronStatus,\r\n                      loading: props.cronLoading,\r\n                      error: props.cronError,\r\n                      onRefresh: props.onCronRefresh,\r\n                    })\r\n                  : nothing\r\n              }\r\n            `\r\n        }\r\n      </section>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderAgentHeader(\r\n  agent: AgentsListResult[\"agents\"][number],\r\n  defaultId: string | null,\r\n  agentIdentity: AgentIdentityResult | null,\r\n) {\r\n  const badge = agentBadgeText(agent.id, defaultId);\r\n  const displayName = normalizeAgentLabel(agent);\r\n  const subtitle = agent.identity?.theme?.trim() || \"Agent workspace and routing.\";\r\n  const emoji = resolveAgentEmoji(agent, agentIdentity);\r\n  return html`\r\n    <section class=\"card agent-header\">\r\n      <div class=\"agent-header-main\">\r\n        <div class=\"agent-avatar agent-avatar--lg\">\r\n          ${emoji || displayName.slice(0, 1)}\r\n        </div>\r\n        <div>\r\n          <div class=\"card-title\">${displayName}</div>\r\n          <div class=\"card-sub\">${subtitle}</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"agent-header-meta\">\r\n        <div class=\"mono\">${agent.id}</div>\r\n        ${badge ? html`<span class=\"agent-pill\">${badge}</span>` : nothing}\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentTabs(active: AgentsPanel, onSelect: (panel: AgentsPanel) => void) {\r\n  const tabs: Array<{ id: AgentsPanel; label: string }> = [\r\n    { id: \"overview\", label: \"Overview\" },\r\n    { id: \"files\", label: \"Files\" },\r\n    { id: \"tools\", label: \"Tools\" },\r\n    { id: \"skills\", label: \"Skills\" },\r\n    { id: \"channels\", label: \"Channels\" },\r\n    { id: \"cron\", label: \"Cron Jobs\" },\r\n  ];\r\n  return html`\r\n    <div class=\"agent-tabs\">\r\n      ${tabs.map(\r\n        (tab) => html`\r\n          <button\r\n            class=\"agent-tab ${active === tab.id ? \"active\" : \"\"}\"\r\n            type=\"button\"\r\n            @click=${() => onSelect(tab.id)}\r\n          >\r\n            ${tab.label}\r\n          </button>\r\n        `,\r\n      )}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderAgentOverview(params: {\r\n  agent: AgentsListResult[\"agents\"][number];\r\n  defaultId: string | null;\r\n  configForm: Record<string, unknown> | null;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentIdentity: AgentIdentityResult | null;\r\n  agentIdentityLoading: boolean;\r\n  agentIdentityError: string | null;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  configDirty: boolean;\r\n  onConfigReload: () => void;\r\n  onConfigSave: () => void;\r\n  onModelChange: (agentId: string, modelId: string | null) => void;\r\n  onModelFallbacksChange: (agentId: string, fallbacks: string[]) => void;\r\n}) {\r\n  const {\r\n    agent,\r\n    configForm,\r\n    agentFilesList,\r\n    agentIdentity,\r\n    agentIdentityLoading,\r\n    agentIdentityError,\r\n    configLoading,\r\n    configSaving,\r\n    configDirty,\r\n    onConfigReload,\r\n    onConfigSave,\r\n    onModelChange,\r\n    onModelFallbacksChange,\r\n  } = params;\r\n  const config = resolveAgentConfig(configForm, agent.id);\r\n  const workspaceFromFiles =\r\n    agentFilesList && agentFilesList.agentId === agent.id ? agentFilesList.workspace : null;\r\n  const workspace =\r\n    workspaceFromFiles || config.entry?.workspace || config.defaults?.workspace || \"default\";\r\n  const model = config.entry?.model\r\n    ? resolveModelLabel(config.entry?.model)\r\n    : resolveModelLabel(config.defaults?.model);\r\n  const defaultModel = resolveModelLabel(config.defaults?.model);\r\n  const modelPrimary =\r\n    resolveModelPrimary(config.entry?.model) || (model !== \"-\" ? normalizeModelValue(model) : null);\r\n  const defaultPrimary =\r\n    resolveModelPrimary(config.defaults?.model) ||\r\n    (defaultModel !== \"-\" ? normalizeModelValue(defaultModel) : null);\r\n  const effectivePrimary = modelPrimary ?? defaultPrimary ?? null;\r\n  const modelFallbacks = resolveModelFallbacks(config.entry?.model);\r\n  const fallbackText = modelFallbacks ? modelFallbacks.join(\", \") : \"\";\r\n  const identityName =\r\n    agentIdentity?.name?.trim() ||\r\n    agent.identity?.name?.trim() ||\r\n    agent.name?.trim() ||\r\n    config.entry?.name ||\r\n    \"-\";\r\n  const resolvedEmoji = resolveAgentEmoji(agent, agentIdentity);\r\n  const identityEmoji = resolvedEmoji || \"-\";\r\n  const skillFilter = Array.isArray(config.entry?.skills) ? config.entry?.skills : null;\r\n  const skillCount = skillFilter?.length ?? null;\r\n  const identityStatus = agentIdentityLoading\r\n    ? \"Loading…\"\r\n    : agentIdentityError\r\n      ? \"Unavailable\"\r\n      : \"\";\r\n  const isDefault = Boolean(params.defaultId && agent.id === params.defaultId);\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"card-title\">Overview</div>\r\n      <div class=\"card-sub\">Workspace paths and identity metadata.</div>\r\n      <div class=\"agents-overview-grid\" style=\"margin-top: 16px;\">\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Workspace</div>\r\n          <div class=\"mono\">${workspace}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Primary Model</div>\r\n          <div class=\"mono\">${model}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Identity Name</div>\r\n          <div>${identityName}</div>\r\n          ${identityStatus ? html`<div class=\"agent-kv-sub muted\">${identityStatus}</div>` : nothing}\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Default</div>\r\n          <div>${isDefault ? \"yes\" : \"no\"}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Identity Emoji</div>\r\n          <div>${identityEmoji}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Skills Filter</div>\r\n          <div>${skillFilter ? `${skillCount} selected` : \"all skills\"}</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"agent-model-select\" style=\"margin-top: 20px;\">\r\n        <div class=\"label\">Model Selection</div>\r\n        <div class=\"row\" style=\"gap: 12px; flex-wrap: wrap;\">\r\n          <label class=\"field\" style=\"min-width: 260px; flex: 1;\">\r\n            <span>Primary model${isDefault ? \" (default)\" : \"\"}</span>\r\n            <select\r\n              .value=${effectivePrimary ?? \"\"}\r\n              ?disabled=${!configForm || configLoading || configSaving}\r\n              @change=${(e: Event) =>\r\n                onModelChange(agent.id, (e.target as HTMLSelectElement).value || null)}\r\n            >\r\n              ${\r\n                isDefault\r\n                  ? nothing\r\n                  : html`\r\n                      <option value=\"\">\r\n                        ${\r\n                          defaultPrimary ? `Inherit default (${defaultPrimary})` : \"Inherit default\"\r\n                        }\r\n                      </option>\r\n                    `\r\n              }\r\n              ${buildModelOptions(configForm, effectivePrimary ?? undefined)}\r\n            </select>\r\n          </label>\r\n          <label class=\"field\" style=\"min-width: 260px; flex: 1;\">\r\n            <span>Fallbacks (comma-separated)</span>\r\n            <input\r\n              .value=${fallbackText}\r\n              ?disabled=${!configForm || configLoading || configSaving}\r\n              placeholder=\"provider/model, provider/model\"\r\n              @input=${(e: Event) =>\r\n                onModelFallbacksChange(\r\n                  agent.id,\r\n                  parseFallbackList((e.target as HTMLInputElement).value),\r\n                )}\r\n            />\r\n          </label>\r\n        </div>\r\n        <div class=\"row\" style=\"justify-content: flex-end; gap: 8px;\">\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${configLoading}\r\n            @click=${onConfigReload}\r\n          >\r\n            Reload Config\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm primary\"\r\n            ?disabled=${configSaving || !configDirty}\r\n            @click=${onConfigSave}\r\n          >\r\n            ${configSaving ? \"Saving…\" : \"Save\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentContextCard(context: AgentContext, subtitle: string) {\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"card-title\">Agent Context</div>\r\n      <div class=\"card-sub\">${subtitle}</div>\r\n      <div class=\"agents-overview-grid\" style=\"margin-top: 16px;\">\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Workspace</div>\r\n          <div class=\"mono\">${context.workspace}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Primary Model</div>\r\n          <div class=\"mono\">${context.model}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Identity Name</div>\r\n          <div>${context.identityName}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Identity Emoji</div>\r\n          <div>${context.identityEmoji}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Skills Filter</div>\r\n          <div>${context.skillsLabel}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Default</div>\r\n          <div>${context.isDefault ? \"yes\" : \"no\"}</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\ntype ChannelSummaryEntry = {\r\n  id: string;\r\n  label: string;\r\n  accounts: ChannelAccountSnapshot[];\r\n};\r\n\r\nfunction resolveChannelLabel(snapshot: ChannelsStatusSnapshot, id: string) {\r\n  const meta = snapshot.channelMeta?.find((entry) => entry.id === id);\r\n  if (meta?.label) {\r\n    return meta.label;\r\n  }\r\n  return snapshot.channelLabels?.[id] ?? id;\r\n}\r\n\r\nfunction resolveChannelEntries(snapshot: ChannelsStatusSnapshot | null): ChannelSummaryEntry[] {\r\n  if (!snapshot) {\r\n    return [];\r\n  }\r\n  const ids = new Set<string>();\r\n  for (const id of snapshot.channelOrder ?? []) {\r\n    ids.add(id);\r\n  }\r\n  for (const entry of snapshot.channelMeta ?? []) {\r\n    ids.add(entry.id);\r\n  }\r\n  for (const id of Object.keys(snapshot.channelAccounts ?? {})) {\r\n    ids.add(id);\r\n  }\r\n  const ordered: string[] = [];\r\n  const seed = snapshot.channelOrder?.length ? snapshot.channelOrder : Array.from(ids);\r\n  for (const id of seed) {\r\n    if (!ids.has(id)) {\r\n      continue;\r\n    }\r\n    ordered.push(id);\r\n    ids.delete(id);\r\n  }\r\n  for (const id of ids) {\r\n    ordered.push(id);\r\n  }\r\n  return ordered.map((id) => ({\r\n    id,\r\n    label: resolveChannelLabel(snapshot, id),\r\n    accounts: snapshot.channelAccounts?.[id] ?? [],\r\n  }));\r\n}\r\n\r\nconst CHANNEL_EXTRA_FIELDS = [\"groupPolicy\", \"streamMode\", \"dmPolicy\"] as const;\r\n\r\nfunction resolveChannelConfigValue(\r\n  configForm: Record<string, unknown> | null,\r\n  channelId: string,\r\n): Record<string, unknown> | null {\r\n  if (!configForm) {\r\n    return null;\r\n  }\r\n  const channels = (configForm.channels ?? {}) as Record<string, unknown>;\r\n  const fromChannels = channels[channelId];\r\n  if (fromChannels && typeof fromChannels === \"object\") {\r\n    return fromChannels as Record<string, unknown>;\r\n  }\r\n  const fallback = configForm[channelId];\r\n  if (fallback && typeof fallback === \"object\") {\r\n    return fallback as Record<string, unknown>;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction formatChannelExtraValue(raw: unknown): string {\r\n  if (raw == null) {\r\n    return \"n/a\";\r\n  }\r\n  if (typeof raw === \"string\" || typeof raw === \"number\" || typeof raw === \"boolean\") {\r\n    return String(raw);\r\n  }\r\n  try {\r\n    return JSON.stringify(raw);\r\n  } catch {\r\n    return \"n/a\";\r\n  }\r\n}\r\n\r\nfunction resolveChannelExtras(\r\n  configForm: Record<string, unknown> | null,\r\n  channelId: string,\r\n): Array<{ label: string; value: string }> {\r\n  const value = resolveChannelConfigValue(configForm, channelId);\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  return CHANNEL_EXTRA_FIELDS.flatMap((field) => {\r\n    if (!(field in value)) {\r\n      return [];\r\n    }\r\n    return [{ label: field, value: formatChannelExtraValue(value[field]) }];\r\n  });\r\n}\r\n\r\nfunction summarizeChannelAccounts(accounts: ChannelAccountSnapshot[]) {\r\n  let connected = 0;\r\n  let configured = 0;\r\n  let enabled = 0;\r\n  for (const account of accounts) {\r\n    const probeOk =\r\n      account.probe && typeof account.probe === \"object\" && \"ok\" in account.probe\r\n        ? Boolean((account.probe as { ok?: unknown }).ok)\r\n        : false;\r\n    const isConnected = account.connected === true || account.running === true || probeOk;\r\n    if (isConnected) {\r\n      connected += 1;\r\n    }\r\n    if (account.configured) {\r\n      configured += 1;\r\n    }\r\n    if (account.enabled) {\r\n      enabled += 1;\r\n    }\r\n  }\r\n  return {\r\n    total: accounts.length,\r\n    connected,\r\n    configured,\r\n    enabled,\r\n  };\r\n}\r\n\r\nfunction renderAgentChannels(params: {\r\n  agent: AgentsListResult[\"agents\"][number];\r\n  defaultId: string | null;\r\n  configForm: Record<string, unknown> | null;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentIdentity: AgentIdentityResult | null;\r\n  snapshot: ChannelsStatusSnapshot | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  lastSuccess: number | null;\r\n  onRefresh: () => void;\r\n}) {\r\n  const context = buildAgentContext(\r\n    params.agent,\r\n    params.configForm,\r\n    params.agentFilesList,\r\n    params.defaultId,\r\n    params.agentIdentity,\r\n  );\r\n  const entries = resolveChannelEntries(params.snapshot);\r\n  const lastSuccessLabel = params.lastSuccess\r\n    ? formatRelativeTimestamp(params.lastSuccess)\r\n    : \"never\";\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      ${renderAgentContextCard(context, \"Workspace, identity, and model configuration.\")}\r\n      <section class=\"card\">\r\n        <div class=\"row\" style=\"justify-content: space-between;\">\r\n          <div>\r\n            <div class=\"card-title\">Channels</div>\r\n            <div class=\"card-sub\">Gateway-wide channel status snapshot.</div>\r\n          </div>\r\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\r\n            ${params.loading ? \"Refreshing…\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n        <div class=\"muted\" style=\"margin-top: 8px;\">\r\n          Last refresh: ${lastSuccessLabel}\r\n        </div>\r\n        ${\r\n          params.error\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\r\n            : nothing\r\n        }\r\n        ${\r\n          !params.snapshot\r\n            ? html`\r\n                <div class=\"callout info\" style=\"margin-top: 12px\">Load channels to see live status.</div>\r\n              `\r\n            : nothing\r\n        }\r\n        ${\r\n          entries.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"margin-top: 16px\">No channels found.</div>\r\n              `\r\n            : html`\r\n              <div class=\"list\" style=\"margin-top: 16px;\">\r\n                ${entries.map((entry) => {\r\n                  const summary = summarizeChannelAccounts(entry.accounts);\r\n                  const status = summary.total\r\n                    ? `${summary.connected}/${summary.total} connected`\r\n                    : \"no accounts\";\r\n                  const config = summary.configured\r\n                    ? `${summary.configured} configured`\r\n                    : \"not configured\";\r\n                  const enabled = summary.total ? `${summary.enabled} enabled` : \"disabled\";\r\n                  const extras = resolveChannelExtras(params.configForm, entry.id);\r\n                  return html`\r\n                    <div class=\"list-item\">\r\n                      <div class=\"list-main\">\r\n                        <div class=\"list-title\">${entry.label}</div>\r\n                        <div class=\"list-sub mono\">${entry.id}</div>\r\n                      </div>\r\n                      <div class=\"list-meta\">\r\n                        <div>${status}</div>\r\n                        <div>${config}</div>\r\n                        <div>${enabled}</div>\r\n                        ${\r\n                          extras.length > 0\r\n                            ? extras.map((extra) => html`<div>${extra.label}: ${extra.value}</div>`)\r\n                            : nothing\r\n                        }\r\n                      </div>\r\n                    </div>\r\n                  `;\r\n                })}\r\n              </div>\r\n            `\r\n        }\r\n      </section>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentCron(params: {\r\n  agent: AgentsListResult[\"agents\"][number];\r\n  defaultId: string | null;\r\n  configForm: Record<string, unknown> | null;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentIdentity: AgentIdentityResult | null;\r\n  jobs: CronJob[];\r\n  status: CronStatus | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  onRefresh: () => void;\r\n}) {\r\n  const context = buildAgentContext(\r\n    params.agent,\r\n    params.configForm,\r\n    params.agentFilesList,\r\n    params.defaultId,\r\n    params.agentIdentity,\r\n  );\r\n  const jobs = params.jobs.filter((job) => job.agentId === params.agent.id);\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      ${renderAgentContextCard(context, \"Workspace and scheduling targets.\")}\r\n      <section class=\"card\">\r\n        <div class=\"row\" style=\"justify-content: space-between;\">\r\n          <div>\r\n            <div class=\"card-title\">Scheduler</div>\r\n            <div class=\"card-sub\">Gateway cron status.</div>\r\n          </div>\r\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\r\n            ${params.loading ? \"Refreshing…\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Enabled</div>\r\n            <div class=\"stat-value\">\r\n              ${params.status ? (params.status.enabled ? \"Yes\" : \"No\") : \"n/a\"}\r\n            </div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Jobs</div>\r\n            <div class=\"stat-value\">${params.status?.jobs ?? \"n/a\"}</div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Next wake</div>\r\n            <div class=\"stat-value\">${formatNextRun(params.status?.nextWakeAtMs ?? null)}</div>\r\n          </div>\r\n        </div>\r\n        ${\r\n          params.error\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\r\n            : nothing\r\n        }\r\n      </section>\r\n    </section>\r\n    <section class=\"card\">\r\n      <div class=\"card-title\">Agent Cron Jobs</div>\r\n      <div class=\"card-sub\">Scheduled jobs targeting this agent.</div>\r\n      ${\r\n        jobs.length === 0\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 16px\">No jobs assigned.</div>\r\n            `\r\n          : html`\r\n              <div class=\"list\" style=\"margin-top: 16px;\">\r\n                ${jobs.map(\r\n                  (job) => html`\r\n                  <div class=\"list-item\">\r\n                    <div class=\"list-main\">\r\n                      <div class=\"list-title\">${job.name}</div>\r\n                      ${job.description ? html`<div class=\"list-sub\">${job.description}</div>` : nothing}\r\n                      <div class=\"chip-row\" style=\"margin-top: 6px;\">\r\n                        <span class=\"chip\">${formatCronSchedule(job)}</span>\r\n                        <span class=\"chip ${job.enabled ? \"chip-ok\" : \"chip-warn\"}\">\r\n                          ${job.enabled ? \"enabled\" : \"disabled\"}\r\n                        </span>\r\n                        <span class=\"chip\">${job.sessionTarget}</span>\r\n                      </div>\r\n                    </div>\r\n                    <div class=\"list-meta\">\r\n                      <div class=\"mono\">${formatCronState(job)}</div>\r\n                      <div class=\"muted\">${formatCronPayload(job)}</div>\r\n                    </div>\r\n                  </div>\r\n                `,\r\n                )}\r\n              </div>\r\n            `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentFiles(params: {\r\n  agentId: string;\r\n  agentFilesList: AgentsFilesListResult | null;\r\n  agentFilesLoading: boolean;\r\n  agentFilesError: string | null;\r\n  agentFileActive: string | null;\r\n  agentFileContents: Record<string, string>;\r\n  agentFileDrafts: Record<string, string>;\r\n  agentFileSaving: boolean;\r\n  onLoadFiles: (agentId: string) => void;\r\n  onSelectFile: (name: string) => void;\r\n  onFileDraftChange: (name: string, content: string) => void;\r\n  onFileReset: (name: string) => void;\r\n  onFileSave: (name: string) => void;\r\n}) {\r\n  const list = params.agentFilesList?.agentId === params.agentId ? params.agentFilesList : null;\r\n  const files = list?.files ?? [];\r\n  const active = params.agentFileActive ?? null;\r\n  const activeEntry = active ? (files.find((file) => file.name === active) ?? null) : null;\r\n  const baseContent = active ? (params.agentFileContents[active] ?? \"\") : \"\";\r\n  const draft = active ? (params.agentFileDrafts[active] ?? baseContent) : \"\";\r\n  const isDirty = active ? draft !== baseContent : false;\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Core Files</div>\r\n          <div class=\"card-sub\">Bootstrap persona, identity, and tool guidance.</div>\r\n        </div>\r\n        <button\r\n          class=\"btn btn--sm\"\r\n          ?disabled=${params.agentFilesLoading}\r\n          @click=${() => params.onLoadFiles(params.agentId)}\r\n        >\r\n          ${params.agentFilesLoading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n      ${list ? html`<div class=\"muted mono\" style=\"margin-top: 8px;\">Workspace: ${list.workspace}</div>` : nothing}\r\n      ${\r\n        params.agentFilesError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${\r\n              params.agentFilesError\r\n            }</div>`\r\n          : nothing\r\n      }\r\n      ${\r\n        !list\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                Load the agent workspace files to edit core instructions.\r\n              </div>\r\n            `\r\n          : html`\r\n              <div class=\"agent-files-grid\" style=\"margin-top: 16px;\">\r\n                <div class=\"agent-files-list\">\r\n                  ${\r\n                    files.length === 0\r\n                      ? html`\r\n                          <div class=\"muted\">No files found.</div>\r\n                        `\r\n                      : files.map((file) =>\r\n                          renderAgentFileRow(file, active, () => params.onSelectFile(file.name)),\r\n                        )\r\n                  }\r\n                </div>\r\n                <div class=\"agent-files-editor\">\r\n                  ${\r\n                    !activeEntry\r\n                      ? html`\r\n                          <div class=\"muted\">Select a file to edit.</div>\r\n                        `\r\n                      : html`\r\n                          <div class=\"agent-file-header\">\r\n                            <div>\r\n                              <div class=\"agent-file-title mono\">${activeEntry.name}</div>\r\n                              <div class=\"agent-file-sub mono\">${activeEntry.path}</div>\r\n                            </div>\r\n                            <div class=\"agent-file-actions\">\r\n                              <button\r\n                                class=\"btn btn--sm\"\r\n                                ?disabled=${!isDirty}\r\n                                @click=${() => params.onFileReset(activeEntry.name)}\r\n                              >\r\n                                Reset\r\n                              </button>\r\n                              <button\r\n                                class=\"btn btn--sm primary\"\r\n                                ?disabled=${params.agentFileSaving || !isDirty}\r\n                                @click=${() => params.onFileSave(activeEntry.name)}\r\n                              >\r\n                                ${params.agentFileSaving ? \"Saving…\" : \"Save\"}\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          ${\r\n                            activeEntry.missing\r\n                              ? html`\r\n                                  <div class=\"callout info\" style=\"margin-top: 10px\">\r\n                                    This file is missing. Saving will create it in the agent workspace.\r\n                                  </div>\r\n                                `\r\n                              : nothing\r\n                          }\r\n                          <label class=\"field\" style=\"margin-top: 12px;\">\r\n                            <span>Content</span>\r\n                            <textarea\r\n                              .value=${draft}\r\n                              @input=${(e: Event) =>\r\n                                params.onFileDraftChange(\r\n                                  activeEntry.name,\r\n                                  (e.target as HTMLTextAreaElement).value,\r\n                                )}\r\n                            ></textarea>\r\n                          </label>\r\n                        `\r\n                  }\r\n                </div>\r\n              </div>\r\n            `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentFileRow(file: AgentFileEntry, active: string | null, onSelect: () => void) {\r\n  const status = file.missing\r\n    ? \"Missing\"\r\n    : `${formatBytes(file.size)} · ${formatRelativeTimestamp(file.updatedAtMs ?? null)}`;\r\n  return html`\r\n    <button\r\n      type=\"button\"\r\n      class=\"agent-file-row ${active === file.name ? \"active\" : \"\"}\"\r\n      @click=${onSelect}\r\n    >\r\n      <div>\r\n        <div class=\"agent-file-name mono\">${file.name}</div>\r\n        <div class=\"agent-file-meta\">${status}</div>\r\n      </div>\r\n      ${\r\n        file.missing\r\n          ? html`\r\n              <span class=\"agent-pill warn\">missing</span>\r\n            `\r\n          : nothing\r\n      }\r\n    </button>\r\n  `;\r\n}\r\n\r\nfunction renderAgentTools(params: {\r\n  agentId: string;\r\n  configForm: Record<string, unknown> | null;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  configDirty: boolean;\r\n  onProfileChange: (agentId: string, profile: string | null, clearAllow: boolean) => void;\r\n  onOverridesChange: (agentId: string, alsoAllow: string[], deny: string[]) => void;\r\n  onConfigReload: () => void;\r\n  onConfigSave: () => void;\r\n}) {\r\n  const config = resolveAgentConfig(params.configForm, params.agentId);\r\n  const agentTools = config.entry?.tools ?? {};\r\n  const globalTools = config.globalTools ?? {};\r\n  const profile = agentTools.profile ?? globalTools.profile ?? \"full\";\r\n  const profileSource = agentTools.profile\r\n    ? \"agent override\"\r\n    : globalTools.profile\r\n      ? \"global default\"\r\n      : \"default\";\r\n  const hasAgentAllow = Array.isArray(agentTools.allow) && agentTools.allow.length > 0;\r\n  const hasGlobalAllow = Array.isArray(globalTools.allow) && globalTools.allow.length > 0;\r\n  const editable =\r\n    Boolean(params.configForm) && !params.configLoading && !params.configSaving && !hasAgentAllow;\r\n  const alsoAllow = hasAgentAllow\r\n    ? []\r\n    : Array.isArray(agentTools.alsoAllow)\r\n      ? agentTools.alsoAllow\r\n      : [];\r\n  const deny = hasAgentAllow ? [] : Array.isArray(agentTools.deny) ? agentTools.deny : [];\r\n  const basePolicy = hasAgentAllow\r\n    ? { allow: agentTools.allow ?? [], deny: agentTools.deny ?? [] }\r\n    : (resolveToolProfilePolicy(profile) ?? undefined);\r\n  const toolIds = TOOL_SECTIONS.flatMap((section) => section.tools.map((tool) => tool.id));\r\n\r\n  const resolveAllowed = (toolId: string) => {\r\n    const baseAllowed = isAllowedByPolicy(toolId, basePolicy);\r\n    const extraAllowed = matchesList(toolId, alsoAllow);\r\n    const denied = matchesList(toolId, deny);\r\n    const allowed = (baseAllowed || extraAllowed) && !denied;\r\n    return {\r\n      allowed,\r\n      baseAllowed,\r\n      denied,\r\n    };\r\n  };\r\n  const enabledCount = toolIds.filter((toolId) => resolveAllowed(toolId).allowed).length;\r\n\r\n  const updateTool = (toolId: string, nextEnabled: boolean) => {\r\n    const nextAllow = new Set(\r\n      alsoAllow.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\r\n    );\r\n    const nextDeny = new Set(\r\n      deny.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\r\n    );\r\n    const baseAllowed = resolveAllowed(toolId).baseAllowed;\r\n    const normalized = normalizeToolName(toolId);\r\n    if (nextEnabled) {\r\n      nextDeny.delete(normalized);\r\n      if (!baseAllowed) {\r\n        nextAllow.add(normalized);\r\n      }\r\n    } else {\r\n      nextAllow.delete(normalized);\r\n      nextDeny.add(normalized);\r\n    }\r\n    params.onOverridesChange(params.agentId, [...nextAllow], [...nextDeny]);\r\n  };\r\n\r\n  const updateAll = (nextEnabled: boolean) => {\r\n    const nextAllow = new Set(\r\n      alsoAllow.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\r\n    );\r\n    const nextDeny = new Set(\r\n      deny.map((entry) => normalizeToolName(entry)).filter((entry) => entry.length > 0),\r\n    );\r\n    for (const toolId of toolIds) {\r\n      const baseAllowed = resolveAllowed(toolId).baseAllowed;\r\n      const normalized = normalizeToolName(toolId);\r\n      if (nextEnabled) {\r\n        nextDeny.delete(normalized);\r\n        if (!baseAllowed) {\r\n          nextAllow.add(normalized);\r\n        }\r\n      } else {\r\n        nextAllow.delete(normalized);\r\n        nextDeny.add(normalized);\r\n      }\r\n    }\r\n    params.onOverridesChange(params.agentId, [...nextAllow], [...nextDeny]);\r\n  };\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Tool Access</div>\r\n          <div class=\"card-sub\">\r\n            Profile + per-tool overrides for this agent.\r\n            <span class=\"mono\">${enabledCount}/${toolIds.length}</span> enabled.\r\n          </div>\r\n        </div>\r\n        <div class=\"row\" style=\"gap: 8px;\">\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${!editable}\r\n            @click=${() => updateAll(true)}\r\n          >\r\n            Enable All\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${!editable}\r\n            @click=${() => updateAll(false)}\r\n          >\r\n            Disable All\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${params.configLoading}\r\n            @click=${params.onConfigReload}\r\n          >\r\n            Reload Config\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm primary\"\r\n            ?disabled=${params.configSaving || !params.configDirty}\r\n            @click=${params.onConfigSave}\r\n          >\r\n            ${params.configSaving ? \"Saving…\" : \"Save\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        !params.configForm\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                Load the gateway config to adjust tool profiles.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        hasAgentAllow\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                This agent is using an explicit allowlist in config. Tool overrides are managed in the Config tab.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        hasGlobalAllow\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                Global tools.allow is set. Agent overrides cannot enable tools that are globally blocked.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"agent-tools-meta\" style=\"margin-top: 16px;\">\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Profile</div>\r\n          <div class=\"mono\">${profile}</div>\r\n        </div>\r\n        <div class=\"agent-kv\">\r\n          <div class=\"label\">Source</div>\r\n          <div>${profileSource}</div>\r\n        </div>\r\n        ${\r\n          params.configDirty\r\n            ? html`\r\n                <div class=\"agent-kv\">\r\n                  <div class=\"label\">Status</div>\r\n                  <div class=\"mono\">unsaved</div>\r\n                </div>\r\n              `\r\n            : nothing\r\n        }\r\n      </div>\r\n\r\n      <div class=\"agent-tools-presets\" style=\"margin-top: 16px;\">\r\n        <div class=\"label\">Quick Presets</div>\r\n        <div class=\"agent-tools-buttons\">\r\n          ${PROFILE_OPTIONS.map(\r\n            (option) => html`\r\n              <button\r\n                class=\"btn btn--sm ${profile === option.id ? \"active\" : \"\"}\"\r\n                ?disabled=${!editable}\r\n                @click=${() => params.onProfileChange(params.agentId, option.id, true)}\r\n              >\r\n                ${option.label}\r\n              </button>\r\n            `,\r\n          )}\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${!editable}\r\n            @click=${() => params.onProfileChange(params.agentId, null, false)}\r\n          >\r\n            Inherit\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"agent-tools-grid\" style=\"margin-top: 20px;\">\r\n        ${TOOL_SECTIONS.map(\r\n          (section) =>\r\n            html`\r\n            <div class=\"agent-tools-section\">\r\n              <div class=\"agent-tools-header\">${section.label}</div>\r\n              <div class=\"agent-tools-list\">\r\n                ${section.tools.map((tool) => {\r\n                  const { allowed } = resolveAllowed(tool.id);\r\n                  return html`\r\n                    <div class=\"agent-tool-row\">\r\n                      <div>\r\n                        <div class=\"agent-tool-title mono\">${tool.label}</div>\r\n                        <div class=\"agent-tool-sub\">${tool.description}</div>\r\n                      </div>\r\n                      <label class=\"cfg-toggle\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          .checked=${allowed}\r\n                          ?disabled=${!editable}\r\n                          @change=${(e: Event) =>\r\n                            updateTool(tool.id, (e.target as HTMLInputElement).checked)}\r\n                        />\r\n                        <span class=\"cfg-toggle__track\"></span>\r\n                      </label>\r\n                    </div>\r\n                  `;\r\n                })}\r\n              </div>\r\n            </div>\r\n          `,\r\n        )}\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\ntype SkillGroup = {\r\n  id: string;\r\n  label: string;\r\n  skills: SkillStatusEntry[];\r\n};\r\n\r\nconst SKILL_SOURCE_GROUPS: Array<{ id: string; label: string; sources: string[] }> = [\r\n  { id: \"workspace\", label: \"Workspace Skills\", sources: [\"openclaw-workspace\"] },\r\n  { id: \"built-in\", label: \"Built-in Skills\", sources: [\"openclaw-bundled\"] },\r\n  { id: \"installed\", label: \"Installed Skills\", sources: [\"openclaw-managed\"] },\r\n  { id: \"extra\", label: \"Extra Skills\", sources: [\"openclaw-extra\"] },\r\n];\r\n\r\nfunction groupSkills(skills: SkillStatusEntry[]): SkillGroup[] {\r\n  const groups = new Map<string, SkillGroup>();\r\n  for (const def of SKILL_SOURCE_GROUPS) {\r\n    groups.set(def.id, { id: def.id, label: def.label, skills: [] });\r\n  }\r\n  const builtInGroup = SKILL_SOURCE_GROUPS.find((group) => group.id === \"built-in\");\r\n  const other: SkillGroup = { id: \"other\", label: \"Other Skills\", skills: [] };\r\n  for (const skill of skills) {\r\n    const match = skill.bundled\r\n      ? builtInGroup\r\n      : SKILL_SOURCE_GROUPS.find((group) => group.sources.includes(skill.source));\r\n    if (match) {\r\n      groups.get(match.id)?.skills.push(skill);\r\n    } else {\r\n      other.skills.push(skill);\r\n    }\r\n  }\r\n  const ordered = SKILL_SOURCE_GROUPS.map((group) => groups.get(group.id)).filter(\r\n    (group): group is SkillGroup => Boolean(group && group.skills.length > 0),\r\n  );\r\n  if (other.skills.length > 0) {\r\n    ordered.push(other);\r\n  }\r\n  return ordered;\r\n}\r\n\r\nfunction renderAgentSkills(params: {\r\n  agentId: string;\r\n  report: SkillStatusReport | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  activeAgentId: string | null;\r\n  configForm: Record<string, unknown> | null;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  configDirty: boolean;\r\n  filter: string;\r\n  onFilterChange: (next: string) => void;\r\n  onRefresh: () => void;\r\n  onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\r\n  onClear: (agentId: string) => void;\r\n  onDisableAll: (agentId: string) => void;\r\n  onConfigReload: () => void;\r\n  onConfigSave: () => void;\r\n}) {\r\n  const editable = Boolean(params.configForm) && !params.configLoading && !params.configSaving;\r\n  const config = resolveAgentConfig(params.configForm, params.agentId);\r\n  const allowlist = Array.isArray(config.entry?.skills) ? config.entry?.skills : undefined;\r\n  const allowSet = new Set((allowlist ?? []).map((name) => name.trim()).filter(Boolean));\r\n  const usingAllowlist = allowlist !== undefined;\r\n  const reportReady = Boolean(params.report && params.activeAgentId === params.agentId);\r\n  const rawSkills = reportReady ? (params.report?.skills ?? []) : [];\r\n  const filter = params.filter.trim().toLowerCase();\r\n  const filtered = filter\r\n    ? rawSkills.filter((skill) =>\r\n        [skill.name, skill.description, skill.source].join(\" \").toLowerCase().includes(filter),\r\n      )\r\n    : rawSkills;\r\n  const groups = groupSkills(filtered);\r\n  const enabledCount = usingAllowlist\r\n    ? rawSkills.filter((skill) => allowSet.has(skill.name)).length\r\n    : rawSkills.length;\r\n  const totalCount = rawSkills.length;\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Skills</div>\r\n          <div class=\"card-sub\">\r\n            Per-agent skill allowlist and workspace skills.\r\n            ${totalCount > 0 ? html`<span class=\"mono\">${enabledCount}/${totalCount}</span>` : nothing}\r\n          </div>\r\n        </div>\r\n        <div class=\"row\" style=\"gap: 8px;\">\r\n          <button class=\"btn btn--sm\" ?disabled=${!editable} @click=${() => params.onClear(params.agentId)}>\r\n            Use All\r\n          </button>\r\n          <button class=\"btn btn--sm\" ?disabled=${!editable} @click=${() => params.onDisableAll(params.agentId)}>\r\n            Disable All\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm\"\r\n            ?disabled=${params.configLoading}\r\n            @click=${params.onConfigReload}\r\n          >\r\n            Reload Config\r\n          </button>\r\n          <button class=\"btn btn--sm\" ?disabled=${params.loading} @click=${params.onRefresh}>\r\n            ${params.loading ? \"Loading…\" : \"Refresh\"}\r\n          </button>\r\n          <button\r\n            class=\"btn btn--sm primary\"\r\n            ?disabled=${params.configSaving || !params.configDirty}\r\n            @click=${params.onConfigSave}\r\n          >\r\n            ${params.configSaving ? \"Saving…\" : \"Save\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        !params.configForm\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                Load the gateway config to set per-agent skills.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        usingAllowlist\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">This agent uses a custom skill allowlist.</div>\r\n            `\r\n          : html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                All skills are enabled. Disabling any skill will create a per-agent allowlist.\r\n              </div>\r\n            `\r\n      }\r\n      ${\r\n        !reportReady && !params.loading\r\n          ? html`\r\n              <div class=\"callout info\" style=\"margin-top: 12px\">\r\n                Load skills for this agent to view workspace-specific entries.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        params.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${params.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"filters\" style=\"margin-top: 14px;\">\r\n        <label class=\"field\" style=\"flex: 1;\">\r\n          <span>Filter</span>\r\n          <input\r\n            .value=${params.filter}\r\n            @input=${(e: Event) => params.onFilterChange((e.target as HTMLInputElement).value)}\r\n            placeholder=\"Search skills\"\r\n          />\r\n        </label>\r\n        <div class=\"muted\">${filtered.length} shown</div>\r\n      </div>\r\n\r\n      ${\r\n        filtered.length === 0\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 16px\">No skills found.</div>\r\n            `\r\n          : html`\r\n              <div class=\"agent-skills-groups\" style=\"margin-top: 16px;\">\r\n                ${groups.map((group) =>\r\n                  renderAgentSkillGroup(group, {\r\n                    agentId: params.agentId,\r\n                    allowSet,\r\n                    usingAllowlist,\r\n                    editable,\r\n                    onToggle: params.onToggle,\r\n                  }),\r\n                )}\r\n              </div>\r\n            `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderAgentSkillGroup(\r\n  group: SkillGroup,\r\n  params: {\r\n    agentId: string;\r\n    allowSet: Set<string>;\r\n    usingAllowlist: boolean;\r\n    editable: boolean;\r\n    onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\r\n  },\r\n) {\r\n  const collapsedByDefault = group.id === \"workspace\" || group.id === \"built-in\";\r\n  return html`\r\n    <details class=\"agent-skills-group\" ?open=${!collapsedByDefault}>\r\n      <summary class=\"agent-skills-header\">\r\n        <span>${group.label}</span>\r\n        <span class=\"muted\">${group.skills.length}</span>\r\n      </summary>\r\n      <div class=\"list skills-grid\">\r\n        ${group.skills.map((skill) =>\r\n          renderAgentSkillRow(skill, {\r\n            agentId: params.agentId,\r\n            allowSet: params.allowSet,\r\n            usingAllowlist: params.usingAllowlist,\r\n            editable: params.editable,\r\n            onToggle: params.onToggle,\r\n          }),\r\n        )}\r\n      </div>\r\n    </details>\r\n  `;\r\n}\r\n\r\nfunction renderAgentSkillRow(\r\n  skill: SkillStatusEntry,\r\n  params: {\r\n    agentId: string;\r\n    allowSet: Set<string>;\r\n    usingAllowlist: boolean;\r\n    editable: boolean;\r\n    onToggle: (agentId: string, skillName: string, enabled: boolean) => void;\r\n  },\r\n) {\r\n  const enabled = params.usingAllowlist ? params.allowSet.has(skill.name) : true;\r\n  const missing = [\r\n    ...skill.missing.bins.map((b) => `bin:${b}`),\r\n    ...skill.missing.env.map((e) => `env:${e}`),\r\n    ...skill.missing.config.map((c) => `config:${c}`),\r\n    ...skill.missing.os.map((o) => `os:${o}`),\r\n  ];\r\n  const reasons: string[] = [];\r\n  if (skill.disabled) {\r\n    reasons.push(\"disabled\");\r\n  }\r\n  if (skill.blockedByAllowlist) {\r\n    reasons.push(\"blocked by allowlist\");\r\n  }\r\n  return html`\r\n    <div class=\"list-item agent-skill-row\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">\r\n          ${skill.emoji ? `${skill.emoji} ` : \"\"}${skill.name}\r\n        </div>\r\n        <div class=\"list-sub\">${skill.description}</div>\r\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\r\n          <span class=\"chip\">${skill.source}</span>\r\n          <span class=\"chip ${skill.eligible ? \"chip-ok\" : \"chip-warn\"}\">\r\n            ${skill.eligible ? \"eligible\" : \"blocked\"}\r\n          </span>\r\n          ${\r\n            skill.disabled\r\n              ? html`\r\n                  <span class=\"chip chip-warn\">disabled</span>\r\n                `\r\n              : nothing\r\n          }\r\n        </div>\r\n        ${\r\n          missing.length > 0\r\n            ? html`<div class=\"muted\" style=\"margin-top: 6px;\">Missing: ${missing.join(\", \")}</div>`\r\n            : nothing\r\n        }\r\n        ${\r\n          reasons.length > 0\r\n            ? html`<div class=\"muted\" style=\"margin-top: 6px;\">Reason: ${reasons.join(\", \")}</div>`\r\n            : nothing\r\n        }\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <label class=\"cfg-toggle\">\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${enabled}\r\n            ?disabled=${!params.editable}\r\n            @change=${(e: Event) =>\r\n              params.onToggle(params.agentId, skill.name, (e.target as HTMLInputElement).checked)}\r\n          />\r\n          <span class=\"cfg-toggle__track\"></span>\r\n        </label>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing, type TemplateResult } from \"lit\";\r\nimport type { ConfigUiHints } from \"../types.ts\";\r\nimport {\r\n  defaultValue,\r\n  hintForPath,\r\n  humanize,\r\n  pathKey,\r\n  schemaType,\r\n  type JsonSchema,\r\n} from \"./config-form.shared.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nconst META_KEYS = new Set([\"title\", \"description\", \"default\", \"nullable\"]);\r\n\r\nfunction isAnySchema(schema: JsonSchema): boolean {\r\n  const keys = Object.keys(schema ?? {}).filter((key) => !META_KEYS.has(key));\r\n  return keys.length === 0;\r\n}\r\n\r\nfunction jsonValue(value: unknown): string {\r\n  if (value === undefined) {\r\n    return \"\";\r\n  }\r\n  try {\r\n    return JSON.stringify(value, null, 2) ?? \"\";\r\n  } catch {\r\n    return \"\";\r\n  }\r\n}\r\n\r\n// SVG Icons as template literals\r\nconst icons = {\r\n  chevronDown: html`\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n    </svg>\r\n  `,\r\n  plus: html`\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\r\n      <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n    </svg>\r\n  `,\r\n  minus: html`\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n    </svg>\r\n  `,\r\n  trash: html`\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <polyline points=\"3 6 5 6 21 6\"></polyline>\r\n      <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path>\r\n    </svg>\r\n  `,\r\n  edit: html`\r\n    <svg\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\r\n      <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\r\n    </svg>\r\n  `,\r\n};\r\n\r\nexport function renderNode(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  unsupported: Set<string>;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult | typeof nothing {\r\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\r\n  const showLabel = params.showLabel ?? true;\r\n  const type = schemaType(schema);\r\n  const hint = hintForPath(path, hints);\r\n  const rawLabel = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const label = T(rawLabel);\r\n  const help = T(hint?.help ?? schema.description ?? \"\");\r\n  const key = pathKey(path);\r\n\r\n  if (unsupported.has(key)) {\r\n    return html`<div class=\"cfg-field cfg-field--error\">\r\n      <div class=\"cfg-field__label\">${label}</div>\r\n      <div class=\"cfg-field__error\">${T(\"Unsupported schema node. Use Raw mode.\")}</div>\r\n    </div>`;\r\n  }\r\n\r\n  // Handle anyOf/oneOf unions\r\n  if (schema.anyOf || schema.oneOf) {\r\n    const variants = schema.anyOf ?? schema.oneOf ?? [];\r\n    const nonNull = variants.filter(\r\n      (v) => !(v.type === \"null\" || (Array.isArray(v.type) && v.type.includes(\"null\"))),\r\n    );\r\n\r\n    if (nonNull.length === 1) {\r\n      return renderNode({ ...params, schema: nonNull[0] });\r\n    }\r\n\r\n    // Check if it's a set of literal values (enum-like)\r\n    const extractLiteral = (v: JsonSchema): unknown => {\r\n      if (v.const !== undefined) {\r\n        return v.const;\r\n      }\r\n      if (v.enum && v.enum.length === 1) {\r\n        return v.enum[0];\r\n      }\r\n      return undefined;\r\n    };\r\n    const literals = nonNull.map(extractLiteral);\r\n    const allLiterals = literals.every((v) => v !== undefined);\r\n\r\n    if (allLiterals && literals.length > 0 && literals.length <= 5) {\r\n      // Use segmented control for small sets\r\n      const resolvedValue = value ?? schema.default;\r\n      return html`\r\n        <div class=\"cfg-field\">\r\n          ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\r\n          ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\r\n          <div class=\"cfg-segmented\">\r\n            ${literals.map(\r\n              (lit) => html`\r\n              <button\r\n                type=\"button\"\r\n                class=\"cfg-segmented__btn ${\r\n                  // oxlint-disable typescript/no-base-to-string\r\n                  lit === resolvedValue || String(lit) === String(resolvedValue) ? \"active\" : \"\"\r\n                }\"\r\n                ?disabled=${disabled}\r\n                @click=${() => onPatch(path, lit)}\r\n              >\r\n                ${\r\n                  // oxlint-disable typescript/no-base-to-string\r\n                  String(lit)\r\n                }\r\n              </button>\r\n            `,\r\n            )}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    if (allLiterals && literals.length > 5) {\r\n      // Use dropdown for larger sets\r\n      return renderSelect({ ...params, options: literals, value: value ?? schema.default });\r\n    }\r\n\r\n    // Handle mixed primitive types\r\n    const primitiveTypes = new Set(nonNull.map((variant) => schemaType(variant)).filter(Boolean));\r\n    const normalizedTypes = new Set(\r\n      [...primitiveTypes].map((v) => (v === \"integer\" ? \"number\" : v)),\r\n    );\r\n\r\n    if ([...normalizedTypes].every((v) => [\"string\", \"number\", \"boolean\"].includes(v as string))) {\r\n      const hasString = normalizedTypes.has(\"string\");\r\n      const hasNumber = normalizedTypes.has(\"number\");\r\n      const hasBoolean = normalizedTypes.has(\"boolean\");\r\n\r\n      if (hasBoolean && normalizedTypes.size === 1) {\r\n        return renderNode({\r\n          ...params,\r\n          schema: { ...schema, type: \"boolean\", anyOf: undefined, oneOf: undefined },\r\n        });\r\n      }\r\n\r\n      if (hasString || hasNumber) {\r\n        return renderTextInput({\r\n          ...params,\r\n          inputType: hasNumber && !hasString ? \"number\" : \"text\",\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // Enum - use segmented for small, dropdown for large\r\n  if (schema.enum) {\r\n    const options = schema.enum;\r\n    if (options.length <= 5) {\r\n      const resolvedValue = value ?? schema.default;\r\n      return html`\r\n        <div class=\"cfg-field\">\r\n          ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\r\n          ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\r\n          <div class=\"cfg-segmented\">\r\n            ${options.map(\r\n              (opt) => html`\r\n              <button\r\n                type=\"button\"\r\n                class=\"cfg-segmented__btn ${opt === resolvedValue || String(opt) === String(resolvedValue) ? \"active\" : \"\"}\"\r\n                ?disabled=${disabled}\r\n                @click=${() => onPatch(path, opt)}\r\n              >\r\n                ${String(opt)}\r\n              </button>\r\n            `,\r\n            )}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }\r\n    return renderSelect({ ...params, options, value: value ?? schema.default });\r\n  }\r\n\r\n  // Object type - collapsible section\r\n  if (type === \"object\") {\r\n    return renderObject(params);\r\n  }\r\n\r\n  // Array type\r\n  if (type === \"array\") {\r\n    return renderArray(params);\r\n  }\r\n\r\n  // Boolean - toggle row\r\n  if (type === \"boolean\") {\r\n    const displayValue =\r\n      typeof value === \"boolean\"\r\n        ? value\r\n        : typeof schema.default === \"boolean\"\r\n          ? schema.default\r\n          : false;\r\n    return html`\r\n      <label class=\"cfg-toggle-row ${disabled ? \"disabled\" : \"\"}\">\r\n        <div class=\"cfg-toggle-row__content\">\r\n          <span class=\"cfg-toggle-row__label\">${label}</span>\r\n          ${help ? html`<span class=\"cfg-toggle-row__help\">${help}</span>` : nothing}\r\n        </div>\r\n        <div class=\"cfg-toggle\">\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${displayValue}\r\n            ?disabled=${disabled}\r\n            @change=${(e: Event) => onPatch(path, (e.target as HTMLInputElement).checked)}\r\n          />\r\n          <span class=\"cfg-toggle__track\"></span>\r\n        </div>\r\n      </label>\r\n    `;\r\n  }\r\n\r\n  // Number/Integer\r\n  if (type === \"number\" || type === \"integer\") {\r\n    return renderNumberInput(params);\r\n  }\r\n\r\n  // String\r\n  if (type === \"string\") {\r\n    return renderTextInput({ ...params, inputType: \"text\" });\r\n  }\r\n\r\n  // Fallback\r\n  return html`\r\n    <div class=\"cfg-field cfg-field--error\">\r\n      <div class=\"cfg-field__label\">${label}</div>\r\n      <div class=\"cfg-field__error\">${T(\"Unsupported type:\")} ${type}. ${T(\"Use Raw mode.\")}</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderTextInput(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  inputType: \"text\" | \"number\";\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, disabled, onPatch, inputType } = params;\r\n  const showLabel = params.showLabel ?? true;\r\n  const hint = hintForPath(path, hints);\r\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const help = hint?.help ?? schema.description;\r\n  const isSensitive =\r\n    (hint?.sensitive ?? false) && !/^\\$\\{[^}]*\\}$/.test(String(value ?? \"\").trim());\r\n  const placeholder =\r\n    hint?.placeholder ??\r\n    // oxlint-disable typescript/no-base-to-string\r\n    (isSensitive\r\n      ? \"••••\"\r\n      : schema.default !== undefined\r\n        ? `Default: ${String(schema.default)}`\r\n        : \"\");\r\n  const displayValue = value ?? \"\";\r\n\r\n  return html`\r\n    <div class=\"cfg-field\">\r\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\r\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\r\n      <div class=\"cfg-input-wrap\">\r\n        <input\r\n          type=${isSensitive ? \"password\" : inputType}\r\n          class=\"cfg-input\"\r\n          placeholder=${placeholder}\r\n          .value=${displayValue == null ? \"\" : String(displayValue)}\r\n          ?disabled=${disabled}\r\n          @input=${(e: Event) => {\r\n            const raw = (e.target as HTMLInputElement).value;\r\n            if (inputType === \"number\") {\r\n              if (raw.trim() === \"\") {\r\n                onPatch(path, undefined);\r\n                return;\r\n              }\r\n              const parsed = Number(raw);\r\n              onPatch(path, Number.isNaN(parsed) ? raw : parsed);\r\n              return;\r\n            }\r\n            onPatch(path, raw);\r\n          }}\r\n          @change=${(e: Event) => {\r\n            if (inputType === \"number\") {\r\n              return;\r\n            }\r\n            const raw = (e.target as HTMLInputElement).value;\r\n            onPatch(path, raw.trim());\r\n          }}\r\n        />\r\n        ${\r\n          schema.default !== undefined\r\n            ? html`\r\n          <button\r\n            type=\"button\"\r\n            class=\"cfg-input__reset\"\r\n            title=\"Reset to default\"\r\n            ?disabled=${disabled}\r\n            @click=${() => onPatch(path, schema.default)}\r\n          >↺</button>\r\n        `\r\n            : nothing\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderNumberInput(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, disabled, onPatch } = params;\r\n  const showLabel = params.showLabel ?? true;\r\n  const hint = hintForPath(path, hints);\r\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const help = hint?.help ?? schema.description;\r\n  const displayValue = value ?? schema.default ?? \"\";\r\n  const numValue = typeof displayValue === \"number\" ? displayValue : 0;\r\n\r\n  return html`\r\n    <div class=\"cfg-field\">\r\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\r\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\r\n      <div class=\"cfg-number\">\r\n        <button\r\n          type=\"button\"\r\n          class=\"cfg-number__btn\"\r\n          ?disabled=${disabled}\r\n          @click=${() => onPatch(path, numValue - 1)}\r\n        >−</button>\r\n        <input\r\n          type=\"number\"\r\n          class=\"cfg-number__input\"\r\n          .value=${displayValue == null ? \"\" : String(displayValue)}\r\n          ?disabled=${disabled}\r\n          @input=${(e: Event) => {\r\n            const raw = (e.target as HTMLInputElement).value;\r\n            const parsed = raw === \"\" ? undefined : Number(raw);\r\n            onPatch(path, parsed);\r\n          }}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          class=\"cfg-number__btn\"\r\n          ?disabled=${disabled}\r\n          @click=${() => onPatch(path, numValue + 1)}\r\n        >+</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSelect(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  options: unknown[];\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, disabled, options, onPatch } = params;\r\n  const showLabel = params.showLabel ?? true;\r\n  const hint = hintForPath(path, hints);\r\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const help = hint?.help ?? schema.description;\r\n  const resolvedValue = value ?? schema.default;\r\n  const currentIndex = options.findIndex(\r\n    (opt) => opt === resolvedValue || String(opt) === String(resolvedValue),\r\n  );\r\n  const unset = \"__unset__\";\r\n\r\n  return html`\r\n    <div class=\"cfg-field\">\r\n      ${showLabel ? html`<label class=\"cfg-field__label\">${label}</label>` : nothing}\r\n      ${help ? html`<div class=\"cfg-field__help\">${help}</div>` : nothing}\r\n      <select\r\n        class=\"cfg-select\"\r\n        ?disabled=${disabled}\r\n        .value=${currentIndex >= 0 ? String(currentIndex) : unset}\r\n        @change=${(e: Event) => {\r\n          const val = (e.target as HTMLSelectElement).value;\r\n          onPatch(path, val === unset ? undefined : options[Number(val)]);\r\n        }}\r\n      >\r\n        <option value=${unset}>Select...</option>\r\n        ${options.map(\r\n          (opt, idx) => html`\r\n          <option value=${String(idx)}>${String(opt)}</option>\r\n        `,\r\n        )}\r\n      </select>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderObject(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  unsupported: Set<string>;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\r\n  const hint = hintForPath(path, hints);\r\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const help = hint?.help ?? schema.description;\r\n\r\n  const fallback = value ?? schema.default;\r\n  const obj =\r\n    fallback && typeof fallback === \"object\" && !Array.isArray(fallback)\r\n      ? (fallback as Record<string, unknown>)\r\n      : {};\r\n  const props = schema.properties ?? {};\r\n  const entries = Object.entries(props);\r\n\r\n  // Sort by hint order\r\n  const sorted = entries.toSorted((a, b) => {\r\n    const orderA = hintForPath([...path, a[0]], hints)?.order ?? 0;\r\n    const orderB = hintForPath([...path, b[0]], hints)?.order ?? 0;\r\n    if (orderA !== orderB) {\r\n      return orderA - orderB;\r\n    }\r\n    return a[0].localeCompare(b[0]);\r\n  });\r\n\r\n  const reserved = new Set(Object.keys(props));\r\n  const additional = schema.additionalProperties;\r\n  const allowExtra = Boolean(additional) && typeof additional === \"object\";\r\n\r\n  // For top-level, don't wrap in collapsible\r\n  if (path.length === 1) {\r\n    return html`\r\n      <div class=\"cfg-fields\">\r\n        ${sorted.map(([propKey, node]) =>\r\n          renderNode({\r\n            schema: node,\r\n            value: obj[propKey],\r\n            path: [...path, propKey],\r\n            hints,\r\n            unsupported,\r\n            disabled,\r\n            onPatch,\r\n          }),\r\n        )}\r\n        ${\r\n          allowExtra\r\n            ? renderMapField({\r\n                schema: additional,\r\n                value: obj,\r\n                path,\r\n                hints,\r\n                unsupported,\r\n                disabled,\r\n                reservedKeys: reserved,\r\n                onPatch,\r\n              })\r\n            : nothing\r\n        }\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // Nested objects get collapsible treatment\r\n  return html`\r\n    <details class=\"cfg-object\" open>\r\n      <summary class=\"cfg-object__header\">\r\n        <span class=\"cfg-object__title\">${label}</span>\r\n        <span class=\"cfg-object__chevron\">${icons.chevronDown}</span>\r\n      </summary>\r\n      ${help ? html`<div class=\"cfg-object__help\">${help}</div>` : nothing}\r\n      <div class=\"cfg-object__content\">\r\n        ${sorted.map(([propKey, node]) =>\r\n          renderNode({\r\n            schema: node,\r\n            value: obj[propKey],\r\n            path: [...path, propKey],\r\n            hints,\r\n            unsupported,\r\n            disabled,\r\n            onPatch,\r\n          }),\r\n        )}\r\n        ${\r\n          allowExtra\r\n            ? renderMapField({\r\n                schema: additional,\r\n                value: obj,\r\n                path,\r\n                hints,\r\n                unsupported,\r\n                disabled,\r\n                reservedKeys: reserved,\r\n                onPatch,\r\n              })\r\n            : nothing\r\n        }\r\n      </div>\r\n    </details>\r\n  `;\r\n}\r\n\r\nfunction renderArray(params: {\r\n  schema: JsonSchema;\r\n  value: unknown;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  unsupported: Set<string>;\r\n  disabled: boolean;\r\n  showLabel?: boolean;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, unsupported, disabled, onPatch } = params;\r\n  const showLabel = params.showLabel ?? true;\r\n  const hint = hintForPath(path, hints);\r\n  const label = hint?.label ?? schema.title ?? humanize(String(path.at(-1)));\r\n  const help = hint?.help ?? schema.description;\r\n\r\n  const itemsSchema = Array.isArray(schema.items) ? schema.items[0] : schema.items;\r\n  if (!itemsSchema) {\r\n    return html`\r\n      <div class=\"cfg-field cfg-field--error\">\r\n        <div class=\"cfg-field__label\">${label}</div>\r\n        <div class=\"cfg-field__error\">${T(\"Unsupported array schema. Use Raw mode.\")}</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const arr = Array.isArray(value) ? value : Array.isArray(schema.default) ? schema.default : [];\r\n\r\n  return html`\r\n    <div class=\"cfg-array\">\r\n      <div class=\"cfg-array__header\">\r\n        ${showLabel ? html`<span class=\"cfg-array__label\">${label}</span>` : nothing}\r\n        <span class=\"cfg-array__count\">${arr.length} item${arr.length !== 1 ? \"s\" : \"\"}</span>\r\n        <button\r\n          type=\"button\"\r\n          class=\"cfg-array__add\"\r\n          ?disabled=${disabled}\r\n          @click=${() => {\r\n            const next = [...arr, defaultValue(itemsSchema)];\r\n            onPatch(path, next);\r\n          }}\r\n        >\r\n          <span class=\"cfg-array__add-icon\">${icons.plus}</span>\r\n          Add\r\n        </button>\r\n      </div>\r\n      ${help ? html`<div class=\"cfg-array__help\">${help}</div>` : nothing}\r\n\r\n      ${\r\n        arr.length === 0\r\n          ? html`\r\n              <div class=\"cfg-array__empty\">No items yet. Click \"Add\" to create one.</div>\r\n            `\r\n          : html`\r\n        <div class=\"cfg-array__items\">\r\n          ${arr.map(\r\n            (item, idx) => html`\r\n            <div class=\"cfg-array__item\">\r\n              <div class=\"cfg-array__item-header\">\r\n                <span class=\"cfg-array__item-index\">#${idx + 1}</span>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"cfg-array__item-remove\"\r\n                  title=\"Remove item\"\r\n                  ?disabled=${disabled}\r\n                  @click=${() => {\r\n                    const next = [...arr];\r\n                    next.splice(idx, 1);\r\n                    onPatch(path, next);\r\n                  }}\r\n                >\r\n                  ${icons.trash}\r\n                </button>\r\n              </div>\r\n              <div class=\"cfg-array__item-content\">\r\n                ${renderNode({\r\n                  schema: itemsSchema,\r\n                  value: item,\r\n                  path: [...path, idx],\r\n                  hints,\r\n                  unsupported,\r\n                  disabled,\r\n                  showLabel: false,\r\n                  onPatch,\r\n                })}\r\n              </div>\r\n            </div>\r\n          `,\r\n          )}\r\n        </div>\r\n      `\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderMapField(params: {\r\n  schema: JsonSchema;\r\n  value: Record<string, unknown>;\r\n  path: Array<string | number>;\r\n  hints: ConfigUiHints;\r\n  unsupported: Set<string>;\r\n  disabled: boolean;\r\n  reservedKeys: Set<string>;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n}): TemplateResult {\r\n  const { schema, value, path, hints, unsupported, disabled, reservedKeys, onPatch } = params;\r\n  const anySchema = isAnySchema(schema);\r\n  const entries = Object.entries(value ?? {}).filter(([key]) => !reservedKeys.has(key));\r\n\r\n  return html`\r\n    <div class=\"cfg-map\">\r\n      <div class=\"cfg-map__header\">\r\n        <span class=\"cfg-map__label\">Custom entries</span>\r\n        <button\r\n          type=\"button\"\r\n          class=\"cfg-map__add\"\r\n          ?disabled=${disabled}\r\n          @click=${() => {\r\n            const next = { ...value };\r\n            let index = 1;\r\n            let key = `custom-${index}`;\r\n            while (key in next) {\r\n              index += 1;\r\n              key = `custom-${index}`;\r\n            }\r\n            next[key] = anySchema ? {} : defaultValue(schema);\r\n            onPatch(path, next);\r\n          }}\r\n        >\r\n          <span class=\"cfg-map__add-icon\">${icons.plus}</span>\r\n          Add Entry\r\n        </button>\r\n      </div>\r\n\r\n      ${\r\n        entries.length === 0\r\n          ? html`\r\n              <div class=\"cfg-map__empty\">No custom entries.</div>\r\n            `\r\n          : html`\r\n        <div class=\"cfg-map__items\">\r\n          ${entries.map(([key, entryValue]) => {\r\n            const valuePath = [...path, key];\r\n            const fallback = jsonValue(entryValue);\r\n            return html`\r\n              <div class=\"cfg-map__item\">\r\n                <div class=\"cfg-map__item-key\">\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"cfg-input cfg-input--sm\"\r\n                    placeholder=\"Key\"\r\n                    .value=${key}\r\n                    ?disabled=${disabled}\r\n                    @change=${(e: Event) => {\r\n                      const nextKey = (e.target as HTMLInputElement).value.trim();\r\n                      if (!nextKey || nextKey === key) {\r\n                        return;\r\n                      }\r\n                      const next = { ...value };\r\n                      if (nextKey in next) {\r\n                        return;\r\n                      }\r\n                      next[nextKey] = next[key];\r\n                      delete next[key];\r\n                      onPatch(path, next);\r\n                    }}\r\n                  />\r\n                </div>\r\n                <div class=\"cfg-map__item-value\">\r\n                  ${\r\n                    anySchema\r\n                      ? html`\r\n                        <textarea\r\n                          class=\"cfg-textarea cfg-textarea--sm\"\r\n                          placeholder=\"JSON value\"\r\n                          rows=\"2\"\r\n                          .value=${fallback}\r\n                          ?disabled=${disabled}\r\n                          @change=${(e: Event) => {\r\n                            const target = e.target as HTMLTextAreaElement;\r\n                            const raw = target.value.trim();\r\n                            if (!raw) {\r\n                              onPatch(valuePath, undefined);\r\n                              return;\r\n                            }\r\n                            try {\r\n                              onPatch(valuePath, JSON.parse(raw));\r\n                            } catch {\r\n                              target.value = fallback;\r\n                            }\r\n                          }}\r\n                        ></textarea>\r\n                      `\r\n                      : renderNode({\r\n                          schema,\r\n                          value: entryValue,\r\n                          path: valuePath,\r\n                          hints,\r\n                          unsupported,\r\n                          disabled,\r\n                          showLabel: false,\r\n                          onPatch,\r\n                        })\r\n                  }\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"cfg-map__item-remove\"\r\n                  title=\"Remove entry\"\r\n                  ?disabled=${disabled}\r\n                  @click=${() => {\r\n                    const next = { ...value };\r\n                    delete next[key];\r\n                    onPatch(path, next);\r\n                  }}\r\n                >\r\n                  ${icons.trash}\r\n                </button>\r\n              </div>\r\n            `;\r\n          })}\r\n        </div>\r\n      `\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ConfigUiHints } from \"../types.ts\";\r\nimport { icons } from \"../icons.ts\";\r\nimport { renderNode } from \"./config-form.node.ts\";\r\nimport { hintForPath, humanize, schemaType, type JsonSchema } from \"./config-form.shared.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type ConfigFormProps = {\r\n  schema: JsonSchema | null;\r\n  uiHints: ConfigUiHints;\r\n  value: Record<string, unknown> | null;\r\n  disabled?: boolean;\r\n  unsupportedPaths?: string[];\r\n  searchQuery?: string;\r\n  activeSection?: string | null;\r\n  activeSubsection?: string | null;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n};\r\n\r\n// SVG Icons for section cards (Lucide-style)\r\nconst sectionIcons = {\r\n  env: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n      <path\r\n        d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  update: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\r\n      <polyline points=\"7 10 12 15 17 10\"></polyline>\r\n      <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\r\n    </svg>\r\n  `,\r\n  agents: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path\r\n        d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"\r\n      ></path>\r\n      <circle cx=\"8\" cy=\"14\" r=\"1\"></circle>\r\n      <circle cx=\"16\" cy=\"14\" r=\"1\"></circle>\r\n    </svg>\r\n  `,\r\n  auth: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\r\n      <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\r\n    </svg>\r\n  `,\r\n  channels: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\r\n    </svg>\r\n  `,\r\n  messages: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n      <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n    </svg>\r\n  `,\r\n  commands: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <polyline points=\"4 17 10 11 4 5\"></polyline>\r\n      <line x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"></line>\r\n    </svg>\r\n  `,\r\n  hooks: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\r\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\r\n    </svg>\r\n  `,\r\n  skills: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <polygon\r\n        points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"\r\n      ></polygon>\r\n    </svg>\r\n  `,\r\n  tools: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path\r\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  gateway: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\r\n      <path\r\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  wizard: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M15 4V2\"></path>\r\n      <path d=\"M15 16v-2\"></path>\r\n      <path d=\"M8 9h2\"></path>\r\n      <path d=\"M20 9h2\"></path>\r\n      <path d=\"M17.8 11.8 19 13\"></path>\r\n      <path d=\"M15 9h0\"></path>\r\n      <path d=\"M17.8 6.2 19 5\"></path>\r\n      <path d=\"m3 21 9-9\"></path>\r\n      <path d=\"M12.2 6.2 11 5\"></path>\r\n    </svg>\r\n  `,\r\n  // Additional sections\r\n  meta: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M12 20h9\"></path>\r\n      <path d=\"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\"></path>\r\n    </svg>\r\n  `,\r\n  logging: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\r\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\r\n      <polyline points=\"10 9 9 9 8 9\"></polyline>\r\n    </svg>\r\n  `,\r\n  browser: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\r\n      <line x1=\"21.17\" y1=\"8\" x2=\"12\" y2=\"8\"></line>\r\n      <line x1=\"3.95\" y1=\"6.06\" x2=\"8.54\" y2=\"14\"></line>\r\n      <line x1=\"10.88\" y1=\"21.94\" x2=\"15.46\" y2=\"14\"></line>\r\n    </svg>\r\n  `,\r\n  ui: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n      <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n    </svg>\r\n  `,\r\n  models: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path\r\n        d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"\r\n      ></path>\r\n      <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline>\r\n      <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line>\r\n    </svg>\r\n  `,\r\n  bindings: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\r\n      <rect x=\"2\" y=\"14\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\r\n      <line x1=\"6\" y1=\"6\" x2=\"6.01\" y2=\"6\"></line>\r\n      <line x1=\"6\" y1=\"18\" x2=\"6.01\" y2=\"18\"></line>\r\n    </svg>\r\n  `,\r\n  broadcast: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M4.9 19.1C1 15.2 1 8.8 4.9 4.9\"></path>\r\n      <path d=\"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5\"></path>\r\n      <circle cx=\"12\" cy=\"12\" r=\"2\"></circle>\r\n      <path d=\"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5\"></path>\r\n      <path d=\"M19.1 4.9C23 8.8 23 15.1 19.1 19\"></path>\r\n    </svg>\r\n  `,\r\n  audio: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M9 18V5l12-2v13\"></path>\r\n      <circle cx=\"6\" cy=\"18\" r=\"3\"></circle>\r\n      <circle cx=\"18\" cy=\"16\" r=\"3\"></circle>\r\n    </svg>\r\n  `,\r\n  session: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\r\n      <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\r\n      <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path>\r\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\r\n    </svg>\r\n  `,\r\n  cron: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <polyline points=\"12 6 12 12 16 14\"></polyline>\r\n    </svg>\r\n  `,\r\n  web: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\r\n      <path\r\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  discovery: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\r\n      <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\r\n    </svg>\r\n  `,\r\n  canvasHost: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n      <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n      <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n    </svg>\r\n  `,\r\n  talk: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"></path>\r\n      <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"></path>\r\n      <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"></line>\r\n      <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"></line>\r\n    </svg>\r\n  `,\r\n  plugins: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M12 2v6\"></path>\r\n      <path d=\"m4.93 10.93 4.24 4.24\"></path>\r\n      <path d=\"M2 12h6\"></path>\r\n      <path d=\"m4.93 13.07 4.24-4.24\"></path>\r\n      <path d=\"M12 22v-6\"></path>\r\n      <path d=\"m19.07 13.07-4.24-4.24\"></path>\r\n      <path d=\"M22 12h-6\"></path>\r\n      <path d=\"m19.07 10.93-4.24 4.24\"></path>\r\n    </svg>\r\n  `,\r\n  default: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n    </svg>\r\n  `,\r\n};\r\n\r\n// Section metadata - raw English (translated at render time)\r\nconst SECTION_LABELS: Record<string, { label: string; description: string }> = {\r\n  env: {\r\n    label: \"环境变量\",\r\n    description: \"传递给网关进程的环境变量\",\r\n  },\r\n  update: { label: \"更新\", description: \"自动更新设置和发布渠道\" },\r\n  agents: { label: \"代理\", description: \"代理配置、模型和身份\" },\r\n  auth: { label: \"身份验证\", description: \"API 密钥和身份验证配置\" },\r\n  channels: {\r\n    label: \"渠道\",\r\n    description: \"消息渠道 (Telegram, Discord, Slack 等)\",\r\n  },\r\n  messages: { label: \"消息\", description: \"消息处理和路由设置\" },\r\n  commands: { label: \"命令\", description: \"自定义斜杠命令\" },\r\n  hooks: { label: \"钩子\", description: \"Webhooks 和事件钩子\" },\r\n  skills: { label: \"技能\", description: \"技能包和能力\" },\r\n  tools: { label: \"工具\", description: \"工具配置 (浏览器、搜索等)\" },\r\n  gateway: { label: \"网关\", description: \"网关服务器设置 (端口、认证、绑定)\" },\r\n  wizard: { label: \"设置向导\", description: \"设置向导状态和历史\" },\r\n  // Additional sections\r\n  meta: { label: \"元信息\", description: \"网关元数据和版本信息\" },\r\n  logging: { label: \"日志\", description: \"日志级别和输出配置\" },\r\n  browser: { label: \"浏览器\", description: \"浏览器自动化设置\" },\r\n  ui: { label: \"界面\", description: \"用户界面首选项\" },\r\n  models: { label: \"模型\", description: \"AI 模型配置和提供商\" },\r\n  bindings: { label: \"绑定\", description: \"键绑定和快捷键\" },\r\n  broadcast: { label: \"广播\", description: \"广播和通知设置\" },\r\n  audio: { label: \"音频\", description: \"音频输入/输出设置\" },\r\n  session: { label: \"会话\", description: \"会话管理和持久化\" },\r\n  cron: { label: \"定时任务\", description: \"计划任务和自动化\" },\r\n  web: { label: \"网络\", description: \"Web 服务器和 API 设置\" },\r\n  discovery: { label: \"发现\", description: \"服务发现和网络\" },\r\n  canvasHost: { label: \"画布主机\", description: \"画布渲染和显示\" },\r\n  talk: { label: \"对话\", description: \"语音和语音设置\" },\r\n  plugins: { label: \"插件\", description: \"插件管理和扩展\" },\r\n  // Missing sections\r\n  nodeHost: { label: \"节点主机\", description: \"节点主机设置和管理\" },\r\n  media: { label: \"媒体\", description: \"媒体处理和存储\" },\r\n  approvals: { label: \"审批\", description: \"待批准和授权\" },\r\n  memory: { label: \"内存\", description: \"内存管理和限制\" },\r\n  diagnostics: { label: \"诊断\", description: \"系统诊断和故障排除\" },\r\n};\r\n\r\n// Lazy translation helper - translate at render time\r\nfunction getSectionLabel(key: string): string {\r\n  const meta = SECTION_LABELS[key];\r\n  if (!meta) return T(key);\r\n  return T(meta.label);\r\n}\r\n\r\nfunction getSectionDescription(key: string): string {\r\n  const meta = SECTION_LABELS[key];\r\n  if (!meta) return \"\";\r\n  return T(meta.description);\r\n}\r\n\r\nexport const SECTION_META: Record<string, { label: string; description: string }> = SECTION_LABELS;\r\n\r\nfunction getSectionIcon(key: string) {\r\n  return sectionIcons[key as keyof typeof sectionIcons] ?? sectionIcons.default;\r\n}\r\n\r\nfunction matchesSearch(key: string, schema: JsonSchema, query: string): boolean {\r\n  if (!query) {\r\n    return true;\r\n  }\r\n  const q = query.toLowerCase();\r\n  const label = getSectionLabel(key);\r\n  const description = getSectionDescription(key);\r\n\r\n  // Check key name\r\n  if (key.toLowerCase().includes(q)) {\r\n    return true;\r\n  }\r\n\r\n  // Check label and description\r\n  if (label.toLowerCase().includes(q)) {\r\n    return true;\r\n  }\r\n  if (description.toLowerCase().includes(q)) {\r\n    return true;\r\n  }\r\n\r\n  return schemaMatches(schema, q);\r\n}\r\n\r\nfunction schemaMatches(schema: JsonSchema, query: string): boolean {\r\n  if (schema.title?.toLowerCase().includes(query)) {\r\n    return true;\r\n  }\r\n  if (schema.description?.toLowerCase().includes(query)) {\r\n    return true;\r\n  }\r\n  if (schema.enum?.some((value) => String(value).toLowerCase().includes(query))) {\r\n    return true;\r\n  }\r\n\r\n  if (schema.properties) {\r\n    for (const [propKey, propSchema] of Object.entries(schema.properties)) {\r\n      if (propKey.toLowerCase().includes(query)) {\r\n        return true;\r\n      }\r\n      if (schemaMatches(propSchema, query)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (schema.items) {\r\n    const items = Array.isArray(schema.items) ? schema.items : [schema.items];\r\n    for (const item of items) {\r\n      if (item && schemaMatches(item, query)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (schema.additionalProperties && typeof schema.additionalProperties === \"object\") {\r\n    if (schemaMatches(schema.additionalProperties, query)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  const unions = schema.anyOf ?? schema.oneOf ?? schema.allOf;\r\n  if (unions) {\r\n    for (const entry of unions) {\r\n      if (entry && schemaMatches(entry, query)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function renderConfigForm(props: ConfigFormProps) {\r\n  if (!props.schema) {\r\n    return html`\r\n      <div class=\"muted\">Schema unavailable.</div>\r\n    `;\r\n  }\r\n  const schema = props.schema;\r\n  const value = props.value ?? {};\r\n  if (schemaType(schema) !== \"object\" || !schema.properties) {\r\n    return html`\r\n      <div class=\"callout danger\">Unsupported schema. Use Raw.</div>\r\n    `;\r\n  }\r\n  const unsupported = new Set(props.unsupportedPaths ?? []);\r\n  const properties = schema.properties;\r\n  const searchQuery = props.searchQuery ?? \"\";\r\n  const activeSection = props.activeSection;\r\n  const activeSubsection = props.activeSubsection ?? null;\r\n\r\n  const entries = Object.entries(properties).toSorted((a, b) => {\r\n    const orderA = hintForPath([a[0]], props.uiHints)?.order ?? 50;\r\n    const orderB = hintForPath([b[0]], props.uiHints)?.order ?? 50;\r\n    if (orderA !== orderB) {\r\n      return orderA - orderB;\r\n    }\r\n    return a[0].localeCompare(b[0]);\r\n  });\r\n\r\n  const filteredEntries = entries.filter(([key, node]) => {\r\n    if (activeSection && key !== activeSection) {\r\n      return false;\r\n    }\r\n    if (searchQuery && !matchesSearch(key, node, searchQuery)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  let subsectionContext: { sectionKey: string; subsectionKey: string; schema: JsonSchema } | null =\r\n    null;\r\n  if (activeSection && activeSubsection && filteredEntries.length === 1) {\r\n    const sectionSchema = filteredEntries[0]?.[1];\r\n    if (\r\n      sectionSchema &&\r\n      schemaType(sectionSchema) === \"object\" &&\r\n      sectionSchema.properties &&\r\n      sectionSchema.properties[activeSubsection]\r\n    ) {\r\n      subsectionContext = {\r\n        sectionKey: activeSection,\r\n        subsectionKey: activeSubsection,\r\n        schema: sectionSchema.properties[activeSubsection],\r\n      };\r\n    }\r\n  }\r\n\r\n  if (filteredEntries.length === 0) {\r\n    return html`\r\n      <div class=\"config-empty\">\r\n        <div class=\"config-empty__icon\">${icons.search}</div>\r\n        <div class=\"config-empty__text\">\r\n          ${searchQuery ? `${T(\"No settings match\")} \"${searchQuery}\"` : T(\"No settings in this section\")}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  return html`\r\n    <div class=\"config-form config-form--modern\">\r\n      ${\r\n        subsectionContext\r\n          ? (() => {\r\n              const { sectionKey, subsectionKey, schema: node } = subsectionContext;\r\n              const hint = hintForPath([sectionKey, subsectionKey], props.uiHints);\r\n              const rawLabel = hint?.label ?? node.title ?? humanize(subsectionKey);\r\n              const rawDescription = hint?.help ?? node.description ?? \"\";\r\n              const label = T(rawLabel);\r\n              const description = T(rawDescription);\r\n              const sectionValue = value[sectionKey];\r\n              const scopedValue =\r\n                sectionValue && typeof sectionValue === \"object\"\r\n                  ? (sectionValue as Record<string, unknown>)[subsectionKey]\r\n                  : undefined;\r\n              const id = `config-section-${sectionKey}-${subsectionKey}`;\r\n              return html`\r\n              <section class=\"config-section-card\" id=${id}>\r\n                <div class=\"config-section-card__header\">\r\n                  <span class=\"config-section-card__icon\">${getSectionIcon(sectionKey)}</span>\r\n                  <div class=\"config-section-card__titles\">\r\n                    <h3 class=\"config-section-card__title\">${label}</h3>\r\n                    ${\r\n                      description\r\n                        ? html`<p class=\"config-section-card__desc\">${description}</p>`\r\n                        : nothing\r\n                    }\r\n                  </div>\r\n                </div>\r\n                <div class=\"config-section-card__content\">\r\n                  ${renderNode({\r\n                    schema: node,\r\n                    value: scopedValue,\r\n                    path: [sectionKey, subsectionKey],\r\n                    hints: props.uiHints,\r\n                    unsupported,\r\n                    disabled: props.disabled ?? false,\r\n                    showLabel: false,\r\n                    onPatch: props.onPatch,\r\n                  })}\r\n                </div>\r\n              </section>\r\n            `;\r\n            })()\r\n          : filteredEntries.map(([key, node]) => {\r\n              const fallbackLabel = key.charAt(0).toUpperCase() + key.slice(1);\r\n              const fallbackDesc = node.description ?? \"\";\r\n              const meta = SECTION_LABELS[key] ?? {\r\n                label: fallbackLabel,\r\n                description: fallbackDesc,\r\n              };\r\n\r\n              return html`\r\n              <section class=\"config-section-card\" id=\"config-section-${key}\">\r\n                <div class=\"config-section-card__header\">\r\n                  <span class=\"config-section-card__icon\">${getSectionIcon(key)}</span>\r\n                  <div class=\"config-section-card__titles\">\r\n                    <h3 class=\"config-section-card__title\">${T(meta.label)}</h3>\r\n                    ${\r\n                      meta.description\r\n                        ? html`<p class=\"config-section-card__desc\">${T(meta.description)}</p>`\r\n                        : nothing\r\n                    }\r\n                  </div>\r\n                </div>\r\n                <div class=\"config-section-card__content\">\r\n                  ${renderNode({\r\n                    schema: node,\r\n                    value: value[key],\r\n                    path: [key],\r\n                    hints: props.uiHints,\r\n                    unsupported,\r\n                    disabled: props.disabled ?? false,\r\n                    showLabel: false,\r\n                    onPatch: props.onPatch,\r\n                  })}\r\n                </div>\r\n              </section>\r\n            `;\r\n            })\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n","import { pathKey, schemaType, type JsonSchema } from \"./config-form.shared.ts\";\r\n\r\nexport type ConfigSchemaAnalysis = {\r\n  schema: JsonSchema | null;\r\n  unsupportedPaths: string[];\r\n};\r\n\r\nconst META_KEYS = new Set([\"title\", \"description\", \"default\", \"nullable\"]);\r\n\r\nfunction isAnySchema(schema: JsonSchema): boolean {\r\n  const keys = Object.keys(schema ?? {}).filter((key) => !META_KEYS.has(key));\r\n  return keys.length === 0;\r\n}\r\n\r\nfunction normalizeEnum(values: unknown[]): { enumValues: unknown[]; nullable: boolean } {\r\n  const filtered = values.filter((value) => value != null);\r\n  const nullable = filtered.length !== values.length;\r\n  const enumValues: unknown[] = [];\r\n  for (const value of filtered) {\r\n    if (!enumValues.some((existing) => Object.is(existing, value))) {\r\n      enumValues.push(value);\r\n    }\r\n  }\r\n  return { enumValues, nullable };\r\n}\r\n\r\nexport function analyzeConfigSchema(raw: unknown): ConfigSchemaAnalysis {\r\n  if (!raw || typeof raw !== \"object\") {\r\n    return { schema: null, unsupportedPaths: [\"<root>\"] };\r\n  }\r\n  return normalizeSchemaNode(raw as JsonSchema, []);\r\n}\r\n\r\nfunction normalizeSchemaNode(\r\n  schema: JsonSchema,\r\n  path: Array<string | number>,\r\n): ConfigSchemaAnalysis {\r\n  const unsupported = new Set<string>();\r\n  const normalized: JsonSchema = { ...schema };\r\n  const pathLabel = pathKey(path) || \"<root>\";\r\n\r\n  if (schema.anyOf || schema.oneOf || schema.allOf) {\r\n    const union = normalizeUnion(schema, path);\r\n    if (union) {\r\n      return union;\r\n    }\r\n    return { schema, unsupportedPaths: [pathLabel] };\r\n  }\r\n\r\n  const nullable = Array.isArray(schema.type) && schema.type.includes(\"null\");\r\n  const type =\r\n    schemaType(schema) ?? (schema.properties || schema.additionalProperties ? \"object\" : undefined);\r\n  normalized.type = type ?? schema.type;\r\n  normalized.nullable = nullable || schema.nullable;\r\n\r\n  if (normalized.enum) {\r\n    const { enumValues, nullable: enumNullable } = normalizeEnum(normalized.enum);\r\n    normalized.enum = enumValues;\r\n    if (enumNullable) {\r\n      normalized.nullable = true;\r\n    }\r\n    if (enumValues.length === 0) {\r\n      unsupported.add(pathLabel);\r\n    }\r\n  }\r\n\r\n  if (type === \"object\") {\r\n    const properties = schema.properties ?? {};\r\n    const normalizedProps: Record<string, JsonSchema> = {};\r\n    for (const [key, value] of Object.entries(properties)) {\r\n      const res = normalizeSchemaNode(value, [...path, key]);\r\n      if (res.schema) {\r\n        normalizedProps[key] = res.schema;\r\n      }\r\n      for (const entry of res.unsupportedPaths) {\r\n        unsupported.add(entry);\r\n      }\r\n    }\r\n    normalized.properties = normalizedProps;\r\n\r\n    if (schema.additionalProperties === true) {\r\n      unsupported.add(pathLabel);\r\n    } else if (schema.additionalProperties === false) {\r\n      normalized.additionalProperties = false;\r\n    } else if (schema.additionalProperties && typeof schema.additionalProperties === \"object\") {\r\n      if (!isAnySchema(schema.additionalProperties)) {\r\n        const res = normalizeSchemaNode(schema.additionalProperties, [...path, \"*\"]);\r\n        normalized.additionalProperties = res.schema ?? schema.additionalProperties;\r\n        if (res.unsupportedPaths.length > 0) {\r\n          unsupported.add(pathLabel);\r\n        }\r\n      }\r\n    }\r\n  } else if (type === \"array\") {\r\n    const itemsSchema = Array.isArray(schema.items) ? schema.items[0] : schema.items;\r\n    if (!itemsSchema) {\r\n      unsupported.add(pathLabel);\r\n    } else {\r\n      const res = normalizeSchemaNode(itemsSchema, [...path, \"*\"]);\r\n      normalized.items = res.schema ?? itemsSchema;\r\n      if (res.unsupportedPaths.length > 0) {\r\n        unsupported.add(pathLabel);\r\n      }\r\n    }\r\n  } else if (\r\n    type !== \"string\" &&\r\n    type !== \"number\" &&\r\n    type !== \"integer\" &&\r\n    type !== \"boolean\" &&\r\n    !normalized.enum\r\n  ) {\r\n    unsupported.add(pathLabel);\r\n  }\r\n\r\n  return {\r\n    schema: normalized,\r\n    unsupportedPaths: Array.from(unsupported),\r\n  };\r\n}\r\n\r\nfunction normalizeUnion(\r\n  schema: JsonSchema,\r\n  path: Array<string | number>,\r\n): ConfigSchemaAnalysis | null {\r\n  if (schema.allOf) {\r\n    return null;\r\n  }\r\n  const union = schema.anyOf ?? schema.oneOf;\r\n  if (!union) {\r\n    return null;\r\n  }\r\n\r\n  const literals: unknown[] = [];\r\n  const remaining: JsonSchema[] = [];\r\n  let nullable = false;\r\n\r\n  for (const entry of union) {\r\n    if (!entry || typeof entry !== \"object\") {\r\n      return null;\r\n    }\r\n    if (Array.isArray(entry.enum)) {\r\n      const { enumValues, nullable: enumNullable } = normalizeEnum(entry.enum);\r\n      literals.push(...enumValues);\r\n      if (enumNullable) {\r\n        nullable = true;\r\n      }\r\n      continue;\r\n    }\r\n    if (\"const\" in entry) {\r\n      if (entry.const == null) {\r\n        nullable = true;\r\n        continue;\r\n      }\r\n      literals.push(entry.const);\r\n      continue;\r\n    }\r\n    if (schemaType(entry) === \"null\") {\r\n      nullable = true;\r\n      continue;\r\n    }\r\n    remaining.push(entry);\r\n  }\r\n\r\n  if (literals.length > 0 && remaining.length === 0) {\r\n    const unique: unknown[] = [];\r\n    for (const value of literals) {\r\n      if (!unique.some((existing) => Object.is(existing, value))) {\r\n        unique.push(value);\r\n      }\r\n    }\r\n    return {\r\n      schema: {\r\n        ...schema,\r\n        enum: unique,\r\n        nullable,\r\n        anyOf: undefined,\r\n        oneOf: undefined,\r\n        allOf: undefined,\r\n      },\r\n      unsupportedPaths: [],\r\n    };\r\n  }\r\n\r\n  if (remaining.length === 1) {\r\n    const res = normalizeSchemaNode(remaining[0], path);\r\n    if (res.schema) {\r\n      res.schema.nullable = nullable || res.schema.nullable;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  const primitiveTypes = new Set([\"string\", \"number\", \"integer\", \"boolean\"]);\r\n  if (\r\n    remaining.length > 0 &&\r\n    literals.length === 0 &&\r\n    remaining.every((entry) => entry.type && primitiveTypes.has(String(entry.type)))\r\n  ) {\r\n    return {\r\n      schema: {\r\n        ...schema,\r\n        nullable,\r\n      },\r\n      unsupportedPaths: [],\r\n    };\r\n  }\r\n\r\n  return null;\r\n}\r\n","import { html } from \"lit\";\r\nimport type { ConfigUiHints } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { analyzeConfigSchema, renderNode, schemaType, type JsonSchema } from \"./config-form.ts\";\r\n\r\ntype ChannelConfigFormProps = {\r\n  channelId: string;\r\n  configValue: Record<string, unknown> | null;\r\n  schema: unknown;\r\n  uiHints: ConfigUiHints;\r\n  disabled: boolean;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n};\r\n\r\nfunction resolveSchemaNode(\r\n  schema: JsonSchema | null,\r\n  path: Array<string | number>,\r\n): JsonSchema | null {\r\n  let current = schema;\r\n  for (const key of path) {\r\n    if (!current) {\r\n      return null;\r\n    }\r\n    const type = schemaType(current);\r\n    if (type === \"object\") {\r\n      const properties = current.properties ?? {};\r\n      if (typeof key === \"string\" && properties[key]) {\r\n        current = properties[key];\r\n        continue;\r\n      }\r\n      const additional = current.additionalProperties;\r\n      if (typeof key === \"string\" && additional && typeof additional === \"object\") {\r\n        current = additional;\r\n        continue;\r\n      }\r\n      return null;\r\n    }\r\n    if (type === \"array\") {\r\n      if (typeof key !== \"number\") {\r\n        return null;\r\n      }\r\n      const items = Array.isArray(current.items) ? current.items[0] : current.items;\r\n      current = items ?? null;\r\n      continue;\r\n    }\r\n    return null;\r\n  }\r\n  return current;\r\n}\r\n\r\nfunction resolveChannelValue(\r\n  config: Record<string, unknown>,\r\n  channelId: string,\r\n): Record<string, unknown> {\r\n  const channels = (config.channels ?? {}) as Record<string, unknown>;\r\n  const fromChannels = channels[channelId];\r\n  const fallback = config[channelId];\r\n  const resolved =\r\n    (fromChannels && typeof fromChannels === \"object\"\r\n      ? (fromChannels as Record<string, unknown>)\r\n      : null) ??\r\n    (fallback && typeof fallback === \"object\" ? (fallback as Record<string, unknown>) : null);\r\n  return resolved ?? {};\r\n}\r\n\r\nconst EXTRA_CHANNEL_FIELDS = [\"groupPolicy\", \"streamMode\", \"dmPolicy\"] as const;\r\n\r\nfunction formatExtraValue(raw: unknown): string {\r\n  if (raw == null) {\r\n    return \"n/a\";\r\n  }\r\n  if (typeof raw === \"string\" || typeof raw === \"number\" || typeof raw === \"boolean\") {\r\n    return String(raw);\r\n  }\r\n  try {\r\n    return JSON.stringify(raw);\r\n  } catch {\r\n    return \"n/a\";\r\n  }\r\n}\r\n\r\nfunction renderExtraChannelFields(value: Record<string, unknown>) {\r\n  const entries = EXTRA_CHANNEL_FIELDS.flatMap((field) => {\r\n    if (!(field in value)) {\r\n      return [];\r\n    }\r\n    return [[field, value[field]]] as Array<[string, unknown]>;\r\n  });\r\n  if (entries.length === 0) {\r\n    return null;\r\n  }\r\n  return html`\r\n    <div class=\"status-list\" style=\"margin-top: 12px;\">\r\n      ${entries.map(\r\n        ([field, raw]) => html`\r\n          <div>\r\n            <span class=\"label\">${field}</span>\r\n            <span>${formatExtraValue(raw)}</span>\r\n          </div>\r\n        `,\r\n      )}\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function renderChannelConfigForm(props: ChannelConfigFormProps) {\r\n  const analysis = analyzeConfigSchema(props.schema);\r\n  const normalized = analysis.schema;\r\n  if (!normalized) {\r\n    return html`\r\n      <div class=\"callout danger\">Schema unavailable. Use Raw.</div>\r\n    `;\r\n  }\r\n  const node = resolveSchemaNode(normalized, [\"channels\", props.channelId]);\r\n  if (!node) {\r\n    return html`\r\n      <div class=\"callout danger\">Channel config schema unavailable.</div>\r\n    `;\r\n  }\r\n  const configValue = props.configValue ?? {};\r\n  const value = resolveChannelValue(configValue, props.channelId);\r\n  return html`\r\n    <div class=\"config-form\">\r\n      ${renderNode({\r\n        schema: node,\r\n        value,\r\n        path: [\"channels\", props.channelId],\r\n        hints: props.uiHints,\r\n        unsupported: new Set(analysis.unsupportedPaths),\r\n        disabled: props.disabled,\r\n        showLabel: false,\r\n        onPatch: props.onPatch,\r\n      })}\r\n    </div>\r\n    ${renderExtraChannelFields(value)}\r\n  `;\r\n}\r\n\r\nexport function renderChannelConfigSection(params: { channelId: string; props: ChannelsProps }) {\r\n  const { channelId, props } = params;\r\n  const disabled = props.configSaving || props.configSchemaLoading;\r\n  return html`\r\n    <div style=\"margin-top: 16px;\">\r\n      ${\r\n        props.configSchemaLoading\r\n          ? html`\r\n              <div class=\"muted\">Loading config schema…</div>\r\n            `\r\n          : renderChannelConfigForm({\r\n              channelId,\r\n              configValue: props.configForm,\r\n              schema: props.configSchema,\r\n              uiHints: props.configUiHints,\r\n              disabled,\r\n              onPatch: props.onConfigPatch,\r\n            })\r\n      }\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button\r\n          class=\"btn primary\"\r\n          ?disabled=${disabled || !props.configFormDirty}\r\n          @click=${() => props.onConfigSave()}\r\n        >\r\n          ${props.configSaving ? \"Saving…\" : \"Save\"}\r\n        </button>\r\n        <button\r\n          class=\"btn\"\r\n          ?disabled=${disabled}\r\n          @click=${() => props.onConfigReload()}\r\n        >\r\n          Reload\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { DiscordStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderDiscordCard(params: {\r\n  props: ChannelsProps;\r\n  discord?: DiscordStatus | null;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, discord, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Discord</div>\r\n      <div class=\"card-sub\">Bot status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${discord?.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${discord?.running ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last start</span>\r\n          <span>${discord?.lastStartAt ? formatRelativeTimestamp(discord.lastStartAt) : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last probe</span>\r\n          <span>${discord?.lastProbeAt ? formatRelativeTimestamp(discord.lastProbeAt) : \"n/a\"}</span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        discord?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${discord.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        discord?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${discord.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${discord.probe.status ?? \"\"} ${discord.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"discord\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { GoogleChatStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderGoogleChatCard(params: {\r\n  props: ChannelsProps;\r\n  googleChat?: GoogleChatStatus | null;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, googleChat, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Google Chat</div>\r\n      <div class=\"card-sub\">Chat API webhook status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${googleChat ? (googleChat.configured ? \"Yes\" : \"No\") : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${googleChat ? (googleChat.running ? \"Yes\" : \"No\") : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Credential</span>\r\n          <span>${googleChat?.credentialSource ?? \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Audience</span>\r\n          <span>\r\n            ${\r\n              googleChat?.audienceType\r\n                ? `${googleChat.audienceType}${googleChat.audience ? ` · ${googleChat.audience}` : \"\"}`\r\n                : \"n/a\"\r\n            }\r\n          </span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last start</span>\r\n          <span>${googleChat?.lastStartAt ? formatRelativeTimestamp(googleChat.lastStartAt) : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last probe</span>\r\n          <span>${googleChat?.lastProbeAt ? formatRelativeTimestamp(googleChat.lastProbeAt) : \"n/a\"}</span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        googleChat?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${googleChat.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        googleChat?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${googleChat.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${googleChat.probe.status ?? \"\"} ${googleChat.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"googlechat\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { IMessageStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderIMessageCard(params: {\r\n  props: ChannelsProps;\r\n  imessage?: IMessageStatus | null;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, imessage, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">iMessage</div>\r\n      <div class=\"card-sub\">macOS bridge status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${imessage?.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${imessage?.running ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last start</span>\r\n          <span>${imessage?.lastStartAt ? formatRelativeTimestamp(imessage.lastStartAt) : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last probe</span>\r\n          <span>${imessage?.lastProbeAt ? formatRelativeTimestamp(imessage.lastProbeAt) : \"n/a\"}</span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        imessage?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${imessage.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        imessage?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${imessage.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${imessage.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"imessage\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ChannelAccountSnapshot, NostrStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\nimport {\r\n  renderNostrProfileForm,\r\n  type NostrProfileFormState,\r\n  type NostrProfileFormCallbacks,\r\n} from \"./channels.nostr-profile-form.ts\";\r\n\r\n/**\r\n * Truncate a pubkey for display (shows first and last 8 chars)\r\n */\r\nfunction truncatePubkey(pubkey: string | null | undefined): string {\r\n  if (!pubkey) {\r\n    return \"n/a\";\r\n  }\r\n  if (pubkey.length <= 20) {\r\n    return pubkey;\r\n  }\r\n  return `${pubkey.slice(0, 8)}...${pubkey.slice(-8)}`;\r\n}\r\n\r\nexport function renderNostrCard(params: {\r\n  props: ChannelsProps;\r\n  nostr?: NostrStatus | null;\r\n  nostrAccounts: ChannelAccountSnapshot[];\r\n  accountCountLabel: unknown;\r\n  /** Profile form state (optional - if provided, shows form) */\r\n  profileFormState?: NostrProfileFormState | null;\r\n  /** Profile form callbacks */\r\n  profileFormCallbacks?: NostrProfileFormCallbacks | null;\r\n  /** Called when Edit Profile is clicked */\r\n  onEditProfile?: () => void;\r\n}) {\r\n  const {\r\n    props,\r\n    nostr,\r\n    nostrAccounts,\r\n    accountCountLabel,\r\n    profileFormState,\r\n    profileFormCallbacks,\r\n    onEditProfile,\r\n  } = params;\r\n  const primaryAccount = nostrAccounts[0];\r\n  const summaryConfigured = nostr?.configured ?? primaryAccount?.configured ?? false;\r\n  const summaryRunning = nostr?.running ?? primaryAccount?.running ?? false;\r\n  const summaryPublicKey =\r\n    nostr?.publicKey ?? (primaryAccount as { publicKey?: string } | undefined)?.publicKey;\r\n  const summaryLastStartAt = nostr?.lastStartAt ?? primaryAccount?.lastStartAt ?? null;\r\n  const summaryLastError = nostr?.lastError ?? primaryAccount?.lastError ?? null;\r\n  const hasMultipleAccounts = nostrAccounts.length > 1;\r\n  const showingForm = profileFormState !== null && profileFormState !== undefined;\r\n\r\n  const renderAccountCard = (account: ChannelAccountSnapshot) => {\r\n    const publicKey = (account as { publicKey?: string }).publicKey;\r\n    const profile = (account as { profile?: { name?: string; displayName?: string } }).profile;\r\n    const displayName = profile?.displayName ?? profile?.name ?? account.name ?? account.accountId;\r\n\r\n    return html`\r\n      <div class=\"account-card\">\r\n        <div class=\"account-card-header\">\r\n          <div class=\"account-card-title\">${displayName}</div>\r\n          <div class=\"account-card-id\">${account.accountId}</div>\r\n        </div>\r\n        <div class=\"status-list account-card-status\">\r\n          <div>\r\n            <span class=\"label\">Running</span>\r\n            <span>${account.running ? \"Yes\" : \"No\"}</span>\r\n          </div>\r\n          <div>\r\n            <span class=\"label\">Configured</span>\r\n            <span>${account.configured ? \"Yes\" : \"No\"}</span>\r\n          </div>\r\n          <div>\r\n            <span class=\"label\">Public Key</span>\r\n            <span class=\"monospace\" title=\"${publicKey ?? \"\"}\">${truncatePubkey(publicKey)}</span>\r\n          </div>\r\n          <div>\r\n            <span class=\"label\">Last inbound</span>\r\n            <span>${account.lastInboundAt ? formatRelativeTimestamp(account.lastInboundAt) : \"n/a\"}</span>\r\n          </div>\r\n          ${\r\n            account.lastError\r\n              ? html`\r\n                <div class=\"account-card-error\">${account.lastError}</div>\r\n              `\r\n              : nothing\r\n          }\r\n        </div>\r\n      </div>\r\n    `;\r\n  };\r\n\r\n  const renderProfileSection = () => {\r\n    // If showing form, render the form instead of the read-only view\r\n    if (showingForm && profileFormCallbacks) {\r\n      return renderNostrProfileForm({\r\n        state: profileFormState,\r\n        callbacks: profileFormCallbacks,\r\n        accountId: nostrAccounts[0]?.accountId ?? \"default\",\r\n      });\r\n    }\r\n\r\n    const profile =\r\n      (\r\n        primaryAccount as\r\n          | {\r\n              profile?: {\r\n                name?: string;\r\n                displayName?: string;\r\n                about?: string;\r\n                picture?: string;\r\n                nip05?: string;\r\n              };\r\n            }\r\n          | undefined\r\n      )?.profile ?? nostr?.profile;\r\n    const { name, displayName, about, picture, nip05 } = profile ?? {};\r\n    const hasAnyProfileData = name || displayName || about || picture || nip05;\r\n\r\n    return html`\r\n      <div style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n          <div style=\"font-weight: 500;\">Profile</div>\r\n          ${\r\n            summaryConfigured\r\n              ? html`\r\n                <button\r\n                  class=\"btn btn-sm\"\r\n                  @click=${onEditProfile}\r\n                  style=\"font-size: 12px; padding: 4px 8px;\"\r\n                >\r\n                  Edit Profile\r\n                </button>\r\n              `\r\n              : nothing\r\n          }\r\n        </div>\r\n        ${\r\n          hasAnyProfileData\r\n            ? html`\r\n              <div class=\"status-list\">\r\n                ${\r\n                  picture\r\n                    ? html`\r\n                      <div style=\"margin-bottom: 8px;\">\r\n                        <img\r\n                          src=${picture}\r\n                          alt=\"Profile picture\"\r\n                          style=\"width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color);\"\r\n                          @error=${(e: Event) => {\r\n                            (e.target as HTMLImageElement).style.display = \"none\";\r\n                          }}\r\n                        />\r\n                      </div>\r\n                    `\r\n                    : nothing\r\n                }\r\n                ${name ? html`<div><span class=\"label\">Name</span><span>${name}</span></div>` : nothing}\r\n                ${\r\n                  displayName\r\n                    ? html`<div><span class=\"label\">Display Name</span><span>${displayName}</span></div>`\r\n                    : nothing\r\n                }\r\n                ${\r\n                  about\r\n                    ? html`<div><span class=\"label\">About</span><span style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis;\">${about}</span></div>`\r\n                    : nothing\r\n                }\r\n                ${nip05 ? html`<div><span class=\"label\">NIP-05</span><span>${nip05}</span></div>` : nothing}\r\n              </div>\r\n            `\r\n            : html`\r\n                <div style=\"color: var(--text-muted); font-size: 13px\">\r\n                  No profile set. Click \"Edit Profile\" to add your name, bio, and avatar.\r\n                </div>\r\n              `\r\n        }\r\n      </div>\r\n    `;\r\n  };\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Nostr</div>\r\n      <div class=\"card-sub\">Decentralized DMs via Nostr relays (NIP-04).</div>\r\n      ${accountCountLabel}\r\n\r\n      ${\r\n        hasMultipleAccounts\r\n          ? html`\r\n            <div class=\"account-card-list\">\r\n              ${nostrAccounts.map((account) => renderAccountCard(account))}\r\n            </div>\r\n          `\r\n          : html`\r\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n              <div>\r\n                <span class=\"label\">Configured</span>\r\n                <span>${summaryConfigured ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Running</span>\r\n                <span>${summaryRunning ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Public Key</span>\r\n                <span class=\"monospace\" title=\"${summaryPublicKey ?? \"\"}\"\r\n                  >${truncatePubkey(summaryPublicKey)}</span\r\n                >\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Last start</span>\r\n                <span>${summaryLastStartAt ? formatRelativeTimestamp(summaryLastStartAt) : \"n/a\"}</span>\r\n              </div>\r\n            </div>\r\n          `\r\n      }\r\n\r\n      ${\r\n        summaryLastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${summaryLastError}</div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderProfileSection()}\r\n\r\n      ${renderChannelConfigSection({ channelId: \"nostr\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(false)}>Refresh</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ChannelAccountSnapshot } from \"../types.ts\";\r\nimport type { ChannelKey, ChannelsProps } from \"./channels.types.ts\";\r\n\r\nexport function channelEnabled(key: ChannelKey, props: ChannelsProps) {\r\n  const snapshot = props.snapshot;\r\n  const channels = snapshot?.channels as Record<string, unknown> | null;\r\n  if (!snapshot || !channels) {\r\n    return false;\r\n  }\r\n  const channelStatus = channels[key] as Record<string, unknown> | undefined;\r\n  const configured = typeof channelStatus?.configured === \"boolean\" && channelStatus.configured;\r\n  const running = typeof channelStatus?.running === \"boolean\" && channelStatus.running;\r\n  const connected = typeof channelStatus?.connected === \"boolean\" && channelStatus.connected;\r\n  const accounts = snapshot.channelAccounts?.[key] ?? [];\r\n  const accountActive = accounts.some(\r\n    (account) => account.configured || account.running || account.connected,\r\n  );\r\n  return configured || running || connected || accountActive;\r\n}\r\n\r\nexport function getChannelAccountCount(\r\n  key: ChannelKey,\r\n  channelAccounts?: Record<string, ChannelAccountSnapshot[]> | null,\r\n): number {\r\n  return channelAccounts?.[key]?.length ?? 0;\r\n}\r\n\r\nexport function renderChannelAccountCount(\r\n  key: ChannelKey,\r\n  channelAccounts?: Record<string, ChannelAccountSnapshot[]> | null,\r\n) {\r\n  const count = getChannelAccountCount(key, channelAccounts);\r\n  if (count < 2) {\r\n    return nothing;\r\n  }\r\n  return html`<div class=\"account-count\">Accounts (${count})</div>`;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { SignalStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderSignalCard(params: {\r\n  props: ChannelsProps;\r\n  signal?: SignalStatus | null;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, signal, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Signal</div>\r\n      <div class=\"card-sub\">signal-cli status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${signal?.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${signal?.running ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Base URL</span>\r\n          <span>${signal?.baseUrl ?? \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last start</span>\r\n          <span>${signal?.lastStartAt ? formatRelativeTimestamp(signal.lastStartAt) : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last probe</span>\r\n          <span>${signal?.lastProbeAt ? formatRelativeTimestamp(signal.lastProbeAt) : \"n/a\"}</span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        signal?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${signal.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        signal?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${signal.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${signal.probe.status ?? \"\"} ${signal.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"signal\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { SlackStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderSlackCard(params: {\r\n  props: ChannelsProps;\r\n  slack?: SlackStatus | null;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, slack, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Slack</div>\r\n      <div class=\"card-sub\">Socket mode status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${slack?.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${slack?.running ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last start</span>\r\n          <span>${slack?.lastStartAt ? formatRelativeTimestamp(slack.lastStartAt) : \"n/a\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last probe</span>\r\n          <span>${slack?.lastProbeAt ? formatRelativeTimestamp(slack.lastProbeAt) : \"n/a\"}</span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        slack?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${slack.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        slack?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${slack.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${slack.probe.status ?? \"\"} ${slack.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"slack\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ChannelAccountSnapshot, TelegramStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderTelegramCard(params: {\r\n  props: ChannelsProps;\r\n  telegram?: TelegramStatus;\r\n  telegramAccounts: ChannelAccountSnapshot[];\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, telegram, telegramAccounts, accountCountLabel } = params;\r\n  const hasMultipleAccounts = telegramAccounts.length > 1;\r\n\r\n  const renderAccountCard = (account: ChannelAccountSnapshot) => {\r\n    const probe = account.probe as { bot?: { username?: string } } | undefined;\r\n    const botUsername = probe?.bot?.username;\r\n    const label = account.name || account.accountId;\r\n    return html`\r\n      <div class=\"account-card\">\r\n        <div class=\"account-card-header\">\r\n          <div class=\"account-card-title\">\r\n            ${botUsername ? `@${botUsername}` : label}\r\n          </div>\r\n          <div class=\"account-card-id\">${account.accountId}</div>\r\n        </div>\r\n        <div class=\"status-list account-card-status\">\r\n          <div>\r\n            <span class=\"label\">Running</span>\r\n            <span>${account.running ? \"Yes\" : \"No\"}</span>\r\n          </div>\r\n          <div>\r\n            <span class=\"label\">Configured</span>\r\n            <span>${account.configured ? \"Yes\" : \"No\"}</span>\r\n          </div>\r\n          <div>\r\n            <span class=\"label\">Last inbound</span>\r\n            <span>${account.lastInboundAt ? formatRelativeTimestamp(account.lastInboundAt) : \"n/a\"}</span>\r\n          </div>\r\n          ${\r\n            account.lastError\r\n              ? html`\r\n                <div class=\"account-card-error\">\r\n                  ${account.lastError}\r\n                </div>\r\n              `\r\n              : nothing\r\n          }\r\n        </div>\r\n      </div>\r\n    `;\r\n  };\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">Telegram</div>\r\n      <div class=\"card-sub\">Bot status and channel configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      ${\r\n        hasMultipleAccounts\r\n          ? html`\r\n            <div class=\"account-card-list\">\r\n              ${telegramAccounts.map((account) => renderAccountCard(account))}\r\n            </div>\r\n          `\r\n          : html`\r\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n              <div>\r\n                <span class=\"label\">Configured</span>\r\n                <span>${telegram?.configured ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Running</span>\r\n                <span>${telegram?.running ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Mode</span>\r\n                <span>${telegram?.mode ?? \"n/a\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Last start</span>\r\n                <span>${telegram?.lastStartAt ? formatRelativeTimestamp(telegram.lastStartAt) : \"n/a\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Last probe</span>\r\n                <span>${telegram?.lastProbeAt ? formatRelativeTimestamp(telegram.lastProbeAt) : \"n/a\"}</span>\r\n              </div>\r\n            </div>\r\n          `\r\n      }\r\n\r\n      ${\r\n        telegram?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${telegram.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        telegram?.probe\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            Probe ${telegram.probe.ok ? \"ok\" : \"failed\"} ·\r\n            ${telegram.probe.status ?? \"\"} ${telegram.probe.error ?? \"\"}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: \"telegram\", props })}\r\n\r\n      <div class=\"row\" style=\"margin-top: 12px;\">\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Probe\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { WhatsAppStatus } from \"../types.ts\";\r\nimport type { ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp, formatDurationHuman } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\n\r\nexport function renderWhatsAppCard(params: {\r\n  props: ChannelsProps;\r\n  whatsapp?: WhatsAppStatus;\r\n  accountCountLabel: unknown;\r\n}) {\r\n  const { props, whatsapp, accountCountLabel } = params;\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">WhatsApp</div>\r\n      <div class=\"card-sub\">Link WhatsApp Web and monitor connection health.</div>\r\n      ${accountCountLabel}\r\n\r\n      <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${whatsapp?.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Linked</span>\r\n          <span>${whatsapp?.linked ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${whatsapp?.running ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Connected</span>\r\n          <span>${whatsapp?.connected ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last connect</span>\r\n          <span>\r\n            ${whatsapp?.lastConnectedAt ? formatRelativeTimestamp(whatsapp.lastConnectedAt) : \"n/a\"}\r\n          </span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last message</span>\r\n          <span>\r\n            ${whatsapp?.lastMessageAt ? formatRelativeTimestamp(whatsapp.lastMessageAt) : \"n/a\"}\r\n          </span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Auth age</span>\r\n          <span>\r\n            ${whatsapp?.authAgeMs != null ? formatDurationHuman(whatsapp.authAgeMs) : \"n/a\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      ${\r\n        whatsapp?.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${whatsapp.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        props.whatsappMessage\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            ${props.whatsappMessage}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        props.whatsappQrDataUrl\r\n          ? html`<div class=\"qr-wrap\">\r\n            <img src=${props.whatsappQrDataUrl} alt=\"WhatsApp QR\" />\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"row\" style=\"margin-top: 14px; flex-wrap: wrap;\">\r\n        <button\r\n          class=\"btn primary\"\r\n          ?disabled=${props.whatsappBusy}\r\n          @click=${() => props.onWhatsAppStart(false)}\r\n        >\r\n          ${props.whatsappBusy ? \"Working…\" : \"Show QR\"}\r\n        </button>\r\n        <button\r\n          class=\"btn\"\r\n          ?disabled=${props.whatsappBusy}\r\n          @click=${() => props.onWhatsAppStart(true)}\r\n        >\r\n          Relink\r\n        </button>\r\n        <button\r\n          class=\"btn\"\r\n          ?disabled=${props.whatsappBusy}\r\n          @click=${() => props.onWhatsAppWait()}\r\n        >\r\n          Wait for scan\r\n        </button>\r\n        <button\r\n          class=\"btn danger\"\r\n          ?disabled=${props.whatsappBusy}\r\n          @click=${() => props.onWhatsAppLogout()}\r\n        >\r\n          Logout\r\n        </button>\r\n        <button class=\"btn\" @click=${() => props.onRefresh(true)}>\r\n          Refresh\r\n        </button>\r\n      </div>\r\n\r\n      ${renderChannelConfigSection({ channelId: \"whatsapp\", props })}\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type {\r\n  ChannelAccountSnapshot,\r\n  ChannelUiMetaEntry,\r\n  ChannelsStatusSnapshot,\r\n  DiscordStatus,\r\n  GoogleChatStatus,\r\n  IMessageStatus,\r\n  NostrProfile,\r\n  NostrStatus,\r\n  SignalStatus,\r\n  SlackStatus,\r\n  TelegramStatus,\r\n  WhatsAppStatus,\r\n} from \"../types.ts\";\r\nimport type { ChannelKey, ChannelsChannelData, ChannelsProps } from \"./channels.types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { renderChannelConfigSection } from \"./channels.config.ts\";\r\nimport { renderDiscordCard } from \"./channels.discord.ts\";\r\nimport { renderGoogleChatCard } from \"./channels.googlechat.ts\";\r\nimport { renderIMessageCard } from \"./channels.imessage.ts\";\r\nimport { renderNostrCard } from \"./channels.nostr.ts\";\r\nimport { channelEnabled, renderChannelAccountCount } from \"./channels.shared.ts\";\r\nimport { renderSignalCard } from \"./channels.signal.ts\";\r\nimport { renderSlackCard } from \"./channels.slack.ts\";\r\nimport { renderTelegramCard } from \"./channels.telegram.ts\";\r\nimport { renderWhatsAppCard } from \"./channels.whatsapp.ts\";\r\n\r\nexport function renderChannels(props: ChannelsProps) {\r\n  const channels = props.snapshot?.channels as Record<string, unknown> | null;\r\n  const whatsapp = (channels?.whatsapp ?? undefined) as WhatsAppStatus | undefined;\r\n  const telegram = (channels?.telegram ?? undefined) as TelegramStatus | undefined;\r\n  const discord = (channels?.discord ?? null) as DiscordStatus | null;\r\n  const googlechat = (channels?.googlechat ?? null) as GoogleChatStatus | null;\r\n  const slack = (channels?.slack ?? null) as SlackStatus | null;\r\n  const signal = (channels?.signal ?? null) as SignalStatus | null;\r\n  const imessage = (channels?.imessage ?? null) as IMessageStatus | null;\r\n  const nostr = (channels?.nostr ?? null) as NostrStatus | null;\r\n  const channelOrder = resolveChannelOrder(props.snapshot);\r\n  const orderedChannels = channelOrder\r\n    .map((key, index) => ({\r\n      key,\r\n      enabled: channelEnabled(key, props),\r\n      order: index,\r\n    }))\r\n    .toSorted((a, b) => {\r\n      if (a.enabled !== b.enabled) {\r\n        return a.enabled ? -1 : 1;\r\n      }\r\n      return a.order - b.order;\r\n    });\r\n\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      ${orderedChannels.map((channel) =>\r\n        renderChannel(channel.key, props, {\r\n          whatsapp,\r\n          telegram,\r\n          discord,\r\n          googlechat,\r\n          slack,\r\n          signal,\r\n          imessage,\r\n          nostr,\r\n          channelAccounts: props.snapshot?.channelAccounts ?? null,\r\n        }),\r\n      )}\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Channel health</div>\r\n          <div class=\"card-sub\">Channel status snapshots from the gateway.</div>\r\n        </div>\r\n        <div class=\"muted\">${props.lastSuccessAt ? formatRelativeTimestamp(props.lastSuccessAt) : \"n/a\"}</div>\r\n      </div>\r\n      ${\r\n        props.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${props.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n      <pre class=\"code-block\" style=\"margin-top: 12px;\">\r\n${props.snapshot ? JSON.stringify(props.snapshot, null, 2) : \"No snapshot yet.\"}\r\n      </pre>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction resolveChannelOrder(snapshot: ChannelsStatusSnapshot | null): ChannelKey[] {\r\n  if (snapshot?.channelMeta?.length) {\r\n    return snapshot.channelMeta.map((entry) => entry.id);\r\n  }\r\n  if (snapshot?.channelOrder?.length) {\r\n    return snapshot.channelOrder;\r\n  }\r\n  return [\"whatsapp\", \"telegram\", \"discord\", \"googlechat\", \"slack\", \"signal\", \"imessage\", \"nostr\"];\r\n}\r\n\r\nfunction renderChannel(key: ChannelKey, props: ChannelsProps, data: ChannelsChannelData) {\r\n  const accountCountLabel = renderChannelAccountCount(key, data.channelAccounts);\r\n  switch (key) {\r\n    case \"whatsapp\":\r\n      return renderWhatsAppCard({\r\n        props,\r\n        whatsapp: data.whatsapp,\r\n        accountCountLabel,\r\n      });\r\n    case \"telegram\":\r\n      return renderTelegramCard({\r\n        props,\r\n        telegram: data.telegram,\r\n        telegramAccounts: data.channelAccounts?.telegram ?? [],\r\n        accountCountLabel,\r\n      });\r\n    case \"discord\":\r\n      return renderDiscordCard({\r\n        props,\r\n        discord: data.discord,\r\n        accountCountLabel,\r\n      });\r\n    case \"googlechat\":\r\n      return renderGoogleChatCard({\r\n        props,\r\n        googleChat: data.googlechat,\r\n        accountCountLabel,\r\n      });\r\n    case \"slack\":\r\n      return renderSlackCard({\r\n        props,\r\n        slack: data.slack,\r\n        accountCountLabel,\r\n      });\r\n    case \"signal\":\r\n      return renderSignalCard({\r\n        props,\r\n        signal: data.signal,\r\n        accountCountLabel,\r\n      });\r\n    case \"imessage\":\r\n      return renderIMessageCard({\r\n        props,\r\n        imessage: data.imessage,\r\n        accountCountLabel,\r\n      });\r\n    case \"nostr\": {\r\n      const nostrAccounts = data.channelAccounts?.nostr ?? [];\r\n      const primaryAccount = nostrAccounts[0];\r\n      const accountId = primaryAccount?.accountId ?? \"default\";\r\n      const profile =\r\n        (primaryAccount as { profile?: NostrProfile | null } | undefined)?.profile ?? null;\r\n      const showForm =\r\n        props.nostrProfileAccountId === accountId ? props.nostrProfileFormState : null;\r\n      const profileFormCallbacks = showForm\r\n        ? {\r\n            onFieldChange: props.onNostrProfileFieldChange,\r\n            onSave: props.onNostrProfileSave,\r\n            onImport: props.onNostrProfileImport,\r\n            onCancel: props.onNostrProfileCancel,\r\n            onToggleAdvanced: props.onNostrProfileToggleAdvanced,\r\n          }\r\n        : null;\r\n      return renderNostrCard({\r\n        props,\r\n        nostr: data.nostr,\r\n        nostrAccounts,\r\n        accountCountLabel,\r\n        profileFormState: showForm,\r\n        profileFormCallbacks,\r\n        onEditProfile: () => props.onNostrProfileEdit(accountId, profile),\r\n      });\r\n    }\r\n    default:\r\n      return renderGenericChannelCard(key, props, data.channelAccounts ?? {});\r\n  }\r\n}\r\n\r\nfunction renderGenericChannelCard(\r\n  key: ChannelKey,\r\n  props: ChannelsProps,\r\n  channelAccounts: Record<string, ChannelAccountSnapshot[]>,\r\n) {\r\n  const label = resolveChannelLabel(props.snapshot, key);\r\n  const status = props.snapshot?.channels?.[key] as Record<string, unknown> | undefined;\r\n  const configured = typeof status?.configured === \"boolean\" ? status.configured : undefined;\r\n  const running = typeof status?.running === \"boolean\" ? status.running : undefined;\r\n  const connected = typeof status?.connected === \"boolean\" ? status.connected : undefined;\r\n  const lastError = typeof status?.lastError === \"string\" ? status.lastError : undefined;\r\n  const accounts = channelAccounts[key] ?? [];\r\n  const accountCountLabel = renderChannelAccountCount(key, channelAccounts);\r\n\r\n  return html`\r\n    <div class=\"card\">\r\n      <div class=\"card-title\">${label}</div>\r\n      <div class=\"card-sub\">Channel status and configuration.</div>\r\n      ${accountCountLabel}\r\n\r\n      ${\r\n        accounts.length > 0\r\n          ? html`\r\n            <div class=\"account-card-list\">\r\n              ${accounts.map((account) => renderGenericAccount(account))}\r\n            </div>\r\n          `\r\n          : html`\r\n            <div class=\"status-list\" style=\"margin-top: 16px;\">\r\n              <div>\r\n                <span class=\"label\">Configured</span>\r\n                <span>${configured == null ? \"n/a\" : configured ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Running</span>\r\n                <span>${running == null ? \"n/a\" : running ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n              <div>\r\n                <span class=\"label\">Connected</span>\r\n                <span>${connected == null ? \"n/a\" : connected ? \"Yes\" : \"No\"}</span>\r\n              </div>\r\n            </div>\r\n          `\r\n      }\r\n\r\n      ${\r\n        lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n\r\n      ${renderChannelConfigSection({ channelId: key, props })}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction resolveChannelMetaMap(\r\n  snapshot: ChannelsStatusSnapshot | null,\r\n): Record<string, ChannelUiMetaEntry> {\r\n  if (!snapshot?.channelMeta?.length) {\r\n    return {};\r\n  }\r\n  return Object.fromEntries(snapshot.channelMeta.map((entry) => [entry.id, entry]));\r\n}\r\n\r\nfunction resolveChannelLabel(snapshot: ChannelsStatusSnapshot | null, key: string): string {\r\n  const meta = resolveChannelMetaMap(snapshot)[key];\r\n  return meta?.label ?? snapshot?.channelLabels?.[key] ?? key;\r\n}\r\n\r\nconst RECENT_ACTIVITY_THRESHOLD_MS = 10 * 60 * 1000; // 10 minutes\r\n\r\nfunction hasRecentActivity(account: ChannelAccountSnapshot): boolean {\r\n  if (!account.lastInboundAt) {\r\n    return false;\r\n  }\r\n  return Date.now() - account.lastInboundAt < RECENT_ACTIVITY_THRESHOLD_MS;\r\n}\r\n\r\nfunction deriveRunningStatus(account: ChannelAccountSnapshot): \"Yes\" | \"No\" | \"Active\" {\r\n  if (account.running) {\r\n    return \"Yes\";\r\n  }\r\n  // If we have recent inbound activity, the channel is effectively running\r\n  if (hasRecentActivity(account)) {\r\n    return \"Active\";\r\n  }\r\n  return \"No\";\r\n}\r\n\r\nfunction deriveConnectedStatus(account: ChannelAccountSnapshot): \"Yes\" | \"No\" | \"Active\" | \"n/a\" {\r\n  if (account.connected === true) {\r\n    return \"Yes\";\r\n  }\r\n  if (account.connected === false) {\r\n    return \"No\";\r\n  }\r\n  // If connected is null/undefined but we have recent activity, show as active\r\n  if (hasRecentActivity(account)) {\r\n    return \"Active\";\r\n  }\r\n  return \"n/a\";\r\n}\r\n\r\nfunction renderGenericAccount(account: ChannelAccountSnapshot) {\r\n  const runningStatus = deriveRunningStatus(account);\r\n  const connectedStatus = deriveConnectedStatus(account);\r\n\r\n  return html`\r\n    <div class=\"account-card\">\r\n      <div class=\"account-card-header\">\r\n        <div class=\"account-card-title\">${account.name || account.accountId}</div>\r\n        <div class=\"account-card-id\">${account.accountId}</div>\r\n      </div>\r\n      <div class=\"status-list account-card-status\">\r\n        <div>\r\n          <span class=\"label\">Running</span>\r\n          <span>${runningStatus}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Configured</span>\r\n          <span>${account.configured ? \"Yes\" : \"No\"}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Connected</span>\r\n          <span>${connectedStatus}</span>\r\n        </div>\r\n        <div>\r\n          <span class=\"label\">Last inbound</span>\r\n          <span>${account.lastInboundAt ? formatRelativeTimestamp(account.lastInboundAt) : \"n/a\"}</span>\r\n        </div>\r\n        ${\r\n          account.lastError\r\n            ? html`\r\n              <div class=\"account-card-error\">\r\n                ${account.lastError}\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import{isSingleExpression as i}from\"./directive-helpers.js\";import{Directive as t,PartType as e}from\"./directive.js\";export{directive}from\"./directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=(i,t)=>{const e=i._$AN;if(void 0===e)return!1;for(const i of e)i._$AO?.(t,!1),s(i,t);return!0},o=i=>{let t,e;do{if(void 0===(t=i._$AM))break;e=t._$AN,e.delete(i),i=t}while(0===e?.size)},r=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(void 0===e)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),c(t)}};function h(i){void 0!==this._$AN?(o(this),this._$AM=i,r(this)):this._$AM=i}function n(i,t=!1,e=0){const r=this._$AH,h=this._$AN;if(void 0!==h&&0!==h.size)if(t)if(Array.isArray(r))for(let i=e;i<r.length;i++)s(r[i],!1),o(r[i]);else null!=r&&(s(r,!1),o(r));else s(this,i)}const c=i=>{i.type==e.CHILD&&(i._$AP??=n,i._$AQ??=h)};class f extends t{constructor(){super(...arguments),this._$AN=void 0}_$AT(i,t,e){super._$AT(i,t,e),r(this),this.isConnected=i._$AU}_$AO(i,t=!0){i!==this.isConnected&&(this.isConnected=i,i?this.reconnected?.():this.disconnected?.()),t&&(s(this,i),o(this))}setValue(t){if(i(this._$Ct))this._$Ct._$AI(t,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=t,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}export{f as AsyncDirective,t as Directive,e as PartType};\n//# sourceMappingURL=async-directive.js.map\n","import{nothing as t}from\"../lit-html.js\";import{AsyncDirective as i}from\"../async-directive.js\";import{directive as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=()=>new h;class h{}const o=new WeakMap,n=s(class extends i{render(i){return t}update(i,[s]){const e=s!==this.G;return e&&void 0!==this.G&&this.rt(void 0),(e||this.lt!==this.ct)&&(this.G=s,this.ht=i.options?.host,this.rt(this.ct=i.element)),t}rt(t){if(this.isConnected||(t=void 0),\"function\"==typeof this.G){const i=this.ht??globalThis;let s=o.get(i);void 0===s&&(s=new WeakMap,o.set(i,s)),void 0!==s.get(this.G)&&this.G.call(this.ht,void 0),s.set(this.G,t),void 0!==t&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return\"function\"==typeof this.G?o.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});export{e as createRef,n as ref};\n//# sourceMappingURL=ref.js.map\n","import{nothing as t,noChange as i}from\"../lit-html.js\";import{directive as r,Directive as s,PartType as n}from\"../directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */class e extends s{constructor(i){if(super(i),this.it=t,i.type!==n.CHILD)throw Error(this.constructor.directiveName+\"() can only be used in child bindings\")}render(r){if(r===t||null==r)return this._t=void 0,this.it=r;if(r===i)return r;if(\"string\"!=typeof r)throw Error(this.constructor.directiveName+\"() called with a non-string value\");if(r===this.it)return this._t;this.it=r;const s=[r];return s.raw=s,this._t={_$litType$:this.constructor.resultType,strings:s,values:[]}}}e.directiveName=\"unsafeHTML\",e.resultType=1;const o=r(e);export{e as UnsafeHTMLDirective,o as unsafeHTML};\n//# sourceMappingURL=unsafe-html.js.map\n","/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */\n\nconst {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor\n} = Object;\nlet {\n  freeze,\n  seal,\n  create\n} = Object; // eslint-disable-line import/no-mutable-exports\nlet {\n  apply,\n  construct\n} = typeof Reflect !== 'undefined' && Reflect;\nif (!freeze) {\n  freeze = function freeze(x) {\n    return x;\n  };\n}\nif (!seal) {\n  seal = function seal(x) {\n    return x;\n  };\n}\nif (!apply) {\n  apply = function apply(func, thisArg) {\n    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n    return func.apply(thisArg, args);\n  };\n}\nif (!construct) {\n  construct = function construct(Func) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    return new Func(...args);\n  };\n}\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySplice = unapply(Array.prototype.splice);\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\nconst regExpTest = unapply(RegExp.prototype.test);\nconst typeErrorCreate = unconstruct(TypeError);\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply(func) {\n  return function (thisArg) {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n    return apply(func, thisArg, args);\n  };\n}\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct(Func) {\n  return function () {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return construct(Func, args);\n  };\n}\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(set, array) {\n  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          array[l] = lcElement;\n        }\n        element = lcElement;\n      }\n    }\n    set[element] = true;\n  }\n  return set;\n}\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray(array) {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n  return array;\n}\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone(object) {\n  const newObject = create(null);\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (value && typeof value === 'object' && value.constructor === Object) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n  return newObject;\n}\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter(object, prop) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n    object = getPrototypeOf(object);\n  }\n  function fallbackValue() {\n    return null;\n  }\n  return fallbackValue;\n}\n\nconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'search', 'section', 'select', 'shadow', 'slot', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\nconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'enterkeyhint', 'exportparts', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'inputmode', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'part', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\nconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\nconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\nconst text = freeze(['#text']);\n\nconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'exportparts', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inert', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'part', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'slot', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\nconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'mask-type', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\nconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\nconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n// eslint-disable-next-line unicorn/better-regex\nconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nconst DOCTYPE_NAME = seal(/^html$/i);\nconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\nvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  ARIA_ATTR: ARIA_ATTR,\n  ATTR_WHITESPACE: ATTR_WHITESPACE,\n  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n  DATA_ATTR: DATA_ATTR,\n  DOCTYPE_NAME: DOCTYPE_NAME,\n  ERB_EXPR: ERB_EXPR,\n  IS_ALLOWED_URI: IS_ALLOWED_URI,\n  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n  MUSTACHE_EXPR: MUSTACHE_EXPR,\n  TMPLIT_EXPR: TMPLIT_EXPR\n});\n\n/* eslint-disable @typescript-eslint/indent */\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5,\n  // Deprecated\n  entityNode: 6,\n  // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12 // Deprecated\n};\nconst getGlobal = function getGlobal() {\n  return typeof window === 'undefined' ? null : window;\n};\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n    return null;\n  }\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      }\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n    return null;\n  }\n};\nconst _createHooksMap = function _createHooksMap() {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: []\n  };\n};\nfunction createDOMPurify() {\n  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n  const DOMPurify = root => createDOMPurify(root);\n  DOMPurify.version = '3.3.1';\n  DOMPurify.removed = [];\n  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n    return DOMPurify;\n  }\n  let {\n    document\n  } = window;\n  const originalDocument = document;\n  const currentScript = originalDocument.currentScript;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes\n  } = window;\n  const ElementPrototype = Element.prototype;\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName\n  } = document;\n  const {\n    importNode\n  } = originalDocument;\n  let hooks = _createHooksMap();\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT\n  } = EXPRESSIONS;\n  let {\n    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n  } = EXPRESSIONS;\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    allowCustomizedBuiltInElements: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: false\n    }\n  }));\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */\n  const EXTRA_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    }\n  }));\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES = {};\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc = null;\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG = null;\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n  const formElement = document.createElement('form');\n  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function _parseConfig() {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n    PARSER_MEDIA_TYPE =\n    // eslint-disable-next-line unicorn/prefer-includes\n    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, html$1);\n        addToSet(ALLOWED_ATTR, html);\n      }\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, svg$1);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, svgFilters);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, mathMl$1);\n        addToSet(ALLOWED_ATTR, mathMl);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n    }\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (typeof cfg.ADD_TAGS === 'function') {\n        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;\n      } else {\n        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n        }\n        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n      }\n    }\n    if (cfg.ADD_ATTR) {\n      if (typeof cfg.ADD_ATTR === 'function') {\n        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;\n      } else {\n        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n        }\n        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n      }\n    }\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n    if (cfg.ADD_FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.ADD_FORBID_CONTENTS, transformCaseFunc);\n    }\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n      }\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n      }\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n      }\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n    CONFIG = cfg;\n  };\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function _checkValidNamespace(element) {\n    let parent = getParentNode(element);\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template'\n      };\n    }\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n      }\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n    }\n    // For XHTML and XML documents that support custom namespaces\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return true;\n    }\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function _forceRemove(node) {\n    arrayPush(DOMPurify.removed, {\n      element: node\n    });\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function _removeAttribute(name, element) {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element\n      });\n    }\n    element.removeAttribute(name);\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function _initDocument(dirty) {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n    }\n    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n    const body = doc.body || doc.documentElement;\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n    }\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n    }\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function _createNodeIterator(root) {\n    return createNodeIterator.call(root.ownerDocument || root, root,\n    // eslint-disable-next-line no-bitwise\n    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n  };\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function _isClobbered(element) {\n    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n  };\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function _isNode(value) {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n  function _executeHooks(hooks, currentNode, data) {\n    arrayForEach(hooks, hook => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function _sanitizeElements(currentNode) {\n    let content = null;\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS\n    });\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\\w!]/g, currentNode.textContent)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any kind of possibly harmful comments */\n    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove element if anything forbids its presence */\n    if (!(EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function && EXTRA_ELEMENT_HANDLING.tagCheck(tagName)) && (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n          return false;\n        }\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n          return false;\n        }\n      }\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        content = stringReplace(content, expr, ' ');\n      });\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, {\n          element: currentNode.cloneNode()\n        });\n        currentNode.textContent = content;\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n    return false;\n  };\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n    /* Make sure attribute cannot clobber */\n    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n      return false;\n    }\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function && EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)) ||\n      // Alternative, second condition checks if it's an `is`-attribute, AND\n      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n      return false;\n    } else ;\n    return true;\n  };\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n    const {\n      attributes\n    } = currentNode;\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined\n    };\n    let l = attributes.length;\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const {\n        name,\n        namespaceURI,\n        value: attrValue\n      } = attr;\n      const lcName = transformCaseFunc(name);\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n      /* Work around a security issue with comments inside attributes */\n      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title|textarea)/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */\n      if (lcName === 'attributename' && stringMatch(value, 'href')) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Handle attributes that require Trusted Types */\n      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n        if (namespaceURI) ; else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML':\n              {\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n              }\n            case 'TrustedScriptURL':\n              {\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n              }\n          }\n        }\n      }\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n    while (shadowNode = shadowIterator.nextNode()) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty) {\n    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if (dirty.nodeName) {\n        const tagName = transformCaseFunc(dirty.nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n      // eslint-disable-next-line unicorn/prefer-includes\n      dirty.indexOf('<') === -1) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      }\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n    /* Now start iterating over the created document */\n    while (currentNode = nodeIterator.nextNode()) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n      return returnNode;\n    }\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n    /* Serialize doctype if allowed */\n    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n  };\n  DOMPurify.setConfig = function () {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n    return arrayPop(hooks[entryPoint]);\n  };\n  DOMPurify.removeHooks = function (entryPoint) {\n    hooks[entryPoint] = [];\n  };\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n  return DOMPurify;\n}\nvar purify = createDOMPurify();\n\nexport { purify as default };\n//# sourceMappingURL=purify.es.mjs.map\n","/**\n * marked v17.0.3 - a markdown parser\n * Copyright (c) 2018-2026, MarkedJS. (MIT License)\n * Copyright (c) 2011-2018, Christopher Jeffrey. (MIT License)\n * https://github.com/markedjs/marked\n */\n\n/**\n * DO NOT EDIT THIS FILE\n * The code in this file is generated from files in ./src/\n */\n\nfunction M(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=M();function H(u){T=u}var _={exec:()=>null};function k(u,e=\"\"){let t=typeof u==\"string\"?u:u.source,n={replace:(r,i)=>{let s=typeof i==\"string\"?i:i.source;return s=s.replace(m.caret,\"$1\"),t=t.replace(r,s),n},getRegex:()=>new RegExp(t,e)};return n}var Re=(()=>{try{return!!new RegExp(\"(?<=1)(?<!1)\")}catch{return!1}})(),m={codeRemoveIndent:/^(?: {1,4}| {0,3}\\t)/gm,outputLinkReplace:/\\\\([\\[\\]])/g,indentCodeCompensation:/^(\\s+)(?:```)/,beginningSpace:/^\\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\\n/g,tabCharGlobal:/\\t/g,multipleSpaceGlobal:/\\s+/g,blankLine:/^[ \\t]*$/,doubleBlankLine:/\\n[ \\t]*\\n[ \\t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \\t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\\[[ xX]\\] +\\S/,listReplaceTask:/^\\[[ xX]\\] +/,listTaskCheckbox:/\\[[ xX]\\]/,anyLine:/\\n.*\\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\\||\\| *$/g,tableRowBlankLine:/\\n[ \\t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\\s|>)/i,endPreScriptTag:/^<\\/(pre|code|kbd|script)(\\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/,unicodeAlphaNumeric:/[\\p{L}\\p{N}]/u,escapeTest:/[&<>\"']/,escapeReplace:/[&<>\"']/g,escapeTestNoEncode:/[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,escapeReplaceNoEncode:/[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/g,unescapeTest:/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig,caret:/(^|[^\\[])\\^/g,percentDecode:/%25/g,findPipe:/\\|/g,splitPipe:/ \\|/,slashPipe:/\\\\\\|/g,carriageReturn:/\\r\\n|\\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\\S*/,endingNewline:/\\n$/,listItemRegex:u=>new RegExp(`^( {0,3}${u})((?:[\t ][^\\\\n]*)?(?:\\\\n|$))`),nextBulletRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \t][^\\\\n]*)?(?:\\\\n|$))`),hrRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),fencesBeginRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\\`\\`\\`|~~~)`),headingBeginRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}#`),htmlBeginRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}<(?:[a-z].*>|!--)`,\"i\"),blockquoteBeginRegex:u=>new RegExp(`^ {0,${Math.min(3,u-1)}}>`)},Te=/^(?:[ \\t]*(?:\\n|$))+/,Oe=/^((?: {4}| {0,3}\\t)[^\\n]+(?:\\n(?:[ \\t]*(?:\\n|$))*)?)+/,we=/^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/,I=/^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/,ye=/^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,N=/ {0,3}(?:[*+-]|\\d{1,9}[.)])/,re=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,se=k(re).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\\n>]+>\\n/).replace(/\\|table/g,\"\").getRegex(),Pe=k(re).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\\n>]+>\\n/).replace(/table/g,/ {0,3}\\|?(?:[:\\- ]*\\|)+[\\:\\- ]*\\n/).getRegex(),Q=/^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/,Se=/^[^\\n]+/,F=/(?!\\s*\\])(?:\\\\[\\s\\S]|[^\\[\\]\\\\])+/,$e=k(/^ {0,3}\\[(label)\\]: *(?:\\n[ \\t]*)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n[ \\t]*)?| *\\n[ \\t]*)(title))? *(?:\\n+|$)/).replace(\"label\",F).replace(\"title\",/(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/).getRegex(),_e=k(/^(bull)([ \\t][^\\n]+?)?(?:\\n|$)/).replace(/bull/g,N).getRegex(),q=\"address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul\",j=/<!--(?:-?>|[\\s\\S]*?(?:-->|$))/,Le=k(\"^ {0,3}(?:<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)|comment[^\\\\n]*(\\\\n+|$)|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n[ \t]*)+\\\\n|$)|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \t]*)+\\\\n|$)|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \t]*)+\\\\n|$))\",\"i\").replace(\"comment\",j).replace(\"tag\",q).replace(\"attribute\",/ +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex(),ie=k(Q).replace(\"hr\",I).replace(\"heading\",\" {0,3}#{1,6}(?:\\\\s|$)\").replace(\"|lheading\",\"\").replace(\"|table\",\"\").replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)])[ \\\\t]\").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",q).getRegex(),Me=k(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/).replace(\"paragraph\",ie).getRegex(),U={blockquote:Me,code:Oe,def:$e,fences:we,heading:ye,hr:I,html:Le,lheading:se,list:_e,newline:Te,paragraph:ie,table:_,text:Se},te=k(\"^ *([^\\\\n ].*)\\\\n {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\").replace(\"hr\",I).replace(\"heading\",\" {0,3}#{1,6}(?:\\\\s|$)\").replace(\"blockquote\",\" {0,3}>\").replace(\"code\",\"(?: {4}| {0,3}\t)[^\\\\n]\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)])[ \\\\t]\").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",q).getRegex(),ze={...U,lheading:Pe,table:te,paragraph:k(Q).replace(\"hr\",I).replace(\"heading\",\" {0,3}#{1,6}(?:\\\\s|$)\").replace(\"|lheading\",\"\").replace(\"table\",te).replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)])[ \\\\t]\").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",q).getRegex()},Ce={...U,html:k(`^ *(?:comment *(?:\\\\n|\\\\s*$)|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\\\s[^'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))`).replace(\"comment\",j).replace(/tag/g,\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b\").getRegex(),def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,heading:/^(#{1,6})(.*)(?:\\n+|$)/,fences:_,lheading:/^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,paragraph:k(Q).replace(\"hr\",I).replace(\"heading\",` *#{1,6} *[^\n]`).replace(\"lheading\",se).replace(\"|table\",\"\").replace(\"blockquote\",\" {0,3}>\").replace(\"|fences\",\"\").replace(\"|list\",\"\").replace(\"|html\",\"\").replace(\"|tag\",\"\").getRegex()},Ae=/^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,Ie=/^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,oe=/^( {2,}|\\\\)\\n(?!\\s*$)/,Ee=/^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/,v=/[\\p{P}\\p{S}]/u,K=/[\\s\\p{P}\\p{S}]/u,ae=/[^\\s\\p{P}\\p{S}]/u,Be=k(/^((?![*_])punctSpace)/,\"u\").replace(/punctSpace/g,K).getRegex(),le=/(?!~)[\\p{P}\\p{S}]/u,De=/(?!~)[\\s\\p{P}\\p{S}]/u,qe=/(?:[^\\s\\p{P}\\p{S}]|~)/u,ue=/(?![*_])[\\p{P}\\p{S}]/u,ve=/(?![*_])[\\s\\p{P}\\p{S}]/u,Ge=/(?:[^\\s\\p{P}\\p{S}]|[*_])/u,He=k(/link|precode-code|html/,\"g\").replace(\"link\",/\\[(?:[^\\[\\]`]|(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)/).replace(\"precode-\",Re?\"(?<!`)()\":\"(^^|[^`])\").replace(\"code\",/(?<b>`+)[^`]+\\k<b>(?!`)/).replace(\"html\",/<(?! )[^<>]*?>/).getRegex(),pe=/^(?:\\*+(?:((?!\\*)punct)|[^\\s*]))|^_+(?:((?!_)punct)|([^\\s_]))/,Ze=k(pe,\"u\").replace(/punct/g,v).getRegex(),Ne=k(pe,\"u\").replace(/punct/g,le).getRegex(),ce=\"^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\\\*)punct(\\\\*+)(?=[\\\\s]|$)|notPunctSpace(\\\\*+)(?!\\\\*)(?=punctSpace|$)|(?!\\\\*)punctSpace(\\\\*+)(?=notPunctSpace)|[\\\\s](\\\\*+)(?!\\\\*)(?=punct)|(?!\\\\*)punct(\\\\*+)(?!\\\\*)(?=punct)|notPunctSpace(\\\\*+)(?=notPunctSpace)\",Qe=k(ce,\"gu\").replace(/notPunctSpace/g,ae).replace(/punctSpace/g,K).replace(/punct/g,v).getRegex(),Fe=k(ce,\"gu\").replace(/notPunctSpace/g,qe).replace(/punctSpace/g,De).replace(/punct/g,le).getRegex(),je=k(\"^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)\",\"gu\").replace(/notPunctSpace/g,ae).replace(/punctSpace/g,K).replace(/punct/g,v).getRegex(),Ue=k(/^~~?(?:((?!~)punct)|[^\\s~])/,\"u\").replace(/punct/g,ue).getRegex(),Ke=\"^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)\",We=k(Ke,\"gu\").replace(/notPunctSpace/g,Ge).replace(/punctSpace/g,ve).replace(/punct/g,ue).getRegex(),Xe=k(/\\\\(punct)/,\"gu\").replace(/punct/g,v).getRegex(),Je=k(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/).replace(\"scheme\",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace(\"email\",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ve=k(j).replace(\"(?:-->|$)\",\"-->\").getRegex(),Ye=k(\"^comment|^</[a-zA-Z][\\\\w:-]*\\\\s*>|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>|^<\\\\?[\\\\s\\\\S]*?\\\\?>|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\").replace(\"comment\",Ve).replace(\"attribute\",/\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/).getRegex(),D=/(?:\\[(?:\\\\[\\s\\S]|[^\\[\\]\\\\])*\\]|\\\\[\\s\\S]|`+[^`]*?`+(?!`)|[^\\[\\]\\\\`])*?/,et=k(/^!?\\[(label)\\]\\(\\s*(href)(?:(?:[ \\t]*(?:\\n[ \\t]*)?)(title))?\\s*\\)/).replace(\"label\",D).replace(\"href\",/<(?:\\\\.|[^\\n<>\\\\])+>|[^ \\t\\n\\x00-\\x1f]*/).replace(\"title\",/\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/).getRegex(),he=k(/^!?\\[(label)\\]\\[(ref)\\]/).replace(\"label\",D).replace(\"ref\",F).getRegex(),ke=k(/^!?\\[(ref)\\](?:\\[\\])?/).replace(\"ref\",F).getRegex(),tt=k(\"reflink|nolink(?!\\\\()\",\"g\").replace(\"reflink\",he).replace(\"nolink\",ke).getRegex(),ne=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,W={_backpedal:_,anyPunctuation:Xe,autolink:Je,blockSkip:He,br:oe,code:Ie,del:_,delLDelim:_,delRDelim:_,emStrongLDelim:Ze,emStrongRDelimAst:Qe,emStrongRDelimUnd:je,escape:Ae,link:et,nolink:ke,punctuation:Be,reflink:he,reflinkSearch:tt,tag:Ye,text:Ee,url:_},nt={...W,link:k(/^!?\\[(label)\\]\\((.*?)\\)/).replace(\"label\",D).getRegex(),reflink:k(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace(\"label\",D).getRegex()},Z={...W,emStrongRDelimAst:Fe,emStrongLDelim:Ne,delLDelim:Ue,delRDelim:We,url:k(/^((?:protocol):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/).replace(\"protocol\",ne).replace(\"email\",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,del:/^(~~?)(?=[^\\s~])((?:\\\\[\\s\\S]|[^\\\\])*?(?:\\\\[\\s\\S]|[^\\s~\\\\]))\\1(?=[^~]|$)/,text:k(/^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|protocol:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/).replace(\"protocol\",ne).getRegex()},rt={...Z,br:k(oe).replace(\"{2,}\",\"*\").getRegex(),text:k(Z.text).replace(\"\\\\b_\",\"\\\\b_| {2,}\\\\n\").replace(/\\{2,\\}/g,\"*\").getRegex()},E={normal:U,gfm:ze,pedantic:Ce},z={normal:W,gfm:Z,breaks:rt,pedantic:nt};var st={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},de=u=>st[u];function O(u,e){if(e){if(m.escapeTest.test(u))return u.replace(m.escapeReplace,de)}else if(m.escapeTestNoEncode.test(u))return u.replace(m.escapeReplaceNoEncode,de);return u}function X(u){try{u=encodeURI(u).replace(m.percentDecode,\"%\")}catch{return null}return u}function J(u,e){let t=u.replace(m.findPipe,(i,s,a)=>{let o=!1,l=s;for(;--l>=0&&a[l]===\"\\\\\";)o=!o;return o?\"|\":\" |\"}),n=t.split(m.splitPipe),r=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push(\"\");for(;r<n.length;r++)n[r]=n[r].trim().replace(m.slashPipe,\"|\");return n}function C(u,e,t){let n=u.length;if(n===0)return\"\";let r=0;for(;r<n;){let i=u.charAt(n-r-1);if(i===e&&!t)r++;else if(i!==e&&t)r++;else break}return u.slice(0,n-r)}function ge(u,e){if(u.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<u.length;n++)if(u[n]===\"\\\\\")n++;else if(u[n]===e[0])t++;else if(u[n]===e[1]&&(t--,t<0))return n;return t>0?-2:-1}function fe(u,e=0){let t=e,n=\"\";for(let r of u)if(r===\"\t\"){let i=4-t%4;n+=\" \".repeat(i),t+=i}else n+=r,t++;return n}function me(u,e,t,n,r){let i=e.href,s=e.title||null,a=u[1].replace(r.other.outputLinkReplace,\"$1\");n.state.inLink=!0;let o={type:u[0].charAt(0)===\"!\"?\"image\":\"link\",raw:t,href:i,title:s,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,o}function it(u,e,t){let n=u.match(t.other.indentCodeCompensation);if(n===null)return e;let r=n[1];return e.split(`\n`).map(i=>{let s=i.match(t.other.beginningSpace);if(s===null)return i;let[a]=s;return a.length>=r.length?i.slice(r.length):i}).join(`\n`)}var w=class{options;rules;lexer;constructor(e){this.options=e||T}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:\"space\",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,\"\");return{type:\"code\",raw:t[0],codeBlockStyle:\"indented\",text:this.options.pedantic?n:C(n,`\n`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let n=t[0],r=it(n,t[3]||\"\",this.rules);return{type:\"code\",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,\"$1\"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let r=C(n,\"#\");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:\"heading\",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:\"hr\",raw:C(t[0],`\n`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let n=C(t[0],`\n`).split(`\n`),r=\"\",i=\"\",s=[];for(;n.length>0;){let a=!1,o=[],l;for(l=0;l<n.length;l++)if(this.rules.other.blockquoteStart.test(n[l]))o.push(n[l]),a=!0;else if(!a)o.push(n[l]);else break;n=n.slice(l);let p=o.join(`\n`),c=p.replace(this.rules.other.blockquoteSetextReplace,`\n    $1`).replace(this.rules.other.blockquoteSetextReplace2,\"\");r=r?`${r}\n${p}`:p,i=i?`${i}\n${c}`:c;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(c,s,!0),this.lexer.state.top=d,n.length===0)break;let h=s.at(-1);if(h?.type===\"code\")break;if(h?.type===\"blockquote\"){let R=h,f=R.raw+`\n`+n.join(`\n`),S=this.blockquote(f);s[s.length-1]=S,r=r.substring(0,r.length-R.raw.length)+S.raw,i=i.substring(0,i.length-R.text.length)+S.text;break}else if(h?.type===\"list\"){let R=h,f=R.raw+`\n`+n.join(`\n`),S=this.list(f);s[s.length-1]=S,r=r.substring(0,r.length-h.raw.length)+S.raw,i=i.substring(0,i.length-R.raw.length)+S.raw,n=f.substring(s.at(-1).raw.length).split(`\n`);continue}}return{type:\"blockquote\",raw:r,tokens:s,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),r=n.length>1,i={type:\"list\",raw:\"\",ordered:r,start:r?+n.slice(0,-1):\"\",loose:!1,items:[]};n=r?`\\\\d{1,9}\\\\${n.slice(-1)}`:`\\\\${n}`,this.options.pedantic&&(n=r?n:\"[*+-]\");let s=this.rules.other.listItemRegex(n),a=!1;for(;e;){let l=!1,p=\"\",c=\"\";if(!(t=s.exec(e))||this.rules.block.hr.test(e))break;p=t[0],e=e.substring(p.length);let d=fe(t[2].split(`\n`,1)[0],t[1].length),h=e.split(`\n`,1)[0],R=!d.trim(),f=0;if(this.options.pedantic?(f=2,c=d.trimStart()):R?f=t[1].length+1:(f=d.search(this.rules.other.nonSpaceChar),f=f>4?1:f,c=d.slice(f),f+=t[1].length),R&&this.rules.other.blankLine.test(h)&&(p+=h+`\n`,e=e.substring(h.length+1),l=!0),!l){let S=this.rules.other.nextBulletRegex(f),V=this.rules.other.hrRegex(f),Y=this.rules.other.fencesBeginRegex(f),ee=this.rules.other.headingBeginRegex(f),xe=this.rules.other.htmlBeginRegex(f),be=this.rules.other.blockquoteBeginRegex(f);for(;e;){let G=e.split(`\n`,1)[0],A;if(h=G,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,\"  \"),A=h):A=h.replace(this.rules.other.tabCharGlobal,\"    \"),Y.test(h)||ee.test(h)||xe.test(h)||be.test(h)||S.test(h)||V.test(h))break;if(A.search(this.rules.other.nonSpaceChar)>=f||!h.trim())c+=`\n`+A.slice(f);else{if(R||d.replace(this.rules.other.tabCharGlobal,\"    \").search(this.rules.other.nonSpaceChar)>=4||Y.test(d)||ee.test(d)||V.test(d))break;c+=`\n`+h}R=!h.trim(),p+=G+`\n`,e=e.substring(G.length+1),d=A.slice(f)}}i.loose||(a?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(a=!0)),i.items.push({type:\"list_item\",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(c),loose:!1,text:c,tokens:[]}),i.raw+=p}let o=i.items.at(-1);if(o)o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let l of i.items){if(this.lexer.state.top=!1,l.tokens=this.lexer.blockTokens(l.text,[]),l.task){if(l.text=l.text.replace(this.rules.other.listReplaceTask,\"\"),l.tokens[0]?.type===\"text\"||l.tokens[0]?.type===\"paragraph\"){l.tokens[0].raw=l.tokens[0].raw.replace(this.rules.other.listReplaceTask,\"\"),l.tokens[0].text=l.tokens[0].text.replace(this.rules.other.listReplaceTask,\"\");for(let c=this.lexer.inlineQueue.length-1;c>=0;c--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[c].src)){this.lexer.inlineQueue[c].src=this.lexer.inlineQueue[c].src.replace(this.rules.other.listReplaceTask,\"\");break}}let p=this.rules.other.listTaskCheckbox.exec(l.raw);if(p){let c={type:\"checkbox\",raw:p[0]+\" \",checked:p[0]!==\"[ ]\"};l.checked=c.checked,i.loose?l.tokens[0]&&[\"paragraph\",\"text\"].includes(l.tokens[0].type)&&\"tokens\"in l.tokens[0]&&l.tokens[0].tokens?(l.tokens[0].raw=c.raw+l.tokens[0].raw,l.tokens[0].text=c.raw+l.tokens[0].text,l.tokens[0].tokens.unshift(c)):l.tokens.unshift({type:\"paragraph\",raw:c.raw,text:c.raw,tokens:[c]}):l.tokens.unshift(c)}}if(!i.loose){let p=l.tokens.filter(d=>d.type===\"space\"),c=p.length>0&&p.some(d=>this.rules.other.anyLine.test(d.raw));i.loose=c}}if(i.loose)for(let l of i.items){l.loose=!0;for(let p of l.tokens)p.type===\"text\"&&(p.type=\"paragraph\")}return i}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:\"html\",block:!0,raw:t[0],pre:t[1]===\"pre\"||t[1]===\"script\"||t[1]===\"style\",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal,\" \"),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,\"$1\").replace(this.rules.inline.anyPunctuation,\"$1\"):\"\",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,\"$1\"):t[3];return{type:\"def\",tag:n,raw:t[0],href:r,title:i}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=J(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,\"\").split(\"|\"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,\"\").split(`\n`):[],s={type:\"table\",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let a of r)this.rules.other.tableAlignRight.test(a)?s.align.push(\"right\"):this.rules.other.tableAlignCenter.test(a)?s.align.push(\"center\"):this.rules.other.tableAlignLeft.test(a)?s.align.push(\"left\"):s.align.push(null);for(let a=0;a<n.length;a++)s.header.push({text:n[a],tokens:this.lexer.inline(n[a]),header:!0,align:s.align[a]});for(let a of i)s.rows.push(J(a,s.header.length).map((o,l)=>({text:o,tokens:this.lexer.inline(o),header:!1,align:s.align[l]})));return s}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:\"heading\",raw:t[0],depth:t[2].charAt(0)===\"=\"?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let n=t[1].charAt(t[1].length-1)===`\n`?t[1].slice(0,-1):t[1];return{type:\"paragraph\",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:\"text\",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:\"escape\",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:\"html\",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=C(n.slice(0,-1),\"\\\\\");if((n.length-s.length)%2===0)return}else{let s=ge(t[2],\"()\");if(s===-2)return;if(s>-1){let o=(t[0].indexOf(\"!\")===0?5:4)+t[1].length+s;t[2]=t[2].substring(0,s),t[0]=t[0].substring(0,o).trim(),t[3]=\"\"}}let r=t[2],i=\"\";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=t[3]?t[3].slice(1,-1):\"\";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),me(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,\"$1\"),title:i&&i.replace(this.rules.inline.anyPunctuation,\"$1\")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal,\" \"),i=t[r.toLowerCase()];if(!i){let s=n[0].charAt(0);return{type:\"text\",raw:s,text:s}}return me(n,i,n[0],this.lexer,this.rules)}}emStrong(e,t,n=\"\"){let r=this.rules.inline.emStrongLDelim.exec(e);if(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(r[1]||r[2]||\"\")||!n||this.rules.inline.punctuation.exec(n)){let s=[...r[0]].length-1,a,o,l=s,p=0,c=r[0][0]===\"*\"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,t=t.slice(-1*e.length+s);(r=c.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=[...a].length,r[3]||r[4]){l+=o;continue}else if((r[5]||r[6])&&s%3&&!((s+o)%3)){p+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+p);let d=[...r[0]][0].length,h=e.slice(0,s+r.index+d+o);if(Math.min(s,o)%2){let f=h.slice(1,-1);return{type:\"em\",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}let R=h.slice(2,-2);return{type:\"strong\",raw:h,text:R,tokens:this.lexer.inlineTokens(R)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal,\" \"),r=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&i&&(n=n.substring(1,n.length-1)),{type:\"codespan\",raw:t[0],text:n}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:\"br\",raw:t[0]}}del(e,t,n=\"\"){let r=this.rules.inline.delLDelim.exec(e);if(!r)return;if(!(r[1]||\"\")||!n||this.rules.inline.punctuation.exec(n)){let s=[...r[0]].length-1,a,o,l=s,p=this.rules.inline.delRDelim;for(p.lastIndex=0,t=t.slice(-1*e.length+s);(r=p.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a||(o=[...a].length,o!==s))continue;if(r[3]||r[4]){l+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l);let c=[...r[0]][0].length,d=e.slice(0,s+r.index+c+o),h=d.slice(s,-s);return{type:\"del\",raw:d,text:h,tokens:this.lexer.inlineTokens(h)}}}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let n,r;return t[2]===\"@\"?(n=t[1],r=\"mailto:\"+n):(n=t[1],r=n),{type:\"link\",raw:t[0],text:n,href:r,tokens:[{type:\"text\",raw:n,text:n}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let n,r;if(t[2]===\"@\")n=t[0],r=\"mailto:\"+n;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??\"\";while(i!==t[0]);n=t[0],t[1]===\"www.\"?r=\"http://\"+t[0]:r=t[0]}return{type:\"link\",raw:t[0],text:n,href:r,tokens:[{type:\"text\",raw:n,text:n}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let n=this.lexer.state.inRawBlock;return{type:\"text\",raw:t[0],text:t[0],escaped:n}}}};var x=class u{tokens;options;state;inlineQueue;tokenizer;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||T,this.options.tokenizer=this.options.tokenizer||new w,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:m,block:E.normal,inline:z.normal};this.options.pedantic?(t.block=E.pedantic,t.inline=z.pedantic):this.options.gfm&&(t.block=E.gfm,this.options.breaks?t.inline=z.breaks:t.inline=z.gfm),this.tokenizer.rules=t}static get rules(){return{block:E,inline:z}}static lex(e,t){return new u(t).lex(e)}static lexInline(e,t){return new u(t).inlineTokens(e)}lex(e){e=e.replace(m.carriageReturn,`\n`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(m.tabCharGlobal,\"    \").replace(m.spaceLine,\"\"));e;){let r;if(this.options.extensions?.block?.some(s=>(r=s.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);let s=t.at(-1);r.raw.length===1&&s!==void 0?s.raw+=`\n`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type===\"paragraph\"||s?.type===\"text\"?(s.raw+=(s.raw.endsWith(`\n`)?\"\":`\n`)+r.raw,s.text+=`\n`+r.text,this.inlineQueue.at(-1).src=s.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type===\"paragraph\"||s?.type===\"text\"?(s.raw+=(s.raw.endsWith(`\n`)?\"\":`\n`)+r.raw,s.text+=`\n`+r.raw,this.inlineQueue.at(-1).src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title},t.push(r));continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let i=e;if(this.options.extensions?.startBlock){let s=1/0,a=e.slice(1),o;this.options.extensions.startBlock.forEach(l=>{o=l.call({lexer:this},a),typeof o==\"number\"&&o>=0&&(s=Math.min(s,o))}),s<1/0&&s>=0&&(i=e.substring(0,s+1))}if(this.state.top&&(r=this.tokenizer.paragraph(i))){let s=t.at(-1);n&&s?.type===\"paragraph\"?(s.raw+=(s.raw.endsWith(`\n`)?\"\":`\n`)+r.raw,s.text+=`\n`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):t.push(r),n=i.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);let s=t.at(-1);s?.type===\"text\"?(s.raw+=(s.raw.endsWith(`\n`)?\"\":`\n`)+r.raw,s.text+=`\n`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):t.push(r);continue}if(e){let s=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(s);break}else throw new Error(s)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,r=null;if(this.tokens.links){let o=Object.keys(this.tokens.links);if(o.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)o.includes(r[0].slice(r[0].lastIndexOf(\"[\")+1,-1))&&(n=n.slice(0,r.index)+\"[\"+\"a\".repeat(r[0].length-2)+\"]\"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,r.index)+\"++\"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i;for(;(r=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)i=r[2]?r[2].length:0,n=n.slice(0,r.index+i)+\"[\"+\"a\".repeat(r[0].length-i-2)+\"]\"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let s=!1,a=\"\";for(;e;){s||(a=\"\"),s=!1;let o;if(this.options.extensions?.inline?.some(p=>(o=p.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.escape(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.tag(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.link(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(o.raw.length);let p=t.at(-1);o.type===\"text\"&&p?.type===\"text\"?(p.raw+=o.raw,p.text+=o.text):t.push(o);continue}if(o=this.tokenizer.emStrong(e,n,a)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.codespan(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.br(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.del(e,n,a)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.autolink(e)){e=e.substring(o.raw.length),t.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(e))){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if(this.options.extensions?.startInline){let p=1/0,c=e.slice(1),d;this.options.extensions.startInline.forEach(h=>{d=h.call({lexer:this},c),typeof d==\"number\"&&d>=0&&(p=Math.min(p,d))}),p<1/0&&p>=0&&(l=e.substring(0,p+1))}if(o=this.tokenizer.inlineText(l)){e=e.substring(o.raw.length),o.raw.slice(-1)!==\"_\"&&(a=o.raw.slice(-1)),s=!0;let p=t.at(-1);p?.type===\"text\"?(p.raw+=o.raw,p.text+=o.text):t.push(o);continue}if(e){let p=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return t}};var y=class{options;parser;constructor(e){this.options=e||T}space(e){return\"\"}code({text:e,lang:t,escaped:n}){let r=(t||\"\").match(m.notSpaceStart)?.[0],i=e.replace(m.endingNewline,\"\")+`\n`;return r?'<pre><code class=\"language-'+O(r)+'\">'+(n?i:O(i,!0))+`</code></pre>\n`:\"<pre><code>\"+(n?i:O(i,!0))+`</code></pre>\n`}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}def(e){return\"\"}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return`<hr>\n`}list(e){let t=e.ordered,n=e.start,r=\"\";for(let a=0;a<e.items.length;a++){let o=e.items[a];r+=this.listitem(o)}let i=t?\"ol\":\"ul\",s=t&&n!==1?' start=\"'+n+'\"':\"\";return\"<\"+i+s+`>\n`+r+\"</\"+i+`>\n`}listitem(e){return`<li>${this.parser.parse(e.tokens)}</li>\n`}checkbox({checked:e}){return\"<input \"+(e?'checked=\"\" ':\"\")+'disabled=\"\" type=\"checkbox\"> '}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t=\"\",n=\"\";for(let i=0;i<e.header.length;i++)n+=this.tablecell(e.header[i]);t+=this.tablerow({text:n});let r=\"\";for(let i=0;i<e.rows.length;i++){let s=e.rows[i];n=\"\";for(let a=0;a<s.length;a++)n+=this.tablecell(s[a]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>\n<thead>\n`+t+`</thead>\n`+r+`</table>\n`}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){let t=this.parser.parseInline(e.tokens),n=e.header?\"th\":\"td\";return(e.align?`<${n} align=\"${e.align}\">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${O(e,!0)}</code>`}br(e){return\"<br>\"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){let r=this.parser.parseInline(n),i=X(e);if(i===null)return r;e=i;let s='<a href=\"'+e+'\"';return t&&(s+=' title=\"'+O(t)+'\"'),s+=\">\"+r+\"</a>\",s}image({href:e,title:t,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let i=X(e);if(i===null)return O(n);e=i;let s=`<img src=\"${e}\" alt=\"${O(n)}\"`;return t&&(s+=` title=\"${O(t)}\"`),s+=\">\",s}text(e){return\"tokens\"in e&&e.tokens?this.parser.parseInline(e.tokens):\"escaped\"in e&&e.escaped?e.text:O(e.text)}};var $=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return\"\"+e}image({text:e}){return\"\"+e}br(){return\"\"}checkbox({raw:e}){return e}};var b=class u{options;renderer;textRenderer;constructor(e){this.options=e||T,this.options.renderer=this.options.renderer||new y,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(e,t){return new u(t).parse(e)}static parseInline(e,t){return new u(t).parseInline(e)}parse(e){let t=\"\";for(let n=0;n<e.length;n++){let r=e[n];if(this.options.extensions?.renderers?.[r.type]){let s=r,a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||![\"space\",\"hr\",\"heading\",\"code\",\"table\",\"blockquote\",\"list\",\"html\",\"def\",\"paragraph\",\"text\"].includes(s.type)){t+=a||\"\";continue}}let i=r;switch(i.type){case\"space\":{t+=this.renderer.space(i);break}case\"hr\":{t+=this.renderer.hr(i);break}case\"heading\":{t+=this.renderer.heading(i);break}case\"code\":{t+=this.renderer.code(i);break}case\"table\":{t+=this.renderer.table(i);break}case\"blockquote\":{t+=this.renderer.blockquote(i);break}case\"list\":{t+=this.renderer.list(i);break}case\"checkbox\":{t+=this.renderer.checkbox(i);break}case\"html\":{t+=this.renderer.html(i);break}case\"def\":{t+=this.renderer.def(i);break}case\"paragraph\":{t+=this.renderer.paragraph(i);break}case\"text\":{t+=this.renderer.text(i);break}default:{let s='Token with \"'+i.type+'\" type was not found.';if(this.options.silent)return console.error(s),\"\";throw new Error(s)}}}return t}parseInline(e,t=this.renderer){let n=\"\";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions?.renderers?.[i.type]){let a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||![\"escape\",\"html\",\"link\",\"image\",\"strong\",\"em\",\"codespan\",\"br\",\"del\",\"text\"].includes(i.type)){n+=a||\"\";continue}}let s=i;switch(s.type){case\"escape\":{n+=t.text(s);break}case\"html\":{n+=t.html(s);break}case\"link\":{n+=t.link(s);break}case\"image\":{n+=t.image(s);break}case\"checkbox\":{n+=t.checkbox(s);break}case\"strong\":{n+=t.strong(s);break}case\"em\":{n+=t.em(s);break}case\"codespan\":{n+=t.codespan(s);break}case\"br\":{n+=t.br(s);break}case\"del\":{n+=t.del(s);break}case\"text\":{n+=t.text(s);break}default:{let a='Token with \"'+s.type+'\" type was not found.';if(this.options.silent)return console.error(a),\"\";throw new Error(a)}}}return n}};var P=class{options;block;constructor(e){this.options=e||T}static passThroughHooks=new Set([\"preprocess\",\"postprocess\",\"processAllTokens\",\"emStrongMask\"]);static passThroughHooksRespectAsync=new Set([\"preprocess\",\"postprocess\",\"processAllTokens\"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?x.lex:x.lexInline}provideParser(){return this.block?b.parse:b.parseInline}};var B=class{defaults=M();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=b;Renderer=y;TextRenderer=$;Lexer=x;Tokenizer=w;Hooks=P;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(let r of e)switch(n=n.concat(t.call(this,r)),r.type){case\"table\":{let i=r;for(let s of i.header)n=n.concat(this.walkTokens(s.tokens,t));for(let s of i.rows)for(let a of s)n=n.concat(this.walkTokens(a.tokens,t));break}case\"list\":{let i=r;n=n.concat(this.walkTokens(i.items,t));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let a=i[s].flat(1/0);n=n.concat(this.walkTokens(a,t))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,t)))}}return n}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error(\"extension name required\");if(\"renderer\"in i){let s=t.renderers[i.name];s?t.renderers[i.name]=function(...a){let o=i.renderer.apply(this,a);return o===!1&&(o=s.apply(this,a)),o}:t.renderers[i.name]=i.renderer}if(\"tokenizer\"in i){if(!i.level||i.level!==\"block\"&&i.level!==\"inline\")throw new Error(\"extension level must be 'block' or 'inline'\");let s=t[i.level];s?s.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level===\"block\"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level===\"inline\"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}\"childTokens\"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),r.extensions=t),n.renderer){let i=this.defaults.renderer||new y(this.defaults);for(let s in n.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if([\"options\",\"parser\"].includes(s))continue;let a=s,o=n.renderer[a],l=i[a];i[a]=(...p)=>{let c=o.apply(i,p);return c===!1&&(c=l.apply(i,p)),c||\"\"}}r.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new w(this.defaults);for(let s in n.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if([\"options\",\"rules\",\"lexer\"].includes(s))continue;let a=s,o=n.tokenizer[a],l=i[a];i[a]=(...p)=>{let c=o.apply(i,p);return c===!1&&(c=l.apply(i,p)),c}}r.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new P;for(let s in n.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if([\"options\",\"block\"].includes(s))continue;let a=s,o=n.hooks[a],l=i[a];P.passThroughHooks.has(s)?i[a]=p=>{if(this.defaults.async&&P.passThroughHooksRespectAsync.has(s))return(async()=>{let d=await o.call(i,p);return l.call(i,d)})();let c=o.call(i,p);return l.call(i,c)}:i[a]=(...p)=>{if(this.defaults.async)return(async()=>{let d=await o.apply(i,p);return d===!1&&(d=await l.apply(i,p)),d})();let c=o.apply(i,p);return c===!1&&(c=l.apply(i,p)),c}}r.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(a){let o=[];return o.push(s.call(this,a)),i&&(o=o.concat(i.call(this,a))),o}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return x.lex(e,t??this.defaults)}parser(e,t){return b.parse(e,t??this.defaults)}parseMarkdown(e){return(n,r)=>{let i={...r},s={...this.defaults,...i},a=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&i.async===!1)return a(new Error(\"marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise.\"));if(typeof n>\"u\"||n===null)return a(new Error(\"marked(): input parameter is undefined or null\"));if(typeof n!=\"string\")return a(new Error(\"marked(): input parameter is of type \"+Object.prototype.toString.call(n)+\", string expected\"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=e),s.async)return(async()=>{let o=s.hooks?await s.hooks.preprocess(n):n,p=await(s.hooks?await s.hooks.provideLexer():e?x.lex:x.lexInline)(o,s),c=s.hooks?await s.hooks.processAllTokens(p):p;s.walkTokens&&await Promise.all(this.walkTokens(c,s.walkTokens));let h=await(s.hooks?await s.hooks.provideParser():e?b.parse:b.parseInline)(c,s);return s.hooks?await s.hooks.postprocess(h):h})().catch(a);try{s.hooks&&(n=s.hooks.preprocess(n));let l=(s.hooks?s.hooks.provideLexer():e?x.lex:x.lexInline)(n,s);s.hooks&&(l=s.hooks.processAllTokens(l)),s.walkTokens&&this.walkTokens(l,s.walkTokens);let c=(s.hooks?s.hooks.provideParser():e?b.parse:b.parseInline)(l,s);return s.hooks&&(c=s.hooks.postprocess(c)),c}catch(o){return a(o)}}}onError(e,t){return n=>{if(n.message+=`\nPlease report this to https://github.com/markedjs/marked.`,e){let r=\"<p>An error occurred:</p><pre>\"+O(n.message+\"\",!0)+\"</pre>\";return t?Promise.resolve(r):r}if(t)return Promise.reject(n);throw n}}};var L=new B;function g(u,e){return L.parse(u,e)}g.options=g.setOptions=function(u){return L.setOptions(u),g.defaults=L.defaults,H(g.defaults),g};g.getDefaults=M;g.defaults=T;g.use=function(...u){return L.use(...u),g.defaults=L.defaults,H(g.defaults),g};g.walkTokens=function(u,e){return L.walkTokens(u,e)};g.parseInline=L.parseInline;g.Parser=b;g.parser=b.parse;g.Renderer=y;g.TextRenderer=$;g.Lexer=x;g.lexer=x.lex;g.Tokenizer=w;g.Hooks=P;g.parse=g;var Ut=g.options,Kt=g.setOptions,Wt=g.use,Xt=g.walkTokens,Jt=g.parseInline,Vt=g,Yt=b.parse,en=x.lex;export{P as Hooks,x as Lexer,B as Marked,b as Parser,y as Renderer,$ as TextRenderer,w as Tokenizer,T as defaults,M as getDefaults,en as lexer,g as marked,Ut as options,Vt as parse,Jt as parseInline,Yt as parser,Kt as setOptions,Wt as use,Xt as walkTokens};\n//# sourceMappingURL=marked.esm.js.map\n","import DOMPurify from \"dompurify\";\r\nimport { marked } from \"marked\";\r\nimport { truncateText } from \"./format.ts\";\r\n\r\nmarked.setOptions({\r\n  gfm: true,\r\n  breaks: true,\r\n});\r\n\r\nconst allowedTags = [\r\n  \"a\",\r\n  \"b\",\r\n  \"blockquote\",\r\n  \"br\",\r\n  \"code\",\r\n  \"del\",\r\n  \"em\",\r\n  \"h1\",\r\n  \"h2\",\r\n  \"h3\",\r\n  \"h4\",\r\n  \"hr\",\r\n  \"i\",\r\n  \"li\",\r\n  \"ol\",\r\n  \"p\",\r\n  \"pre\",\r\n  \"strong\",\r\n  \"table\",\r\n  \"tbody\",\r\n  \"td\",\r\n  \"th\",\r\n  \"thead\",\r\n  \"tr\",\r\n  \"ul\",\r\n];\r\n\r\nconst allowedAttrs = [\"class\", \"href\", \"rel\", \"target\", \"title\", \"start\"];\r\n\r\nlet hooksInstalled = false;\r\nconst MARKDOWN_CHAR_LIMIT = 140_000;\r\nconst MARKDOWN_PARSE_LIMIT = 40_000;\r\nconst MARKDOWN_CACHE_LIMIT = 200;\r\nconst MARKDOWN_CACHE_MAX_CHARS = 50_000;\r\nconst markdownCache = new Map<string, string>();\r\n\r\nfunction getCachedMarkdown(key: string): string | null {\r\n  const cached = markdownCache.get(key);\r\n  if (cached === undefined) {\r\n    return null;\r\n  }\r\n  markdownCache.delete(key);\r\n  markdownCache.set(key, cached);\r\n  return cached;\r\n}\r\n\r\nfunction setCachedMarkdown(key: string, value: string) {\r\n  markdownCache.set(key, value);\r\n  if (markdownCache.size <= MARKDOWN_CACHE_LIMIT) {\r\n    return;\r\n  }\r\n  const oldest = markdownCache.keys().next().value;\r\n  if (oldest) {\r\n    markdownCache.delete(oldest);\r\n  }\r\n}\r\n\r\nfunction installHooks() {\r\n  if (hooksInstalled) {\r\n    return;\r\n  }\r\n  hooksInstalled = true;\r\n\r\n  DOMPurify.addHook(\"afterSanitizeAttributes\", (node) => {\r\n    if (!(node instanceof HTMLAnchorElement)) {\r\n      return;\r\n    }\r\n    const href = node.getAttribute(\"href\");\r\n    if (!href) {\r\n      return;\r\n    }\r\n    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n    node.setAttribute(\"target\", \"_blank\");\r\n  });\r\n}\r\n\r\nexport function toSanitizedMarkdownHtml(markdown: string): string {\r\n  const input = markdown.trim();\r\n  if (!input) {\r\n    return \"\";\r\n  }\r\n  installHooks();\r\n  if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\r\n    const cached = getCachedMarkdown(input);\r\n    if (cached !== null) {\r\n      return cached;\r\n    }\r\n  }\r\n  const truncated = truncateText(input, MARKDOWN_CHAR_LIMIT);\r\n  const suffix = truncated.truncated\r\n    ? `\\n\\n… truncated (${truncated.total} chars, showing first ${truncated.text.length}).`\r\n    : \"\";\r\n  if (truncated.text.length > MARKDOWN_PARSE_LIMIT) {\r\n    const escaped = escapeHtml(`${truncated.text}${suffix}`);\r\n    const html = `<pre class=\"code-block\">${escaped}</pre>`;\r\n    const sanitized = DOMPurify.sanitize(html, {\r\n      ALLOWED_TAGS: allowedTags,\r\n      ALLOWED_ATTR: allowedAttrs,\r\n    });\r\n    if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\r\n      setCachedMarkdown(input, sanitized);\r\n    }\r\n    return sanitized;\r\n  }\r\n  const rendered = marked.parse(`${truncated.text}${suffix}`, {\r\n    renderer: htmlEscapeRenderer,\r\n  }) as string;\r\n  const sanitized = DOMPurify.sanitize(rendered, {\r\n    ALLOWED_TAGS: allowedTags,\r\n    ALLOWED_ATTR: allowedAttrs,\r\n  });\r\n  if (input.length <= MARKDOWN_CACHE_MAX_CHARS) {\r\n    setCachedMarkdown(input, sanitized);\r\n  }\r\n  return sanitized;\r\n}\r\n\r\n// Prevent raw HTML in chat messages from being rendered as formatted HTML.\r\n// Display it as escaped text so users see the literal markup.\r\n// Security is handled by DOMPurify, but rendering pasted HTML (e.g. error\r\n// pages) as formatted output is confusing UX (#13937).\r\nconst htmlEscapeRenderer = new marked.Renderer();\r\nhtmlEscapeRenderer.html = ({ text }: { text: string }) => escapeHtml(text);\r\n\r\nfunction escapeHtml(value: string): string {\r\n  return value\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n}\r\n","/**\r\n * RTL (Right-to-Left) text direction detection.\r\n * Detects Hebrew, Arabic, Syriac, Thaana, Nko, Samaritan, Mandaic, Adlam,\r\n * Phoenician, and Lydian scripts using Unicode Script Properties.\r\n */\r\n\r\nconst RTL_CHAR_REGEX =\r\n  /\\p{Script=Hebrew}|\\p{Script=Arabic}|\\p{Script=Syriac}|\\p{Script=Thaana}|\\p{Script=Nko}|\\p{Script=Samaritan}|\\p{Script=Mandaic}|\\p{Script=Adlam}|\\p{Script=Phoenician}|\\p{Script=Lydian}/u;\r\n\r\n/**\r\n * Detect text direction from the first significant character.\r\n * @param text - The text to check\r\n * @param skipPattern - Characters to skip when looking for the first significant char.\r\n *   Defaults to whitespace and Unicode punctuation/symbols.\r\n */\r\nexport function detectTextDirection(\r\n  text: string | null,\r\n  skipPattern: RegExp = /[\\s\\p{P}\\p{S}]/u,\r\n): \"rtl\" | \"ltr\" {\r\n  if (!text) {\r\n    return \"ltr\";\r\n  }\r\n  for (const char of text) {\r\n    if (skipPattern.test(char)) {\r\n      continue;\r\n    }\r\n    return RTL_CHAR_REGEX.test(char) ? \"rtl\" : \"ltr\";\r\n  }\r\n  return \"ltr\";\r\n}\r\n","import { html, type TemplateResult } from \"lit\";\r\nimport { icons } from \"../icons.ts\";\r\n\r\nconst COPIED_FOR_MS = 1500;\r\nconst ERROR_FOR_MS = 2000;\r\nconst COPY_LABEL = \"Copy as markdown\";\r\nconst COPIED_LABEL = \"Copied\";\r\nconst ERROR_LABEL = \"Copy failed\";\r\n\r\ntype CopyButtonOptions = {\r\n  text: () => string;\r\n  label?: string;\r\n};\r\n\r\nasync function copyTextToClipboard(text: string): Promise<boolean> {\r\n  if (!text) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction setButtonLabel(button: HTMLButtonElement, label: string) {\r\n  button.title = label;\r\n  button.setAttribute(\"aria-label\", label);\r\n}\r\n\r\nfunction createCopyButton(options: CopyButtonOptions): TemplateResult {\r\n  const idleLabel = options.label ?? COPY_LABEL;\r\n  return html`\r\n    <button\r\n      class=\"chat-copy-btn\"\r\n      type=\"button\"\r\n      title=${idleLabel}\r\n      aria-label=${idleLabel}\r\n      @click=${async (e: Event) => {\r\n        const btn = e.currentTarget as HTMLButtonElement | null;\r\n\r\n        if (!btn || btn.dataset.copying === \"1\") {\r\n          return;\r\n        }\r\n\r\n        btn.dataset.copying = \"1\";\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n        btn.disabled = true;\r\n\r\n        const copied = await copyTextToClipboard(options.text());\r\n        if (!btn.isConnected) {\r\n          return;\r\n        }\r\n\r\n        delete btn.dataset.copying;\r\n        btn.removeAttribute(\"aria-busy\");\r\n        btn.disabled = false;\r\n\r\n        if (!copied) {\r\n          btn.dataset.error = \"1\";\r\n          setButtonLabel(btn, ERROR_LABEL);\r\n\r\n          window.setTimeout(() => {\r\n            if (!btn.isConnected) {\r\n              return;\r\n            }\r\n            delete btn.dataset.error;\r\n            setButtonLabel(btn, idleLabel);\r\n          }, ERROR_FOR_MS);\r\n          return;\r\n        }\r\n\r\n        btn.dataset.copied = \"1\";\r\n        setButtonLabel(btn, COPIED_LABEL);\r\n\r\n        window.setTimeout(() => {\r\n          if (!btn.isConnected) {\r\n            return;\r\n          }\r\n          delete btn.dataset.copied;\r\n          setButtonLabel(btn, idleLabel);\r\n        }, COPIED_FOR_MS);\r\n      }}\r\n    >\r\n      <span class=\"chat-copy-btn__icon\" aria-hidden=\"true\">\r\n        <span class=\"chat-copy-btn__icon-copy\">${icons.copy}</span>\r\n        <span class=\"chat-copy-btn__icon-check\">${icons.check}</span>\r\n      </span>\r\n    </button>\r\n  `;\r\n}\r\n\r\nexport function renderCopyAsMarkdownButton(markdown: string): TemplateResult {\r\n  return createCopyButton({ text: () => markdown, label: COPY_LABEL });\r\n}\r\n","/**\r\n * Message normalization utilities for chat rendering.\r\n */\r\n\r\nimport type { NormalizedMessage, MessageContentItem } from \"../types/chat-types.ts\";\r\n\r\n/**\r\n * Normalize a raw message object into a consistent structure.\r\n */\r\nexport function normalizeMessage(message: unknown): NormalizedMessage {\r\n  const m = message as Record<string, unknown>;\r\n  let role = typeof m.role === \"string\" ? m.role : \"unknown\";\r\n\r\n  // Detect tool messages by common gateway shapes.\r\n  // Some tool events come through as assistant role with tool_* items in the content array.\r\n  const hasToolId = typeof m.toolCallId === \"string\" || typeof m.tool_call_id === \"string\";\r\n\r\n  const contentRaw = m.content;\r\n  const contentItems = Array.isArray(contentRaw) ? contentRaw : null;\r\n  const hasToolContent =\r\n    Array.isArray(contentItems) &&\r\n    contentItems.some((item) => {\r\n      const x = item as Record<string, unknown>;\r\n      const t = (typeof x.type === \"string\" ? x.type : \"\").toLowerCase();\r\n      return t === \"toolresult\" || t === \"tool_result\";\r\n    });\r\n\r\n  const hasToolName = typeof m.toolName === \"string\" || typeof m.tool_name === \"string\";\r\n\r\n  if (hasToolId || hasToolContent || hasToolName) {\r\n    role = \"toolResult\";\r\n  }\r\n\r\n  // Extract content\r\n  let content: MessageContentItem[] = [];\r\n\r\n  if (typeof m.content === \"string\") {\r\n    content = [{ type: \"text\", text: m.content }];\r\n  } else if (Array.isArray(m.content)) {\r\n    content = m.content.map((item: Record<string, unknown>) => ({\r\n      type: (item.type as MessageContentItem[\"type\"]) || \"text\",\r\n      text: item.text as string | undefined,\r\n      name: item.name as string | undefined,\r\n      args: item.args || item.arguments,\r\n    }));\r\n  } else if (typeof m.text === \"string\") {\r\n    content = [{ type: \"text\", text: m.text }];\r\n  }\r\n\r\n  const timestamp = typeof m.timestamp === \"number\" ? m.timestamp : Date.now();\r\n  const id = typeof m.id === \"string\" ? m.id : undefined;\r\n\r\n  return { role, content, timestamp, id };\r\n}\r\n\r\n/**\r\n * Normalize role for grouping purposes.\r\n */\r\nexport function normalizeRoleForGrouping(role: string): string {\r\n  const lower = role.toLowerCase();\r\n  // Preserve original casing when it's already a core role.\r\n  if (role === \"user\" || role === \"User\") {\r\n    return role;\r\n  }\r\n  if (role === \"assistant\") {\r\n    return \"assistant\";\r\n  }\r\n  if (role === \"system\") {\r\n    return \"system\";\r\n  }\r\n  // Keep tool-related roles distinct so the UI can style/toggle them.\r\n  if (\r\n    lower === \"toolresult\" ||\r\n    lower === \"tool_result\" ||\r\n    lower === \"tool\" ||\r\n    lower === \"function\"\r\n  ) {\r\n    return \"tool\";\r\n  }\r\n  return role;\r\n}\r\n\r\n/**\r\n * Check if a message is a tool result message based on its role.\r\n */\r\nexport function isToolResultMessage(message: unknown): boolean {\r\n  const m = message as Record<string, unknown>;\r\n  const role = typeof m.role === \"string\" ? m.role.toLowerCase() : \"\";\r\n  return role === \"toolresult\" || role === \"tool_result\";\r\n}\r\n","import type { IconName } from \"./icons.ts\";\r\nimport rawConfig from \"./tool-display.json\" with { type: \"json\" };\r\n\r\ntype ToolDisplayActionSpec = {\r\n  label?: string;\r\n  detailKeys?: string[];\r\n};\r\n\r\ntype ToolDisplaySpec = {\r\n  icon?: string;\r\n  title?: string;\r\n  label?: string;\r\n  detailKeys?: string[];\r\n  actions?: Record<string, ToolDisplayActionSpec>;\r\n};\r\n\r\ntype ToolDisplayConfig = {\r\n  version?: number;\r\n  fallback?: ToolDisplaySpec;\r\n  tools?: Record<string, ToolDisplaySpec>;\r\n};\r\n\r\nexport type ToolDisplay = {\r\n  name: string;\r\n  icon: IconName;\r\n  title: string;\r\n  label: string;\r\n  verb?: string;\r\n  detail?: string;\r\n};\r\n\r\nconst TOOL_DISPLAY_CONFIG = rawConfig as ToolDisplayConfig;\r\nconst FALLBACK = TOOL_DISPLAY_CONFIG.fallback ?? { icon: \"puzzle\" };\r\nconst TOOL_MAP = TOOL_DISPLAY_CONFIG.tools ?? {};\r\n\r\nfunction normalizeToolName(name?: string): string {\r\n  return (name ?? \"tool\").trim();\r\n}\r\n\r\nfunction defaultTitle(name: string): string {\r\n  const cleaned = name.replace(/_/g, \" \").trim();\r\n  if (!cleaned) {\r\n    return \"Tool\";\r\n  }\r\n  return cleaned\r\n    .split(/\\s+/)\r\n    .map((part) =>\r\n      part.length <= 2 && part.toUpperCase() === part\r\n        ? part\r\n        : `${part.at(0)?.toUpperCase() ?? \"\"}${part.slice(1)}`,\r\n    )\r\n    .join(\" \");\r\n}\r\n\r\nfunction normalizeVerb(value?: string): string | undefined {\r\n  const trimmed = value?.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  return trimmed.replace(/_/g, \" \");\r\n}\r\n\r\nfunction coerceDisplayValue(value: unknown): string | undefined {\r\n  if (value === null || value === undefined) {\r\n    return undefined;\r\n  }\r\n  if (typeof value === \"string\") {\r\n    const trimmed = value.trim();\r\n    if (!trimmed) {\r\n      return undefined;\r\n    }\r\n    const firstLine = trimmed.split(/\\r?\\n/)[0]?.trim() ?? \"\";\r\n    if (!firstLine) {\r\n      return undefined;\r\n    }\r\n    return firstLine.length > 160 ? `${firstLine.slice(0, 157)}…` : firstLine;\r\n  }\r\n  if (typeof value === \"number\" || typeof value === \"boolean\") {\r\n    return String(value);\r\n  }\r\n  if (Array.isArray(value)) {\r\n    const values = value\r\n      .map((item) => coerceDisplayValue(item))\r\n      .filter((item): item is string => Boolean(item));\r\n    if (values.length === 0) {\r\n      return undefined;\r\n    }\r\n    const preview = values.slice(0, 3).join(\", \");\r\n    return values.length > 3 ? `${preview}…` : preview;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction lookupValueByPath(args: unknown, path: string): unknown {\r\n  if (!args || typeof args !== \"object\") {\r\n    return undefined;\r\n  }\r\n  let current: unknown = args;\r\n  for (const segment of path.split(\".\")) {\r\n    if (!segment) {\r\n      return undefined;\r\n    }\r\n    if (!current || typeof current !== \"object\") {\r\n      return undefined;\r\n    }\r\n    const record = current as Record<string, unknown>;\r\n    current = record[segment];\r\n  }\r\n  return current;\r\n}\r\n\r\nfunction resolveDetailFromKeys(args: unknown, keys: string[]): string | undefined {\r\n  for (const key of keys) {\r\n    const value = lookupValueByPath(args, key);\r\n    const display = coerceDisplayValue(value);\r\n    if (display) {\r\n      return display;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction resolveReadDetail(args: unknown): string | undefined {\r\n  if (!args || typeof args !== \"object\") {\r\n    return undefined;\r\n  }\r\n  const record = args as Record<string, unknown>;\r\n  const path = typeof record.path === \"string\" ? record.path : undefined;\r\n  if (!path) {\r\n    return undefined;\r\n  }\r\n  const offset = typeof record.offset === \"number\" ? record.offset : undefined;\r\n  const limit = typeof record.limit === \"number\" ? record.limit : undefined;\r\n  if (offset !== undefined && limit !== undefined) {\r\n    return `${path}:${offset}-${offset + limit}`;\r\n  }\r\n  return path;\r\n}\r\n\r\nfunction resolveWriteDetail(args: unknown): string | undefined {\r\n  if (!args || typeof args !== \"object\") {\r\n    return undefined;\r\n  }\r\n  const record = args as Record<string, unknown>;\r\n  const path = typeof record.path === \"string\" ? record.path : undefined;\r\n  return path;\r\n}\r\n\r\nfunction resolveActionSpec(\r\n  spec: ToolDisplaySpec | undefined,\r\n  action: string | undefined,\r\n): ToolDisplayActionSpec | undefined {\r\n  if (!spec || !action) {\r\n    return undefined;\r\n  }\r\n  return spec.actions?.[action] ?? undefined;\r\n}\r\n\r\nexport function resolveToolDisplay(params: {\r\n  name?: string;\r\n  args?: unknown;\r\n  meta?: string;\r\n}): ToolDisplay {\r\n  const name = normalizeToolName(params.name);\r\n  const key = name.toLowerCase();\r\n  const spec = TOOL_MAP[key];\r\n  const icon = (spec?.icon ?? FALLBACK.icon ?? \"puzzle\") as IconName;\r\n  const title = spec?.title ?? defaultTitle(name);\r\n  const label = spec?.label ?? name;\r\n  const actionRaw =\r\n    params.args && typeof params.args === \"object\"\r\n      ? ((params.args as Record<string, unknown>).action as string | undefined)\r\n      : undefined;\r\n  const action = typeof actionRaw === \"string\" ? actionRaw.trim() : undefined;\r\n  const actionSpec = resolveActionSpec(spec, action);\r\n  const verb = normalizeVerb(actionSpec?.label ?? action);\r\n\r\n  let detail: string | undefined;\r\n  if (key === \"read\") {\r\n    detail = resolveReadDetail(params.args);\r\n  }\r\n  if (!detail && (key === \"write\" || key === \"edit\" || key === \"attach\")) {\r\n    detail = resolveWriteDetail(params.args);\r\n  }\r\n\r\n  const detailKeys = actionSpec?.detailKeys ?? spec?.detailKeys ?? FALLBACK.detailKeys ?? [];\r\n  if (!detail && detailKeys.length > 0) {\r\n    detail = resolveDetailFromKeys(params.args, detailKeys);\r\n  }\r\n\r\n  if (!detail && params.meta) {\r\n    detail = params.meta;\r\n  }\r\n\r\n  if (detail) {\r\n    detail = shortenHomeInString(detail);\r\n  }\r\n\r\n  return {\r\n    name,\r\n    icon,\r\n    title,\r\n    label,\r\n    verb,\r\n    detail,\r\n  };\r\n}\r\n\r\nexport function formatToolDetail(display: ToolDisplay): string | undefined {\r\n  const parts: string[] = [];\r\n  if (display.verb) {\r\n    parts.push(display.verb);\r\n  }\r\n  if (display.detail) {\r\n    parts.push(display.detail);\r\n  }\r\n  if (parts.length === 0) {\r\n    return undefined;\r\n  }\r\n  return parts.join(\" · \");\r\n}\r\n\r\nexport function formatToolSummary(display: ToolDisplay): string {\r\n  const detail = formatToolDetail(display);\r\n  return detail ? `${display.label}: ${detail}` : display.label;\r\n}\r\n\r\nfunction shortenHomeInString(input: string): string {\r\n  if (!input) {\r\n    return input;\r\n  }\r\n  return input.replace(/\\/Users\\/[^/]+/g, \"~\").replace(/\\/home\\/[^/]+/g, \"~\");\r\n}\r\n","/**\r\n * Chat-related constants for the UI layer.\r\n */\r\n\r\n/** Character threshold for showing tool output inline vs collapsed */\r\nexport const TOOL_INLINE_THRESHOLD = 80;\r\n\r\n/** Maximum lines to show in collapsed preview */\r\nexport const PREVIEW_MAX_LINES = 2;\r\n\r\n/** Maximum characters to show in collapsed preview */\r\nexport const PREVIEW_MAX_CHARS = 100;\r\n","/**\r\n * Helper functions for tool card rendering.\r\n */\r\n\r\nimport { PREVIEW_MAX_CHARS, PREVIEW_MAX_LINES } from \"./constants.ts\";\r\n\r\n/**\r\n * Format tool output content for display in the sidebar.\r\n * Detects JSON and wraps it in a code block with formatting.\r\n */\r\nexport function formatToolOutputForSidebar(text: string): string {\r\n  const trimmed = text.trim();\r\n  // Try to detect and format JSON\r\n  if (trimmed.startsWith(\"{\") || trimmed.startsWith(\"[\")) {\r\n    try {\r\n      const parsed = JSON.parse(trimmed);\r\n      return \"```json\\n\" + JSON.stringify(parsed, null, 2) + \"\\n```\";\r\n    } catch {\r\n      // Not valid JSON, return as-is\r\n    }\r\n  }\r\n  return text;\r\n}\r\n\r\n/**\r\n * Get a truncated preview of tool output text.\r\n * Truncates to first N lines or first N characters, whichever is shorter.\r\n */\r\nexport function getTruncatedPreview(text: string): string {\r\n  const allLines = text.split(\"\\n\");\r\n  const lines = allLines.slice(0, PREVIEW_MAX_LINES);\r\n  const preview = lines.join(\"\\n\");\r\n  if (preview.length > PREVIEW_MAX_CHARS) {\r\n    return preview.slice(0, PREVIEW_MAX_CHARS) + \"…\";\r\n  }\r\n  return lines.length < allLines.length ? preview + \"…\" : preview;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ToolCard } from \"../types/chat-types.ts\";\r\nimport { icons } from \"../icons.ts\";\r\nimport { formatToolDetail, resolveToolDisplay } from \"../tool-display.ts\";\r\nimport { TOOL_INLINE_THRESHOLD } from \"./constants.ts\";\r\nimport { extractTextCached } from \"./message-extract.ts\";\r\nimport { isToolResultMessage } from \"./message-normalizer.ts\";\r\nimport { formatToolOutputForSidebar, getTruncatedPreview } from \"./tool-helpers.ts\";\r\n\r\nexport function extractToolCards(message: unknown): ToolCard[] {\r\n  const m = message as Record<string, unknown>;\r\n  const content = normalizeContent(m.content);\r\n  const cards: ToolCard[] = [];\r\n\r\n  for (const item of content) {\r\n    const kind = (typeof item.type === \"string\" ? item.type : \"\").toLowerCase();\r\n    const isToolCall =\r\n      [\"toolcall\", \"tool_call\", \"tooluse\", \"tool_use\"].includes(kind) ||\r\n      (typeof item.name === \"string\" && item.arguments != null);\r\n    if (isToolCall) {\r\n      cards.push({\r\n        kind: \"call\",\r\n        name: (item.name as string) ?? \"tool\",\r\n        args: coerceArgs(item.arguments ?? item.args),\r\n      });\r\n    }\r\n  }\r\n\r\n  for (const item of content) {\r\n    const kind = (typeof item.type === \"string\" ? item.type : \"\").toLowerCase();\r\n    if (kind !== \"toolresult\" && kind !== \"tool_result\") {\r\n      continue;\r\n    }\r\n    const text = extractToolText(item);\r\n    const name = typeof item.name === \"string\" ? item.name : \"tool\";\r\n    cards.push({ kind: \"result\", name, text });\r\n  }\r\n\r\n  if (isToolResultMessage(message) && !cards.some((card) => card.kind === \"result\")) {\r\n    const name =\r\n      (typeof m.toolName === \"string\" && m.toolName) ||\r\n      (typeof m.tool_name === \"string\" && m.tool_name) ||\r\n      \"tool\";\r\n    const text = extractTextCached(message) ?? undefined;\r\n    cards.push({ kind: \"result\", name, text });\r\n  }\r\n\r\n  return cards;\r\n}\r\n\r\nexport function renderToolCardSidebar(card: ToolCard, onOpenSidebar?: (content: string) => void) {\r\n  const display = resolveToolDisplay({ name: card.name, args: card.args });\r\n  const detail = formatToolDetail(display);\r\n  const hasText = Boolean(card.text?.trim());\r\n\r\n  const canClick = Boolean(onOpenSidebar);\r\n  const handleClick = canClick\r\n    ? () => {\r\n        if (hasText) {\r\n          onOpenSidebar!(formatToolOutputForSidebar(card.text!));\r\n          return;\r\n        }\r\n        const info = `## ${display.label}\\n\\n${\r\n          detail ? `**Command:** \\`${detail}\\`\\n\\n` : \"\"\r\n        }*No output — tool completed successfully.*`;\r\n        onOpenSidebar!(info);\r\n      }\r\n    : undefined;\r\n\r\n  const isShort = hasText && (card.text?.length ?? 0) <= TOOL_INLINE_THRESHOLD;\r\n  const showCollapsed = hasText && !isShort;\r\n  const showInline = hasText && isShort;\r\n  const isEmpty = !hasText;\r\n\r\n  return html`\r\n    <div\r\n      class=\"chat-tool-card ${canClick ? \"chat-tool-card--clickable\" : \"\"}\"\r\n      @click=${handleClick}\r\n      role=${canClick ? \"button\" : nothing}\r\n      tabindex=${canClick ? \"0\" : nothing}\r\n      @keydown=${\r\n        canClick\r\n          ? (e: KeyboardEvent) => {\r\n              if (e.key !== \"Enter\" && e.key !== \" \") {\r\n                return;\r\n              }\r\n              e.preventDefault();\r\n              handleClick?.();\r\n            }\r\n          : nothing\r\n      }\r\n    >\r\n      <div class=\"chat-tool-card__header\">\r\n        <div class=\"chat-tool-card__title\">\r\n          <span class=\"chat-tool-card__icon\">${icons[display.icon]}</span>\r\n          <span>${display.label}</span>\r\n        </div>\r\n        ${\r\n          canClick\r\n            ? html`<span class=\"chat-tool-card__action\">${hasText ? \"View\" : \"\"} ${icons.check}</span>`\r\n            : nothing\r\n        }\r\n        ${isEmpty && !canClick ? html`<span class=\"chat-tool-card__status\">${icons.check}</span>` : nothing}\r\n      </div>\r\n      ${detail ? html`<div class=\"chat-tool-card__detail\">${detail}</div>` : nothing}\r\n      ${\r\n        isEmpty\r\n          ? html`\r\n              <div class=\"chat-tool-card__status-text muted\">Completed</div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        showCollapsed\r\n          ? html`<div class=\"chat-tool-card__preview mono\">${getTruncatedPreview(card.text!)}</div>`\r\n          : nothing\r\n      }\r\n      ${showInline ? html`<div class=\"chat-tool-card__inline mono\">${card.text}</div>` : nothing}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction normalizeContent(content: unknown): Array<Record<string, unknown>> {\r\n  if (!Array.isArray(content)) {\r\n    return [];\r\n  }\r\n  return content.filter(Boolean) as Array<Record<string, unknown>>;\r\n}\r\n\r\nfunction coerceArgs(value: unknown): unknown {\r\n  if (typeof value !== \"string\") {\r\n    return value;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return value;\r\n  }\r\n  if (!trimmed.startsWith(\"{\") && !trimmed.startsWith(\"[\")) {\r\n    return value;\r\n  }\r\n  try {\r\n    return JSON.parse(trimmed);\r\n  } catch {\r\n    return value;\r\n  }\r\n}\r\n\r\nfunction extractToolText(item: Record<string, unknown>): string | undefined {\r\n  if (typeof item.text === \"string\") {\r\n    return item.text;\r\n  }\r\n  if (typeof item.content === \"string\") {\r\n    return item.content;\r\n  }\r\n  return undefined;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\r\nimport type { AssistantIdentity } from \"../assistant-identity.ts\";\r\nimport type { MessageGroup } from \"../types/chat-types.ts\";\r\nimport { toSanitizedMarkdownHtml } from \"../markdown.ts\";\r\nimport { detectTextDirection } from \"../text-direction.ts\";\r\nimport { renderCopyAsMarkdownButton } from \"./copy-as-markdown.ts\";\r\nimport {\r\n  extractTextCached,\r\n  extractThinkingCached,\r\n  formatReasoningMarkdown,\r\n} from \"./message-extract.ts\";\r\nimport { isToolResultMessage, normalizeRoleForGrouping } from \"./message-normalizer.ts\";\r\nimport { extractToolCards, renderToolCardSidebar } from \"./tool-cards.ts\";\r\n\r\ntype ImageBlock = {\r\n  url: string;\r\n  alt?: string;\r\n};\r\n\r\nfunction extractImages(message: unknown): ImageBlock[] {\r\n  const m = message as Record<string, unknown>;\r\n  const content = m.content;\r\n  const images: ImageBlock[] = [];\r\n\r\n  if (Array.isArray(content)) {\r\n    for (const block of content) {\r\n      if (typeof block !== \"object\" || block === null) {\r\n        continue;\r\n      }\r\n      const b = block as Record<string, unknown>;\r\n\r\n      if (b.type === \"image\") {\r\n        // Handle source object format (from sendChatMessage)\r\n        const source = b.source as Record<string, unknown> | undefined;\r\n        if (source?.type === \"base64\" && typeof source.data === \"string\") {\r\n          const data = source.data;\r\n          const mediaType = (source.media_type as string) || \"image/png\";\r\n          // If data is already a data URL, use it directly\r\n          const url = data.startsWith(\"data:\") ? data : `data:${mediaType};base64,${data}`;\r\n          images.push({ url });\r\n        } else if (typeof b.url === \"string\") {\r\n          images.push({ url: b.url });\r\n        }\r\n      } else if (b.type === \"image_url\") {\r\n        // OpenAI format\r\n        const imageUrl = b.image_url as Record<string, unknown> | undefined;\r\n        if (typeof imageUrl?.url === \"string\") {\r\n          images.push({ url: imageUrl.url });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return images;\r\n}\r\n\r\nexport function renderReadingIndicatorGroup(assistant?: AssistantIdentity) {\r\n  return html`\r\n    <div class=\"chat-group assistant\">\r\n      ${renderAvatar(\"assistant\", assistant)}\r\n      <div class=\"chat-group-messages\">\r\n        <div class=\"chat-bubble chat-reading-indicator\" aria-hidden=\"true\">\r\n          <span class=\"chat-reading-indicator__dots\">\r\n            <span></span><span></span><span></span>\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function renderStreamingGroup(\r\n  text: string,\r\n  startedAt: number,\r\n  onOpenSidebar?: (content: string) => void,\r\n  assistant?: AssistantIdentity,\r\n) {\r\n  const timestamp = new Date(startedAt).toLocaleTimeString([], {\r\n    hour: \"numeric\",\r\n    minute: \"2-digit\",\r\n  });\r\n  const name = assistant?.name ?? \"Assistant\";\r\n\r\n  return html`\r\n    <div class=\"chat-group assistant\">\r\n      ${renderAvatar(\"assistant\", assistant)}\r\n      <div class=\"chat-group-messages\">\r\n        ${renderGroupedMessage(\r\n          {\r\n            role: \"assistant\",\r\n            content: [{ type: \"text\", text }],\r\n            timestamp: startedAt,\r\n          },\r\n          { isStreaming: true, showReasoning: false },\r\n          onOpenSidebar,\r\n        )}\r\n        <div class=\"chat-group-footer\">\r\n          <span class=\"chat-sender-name\">${name}</span>\r\n          <span class=\"chat-group-timestamp\">${timestamp}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function renderMessageGroup(\r\n  group: MessageGroup,\r\n  opts: {\r\n    onOpenSidebar?: (content: string) => void;\r\n    showReasoning: boolean;\r\n    assistantName?: string;\r\n    assistantAvatar?: string | null;\r\n  },\r\n) {\r\n  const normalizedRole = normalizeRoleForGrouping(group.role);\r\n  const assistantName = opts.assistantName ?? \"Assistant\";\r\n  const who =\r\n    normalizedRole === \"user\"\r\n      ? \"You\"\r\n      : normalizedRole === \"assistant\"\r\n        ? assistantName\r\n        : normalizedRole;\r\n  const roleClass =\r\n    normalizedRole === \"user\" ? \"user\" : normalizedRole === \"assistant\" ? \"assistant\" : \"other\";\r\n  const timestamp = new Date(group.timestamp).toLocaleTimeString([], {\r\n    hour: \"numeric\",\r\n    minute: \"2-digit\",\r\n  });\r\n\r\n  return html`\r\n    <div class=\"chat-group ${roleClass}\">\r\n      ${renderAvatar(group.role, {\r\n        name: assistantName,\r\n        avatar: opts.assistantAvatar ?? null,\r\n      })}\r\n      <div class=\"chat-group-messages\">\r\n        ${group.messages.map((item, index) =>\r\n          renderGroupedMessage(\r\n            item.message,\r\n            {\r\n              isStreaming: group.isStreaming && index === group.messages.length - 1,\r\n              showReasoning: opts.showReasoning,\r\n            },\r\n            opts.onOpenSidebar,\r\n          ),\r\n        )}\r\n        <div class=\"chat-group-footer\">\r\n          <span class=\"chat-sender-name\">${who}</span>\r\n          <span class=\"chat-group-timestamp\">${timestamp}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderAvatar(role: string, assistant?: Pick<AssistantIdentity, \"name\" | \"avatar\">) {\r\n  const normalized = normalizeRoleForGrouping(role);\r\n  const assistantName = assistant?.name?.trim() || \"Assistant\";\r\n  const assistantAvatar = assistant?.avatar?.trim() || \"\";\r\n  const initial =\r\n    normalized === \"user\"\r\n      ? \"U\"\r\n      : normalized === \"assistant\"\r\n        ? assistantName.charAt(0).toUpperCase() || \"A\"\r\n        : normalized === \"tool\"\r\n          ? \"⚙\"\r\n          : \"?\";\r\n  const className =\r\n    normalized === \"user\"\r\n      ? \"user\"\r\n      : normalized === \"assistant\"\r\n        ? \"assistant\"\r\n        : normalized === \"tool\"\r\n          ? \"tool\"\r\n          : \"other\";\r\n\r\n  if (assistantAvatar && normalized === \"assistant\") {\r\n    if (isAvatarUrl(assistantAvatar)) {\r\n      return html`<img\r\n        class=\"chat-avatar ${className}\"\r\n        src=\"${assistantAvatar}\"\r\n        alt=\"${assistantName}\"\r\n      />`;\r\n    }\r\n    return html`<div class=\"chat-avatar ${className}\">${assistantAvatar}</div>`;\r\n  }\r\n\r\n  return html`<div class=\"chat-avatar ${className}\">${initial}</div>`;\r\n}\r\n\r\nfunction isAvatarUrl(value: string): boolean {\r\n  return (\r\n    /^https?:\\/\\//i.test(value) || /^data:image\\//i.test(value) || value.startsWith(\"/\") // Relative paths from avatar endpoint\r\n  );\r\n}\r\n\r\nfunction renderMessageImages(images: ImageBlock[]) {\r\n  if (images.length === 0) {\r\n    return nothing;\r\n  }\r\n\r\n  return html`\r\n    <div class=\"chat-message-images\">\r\n      ${images.map(\r\n        (img) => html`\r\n          <img\r\n            src=${img.url}\r\n            alt=${img.alt ?? \"Attached image\"}\r\n            class=\"chat-message-image\"\r\n            @click=${() => window.open(img.url, \"_blank\")}\r\n          />\r\n        `,\r\n      )}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderGroupedMessage(\r\n  message: unknown,\r\n  opts: { isStreaming: boolean; showReasoning: boolean },\r\n  onOpenSidebar?: (content: string) => void,\r\n) {\r\n  const m = message as Record<string, unknown>;\r\n  const role = typeof m.role === \"string\" ? m.role : \"unknown\";\r\n  const isToolResult =\r\n    isToolResultMessage(message) ||\r\n    role.toLowerCase() === \"toolresult\" ||\r\n    role.toLowerCase() === \"tool_result\" ||\r\n    typeof m.toolCallId === \"string\" ||\r\n    typeof m.tool_call_id === \"string\";\r\n\r\n  const toolCards = extractToolCards(message);\r\n  const hasToolCards = toolCards.length > 0;\r\n  const images = extractImages(message);\r\n  const hasImages = images.length > 0;\r\n\r\n  const extractedText = extractTextCached(message);\r\n  const extractedThinking =\r\n    opts.showReasoning && role === \"assistant\" ? extractThinkingCached(message) : null;\r\n  const markdownBase = extractedText?.trim() ? extractedText : null;\r\n  const reasoningMarkdown = extractedThinking ? formatReasoningMarkdown(extractedThinking) : null;\r\n  const markdown = markdownBase;\r\n  const canCopyMarkdown = role === \"assistant\" && Boolean(markdown?.trim());\r\n\r\n  const bubbleClasses = [\r\n    \"chat-bubble\",\r\n    canCopyMarkdown ? \"has-copy\" : \"\",\r\n    opts.isStreaming ? \"streaming\" : \"\",\r\n    \"fade-in\",\r\n  ]\r\n    .filter(Boolean)\r\n    .join(\" \");\r\n\r\n  if (!markdown && hasToolCards && isToolResult) {\r\n    return html`${toolCards.map((card) => renderToolCardSidebar(card, onOpenSidebar))}`;\r\n  }\r\n\r\n  if (!markdown && !hasToolCards && !hasImages) {\r\n    return nothing;\r\n  }\r\n\r\n  return html`\r\n    <div class=\"${bubbleClasses}\">\r\n      ${canCopyMarkdown ? renderCopyAsMarkdownButton(markdown!) : nothing}\r\n      ${renderMessageImages(images)}\r\n      ${\r\n        reasoningMarkdown\r\n          ? html`<div class=\"chat-thinking\">${unsafeHTML(\r\n              toSanitizedMarkdownHtml(reasoningMarkdown),\r\n            )}</div>`\r\n          : nothing\r\n      }\r\n      ${\r\n        markdown\r\n          ? html`<div class=\"chat-text\" dir=\"${detectTextDirection(markdown)}\">${unsafeHTML(toSanitizedMarkdownHtml(markdown))}</div>`\r\n          : nothing\r\n      }\r\n      ${toolCards.map((card) => renderToolCardSidebar(card, onOpenSidebar))}\r\n    </div>\r\n  `;\r\n}\r\n","import { html } from \"lit\";\r\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\r\nimport { icons } from \"../icons.ts\";\r\nimport { toSanitizedMarkdownHtml } from \"../markdown.ts\";\r\n\r\nexport type MarkdownSidebarProps = {\r\n  content: string | null;\r\n  error: string | null;\r\n  onClose: () => void;\r\n  onViewRawText: () => void;\r\n};\r\n\r\nexport function renderMarkdownSidebar(props: MarkdownSidebarProps) {\r\n  return html`\r\n    <div class=\"sidebar-panel\">\r\n      <div class=\"sidebar-header\">\r\n        <div class=\"sidebar-title\">Tool Output</div>\r\n        <button @click=${props.onClose} class=\"btn\" title=\"Close sidebar\">\r\n          ${icons.x}\r\n        </button>\r\n      </div>\r\n      <div class=\"sidebar-content\">\r\n        ${\r\n          props.error\r\n            ? html`\r\n              <div class=\"callout danger\">${props.error}</div>\r\n              <button @click=${props.onViewRawText} class=\"btn\" style=\"margin-top: 12px;\">\r\n                View Raw Text\r\n              </button>\r\n            `\r\n            : props.content\r\n              ? html`<div class=\"sidebar-markdown\">${unsafeHTML(toSanitizedMarkdownHtml(props.content))}</div>`\r\n              : html`\r\n                  <div class=\"muted\">No content available</div>\r\n                `\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { LitElement, css, nothing } from \"lit\";\r\nimport { customElement, property } from \"lit/decorators.js\";\r\n\r\n/**\r\n * A draggable divider for resizable split views.\r\n * Dispatches 'resize' events with { splitRatio: number } detail.\r\n */\r\n@customElement(\"resizable-divider\")\r\nexport class ResizableDivider extends LitElement {\r\n  @property({ type: Number }) splitRatio = 0.6;\r\n  @property({ type: Number }) minRatio = 0.4;\r\n  @property({ type: Number }) maxRatio = 0.7;\r\n\r\n  private isDragging = false;\r\n  private startX = 0;\r\n  private startRatio = 0;\r\n\r\n  static styles = css`\r\n    :host {\r\n      width: 4px;\r\n      cursor: col-resize;\r\n      background: var(--border, #333);\r\n      transition: background 150ms ease-out;\r\n      flex-shrink: 0;\r\n      position: relative;\r\n    }\r\n    :host::before {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 0;\r\n      left: -4px;\r\n      right: -4px;\r\n      bottom: 0;\r\n    }\r\n    :host(:hover) {\r\n      background: var(--accent, #007bff);\r\n    }\r\n    :host(.dragging) {\r\n      background: var(--accent, #007bff);\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    return nothing;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this.addEventListener(\"mousedown\", this.handleMouseDown);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    this.removeEventListener(\"mousedown\", this.handleMouseDown);\r\n    document.removeEventListener(\"mousemove\", this.handleMouseMove);\r\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\r\n  }\r\n\r\n  private handleMouseDown = (e: MouseEvent) => {\r\n    this.isDragging = true;\r\n    this.startX = e.clientX;\r\n    this.startRatio = this.splitRatio;\r\n    this.classList.add(\"dragging\");\r\n\r\n    document.addEventListener(\"mousemove\", this.handleMouseMove);\r\n    document.addEventListener(\"mouseup\", this.handleMouseUp);\r\n\r\n    e.preventDefault();\r\n  };\r\n\r\n  private handleMouseMove = (e: MouseEvent) => {\r\n    if (!this.isDragging) {\r\n      return;\r\n    }\r\n\r\n    const container = this.parentElement;\r\n    if (!container) {\r\n      return;\r\n    }\r\n\r\n    const containerWidth = container.getBoundingClientRect().width;\r\n    const deltaX = e.clientX - this.startX;\r\n    const deltaRatio = deltaX / containerWidth;\r\n\r\n    let newRatio = this.startRatio + deltaRatio;\r\n    newRatio = Math.max(this.minRatio, Math.min(this.maxRatio, newRatio));\r\n\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"resize\", {\r\n        detail: { splitRatio: newRatio },\r\n        bubbles: true,\r\n        composed: true,\r\n      }),\r\n    );\r\n  };\r\n\r\n  private handleMouseUp = () => {\r\n    this.isDragging = false;\r\n    this.classList.remove(\"dragging\");\r\n\r\n    document.removeEventListener(\"mousemove\", this.handleMouseMove);\r\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\r\n  };\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"resizable-divider\": ResizableDivider;\r\n  }\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport { ref } from \"lit/directives/ref.js\";\r\nimport { repeat } from \"lit/directives/repeat.js\";\r\nimport type { SessionsListResult } from \"../types.ts\";\r\nimport type { ChatItem, MessageGroup } from \"../types/chat-types.ts\";\r\nimport type { ChatAttachment, ChatQueueItem } from \"../ui-types.ts\";\r\nimport {\r\n  renderMessageGroup,\r\n  renderReadingIndicatorGroup,\r\n  renderStreamingGroup,\r\n} from \"../chat/grouped-render.ts\";\r\nimport { normalizeMessage, normalizeRoleForGrouping } from \"../chat/message-normalizer.ts\";\r\nimport { icons } from \"../icons.ts\";\r\nimport { detectTextDirection } from \"../text-direction.ts\";\r\nimport { renderMarkdownSidebar } from \"./markdown-sidebar.ts\";\r\nimport \"../components/resizable-divider.ts\";\r\n\r\nexport type CompactionIndicatorStatus = {\r\n  active: boolean;\r\n  startedAt: number | null;\r\n  completedAt: number | null;\r\n};\r\n\r\nexport type ChatProps = {\r\n  sessionKey: string;\r\n  onSessionKeyChange: (next: string) => void;\r\n  thinkingLevel: string | null;\r\n  showThinking: boolean;\r\n  loading: boolean;\r\n  sending: boolean;\r\n  canAbort?: boolean;\r\n  compactionStatus?: CompactionIndicatorStatus | null;\r\n  messages: unknown[];\r\n  toolMessages: unknown[];\r\n  stream: string | null;\r\n  streamStartedAt: number | null;\r\n  assistantAvatarUrl?: string | null;\r\n  draft: string;\r\n  queue: ChatQueueItem[];\r\n  connected: boolean;\r\n  canSend: boolean;\r\n  disabledReason: string | null;\r\n  error: string | null;\r\n  sessions: SessionsListResult | null;\r\n  // Focus mode\r\n  focusMode: boolean;\r\n  // Sidebar state\r\n  sidebarOpen?: boolean;\r\n  sidebarContent?: string | null;\r\n  sidebarError?: string | null;\r\n  splitRatio?: number;\r\n  assistantName: string;\r\n  assistantAvatar: string | null;\r\n  // Image attachments\r\n  attachments?: ChatAttachment[];\r\n  onAttachmentsChange?: (attachments: ChatAttachment[]) => void;\r\n  // Scroll control\r\n  showNewMessages?: boolean;\r\n  onScrollToBottom?: () => void;\r\n  // Event handlers\r\n  onRefresh: () => void;\r\n  onToggleFocusMode: () => void;\r\n  onDraftChange: (next: string) => void;\r\n  onSend: () => void;\r\n  onAbort?: () => void;\r\n  onQueueRemove: (id: string) => void;\r\n  onNewSession: () => void;\r\n  onOpenSidebar?: (content: string) => void;\r\n  onCloseSidebar?: () => void;\r\n  onSplitRatioChange?: (ratio: number) => void;\r\n  onChatScroll?: (event: Event) => void;\r\n};\r\n\r\nconst COMPACTION_TOAST_DURATION_MS = 5000;\r\n\r\nfunction adjustTextareaHeight(el: HTMLTextAreaElement) {\r\n  el.style.height = \"auto\";\r\n  el.style.height = `${el.scrollHeight}px`;\r\n}\r\n\r\nfunction renderCompactionIndicator(status: CompactionIndicatorStatus | null | undefined) {\r\n  if (!status) {\r\n    return nothing;\r\n  }\r\n\r\n  // Show \"compacting...\" while active\r\n  if (status.active) {\r\n    return html`\r\n      <div class=\"compaction-indicator compaction-indicator--active\" role=\"status\" aria-live=\"polite\">\r\n        ${icons.loader} Compacting context...\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // Show \"compaction complete\" briefly after completion\r\n  if (status.completedAt) {\r\n    const elapsed = Date.now() - status.completedAt;\r\n    if (elapsed < COMPACTION_TOAST_DURATION_MS) {\r\n      return html`\r\n        <div class=\"compaction-indicator compaction-indicator--complete\" role=\"status\" aria-live=\"polite\">\r\n          ${icons.check} Context compacted\r\n        </div>\r\n      `;\r\n    }\r\n  }\r\n\r\n  return nothing;\r\n}\r\n\r\nfunction generateAttachmentId(): string {\r\n  return `att-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\r\n}\r\n\r\nfunction handlePaste(e: ClipboardEvent, props: ChatProps) {\r\n  const items = e.clipboardData?.items;\r\n  if (!items || !props.onAttachmentsChange) {\r\n    return;\r\n  }\r\n\r\n  const imageItems: DataTransferItem[] = [];\r\n  for (let i = 0; i < items.length; i++) {\r\n    const item = items[i];\r\n    if (item.type.startsWith(\"image/\")) {\r\n      imageItems.push(item);\r\n    }\r\n  }\r\n\r\n  if (imageItems.length === 0) {\r\n    return;\r\n  }\r\n\r\n  e.preventDefault();\r\n\r\n  for (const item of imageItems) {\r\n    const file = item.getAsFile();\r\n    if (!file) {\r\n      continue;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.addEventListener(\"load\", () => {\r\n      const dataUrl = reader.result as string;\r\n      const newAttachment: ChatAttachment = {\r\n        id: generateAttachmentId(),\r\n        dataUrl,\r\n        mimeType: file.type,\r\n      };\r\n      const current = props.attachments ?? [];\r\n      props.onAttachmentsChange?.([...current, newAttachment]);\r\n    });\r\n    reader.readAsDataURL(file);\r\n  }\r\n}\r\n\r\nfunction renderAttachmentPreview(props: ChatProps) {\r\n  const attachments = props.attachments ?? [];\r\n  if (attachments.length === 0) {\r\n    return nothing;\r\n  }\r\n\r\n  return html`\r\n    <div class=\"chat-attachments\">\r\n      ${attachments.map(\r\n        (att) => html`\r\n          <div class=\"chat-attachment\">\r\n            <img\r\n              src=${att.dataUrl}\r\n              alt=\"Attachment preview\"\r\n              class=\"chat-attachment__img\"\r\n            />\r\n            <button\r\n              class=\"chat-attachment__remove\"\r\n              type=\"button\"\r\n              aria-label=\"Remove attachment\"\r\n              @click=${() => {\r\n                const next = (props.attachments ?? []).filter((a) => a.id !== att.id);\r\n                props.onAttachmentsChange?.(next);\r\n              }}\r\n            >\r\n              ${icons.x}\r\n            </button>\r\n          </div>\r\n        `,\r\n      )}\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function renderChat(props: ChatProps) {\r\n  const canCompose = props.connected;\r\n  const isBusy = props.sending || props.stream !== null;\r\n  const canAbort = Boolean(props.canAbort && props.onAbort);\r\n  const activeSession = props.sessions?.sessions?.find((row) => row.key === props.sessionKey);\r\n  const reasoningLevel = activeSession?.reasoningLevel ?? \"off\";\r\n  const showReasoning = props.showThinking && reasoningLevel !== \"off\";\r\n  const assistantIdentity = {\r\n    name: props.assistantName,\r\n    avatar: props.assistantAvatar ?? props.assistantAvatarUrl ?? null,\r\n  };\r\n\r\n  const hasAttachments = (props.attachments?.length ?? 0) > 0;\r\n  const composePlaceholder = props.connected\r\n    ? hasAttachments\r\n      ? \"Add a message or paste more images...\"\r\n      : \"Message (↩ to send, Shift+↩ for line breaks, paste images)\"\r\n    : \"Connect to the gateway to start chatting…\";\r\n\r\n  const splitRatio = props.splitRatio ?? 0.6;\r\n  const sidebarOpen = Boolean(props.sidebarOpen && props.onCloseSidebar);\r\n  const thread = html`\r\n    <div\r\n      class=\"chat-thread\"\r\n      role=\"log\"\r\n      aria-live=\"polite\"\r\n      @scroll=${props.onChatScroll}\r\n    >\r\n      ${\r\n        props.loading\r\n          ? html`\r\n              <div class=\"muted\">Loading chat…</div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${repeat(\r\n        buildChatItems(props),\r\n        (item) => item.key,\r\n        (item) => {\r\n          if (item.kind === \"divider\") {\r\n            return html`\r\n              <div class=\"chat-divider\" role=\"separator\" data-ts=${String(item.timestamp)}>\r\n                <span class=\"chat-divider__line\"></span>\r\n                <span class=\"chat-divider__label\">${item.label}</span>\r\n                <span class=\"chat-divider__line\"></span>\r\n              </div>\r\n            `;\r\n          }\r\n\r\n          if (item.kind === \"reading-indicator\") {\r\n            return renderReadingIndicatorGroup(assistantIdentity);\r\n          }\r\n\r\n          if (item.kind === \"stream\") {\r\n            return renderStreamingGroup(\r\n              item.text,\r\n              item.startedAt,\r\n              props.onOpenSidebar,\r\n              assistantIdentity,\r\n            );\r\n          }\r\n\r\n          if (item.kind === \"group\") {\r\n            return renderMessageGroup(item, {\r\n              onOpenSidebar: props.onOpenSidebar,\r\n              showReasoning,\r\n              assistantName: props.assistantName,\r\n              assistantAvatar: assistantIdentity.avatar,\r\n            });\r\n          }\r\n\r\n          return nothing;\r\n        },\r\n      )}\r\n    </div>\r\n  `;\r\n\r\n  return html`\r\n    <section class=\"card chat\">\r\n      ${props.disabledReason ? html`<div class=\"callout\">${props.disabledReason}</div>` : nothing}\r\n\r\n      ${props.error ? html`<div class=\"callout danger\">${props.error}</div>` : nothing}\r\n\r\n      ${\r\n        props.focusMode\r\n          ? html`\r\n            <button\r\n              class=\"chat-focus-exit\"\r\n              type=\"button\"\r\n              @click=${props.onToggleFocusMode}\r\n              aria-label=\"Exit focus mode\"\r\n              title=\"Exit focus mode\"\r\n            >\r\n              ${icons.x}\r\n            </button>\r\n          `\r\n          : nothing\r\n      }\r\n\r\n      <div\r\n        class=\"chat-split-container ${sidebarOpen ? \"chat-split-container--open\" : \"\"}\"\r\n      >\r\n        <div\r\n          class=\"chat-main\"\r\n          style=\"flex: ${sidebarOpen ? `0 0 ${splitRatio * 100}%` : \"1 1 100%\"}\"\r\n        >\r\n          ${thread}\r\n        </div>\r\n\r\n        ${\r\n          sidebarOpen\r\n            ? html`\r\n              <resizable-divider\r\n                .splitRatio=${splitRatio}\r\n                @resize=${(e: CustomEvent) => props.onSplitRatioChange?.(e.detail.splitRatio)}\r\n              ></resizable-divider>\r\n              <div class=\"chat-sidebar\">\r\n                ${renderMarkdownSidebar({\r\n                  content: props.sidebarContent ?? null,\r\n                  error: props.sidebarError ?? null,\r\n                  onClose: props.onCloseSidebar!,\r\n                  onViewRawText: () => {\r\n                    if (!props.sidebarContent || !props.onOpenSidebar) {\r\n                      return;\r\n                    }\r\n                    props.onOpenSidebar(`\\`\\`\\`\\n${props.sidebarContent}\\n\\`\\`\\``);\r\n                  },\r\n                })}\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n      </div>\r\n\r\n      ${\r\n        props.queue.length\r\n          ? html`\r\n            <div class=\"chat-queue\" role=\"status\" aria-live=\"polite\">\r\n              <div class=\"chat-queue__title\">Queued (${props.queue.length})</div>\r\n              <div class=\"chat-queue__list\">\r\n                ${props.queue.map(\r\n                  (item) => html`\r\n                    <div class=\"chat-queue__item\">\r\n                      <div class=\"chat-queue__text\">\r\n                        ${\r\n                          item.text ||\r\n                          (item.attachments?.length ? `Image (${item.attachments.length})` : \"\")\r\n                        }\r\n                      </div>\r\n                      <button\r\n                        class=\"btn chat-queue__remove\"\r\n                        type=\"button\"\r\n                        aria-label=\"Remove queued message\"\r\n                        @click=${() => props.onQueueRemove(item.id)}\r\n                      >\r\n                        ${icons.x}\r\n                      </button>\r\n                    </div>\r\n                  `,\r\n                )}\r\n              </div>\r\n            </div>\r\n          `\r\n          : nothing\r\n      }\r\n\r\n      ${renderCompactionIndicator(props.compactionStatus)}\r\n\r\n      ${\r\n        props.showNewMessages\r\n          ? html`\r\n            <button\r\n              class=\"btn chat-new-messages\"\r\n              type=\"button\"\r\n              @click=${props.onScrollToBottom}\r\n            >\r\n              New messages ${icons.arrowDown}\r\n            </button>\r\n          `\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"chat-compose\">\r\n        ${renderAttachmentPreview(props)}\r\n        <div class=\"chat-compose__row\">\r\n          <label class=\"field chat-compose__field\">\r\n            <span>Message</span>\r\n            <textarea\r\n              ${ref((el) => el && adjustTextareaHeight(el as HTMLTextAreaElement))}\r\n              .value=${props.draft}\r\n              dir=${detectTextDirection(props.draft)}\r\n              ?disabled=${!props.connected}\r\n              @keydown=${(e: KeyboardEvent) => {\r\n                if (e.key !== \"Enter\") {\r\n                  return;\r\n                }\r\n                if (e.isComposing || e.keyCode === 229) {\r\n                  return;\r\n                }\r\n                if (e.shiftKey) {\r\n                  return;\r\n                } // Allow Shift+Enter for line breaks\r\n                if (!props.connected) {\r\n                  return;\r\n                }\r\n                e.preventDefault();\r\n                if (canCompose) {\r\n                  props.onSend();\r\n                }\r\n              }}\r\n              @input=${(e: Event) => {\r\n                const target = e.target as HTMLTextAreaElement;\r\n                adjustTextareaHeight(target);\r\n                props.onDraftChange(target.value);\r\n              }}\r\n              @paste=${(e: ClipboardEvent) => handlePaste(e, props)}\r\n              placeholder=${composePlaceholder}\r\n            ></textarea>\r\n          </label>\r\n          <div class=\"chat-compose__actions\">\r\n            <button\r\n              class=\"btn\"\r\n              ?disabled=${!props.connected || (!canAbort && props.sending)}\r\n              @click=${canAbort ? props.onAbort : props.onNewSession}\r\n            >\r\n              ${canAbort ? \"Stop\" : \"New session\"}\r\n            </button>\r\n            <button\r\n              class=\"btn primary\"\r\n              ?disabled=${!props.connected}\r\n              @click=${props.onSend}\r\n            >\r\n              ${isBusy ? \"Queue\" : \"Send\"}<kbd class=\"btn-kbd\">↵</kbd>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nconst CHAT_HISTORY_RENDER_LIMIT = 200;\r\n\r\nfunction groupMessages(items: ChatItem[]): Array<ChatItem | MessageGroup> {\r\n  const result: Array<ChatItem | MessageGroup> = [];\r\n  let currentGroup: MessageGroup | null = null;\r\n\r\n  for (const item of items) {\r\n    if (item.kind !== \"message\") {\r\n      if (currentGroup) {\r\n        result.push(currentGroup);\r\n        currentGroup = null;\r\n      }\r\n      result.push(item);\r\n      continue;\r\n    }\r\n\r\n    const normalized = normalizeMessage(item.message);\r\n    const role = normalizeRoleForGrouping(normalized.role);\r\n    const timestamp = normalized.timestamp || Date.now();\r\n\r\n    if (!currentGroup || currentGroup.role !== role) {\r\n      if (currentGroup) {\r\n        result.push(currentGroup);\r\n      }\r\n      currentGroup = {\r\n        kind: \"group\",\r\n        key: `group:${role}:${item.key}`,\r\n        role,\r\n        messages: [{ message: item.message, key: item.key }],\r\n        timestamp,\r\n        isStreaming: false,\r\n      };\r\n    } else {\r\n      currentGroup.messages.push({ message: item.message, key: item.key });\r\n    }\r\n  }\r\n\r\n  if (currentGroup) {\r\n    result.push(currentGroup);\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction buildChatItems(props: ChatProps): Array<ChatItem | MessageGroup> {\r\n  const items: ChatItem[] = [];\r\n  const history = Array.isArray(props.messages) ? props.messages : [];\r\n  const tools = Array.isArray(props.toolMessages) ? props.toolMessages : [];\r\n  const historyStart = Math.max(0, history.length - CHAT_HISTORY_RENDER_LIMIT);\r\n  if (historyStart > 0) {\r\n    items.push({\r\n      kind: \"message\",\r\n      key: \"chat:history:notice\",\r\n      message: {\r\n        role: \"system\",\r\n        content: `Showing last ${CHAT_HISTORY_RENDER_LIMIT} messages (${historyStart} hidden).`,\r\n        timestamp: Date.now(),\r\n      },\r\n    });\r\n  }\r\n  for (let i = historyStart; i < history.length; i++) {\r\n    const msg = history[i];\r\n    const normalized = normalizeMessage(msg);\r\n    const raw = msg as Record<string, unknown>;\r\n    const marker = raw.__openclaw as Record<string, unknown> | undefined;\r\n    if (marker && marker.kind === \"compaction\") {\r\n      items.push({\r\n        kind: \"divider\",\r\n        key:\r\n          typeof marker.id === \"string\"\r\n            ? `divider:compaction:${marker.id}`\r\n            : `divider:compaction:${normalized.timestamp}:${i}`,\r\n        label: \"Compaction\",\r\n        timestamp: normalized.timestamp ?? Date.now(),\r\n      });\r\n      continue;\r\n    }\r\n\r\n    if (!props.showThinking && normalized.role.toLowerCase() === \"toolresult\") {\r\n      continue;\r\n    }\r\n\r\n    items.push({\r\n      kind: \"message\",\r\n      key: messageKey(msg, i),\r\n      message: msg,\r\n    });\r\n  }\r\n  if (props.showThinking) {\r\n    for (let i = 0; i < tools.length; i++) {\r\n      items.push({\r\n        kind: \"message\",\r\n        key: messageKey(tools[i], i + history.length),\r\n        message: tools[i],\r\n      });\r\n    }\r\n  }\r\n\r\n  if (props.stream !== null) {\r\n    const key = `stream:${props.sessionKey}:${props.streamStartedAt ?? \"live\"}`;\r\n    if (props.stream.trim().length > 0) {\r\n      items.push({\r\n        kind: \"stream\",\r\n        key,\r\n        text: props.stream,\r\n        startedAt: props.streamStartedAt ?? Date.now(),\r\n      });\r\n    } else {\r\n      items.push({ kind: \"reading-indicator\", key });\r\n    }\r\n  }\r\n\r\n  return groupMessages(items);\r\n}\r\n\r\nfunction messageKey(message: unknown, index: number): string {\r\n  const m = message as Record<string, unknown>;\r\n  const toolCallId = typeof m.toolCallId === \"string\" ? m.toolCallId : \"\";\r\n  if (toolCallId) {\r\n    return `tool:${toolCallId}`;\r\n  }\r\n  const id = typeof m.id === \"string\" ? m.id : \"\";\r\n  if (id) {\r\n    return `msg:${id}`;\r\n  }\r\n  const messageId = typeof m.messageId === \"string\" ? m.messageId : \"\";\r\n  if (messageId) {\r\n    return `msg:${messageId}`;\r\n  }\r\n  const timestamp = typeof m.timestamp === \"number\" ? m.timestamp : null;\r\n  const role = typeof m.role === \"string\" ? m.role : \"unknown\";\r\n  if (timestamp != null) {\r\n    return `msg:${role}:${timestamp}:${index}`;\r\n  }\r\n  return `msg:${role}:${index}`;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ConfigUiHints } from \"../types.ts\";\r\nimport { hintForPath, humanize, schemaType, type JsonSchema } from \"./config-form.shared.ts\";\r\nimport { analyzeConfigSchema, renderConfigForm, SECTION_META } from \"./config-form.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type ConfigProps = {\r\n  raw: string;\r\n  originalRaw: string;\r\n  valid: boolean | null;\r\n  issues: unknown[];\r\n  loading: boolean;\r\n  saving: boolean;\r\n  applying: boolean;\r\n  updating: boolean;\r\n  connected: boolean;\r\n  schema: unknown;\r\n  schemaLoading: boolean;\r\n  uiHints: ConfigUiHints;\r\n  formMode: \"form\" | \"raw\";\r\n  formValue: Record<string, unknown> | null;\r\n  originalValue: Record<string, unknown> | null;\r\n  searchQuery: string;\r\n  activeSection: string | null;\r\n  activeSubsection: string | null;\r\n  onRawChange: (next: string) => void;\r\n  onFormModeChange: (mode: \"form\" | \"raw\") => void;\r\n  onFormPatch: (path: Array<string | number>, value: unknown) => void;\r\n  onSearchChange: (query: string) => void;\r\n  onSectionChange: (section: string | null) => void;\r\n  onSubsectionChange: (section: string | null) => void;\r\n  onReload: () => void;\r\n  onSave: () => void;\r\n  onApply: () => void;\r\n  onUpdate: () => void;\r\n};\r\n\r\n// SVG Icons for sidebar (Lucide-style)\r\nconst sidebarIcons = {\r\n  all: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n      <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n      <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n      <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n    </svg>\r\n  `,\r\n  env: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n      <path\r\n        d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  update: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\r\n      <polyline points=\"7 10 12 15 17 10\"></polyline>\r\n      <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\r\n    </svg>\r\n  `,\r\n  agents: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path\r\n        d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"\r\n      ></path>\r\n      <circle cx=\"8\" cy=\"14\" r=\"1\"></circle>\r\n      <circle cx=\"16\" cy=\"14\" r=\"1\"></circle>\r\n    </svg>\r\n  `,\r\n  auth: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\r\n      <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\r\n    </svg>\r\n  `,\r\n  channels: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\r\n    </svg>\r\n  `,\r\n  messages: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n      <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n    </svg>\r\n  `,\r\n  commands: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <polyline points=\"4 17 10 11 4 5\"></polyline>\r\n      <line x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"></line>\r\n    </svg>\r\n  `,\r\n  hooks: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\r\n      <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\r\n    </svg>\r\n  `,\r\n  skills: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <polygon\r\n        points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"\r\n      ></polygon>\r\n    </svg>\r\n  `,\r\n  tools: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path\r\n        d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  gateway: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\r\n      <path\r\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  wizard: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M15 4V2\"></path>\r\n      <path d=\"M15 16v-2\"></path>\r\n      <path d=\"M8 9h2\"></path>\r\n      <path d=\"M20 9h2\"></path>\r\n      <path d=\"M17.8 11.8 19 13\"></path>\r\n      <path d=\"M15 9h0\"></path>\r\n      <path d=\"M17.8 6.2 19 5\"></path>\r\n      <path d=\"m3 21 9-9\"></path>\r\n      <path d=\"M12.2 6.2 11 5\"></path>\r\n    </svg>\r\n  `,\r\n  // Additional sections\r\n  meta: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M12 20h9\"></path>\r\n      <path d=\"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\"></path>\r\n    </svg>\r\n  `,\r\n  logging: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\r\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\r\n      <polyline points=\"10 9 9 9 8 9\"></polyline>\r\n    </svg>\r\n  `,\r\n  browser: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <circle cx=\"12\" cy=\"12\" r=\"4\"></circle>\r\n      <line x1=\"21.17\" y1=\"8\" x2=\"12\" y2=\"8\"></line>\r\n      <line x1=\"3.95\" y1=\"6.06\" x2=\"8.54\" y2=\"14\"></line>\r\n      <line x1=\"10.88\" y1=\"21.94\" x2=\"15.46\" y2=\"14\"></line>\r\n    </svg>\r\n  `,\r\n  ui: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n      <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n    </svg>\r\n  `,\r\n  models: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path\r\n        d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"\r\n      ></path>\r\n      <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline>\r\n      <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line>\r\n    </svg>\r\n  `,\r\n  bindings: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\r\n      <rect x=\"2\" y=\"14\" width=\"20\" height=\"8\" rx=\"2\" ry=\"2\"></rect>\r\n      <line x1=\"6\" y1=\"6\" x2=\"6.01\" y2=\"6\"></line>\r\n      <line x1=\"6\" y1=\"18\" x2=\"6.01\" y2=\"18\"></line>\r\n    </svg>\r\n  `,\r\n  broadcast: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M4.9 19.1C1 15.2 1 8.8 4.9 4.9\"></path>\r\n      <path d=\"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5\"></path>\r\n      <circle cx=\"12\" cy=\"12\" r=\"2\"></circle>\r\n      <path d=\"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5\"></path>\r\n      <path d=\"M19.1 4.9C23 8.8 23 15.1 19.1 19\"></path>\r\n    </svg>\r\n  `,\r\n  audio: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 18V5l12-2v13\"></path>\r\n      <circle cx=\"6\" cy=\"18\" r=\"3\"></circle>\r\n      <circle cx=\"18\" cy=\"16\" r=\"3\"></circle>\r\n    </svg>\r\n  `,\r\n  session: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\r\n      <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\r\n      <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path>\r\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\r\n    </svg>\r\n  `,\r\n  cron: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <polyline points=\"12 6 12 12 16 14\"></polyline>\r\n    </svg>\r\n  `,\r\n  web: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n      <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\r\n      <path\r\n        d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"\r\n      ></path>\r\n    </svg>\r\n  `,\r\n  discovery: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\r\n      <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\r\n    </svg>\r\n  `,\r\n  canvasHost: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n      <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n      <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n    </svg>\r\n  `,\r\n  talk: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"></path>\r\n      <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"></path>\r\n      <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"></line>\r\n      <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"></line>\r\n    </svg>\r\n  `,\r\n  plugins: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M12 2v6\"></path>\r\n      <path d=\"m4.93 10.93 4.24 4.24\"></path>\r\n      <path d=\"M2 12h6\"></path>\r\n      <path d=\"m4.93 13.07 4.24-4.24\"></path>\r\n      <path d=\"M12 22v-6\"></path>\r\n      <path d=\"m19.07 13.07-4.24-4.24\"></path>\r\n      <path d=\"M22 12h-6\"></path>\r\n      <path d=\"m19.07 10.93-4.24 4.24\"></path>\r\n    </svg>\r\n  `,\r\n  default: html`\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n      <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n    </svg>\r\n  `,\r\n};\r\n\r\n// Section definitions\r\nconst SECTIONS: Array<{ key: string; label: string }> = [\r\n  { key: \"env\", label: T(\"Environment\") },\r\n  { key: \"update\", label: T(\"Updates\") },\r\n  { key: \"agents\", label: T(\"Agents\") },\r\n  { key: \"auth\", label: T(\"Authentication\") },\r\n  { key: \"channels\", label: T(\"Channels\") },\r\n  { key: \"messages\", label: T(\"Messages\") },\r\n  { key: \"commands\", label: T(\"Commands\") },\r\n  { key: \"hooks\", label: T(\"Hooks\") },\r\n  { key: \"skills\", label: T(\"Skills\") },\r\n  { key: \"tools\", label: T(\"Tools\") },\r\n  { key: \"gateway\", label: T(\"Gateway\") },\r\n  { key: \"wizard\", label: T(\"Setup Wizard\") },\r\n  { key: \"meta\", label: T(\"Meta\") },\r\n  { key: \"diagnostics\", label: T(\"Diagnostics\") },\r\n  { key: \"logging\", label: T(\"Logging\") },\r\n  { key: \"browser\", label: T(\"Browser\") },\r\n  { key: \"ui\", label: T(\"Ui\") },\r\n  { key: \"models\", label: T(\"Models\") },\r\n  { key: \"nodeHost\", label: T(\"NodeHost\") },\r\n  { key: \"bindings\", label: T(\"Bindings\") },\r\n  { key: \"broadcast\", label: T(\"Broadcast\") },\r\n  { key: \"audio\", label: T(\"Audio\") },\r\n  { key: \"media\", label: T(\"Media\") },\r\n  { key: \"approvals\", label: T(\"Approvals\") },\r\n  { key: \"session\", label: T(\"Session\") },\r\n  { key: \"cron\", label: T(\"Cron\") },\r\n  { key: \"web\", label: T(\"Web\") },\r\n  { key: \"discovery\", label: T(\"Discovery\") },\r\n  { key: \"canvasHost\", label: T(\"CanvasHost\") },\r\n  { key: \"talk\", label: T(\"Talk\") },\r\n  { key: \"memory\", label: T(\"Memory\") },\r\n  { key: \"plugins\", label: T(\"Plugins\") },\r\n];\r\n\r\ntype SubsectionEntry = {\r\n  key: string;\r\n  label: string;\r\n  description?: string;\r\n  order: number;\r\n};\r\n\r\nconst ALL_SUBSECTION = \"__all__\";\r\n\r\nfunction getSectionIcon(key: string) {\r\n  return sidebarIcons[key as keyof typeof sidebarIcons] ?? sidebarIcons.default;\r\n}\r\n\r\nfunction resolveSectionMeta(\r\n  key: string,\r\n  schema?: JsonSchema,\r\n): {\r\n  label: string;\r\n  description?: string;\r\n} {\r\n  const meta = SECTION_META[key];\r\n  if (meta) {\r\n    return meta;\r\n  }\r\n  return {\r\n    label: schema?.title ?? humanize(key),\r\n    description: schema?.description ?? \"\",\r\n  };\r\n}\r\n\r\nfunction resolveSubsections(params: {\r\n  key: string;\r\n  schema: JsonSchema | undefined;\r\n  uiHints: ConfigUiHints;\r\n}): SubsectionEntry[] {\r\n  const { key, schema, uiHints } = params;\r\n  if (!schema || schemaType(schema) !== \"object\" || !schema.properties) {\r\n    return [];\r\n  }\r\n  const entries = Object.entries(schema.properties).map(([subKey, node]) => {\r\n    const hint = hintForPath([key, subKey], uiHints);\r\n    const label = hint?.label ?? node.title ?? humanize(subKey);\r\n    const description = hint?.help ?? node.description ?? \"\";\r\n    const order = hint?.order ?? 50;\r\n    return { key: subKey, label: T(label), description: T(description), order };\r\n  });\r\n  entries.sort((a, b) => (a.order !== b.order ? a.order - b.order : a.key.localeCompare(b.key)));\r\n  return entries;\r\n}\r\n\r\nfunction computeDiff(\r\n  original: Record<string, unknown> | null,\r\n  current: Record<string, unknown> | null,\r\n): Array<{ path: string; from: unknown; to: unknown }> {\r\n  if (!original || !current) {\r\n    return [];\r\n  }\r\n  const changes: Array<{ path: string; from: unknown; to: unknown }> = [];\r\n\r\n  function compare(orig: unknown, curr: unknown, path: string) {\r\n    if (orig === curr) {\r\n      return;\r\n    }\r\n    if (typeof orig !== typeof curr) {\r\n      changes.push({ path, from: orig, to: curr });\r\n      return;\r\n    }\r\n    if (typeof orig !== \"object\" || orig === null || curr === null) {\r\n      if (orig !== curr) {\r\n        changes.push({ path, from: orig, to: curr });\r\n      }\r\n      return;\r\n    }\r\n    if (Array.isArray(orig) && Array.isArray(curr)) {\r\n      if (JSON.stringify(orig) !== JSON.stringify(curr)) {\r\n        changes.push({ path, from: orig, to: curr });\r\n      }\r\n      return;\r\n    }\r\n    const origObj = orig as Record<string, unknown>;\r\n    const currObj = curr as Record<string, unknown>;\r\n    const allKeys = new Set([...Object.keys(origObj), ...Object.keys(currObj)]);\r\n    for (const key of allKeys) {\r\n      compare(origObj[key], currObj[key], path ? `${path}.${key}` : key);\r\n    }\r\n  }\r\n\r\n  compare(original, current, \"\");\r\n  return changes;\r\n}\r\n\r\nfunction truncateValue(value: unknown, maxLen = 40): string {\r\n  let str: string;\r\n  try {\r\n    const json = JSON.stringify(value);\r\n    str = json ?? String(value);\r\n  } catch {\r\n    str = String(value);\r\n  }\r\n  if (str.length <= maxLen) {\r\n    return str;\r\n  }\r\n  return str.slice(0, maxLen - 3) + \"...\";\r\n}\r\n\r\nexport function renderConfig(props: ConfigProps) {\r\n  const validity = props.valid == null ? \"unknown\" : props.valid ? \"valid\" : \"invalid\";\r\n  const analysis = analyzeConfigSchema(props.schema);\r\n  const formUnsafe = analysis.schema ? analysis.unsupportedPaths.length > 0 : false;\r\n\r\n  // Get available sections from schema\r\n  const schemaProps = analysis.schema?.properties ?? {};\r\n  const availableSections = SECTIONS.filter((s) => s.key in schemaProps);\r\n\r\n  // Add any sections in schema but not in our list\r\n  const knownKeys = new Set(SECTIONS.map((s) => s.key));\r\n  const extraSections = Object.keys(schemaProps)\r\n    .filter((k) => !knownKeys.has(k))\r\n    .map((k) => ({ key: k, label: k.charAt(0).toUpperCase() + k.slice(1) }));\r\n\r\n  const allSections = [...availableSections, ...extraSections];\r\n\r\n  const activeSectionSchema =\r\n    props.activeSection && analysis.schema && schemaType(analysis.schema) === \"object\"\r\n      ? analysis.schema.properties?.[props.activeSection]\r\n      : undefined;\r\n  const activeSectionMeta = props.activeSection\r\n    ? resolveSectionMeta(props.activeSection, activeSectionSchema)\r\n    : null;\r\n  const subsections = props.activeSection\r\n    ? resolveSubsections({\r\n        key: props.activeSection,\r\n        schema: activeSectionSchema,\r\n        uiHints: props.uiHints,\r\n      })\r\n    : [];\r\n  const allowSubnav =\r\n    props.formMode === \"form\" && Boolean(props.activeSection) && subsections.length > 0;\r\n  const isAllSubsection = props.activeSubsection === ALL_SUBSECTION;\r\n  const effectiveSubsection = props.searchQuery\r\n    ? null\r\n    : isAllSubsection\r\n      ? null\r\n      : (props.activeSubsection ?? subsections[0]?.key ?? null);\r\n\r\n  // Compute diff for showing changes (works for both form and raw modes)\r\n  const diff = props.formMode === \"form\" ? computeDiff(props.originalValue, props.formValue) : [];\r\n  const hasRawChanges = props.formMode === \"raw\" && props.raw !== props.originalRaw;\r\n  const hasChanges = props.formMode === \"form\" ? diff.length > 0 : hasRawChanges;\r\n\r\n  // Save/apply buttons require actual changes to be enabled.\r\n  // Note: formUnsafe warns about unsupported schema paths but shouldn't block saving.\r\n  const canSaveForm = Boolean(props.formValue) && !props.loading && Boolean(analysis.schema);\r\n  const canSave =\r\n    props.connected &&\r\n    !props.saving &&\r\n    hasChanges &&\r\n    (props.formMode === \"raw\" ? true : canSaveForm);\r\n  const canApply =\r\n    props.connected &&\r\n    !props.applying &&\r\n    !props.updating &&\r\n    hasChanges &&\r\n    (props.formMode === \"raw\" ? true : canSaveForm);\r\n  const canUpdate = props.connected && !props.applying && !props.updating;\r\n\r\n  return html`\r\n    <div class=\"config-layout\">\r\n      <!-- Sidebar -->\r\n      <aside class=\"config-sidebar\">\r\n        <div class=\"config-sidebar__header\">\r\n          <div class=\"config-sidebar__title\">Settings</div>\r\n          <span\r\n            class=\"pill pill--sm ${\r\n              validity === \"valid\" ? \"pill--ok\" : validity === \"invalid\" ? \"pill--danger\" : \"\"\r\n            }\"\r\n            >${validity}</span\r\n          >\r\n        </div>\r\n\r\n        <!-- Search -->\r\n        <div class=\"config-search\">\r\n          <svg\r\n            class=\"config-search__icon\"\r\n            viewBox=\"0 0 24 24\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            stroke-width=\"2\"\r\n          >\r\n            <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\r\n            <path d=\"M21 21l-4.35-4.35\"></path>\r\n          </svg>\r\n          <input\r\n            type=\"text\"\r\n            class=\"config-search__input\"\r\n            placeholder=\"Search settings...\"\r\n            .value=${props.searchQuery}\r\n            @input=${(e: Event) => props.onSearchChange((e.target as HTMLInputElement).value)}\r\n          />\r\n          ${\r\n            props.searchQuery\r\n              ? html`\r\n                <button\r\n                  class=\"config-search__clear\"\r\n                  @click=${() => props.onSearchChange(\"\")}\r\n                >\r\n                  ×\r\n                </button>\r\n              `\r\n              : nothing\r\n          }\r\n        </div>\r\n\r\n        <!-- Section nav -->\r\n        <nav class=\"config-nav\">\r\n          <button\r\n            class=\"config-nav__item ${props.activeSection === null ? \"active\" : \"\"}\"\r\n            @click=${() => props.onSectionChange(null)}\r\n          >\r\n            <span class=\"config-nav__icon\">${sidebarIcons.all}</span>\r\n            <span class=\"config-nav__label\">${T(\"All Settings\")}</span>\r\n          </button>\r\n          ${allSections.map(\r\n            (section) => html`\r\n              <button\r\n                class=\"config-nav__item ${props.activeSection === section.key ? \"active\" : \"\"}\"\r\n                @click=${() => props.onSectionChange(section.key)}\r\n              >\r\n                <span class=\"config-nav__icon\"\r\n                  >${getSectionIcon(section.key)}</span\r\n                >\r\n                <span class=\"config-nav__label\">${section.label}</span>\r\n              </button>\r\n            `,\r\n          )}\r\n        </nav>\r\n\r\n        <!-- Mode toggle at bottom -->\r\n        <div class=\"config-sidebar__footer\">\r\n          <div class=\"config-mode-toggle\">\r\n            <button\r\n              class=\"config-mode-toggle__btn ${props.formMode === \"form\" ? \"active\" : \"\"}\"\r\n              ?disabled=${props.schemaLoading || !props.schema}\r\n              @click=${() => props.onFormModeChange(\"form\")}\r\n            >\r\n              Form\r\n            </button>\r\n            <button\r\n              class=\"config-mode-toggle__btn ${props.formMode === \"raw\" ? \"active\" : \"\"}\"\r\n              @click=${() => props.onFormModeChange(\"raw\")}\r\n            >\r\n              Raw\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </aside>\r\n\r\n      <!-- Main content -->\r\n      <main class=\"config-main\">\r\n        <!-- Action bar -->\r\n        <div class=\"config-actions\">\r\n          <div class=\"config-actions__left\">\r\n            ${\r\n              hasChanges\r\n                ? html`\r\n                  <span class=\"config-changes-badge\"\r\n                    >${\r\n                      props.formMode === \"raw\"\r\n                        ? \"Unsaved changes\"\r\n                        : `${diff.length} unsaved change${diff.length !== 1 ? \"s\" : \"\"}`\r\n                    }</span\r\n                  >\r\n                `\r\n                : html`\r\n                    <span class=\"config-status muted\">${T(\"No changes\")}</span>\r\n                  `\r\n            }\r\n          </div>\r\n          <div class=\"config-actions__right\">\r\n            <button\r\n              class=\"btn btn--sm\"\r\n              ?disabled=${props.loading}\r\n              @click=${props.onReload}\r\n            >\r\n              ${props.loading ? T(\"Loading...\") : T(\"Reload\")}\r\n            </button>\r\n            <button\r\n              class=\"btn btn--sm primary\"\r\n              ?disabled=${!canSave}\r\n              @click=${props.onSave}\r\n            >\r\n              ${props.saving ? T(\"Saving...\") : T(\"Save\")}\r\n            </button>\r\n            <button\r\n              class=\"btn btn--sm\"\r\n              ?disabled=${!canApply}\r\n              @click=${props.onApply}\r\n            >\r\n              ${props.applying ? T(\"Applying...\") : T(\"Apply\")}\r\n            </button>\r\n            <button\r\n              class=\"btn btn--sm\"\r\n              ?disabled=${!canUpdate}\r\n              @click=${props.onUpdate}\r\n            >\r\n              ${props.updating ? T(\"Updating...\") : T(\"Update\")}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Diff panel (form mode only - raw mode doesn't have granular diff) -->\r\n        ${\r\n          hasChanges && props.formMode === \"form\"\r\n            ? html`\r\n              <details class=\"config-diff\">\r\n                <summary class=\"config-diff__summary\">\r\n                  <span\r\n                    >${T(\"View\")} ${diff.length} ${T(\"pending\")} ${T(\"change\")}${diff.length !== 1 ? \"s\" : \"\"}</span\r\n                  >\r\n                  <svg\r\n                    class=\"config-diff__chevron\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    stroke-width=\"2\"\r\n                  >\r\n                    <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n                  </svg>\r\n                </summary>\r\n                <div class=\"config-diff__content\">\r\n                  ${diff.map(\r\n                    (change) => html`\r\n                      <div class=\"config-diff__item\">\r\n                        <div class=\"config-diff__path\">${change.path}</div>\r\n                        <div class=\"config-diff__values\">\r\n                          <span class=\"config-diff__from\"\r\n                            >${truncateValue(change.from)}</span\r\n                          >\r\n                          <span class=\"config-diff__arrow\">→</span>\r\n                          <span class=\"config-diff__to\"\r\n                            >${truncateValue(change.to)}</span\r\n                          >\r\n                        </div>\r\n                      </div>\r\n                    `,\r\n                  )}\r\n                </div>\r\n              </details>\r\n            `\r\n            : nothing\r\n        }\r\n        ${\r\n          activeSectionMeta && props.formMode === \"form\"\r\n            ? html`\r\n              <div class=\"config-section-hero\">\r\n                <div class=\"config-section-hero__icon\">\r\n                  ${getSectionIcon(props.activeSection ?? \"\")}\r\n                </div>\r\n                <div class=\"config-section-hero__text\">\r\n                  <div class=\"config-section-hero__title\">\r\n                    ${activeSectionMeta.label}\r\n                  </div>\r\n                  ${\r\n                    activeSectionMeta.description\r\n                      ? html`<div class=\"config-section-hero__desc\">\r\n                        ${activeSectionMeta.description}\r\n                      </div>`\r\n                      : nothing\r\n                  }\r\n                </div>\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n        ${\r\n          allowSubnav\r\n            ? html`\r\n              <div class=\"config-subnav\">\r\n                <button\r\n                  class=\"config-subnav__item ${effectiveSubsection === null ? \"active\" : \"\"}\"\r\n                  @click=${() => props.onSubsectionChange(ALL_SUBSECTION)}\r\n                >\r\n                  ${T(\"All\")}\r\n                </button>\r\n                ${subsections.map(\r\n                  (entry) => html`\r\n                    <button\r\n                      class=\"config-subnav__item ${\r\n                        effectiveSubsection === entry.key ? \"active\" : \"\"\r\n                      }\"\r\n                      title=${entry.description || entry.label}\r\n                      @click=${() => props.onSubsectionChange(entry.key)}\r\n                    >\r\n                      ${entry.label}\r\n                    </button>\r\n                  `,\r\n                )}\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n\r\n        <!-- Form content -->\r\n        <div class=\"config-content\">\r\n          ${\r\n            props.formMode === \"form\"\r\n              ? html`\r\n                ${\r\n                  props.schemaLoading\r\n                    ? html`\r\n                        <div class=\"config-loading\">\r\n                          <div class=\"config-loading__spinner\"></div>\r\n                          <span>Loading schema…</span>\r\n                        </div>\r\n                      `\r\n                    : renderConfigForm({\r\n                        schema: analysis.schema,\r\n                        uiHints: props.uiHints,\r\n                        value: props.formValue,\r\n                        disabled: props.loading || !props.formValue,\r\n                        unsupportedPaths: analysis.unsupportedPaths,\r\n                        onPatch: props.onFormPatch,\r\n                        searchQuery: props.searchQuery,\r\n                        activeSection: props.activeSection,\r\n                        activeSubsection: effectiveSubsection,\r\n                      })\r\n                }\r\n                ${\r\n                  formUnsafe\r\n                    ? html`\r\n                        <div class=\"callout danger\" style=\"margin-top: 12px\">\r\n                          Form view can't safely edit some fields. Use Raw to avoid losing config entries.\r\n                        </div>\r\n                      `\r\n                    : nothing\r\n                }\r\n              `\r\n              : html`\r\n                <label class=\"field config-raw-field\">\r\n                  <span>Raw JSON5</span>\r\n                  <textarea\r\n                    .value=${props.raw}\r\n                    @input=${(e: Event) =>\r\n                      props.onRawChange((e.target as HTMLTextAreaElement).value)}\r\n                  ></textarea>\r\n                </label>\r\n              `\r\n          }\r\n        </div>\r\n\r\n        ${\r\n          props.issues.length > 0\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n              <pre class=\"code-block\">\r\n${JSON.stringify(props.issues, null, 2)}</pre\r\n              >\r\n            </div>`\r\n            : nothing\r\n        }\r\n      </main>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { ChannelUiMetaEntry, CronJob, CronRunLogEntry, CronStatus } from \"../types.ts\";\r\nimport type { CronFormState } from \"../ui-types.ts\";\r\nimport { formatRelativeTimestamp, formatMs } from \"../format.ts\";\r\nimport { pathForTab } from \"../navigation.ts\";\r\nimport { formatCronSchedule, formatNextRun } from \"../presenter.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type CronProps = {\r\n  basePath: string;\r\n  loading: boolean;\r\n  status: CronStatus | null;\r\n  jobs: CronJob[];\r\n  error: string | null;\r\n  busy: boolean;\r\n  form: CronFormState;\r\n  channels: string[];\r\n  channelLabels?: Record<string, string>;\r\n  channelMeta?: ChannelUiMetaEntry[];\r\n  runsJobId: string | null;\r\n  runs: CronRunLogEntry[];\r\n  onFormChange: (patch: Partial<CronFormState>) => void;\r\n  onRefresh: () => void;\r\n  onAdd: () => void;\r\n  onToggle: (job: CronJob, enabled: boolean) => void;\r\n  onRun: (job: CronJob) => void;\r\n  onRemove: (job: CronJob) => void;\r\n  onLoadRuns: (jobId: string) => void;\r\n};\r\n\r\nfunction buildChannelOptions(props: CronProps): string[] {\r\n  const options = [\"last\", ...props.channels.filter(Boolean)];\r\n  const current = props.form.deliveryChannel?.trim();\r\n  if (current && !options.includes(current)) {\r\n    options.push(current);\r\n  }\r\n  const seen = new Set<string>();\r\n  return options.filter((value) => {\r\n    if (seen.has(value)) {\r\n      return false;\r\n    }\r\n    seen.add(value);\r\n    return true;\r\n  });\r\n}\r\n\r\nfunction resolveChannelLabel(props: CronProps, channel: string): string {\r\n  if (channel === \"last\") {\r\n    return \"last\";\r\n  }\r\n  const meta = props.channelMeta?.find((entry) => entry.id === channel);\r\n  if (meta?.label) {\r\n    return meta.label;\r\n  }\r\n  return props.channelLabels?.[channel] ?? channel;\r\n}\r\n\r\nexport function renderCron(props: CronProps) {\r\n  const channelOptions = buildChannelOptions(props);\r\n  const selectedJob =\r\n    props.runsJobId == null ? undefined : props.jobs.find((job) => job.id === props.runsJobId);\r\n  const selectedRunTitle = selectedJob?.name ?? props.runsJobId ?? \"(select a job)\";\r\n  const orderedRuns = props.runs.toSorted((a, b) => b.ts - a.ts);\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      <div class=\"card\">\r\n        <div class=\"card-title\">Scheduler</div>\r\n        <div class=\"card-sub\">Gateway-owned cron scheduler status.</div>\r\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Enabled</div>\r\n            <div class=\"stat-value\">\r\n              ${props.status ? (props.status.enabled ? \"Yes\" : \"No\") : \"n/a\"}\r\n            </div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Jobs</div>\r\n            <div class=\"stat-value\">${props.status?.jobs ?? \"n/a\"}</div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">Next wake</div>\r\n            <div class=\"stat-value\">${formatNextRun(props.status?.nextWakeAtMs ?? null)}</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"row\" style=\"margin-top: 12px;\">\r\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n            ${props.loading ? \"Refreshing…\" : \"Refresh\"}\r\n          </button>\r\n          ${props.error ? html`<span class=\"muted\">${props.error}</span>` : nothing}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card\">\r\n        <div class=\"card-title\">New Job</div>\r\n        <div class=\"card-sub\">Create a scheduled wakeup or agent run.</div>\r\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\r\n          <label class=\"field\">\r\n            <span>Name</span>\r\n            <input\r\n              .value=${props.form.name}\r\n              @input=${(e: Event) =>\r\n                props.onFormChange({ name: (e.target as HTMLInputElement).value })}\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Description</span>\r\n            <input\r\n              .value=${props.form.description}\r\n              @input=${(e: Event) =>\r\n                props.onFormChange({ description: (e.target as HTMLInputElement).value })}\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Agent ID</span>\r\n            <input\r\n              .value=${props.form.agentId}\r\n              @input=${(e: Event) =>\r\n                props.onFormChange({ agentId: (e.target as HTMLInputElement).value })}\r\n              placeholder=\"default\"\r\n            />\r\n          </label>\r\n          <label class=\"field checkbox\">\r\n            <span>Enabled</span>\r\n            <input\r\n              type=\"checkbox\"\r\n              .checked=${props.form.enabled}\r\n              @change=${(e: Event) =>\r\n                props.onFormChange({ enabled: (e.target as HTMLInputElement).checked })}\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Schedule</span>\r\n            <select\r\n              .value=${props.form.scheduleKind}\r\n              @change=${(e: Event) =>\r\n                props.onFormChange({\r\n                  scheduleKind: (e.target as HTMLSelectElement)\r\n                    .value as CronFormState[\"scheduleKind\"],\r\n                })}\r\n            >\r\n              <option value=\"every\">Every</option>\r\n              <option value=\"at\">At</option>\r\n              <option value=\"cron\">Cron</option>\r\n            </select>\r\n          </label>\r\n        </div>\r\n        ${renderScheduleFields(props)}\r\n        <div class=\"form-grid\" style=\"margin-top: 12px;\">\r\n          <label class=\"field\">\r\n            <span>Session</span>\r\n            <select\r\n              .value=${props.form.sessionTarget}\r\n              @change=${(e: Event) =>\r\n                props.onFormChange({\r\n                  sessionTarget: (e.target as HTMLSelectElement)\r\n                    .value as CronFormState[\"sessionTarget\"],\r\n                })}\r\n            >\r\n              <option value=\"main\">Main</option>\r\n              <option value=\"isolated\">Isolated</option>\r\n            </select>\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Wake mode</span>\r\n            <select\r\n              .value=${props.form.wakeMode}\r\n              @change=${(e: Event) =>\r\n                props.onFormChange({\r\n                  wakeMode: (e.target as HTMLSelectElement).value as CronFormState[\"wakeMode\"],\r\n                })}\r\n            >\r\n              <option value=\"now\">Now</option>\r\n              <option value=\"next-heartbeat\">Next heartbeat</option>\r\n            </select>\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Payload</span>\r\n            <select\r\n              .value=${props.form.payloadKind}\r\n              @change=${(e: Event) =>\r\n                props.onFormChange({\r\n                  payloadKind: (e.target as HTMLSelectElement)\r\n                    .value as CronFormState[\"payloadKind\"],\r\n                })}\r\n            >\r\n              <option value=\"systemEvent\">System event</option>\r\n              <option value=\"agentTurn\">Agent turn</option>\r\n            </select>\r\n          </label>\r\n        </div>\r\n        <label class=\"field\" style=\"margin-top: 12px;\">\r\n          <span>${props.form.payloadKind === \"systemEvent\" ? \"System text\" : \"Agent message\"}</span>\r\n          <textarea\r\n            .value=${props.form.payloadText}\r\n            @input=${(e: Event) =>\r\n              props.onFormChange({\r\n                payloadText: (e.target as HTMLTextAreaElement).value,\r\n              })}\r\n            rows=\"4\"\r\n          ></textarea>\r\n        </label>\r\n        ${\r\n          props.form.payloadKind === \"agentTurn\"\r\n            ? html`\r\n                <div class=\"form-grid\" style=\"margin-top: 12px;\">\r\n                  <label class=\"field\">\r\n                    <span>Delivery</span>\r\n                    <select\r\n                      .value=${props.form.deliveryMode}\r\n                      @change=${(e: Event) =>\r\n                        props.onFormChange({\r\n                          deliveryMode: (e.target as HTMLSelectElement)\r\n                            .value as CronFormState[\"deliveryMode\"],\r\n                        })}\r\n                    >\r\n                      <option value=\"announce\">Announce summary (default)</option>\r\n                      <option value=\"none\">None (internal)</option>\r\n                    </select>\r\n                  </label>\r\n                  <label class=\"field\">\r\n                    <span>Timeout (seconds)</span>\r\n                    <input\r\n                      .value=${props.form.timeoutSeconds}\r\n                      @input=${(e: Event) =>\r\n                        props.onFormChange({\r\n                          timeoutSeconds: (e.target as HTMLInputElement).value,\r\n                        })}\r\n                    />\r\n                  </label>\r\n                  ${\r\n                    props.form.deliveryMode === \"announce\"\r\n                      ? html`\r\n                          <label class=\"field\">\r\n                            <span>Channel</span>\r\n                            <select\r\n                              .value=${props.form.deliveryChannel || \"last\"}\r\n                              @change=${(e: Event) =>\r\n                                props.onFormChange({\r\n                                  deliveryChannel: (e.target as HTMLSelectElement).value,\r\n                                })}\r\n                            >\r\n                              ${channelOptions.map(\r\n                                (channel) =>\r\n                                  html`<option value=${channel}>\r\n                                    ${resolveChannelLabel(props, channel)}\r\n                                  </option>`,\r\n                              )}\r\n                            </select>\r\n                          </label>\r\n                          <label class=\"field\">\r\n                            <span>To</span>\r\n                            <input\r\n                              .value=${props.form.deliveryTo}\r\n                              @input=${(e: Event) =>\r\n                                props.onFormChange({\r\n                                  deliveryTo: (e.target as HTMLInputElement).value,\r\n                                })}\r\n                              placeholder=\"+1555… or chat id\"\r\n                            />\r\n                          </label>\r\n                        `\r\n                      : nothing\r\n                  }\r\n                </div>\r\n              `\r\n            : nothing\r\n        }\r\n        <div class=\"row\" style=\"margin-top: 14px;\">\r\n          <button class=\"btn primary\" ?disabled=${props.busy} @click=${props.onAdd}>\r\n            ${props.busy ? \"Saving…\" : \"Add job\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"card-title\">Jobs</div>\r\n      <div class=\"card-sub\">All scheduled jobs stored in the gateway.</div>\r\n      ${\r\n        props.jobs.length === 0\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 12px\">No jobs yet.</div>\r\n            `\r\n          : html`\r\n            <div class=\"list\" style=\"margin-top: 12px;\">\r\n              ${props.jobs.map((job) => renderJob(job, props))}\r\n            </div>\r\n          `\r\n      }\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"card-title\">Run history</div>\r\n      <div class=\"card-sub\">Latest runs for ${selectedRunTitle}.</div>\r\n      ${\r\n        props.runsJobId == null\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 12px\">Select a job to inspect run history.</div>\r\n            `\r\n          : orderedRuns.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"margin-top: 12px\">No runs yet.</div>\r\n              `\r\n            : html`\r\n              <div class=\"list\" style=\"margin-top: 12px;\">\r\n                ${orderedRuns.map((entry) => renderRun(entry, props.basePath))}\r\n              </div>\r\n            `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderScheduleFields(props: CronProps) {\r\n  const form = props.form;\r\n  if (form.scheduleKind === \"at\") {\r\n    return html`\r\n      <label class=\"field\" style=\"margin-top: 12px;\">\r\n        <span>Run at</span>\r\n        <input\r\n          type=\"datetime-local\"\r\n          .value=${form.scheduleAt}\r\n          @input=${(e: Event) =>\r\n            props.onFormChange({\r\n              scheduleAt: (e.target as HTMLInputElement).value,\r\n            })}\r\n        />\r\n      </label>\r\n    `;\r\n  }\r\n  if (form.scheduleKind === \"every\") {\r\n    return html`\r\n      <div class=\"form-grid\" style=\"margin-top: 12px;\">\r\n        <label class=\"field\">\r\n          <span>Every</span>\r\n          <input\r\n            .value=${form.everyAmount}\r\n            @input=${(e: Event) =>\r\n              props.onFormChange({\r\n                everyAmount: (e.target as HTMLInputElement).value,\r\n              })}\r\n          />\r\n        </label>\r\n        <label class=\"field\">\r\n          <span>Unit</span>\r\n          <select\r\n            .value=${form.everyUnit}\r\n            @change=${(e: Event) =>\r\n              props.onFormChange({\r\n                everyUnit: (e.target as HTMLSelectElement).value as CronFormState[\"everyUnit\"],\r\n              })}\r\n          >\r\n            <option value=\"minutes\">Minutes</option>\r\n            <option value=\"hours\">Hours</option>\r\n            <option value=\"days\">Days</option>\r\n          </select>\r\n        </label>\r\n      </div>\r\n    `;\r\n  }\r\n  return html`\r\n    <div class=\"form-grid\" style=\"margin-top: 12px;\">\r\n      <label class=\"field\">\r\n        <span>Expression</span>\r\n        <input\r\n          .value=${form.cronExpr}\r\n          @input=${(e: Event) =>\r\n            props.onFormChange({ cronExpr: (e.target as HTMLInputElement).value })}\r\n        />\r\n      </label>\r\n      <label class=\"field\">\r\n        <span>Timezone (optional)</span>\r\n        <input\r\n          .value=${form.cronTz}\r\n          @input=${(e: Event) =>\r\n            props.onFormChange({ cronTz: (e.target as HTMLInputElement).value })}\r\n        />\r\n      </label>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderJob(job: CronJob, props: CronProps) {\r\n  const isSelected = props.runsJobId === job.id;\r\n  const itemClass = `list-item list-item-clickable cron-job${isSelected ? \" list-item-selected\" : \"\"}`;\r\n  return html`\r\n    <div class=${itemClass} @click=${() => props.onLoadRuns(job.id)}>\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${job.name}</div>\r\n        <div class=\"list-sub\">${formatCronSchedule(job)}</div>\r\n        ${renderJobPayload(job)}\r\n        ${job.agentId ? html`<div class=\"muted cron-job-agent\">Agent: ${job.agentId}</div>` : nothing}\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        ${renderJobState(job)}\r\n      </div>\r\n      <div class=\"cron-job-footer\">\r\n        <div class=\"chip-row cron-job-chips\">\r\n          <span class=${`chip ${job.enabled ? \"chip-ok\" : \"chip-danger\"}`}>\r\n            ${job.enabled ? \"enabled\" : \"disabled\"}\r\n          </span>\r\n          <span class=\"chip\">${job.sessionTarget}</span>\r\n          <span class=\"chip\">${job.wakeMode}</span>\r\n        </div>\r\n        <div class=\"row cron-job-actions\">\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${props.busy}\r\n            @click=${(event: Event) => {\r\n              event.stopPropagation();\r\n              props.onToggle(job, !job.enabled);\r\n            }}\r\n          >\r\n            ${job.enabled ? \"Disable\" : \"Enable\"}\r\n          </button>\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${props.busy}\r\n            @click=${(event: Event) => {\r\n              event.stopPropagation();\r\n              props.onRun(job);\r\n            }}\r\n          >\r\n            Run\r\n          </button>\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${props.busy}\r\n            @click=${(event: Event) => {\r\n              event.stopPropagation();\r\n              props.onLoadRuns(job.id);\r\n            }}\r\n          >\r\n            History\r\n          </button>\r\n          <button\r\n            class=\"btn danger\"\r\n            ?disabled=${props.busy}\r\n            @click=${(event: Event) => {\r\n              event.stopPropagation();\r\n              props.onRemove(job);\r\n            }}\r\n          >\r\n            Remove\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderJobPayload(job: CronJob) {\r\n  if (job.payload.kind === \"systemEvent\") {\r\n    return html`<div class=\"cron-job-detail\">\r\n      <span class=\"cron-job-detail-label\">System</span>\r\n      <span class=\"muted cron-job-detail-value\">${job.payload.text}</span>\r\n    </div>`;\r\n  }\r\n\r\n  const delivery = job.delivery;\r\n  const deliveryTarget =\r\n    delivery?.channel || delivery?.to\r\n      ? ` (${delivery.channel ?? \"last\"}${delivery.to ? ` -> ${delivery.to}` : \"\"})`\r\n      : \"\";\r\n\r\n  return html`\r\n    <div class=\"cron-job-detail\">\r\n      <span class=\"cron-job-detail-label\">Prompt</span>\r\n      <span class=\"muted cron-job-detail-value\">${job.payload.message}</span>\r\n    </div>\r\n    ${\r\n      delivery\r\n        ? html`<div class=\"cron-job-detail\">\r\n            <span class=\"cron-job-detail-label\">Delivery</span>\r\n            <span class=\"muted cron-job-detail-value\">${delivery.mode}${deliveryTarget}</span>\r\n          </div>`\r\n        : nothing\r\n    }\r\n  `;\r\n}\r\n\r\nfunction formatStateRelative(ms?: number) {\r\n  if (typeof ms !== \"number\" || !Number.isFinite(ms)) {\r\n    return \"n/a\";\r\n  }\r\n  return formatRelativeTimestamp(ms);\r\n}\r\n\r\nfunction renderJobState(job: CronJob) {\r\n  const status = job.state?.lastStatus ?? \"n/a\";\r\n  const statusClass =\r\n    status === \"ok\"\r\n      ? \"cron-job-status-ok\"\r\n      : status === \"error\"\r\n        ? \"cron-job-status-error\"\r\n        : status === \"skipped\"\r\n          ? \"cron-job-status-skipped\"\r\n          : \"cron-job-status-na\";\r\n  const nextRunAtMs = job.state?.nextRunAtMs;\r\n  const lastRunAtMs = job.state?.lastRunAtMs;\r\n\r\n  return html`\r\n    <div class=\"cron-job-state\">\r\n      <div class=\"cron-job-state-row\">\r\n        <span class=\"cron-job-state-key\">Status</span>\r\n        <span class=${`cron-job-status-pill ${statusClass}`}>${status}</span>\r\n      </div>\r\n      <div class=\"cron-job-state-row\">\r\n        <span class=\"cron-job-state-key\">Next</span>\r\n        <span class=\"cron-job-state-value\" title=${formatMs(nextRunAtMs)}>\r\n          ${formatStateRelative(nextRunAtMs)}\r\n        </span>\r\n      </div>\r\n      <div class=\"cron-job-state-row\">\r\n        <span class=\"cron-job-state-key\">Last</span>\r\n        <span class=\"cron-job-state-value\" title=${formatMs(lastRunAtMs)}>\r\n          ${formatStateRelative(lastRunAtMs)}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderRun(entry: CronRunLogEntry, basePath: string) {\r\n  const chatUrl =\r\n    typeof entry.sessionKey === \"string\" && entry.sessionKey.trim().length > 0\r\n      ? `${pathForTab(\"chat\", basePath)}?session=${encodeURIComponent(entry.sessionKey)}`\r\n      : null;\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${entry.status}</div>\r\n        <div class=\"list-sub\">${entry.summary ?? \"\"}</div>\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <div>${formatMs(entry.ts)}</div>\r\n        <div class=\"muted\">${entry.durationMs ?? 0}ms</div>\r\n        ${\r\n          chatUrl\r\n            ? html`<div><a class=\"session-link\" href=${chatUrl}>Open run chat</a></div>`\r\n            : nothing\r\n        }\r\n        ${entry.error ? html`<div class=\"muted\">${entry.error}</div>` : nothing}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { EventLogEntry } from \"../app-events.ts\";\r\nimport { formatEventPayload } from \"../presenter.ts\";\r\n\r\nexport type DebugProps = {\r\n  loading: boolean;\r\n  status: Record<string, unknown> | null;\r\n  health: Record<string, unknown> | null;\r\n  models: unknown[];\r\n  heartbeat: unknown;\r\n  eventLog: EventLogEntry[];\r\n  callMethod: string;\r\n  callParams: string;\r\n  callResult: string | null;\r\n  callError: string | null;\r\n  onCallMethodChange: (next: string) => void;\r\n  onCallParamsChange: (next: string) => void;\r\n  onRefresh: () => void;\r\n  onCall: () => void;\r\n};\r\n\r\nexport function renderDebug(props: DebugProps) {\r\n  const securityAudit =\r\n    props.status && typeof props.status === \"object\"\r\n      ? (props.status as { securityAudit?: { summary?: Record<string, number> } }).securityAudit\r\n      : null;\r\n  const securitySummary = securityAudit?.summary ?? null;\r\n  const critical = securitySummary?.critical ?? 0;\r\n  const warn = securitySummary?.warn ?? 0;\r\n  const info = securitySummary?.info ?? 0;\r\n  const securityTone = critical > 0 ? \"danger\" : warn > 0 ? \"warn\" : \"success\";\r\n  const securityLabel =\r\n    critical > 0 ? `${critical} critical` : warn > 0 ? `${warn} warnings` : \"No critical issues\";\r\n\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      <div class=\"card\">\r\n        <div class=\"row\" style=\"justify-content: space-between;\">\r\n          <div>\r\n            <div class=\"card-title\">Snapshots</div>\r\n            <div class=\"card-sub\">Status, health, and heartbeat data.</div>\r\n          </div>\r\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n            ${props.loading ? \"Refreshing…\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n        <div class=\"stack\" style=\"margin-top: 12px;\">\r\n          <div>\r\n            <div class=\"muted\">Status</div>\r\n            ${\r\n              securitySummary\r\n                ? html`<div class=\"callout ${securityTone}\" style=\"margin-top: 8px;\">\r\n                  Security audit: ${securityLabel}${info > 0 ? ` · ${info} info` : \"\"}. Run\r\n                  <span class=\"mono\">openclaw security audit --deep</span> for details.\r\n                </div>`\r\n                : nothing\r\n            }\r\n            <pre class=\"code-block\">${JSON.stringify(props.status ?? {}, null, 2)}</pre>\r\n          </div>\r\n          <div>\r\n            <div class=\"muted\">Health</div>\r\n            <pre class=\"code-block\">${JSON.stringify(props.health ?? {}, null, 2)}</pre>\r\n          </div>\r\n          <div>\r\n            <div class=\"muted\">Last heartbeat</div>\r\n            <pre class=\"code-block\">${JSON.stringify(props.heartbeat ?? {}, null, 2)}</pre>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card\">\r\n        <div class=\"card-title\">Manual RPC</div>\r\n        <div class=\"card-sub\">Send a raw gateway method with JSON params.</div>\r\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\r\n          <label class=\"field\">\r\n            <span>Method</span>\r\n            <input\r\n              .value=${props.callMethod}\r\n              @input=${(e: Event) => props.onCallMethodChange((e.target as HTMLInputElement).value)}\r\n              placeholder=\"system-presence\"\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>Params (JSON)</span>\r\n            <textarea\r\n              .value=${props.callParams}\r\n              @input=${(e: Event) =>\r\n                props.onCallParamsChange((e.target as HTMLTextAreaElement).value)}\r\n              rows=\"6\"\r\n            ></textarea>\r\n          </label>\r\n        </div>\r\n        <div class=\"row\" style=\"margin-top: 12px;\">\r\n          <button class=\"btn primary\" @click=${props.onCall}>Call</button>\r\n        </div>\r\n        ${\r\n          props.callError\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n              ${props.callError}\r\n            </div>`\r\n            : nothing\r\n        }\r\n        ${\r\n          props.callResult\r\n            ? html`<pre class=\"code-block\" style=\"margin-top: 12px;\">${props.callResult}</pre>`\r\n            : nothing\r\n        }\r\n      </div>\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"card-title\">Models</div>\r\n      <div class=\"card-sub\">Catalog from models.list.</div>\r\n      <pre class=\"code-block\" style=\"margin-top: 12px;\">${JSON.stringify(\r\n        props.models ?? [],\r\n        null,\r\n        2,\r\n      )}</pre>\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"card-title\">Event Log</div>\r\n      <div class=\"card-sub\">Latest gateway events.</div>\r\n      ${\r\n        props.eventLog.length === 0\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 12px\">No events yet.</div>\r\n            `\r\n          : html`\r\n            <div class=\"list\" style=\"margin-top: 12px;\">\r\n              ${props.eventLog.map(\r\n                (evt) => html`\r\n                  <div class=\"list-item\">\r\n                    <div class=\"list-main\">\r\n                      <div class=\"list-title\">${evt.event}</div>\r\n                      <div class=\"list-sub\">${new Date(evt.ts).toLocaleTimeString()}</div>\r\n                    </div>\r\n                    <div class=\"list-meta\">\r\n                      <pre class=\"code-block\">${formatEventPayload(evt.payload)}</pre>\r\n                    </div>\r\n                  </div>\r\n                `,\r\n              )}\r\n            </div>\r\n          `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { AppViewState } from \"../app-view-state.ts\";\r\n\r\nfunction formatRemaining(ms: number): string {\r\n  const remaining = Math.max(0, ms);\r\n  const totalSeconds = Math.floor(remaining / 1000);\r\n  if (totalSeconds < 60) {\r\n    return `${totalSeconds}s`;\r\n  }\r\n  const minutes = Math.floor(totalSeconds / 60);\r\n  if (minutes < 60) {\r\n    return `${minutes}m`;\r\n  }\r\n  const hours = Math.floor(minutes / 60);\r\n  return `${hours}h`;\r\n}\r\n\r\nfunction renderMetaRow(label: string, value?: string | null) {\r\n  if (!value) {\r\n    return nothing;\r\n  }\r\n  return html`<div class=\"exec-approval-meta-row\"><span>${label}</span><span>${value}</span></div>`;\r\n}\r\n\r\nexport function renderExecApprovalPrompt(state: AppViewState) {\r\n  const active = state.execApprovalQueue[0];\r\n  if (!active) {\r\n    return nothing;\r\n  }\r\n  const request = active.request;\r\n  const remainingMs = active.expiresAtMs - Date.now();\r\n  const remaining = remainingMs > 0 ? `expires in ${formatRemaining(remainingMs)}` : \"expired\";\r\n  const queueCount = state.execApprovalQueue.length;\r\n  return html`\r\n    <div class=\"exec-approval-overlay\" role=\"dialog\" aria-live=\"polite\">\r\n      <div class=\"exec-approval-card\">\r\n        <div class=\"exec-approval-header\">\r\n          <div>\r\n            <div class=\"exec-approval-title\">Exec approval needed</div>\r\n            <div class=\"exec-approval-sub\">${remaining}</div>\r\n          </div>\r\n          ${\r\n            queueCount > 1\r\n              ? html`<div class=\"exec-approval-queue\">${queueCount} pending</div>`\r\n              : nothing\r\n          }\r\n        </div>\r\n        <div class=\"exec-approval-command mono\">${request.command}</div>\r\n        <div class=\"exec-approval-meta\">\r\n          ${renderMetaRow(\"Host\", request.host)}\r\n          ${renderMetaRow(\"Agent\", request.agentId)}\r\n          ${renderMetaRow(\"Session\", request.sessionKey)}\r\n          ${renderMetaRow(\"CWD\", request.cwd)}\r\n          ${renderMetaRow(\"Resolved\", request.resolvedPath)}\r\n          ${renderMetaRow(\"Security\", request.security)}\r\n          ${renderMetaRow(\"Ask\", request.ask)}\r\n        </div>\r\n        ${\r\n          state.execApprovalError\r\n            ? html`<div class=\"exec-approval-error\">${state.execApprovalError}</div>`\r\n            : nothing\r\n        }\r\n        <div class=\"exec-approval-actions\">\r\n          <button\r\n            class=\"btn primary\"\r\n            ?disabled=${state.execApprovalBusy}\r\n            @click=${() => state.handleExecApprovalDecision(\"allow-once\")}\r\n          >\r\n            Allow once\r\n          </button>\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${state.execApprovalBusy}\r\n            @click=${() => state.handleExecApprovalDecision(\"allow-always\")}\r\n          >\r\n            Always allow\r\n          </button>\r\n          <button\r\n            class=\"btn danger\"\r\n            ?disabled=${state.execApprovalBusy}\r\n            @click=${() => state.handleExecApprovalDecision(\"deny\")}\r\n          >\r\n            Deny\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { AppViewState } from \"../app-view-state.ts\";\r\n\r\nexport function renderGatewayUrlConfirmation(state: AppViewState) {\r\n  const { pendingGatewayUrl } = state;\r\n  if (!pendingGatewayUrl) {\r\n    return nothing;\r\n  }\r\n\r\n  return html`\r\n    <div class=\"exec-approval-overlay\" role=\"dialog\" aria-modal=\"true\" aria-live=\"polite\">\r\n      <div class=\"exec-approval-card\">\r\n        <div class=\"exec-approval-header\">\r\n          <div>\r\n            <div class=\"exec-approval-title\">Change Gateway URL</div>\r\n            <div class=\"exec-approval-sub\">This will reconnect to a different gateway server</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"exec-approval-command mono\">${pendingGatewayUrl}</div>\r\n        <div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n          Only confirm if you trust this URL. Malicious URLs can compromise your system.\r\n        </div>\r\n        <div class=\"exec-approval-actions\">\r\n          <button\r\n            class=\"btn primary\"\r\n            @click=${() => state.handleGatewayUrlConfirm()}\r\n          >\r\n            Confirm\r\n          </button>\r\n          <button\r\n            class=\"btn\"\r\n            @click=${() => state.handleGatewayUrlCancel()}\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { PresenceEntry } from \"../types.ts\";\r\nimport { formatPresenceAge, formatPresenceSummary } from \"../presenter.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type InstancesProps = {\r\n  loading: boolean;\r\n  entries: PresenceEntry[];\r\n  lastError: string | null;\r\n  statusMessage: string | null;\r\n  onRefresh: () => void;\r\n};\r\n\r\nexport function renderInstances(props: InstancesProps) {\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">${T(\"Connected Instances\")}</div>\r\n          <div class=\"card-sub\">${T(\"Presence beacons from the gateway and clients.\")}</div>\r\n        </div>\r\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n          ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n      ${\r\n        props.lastError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">\r\n            ${props.lastError}\r\n          </div>`\r\n          : nothing\r\n      }\r\n      ${\r\n        props.statusMessage\r\n          ? html`<div class=\"callout\" style=\"margin-top: 12px;\">\r\n            ${props.statusMessage}\r\n          </div>`\r\n          : nothing\r\n      }\r\n      <div class=\"list\" style=\"margin-top: 16px;\">\r\n        ${\r\n          props.entries.length === 0\r\n            ? html`\r\n                <div class=\"muted\">No instances reported yet.</div>\r\n              `\r\n            : props.entries.map((entry) => renderEntry(entry))\r\n        }\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderEntry(entry: PresenceEntry) {\r\n  const lastInput = entry.lastInputSeconds != null ? `${entry.lastInputSeconds}s ago` : \"n/a\";\r\n  const mode = entry.mode ?? \"unknown\";\r\n  const roles = Array.isArray(entry.roles) ? entry.roles.filter(Boolean) : [];\r\n  const scopes = Array.isArray(entry.scopes) ? entry.scopes.filter(Boolean) : [];\r\n  const scopesLabel =\r\n    scopes.length > 0\r\n      ? scopes.length > 3\r\n        ? `${scopes.length} scopes`\r\n        : `scopes: ${scopes.join(\", \")}`\r\n      : null;\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${entry.host ?? \"unknown host\"}</div>\r\n        <div class=\"list-sub\">${formatPresenceSummary(entry)}</div>\r\n        <div class=\"chip-row\">\r\n          <span class=\"chip\">${mode}</span>\r\n          ${roles.map((role) => html`<span class=\"chip\">${role}</span>`)}\r\n          ${scopesLabel ? html`<span class=\"chip\">${scopesLabel}</span>` : nothing}\r\n          ${entry.platform ? html`<span class=\"chip\">${entry.platform}</span>` : nothing}\r\n          ${entry.deviceFamily ? html`<span class=\"chip\">${entry.deviceFamily}</span>` : nothing}\r\n          ${\r\n            entry.modelIdentifier\r\n              ? html`<span class=\"chip\">${entry.modelIdentifier}</span>`\r\n              : nothing\r\n          }\r\n          ${entry.version ? html`<span class=\"chip\">${entry.version}</span>` : nothing}\r\n        </div>\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <div>${formatPresenceAge(entry)}</div>\r\n        <div class=\"muted\">Last input ${lastInput}</div>\r\n        <div class=\"muted\">Reason ${entry.reason ?? \"\"}</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { LogEntry, LogLevel } from \"../types.ts\";\r\n\r\nconst LEVELS: LogLevel[] = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"fatal\"];\r\n\r\nexport type LogsProps = {\r\n  loading: boolean;\r\n  error: string | null;\r\n  file: string | null;\r\n  entries: LogEntry[];\r\n  filterText: string;\r\n  levelFilters: Record<LogLevel, boolean>;\r\n  autoFollow: boolean;\r\n  truncated: boolean;\r\n  onFilterTextChange: (next: string) => void;\r\n  onLevelToggle: (level: LogLevel, enabled: boolean) => void;\r\n  onToggleAutoFollow: (next: boolean) => void;\r\n  onRefresh: () => void;\r\n  onExport: (lines: string[], label: string) => void;\r\n  onScroll: (event: Event) => void;\r\n};\r\n\r\nfunction formatTime(value?: string | null) {\r\n  if (!value) {\r\n    return \"\";\r\n  }\r\n  const date = new Date(value);\r\n  if (Number.isNaN(date.getTime())) {\r\n    return value;\r\n  }\r\n  return date.toLocaleTimeString();\r\n}\r\n\r\nfunction matchesFilter(entry: LogEntry, needle: string) {\r\n  if (!needle) {\r\n    return true;\r\n  }\r\n  const haystack = [entry.message, entry.subsystem, entry.raw]\r\n    .filter(Boolean)\r\n    .join(\" \")\r\n    .toLowerCase();\r\n  return haystack.includes(needle);\r\n}\r\n\r\nexport function renderLogs(props: LogsProps) {\r\n  const needle = props.filterText.trim().toLowerCase();\r\n  const levelFiltered = LEVELS.some((level) => !props.levelFilters[level]);\r\n  const filtered = props.entries.filter((entry) => {\r\n    if (entry.level && !props.levelFilters[entry.level]) {\r\n      return false;\r\n    }\r\n    return matchesFilter(entry, needle);\r\n  });\r\n  const exportLabel = needle || levelFiltered ? \"filtered\" : \"visible\";\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Logs</div>\r\n          <div class=\"card-sub\">Gateway file logs (JSONL).</div>\r\n        </div>\r\n        <div class=\"row\" style=\"gap: 8px;\">\r\n          <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n            ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n          </button>\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${filtered.length === 0}\r\n            @click=${() =>\r\n              props.onExport(\r\n                filtered.map((entry) => entry.raw),\r\n                exportLabel,\r\n              )}\r\n          >\r\n            Export ${exportLabel}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"filters\" style=\"margin-top: 14px;\">\r\n        <label class=\"field\" style=\"min-width: 220px;\">\r\n          <span>Filter</span>\r\n          <input\r\n            .value=${props.filterText}\r\n            @input=${(e: Event) => props.onFilterTextChange((e.target as HTMLInputElement).value)}\r\n            placeholder=\"Search logs\"\r\n          />\r\n        </label>\r\n        <label class=\"field checkbox\">\r\n          <span>Auto-follow</span>\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${props.autoFollow}\r\n            @change=${(e: Event) =>\r\n              props.onToggleAutoFollow((e.target as HTMLInputElement).checked)}\r\n          />\r\n        </label>\r\n      </div>\r\n\r\n      <div class=\"chip-row\" style=\"margin-top: 12px;\">\r\n        ${LEVELS.map(\r\n          (level) => html`\r\n            <label class=\"chip log-chip ${level}\">\r\n              <input\r\n                type=\"checkbox\"\r\n                .checked=${props.levelFilters[level]}\r\n                @change=${(e: Event) =>\r\n                  props.onLevelToggle(level, (e.target as HTMLInputElement).checked)}\r\n              />\r\n              <span>${level}</span>\r\n            </label>\r\n          `,\r\n        )}\r\n      </div>\r\n\r\n      ${\r\n        props.file\r\n          ? html`<div class=\"muted\" style=\"margin-top: 10px;\">File: ${props.file}</div>`\r\n          : nothing\r\n      }\r\n      ${\r\n        props.truncated\r\n          ? html`\r\n              <div class=\"callout\" style=\"margin-top: 10px\">Log output truncated; showing latest chunk.</div>\r\n            `\r\n          : nothing\r\n      }\r\n      ${\r\n        props.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 10px;\">${props.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"log-stream\" style=\"margin-top: 12px;\" @scroll=${props.onScroll}>\r\n        ${\r\n          filtered.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"padding: 12px\">No log entries.</div>\r\n              `\r\n            : filtered.map(\r\n                (entry) => html`\r\n                <div class=\"log-row\">\r\n                  <div class=\"log-time mono\">${formatTime(entry.time)}</div>\r\n                  <div class=\"log-level ${entry.level ?? \"\"}\">${entry.level ?? \"\"}</div>\r\n                  <div class=\"log-subsystem mono\">${entry.subsystem ?? \"\"}</div>\r\n                  <div class=\"log-message mono\">${entry.message ?? entry.raw}</div>\r\n                </div>\r\n              `,\r\n              )\r\n        }\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type {\r\n  DevicePairingList,\r\n  DeviceTokenSummary,\r\n  PairedDevice,\r\n  PendingDevice,\r\n} from \"../controllers/devices.ts\";\r\nimport type {\r\n  ExecApprovalsAllowlistEntry,\r\n  ExecApprovalsFile,\r\n  ExecApprovalsSnapshot,\r\n} from \"../controllers/exec-approvals.ts\";\r\nimport { clampText, formatRelativeTimestamp, formatList } from \"../format.ts\";\r\n\r\nexport type NodesProps = {\r\n  loading: boolean;\r\n  nodes: Array<Record<string, unknown>>;\r\n  devicesLoading: boolean;\r\n  devicesError: string | null;\r\n  devicesList: DevicePairingList | null;\r\n  configForm: Record<string, unknown> | null;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  configDirty: boolean;\r\n  configFormMode: \"form\" | \"raw\";\r\n  execApprovalsLoading: boolean;\r\n  execApprovalsSaving: boolean;\r\n  execApprovalsDirty: boolean;\r\n  execApprovalsSnapshot: ExecApprovalsSnapshot | null;\r\n  execApprovalsForm: ExecApprovalsFile | null;\r\n  execApprovalsSelectedAgent: string | null;\r\n  execApprovalsTarget: \"gateway\" | \"node\";\r\n  execApprovalsTargetNodeId: string | null;\r\n  onRefresh: () => void;\r\n  onDevicesRefresh: () => void;\r\n  onDeviceApprove: (requestId: string) => void;\r\n  onDeviceReject: (requestId: string) => void;\r\n  onDeviceRotate: (deviceId: string, role: string, scopes?: string[]) => void;\r\n  onDeviceRevoke: (deviceId: string, role: string) => void;\r\n  onLoadConfig: () => void;\r\n  onLoadExecApprovals: () => void;\r\n  onBindDefault: (nodeId: string | null) => void;\r\n  onBindAgent: (agentIndex: number, nodeId: string | null) => void;\r\n  onSaveBindings: () => void;\r\n  onExecApprovalsTargetChange: (kind: \"gateway\" | \"node\", nodeId: string | null) => void;\r\n  onExecApprovalsSelectAgent: (agentId: string) => void;\r\n  onExecApprovalsPatch: (path: Array<string | number>, value: unknown) => void;\r\n  onExecApprovalsRemove: (path: Array<string | number>) => void;\r\n  onSaveExecApprovals: () => void;\r\n};\r\n\r\nexport function renderNodes(props: NodesProps) {\r\n  const bindingState = resolveBindingsState(props);\r\n  const approvalsState = resolveExecApprovalsState(props);\r\n  return html`\r\n    ${renderExecApprovals(approvalsState)}\r\n    ${renderBindings(bindingState)}\r\n    ${renderDevices(props)}\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Nodes</div>\r\n          <div class=\"card-sub\">Paired devices and live links.</div>\r\n        </div>\r\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n          ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n      <div class=\"list\" style=\"margin-top: 16px;\">\r\n        ${\r\n          props.nodes.length === 0\r\n            ? html`\r\n                <div class=\"muted\">No nodes found.</div>\r\n              `\r\n            : props.nodes.map((n) => renderNode(n))\r\n        }\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderDevices(props: NodesProps) {\r\n  const list = props.devicesList ?? { pending: [], paired: [] };\r\n  const pending = Array.isArray(list.pending) ? list.pending : [];\r\n  const paired = Array.isArray(list.paired) ? list.paired : [];\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Devices</div>\r\n          <div class=\"card-sub\">Pairing requests + role tokens.</div>\r\n        </div>\r\n        <button class=\"btn\" ?disabled=${props.devicesLoading} @click=${props.onDevicesRefresh}>\r\n          ${props.devicesLoading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n      ${\r\n        props.devicesError\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.devicesError}</div>`\r\n          : nothing\r\n      }\r\n      <div class=\"list\" style=\"margin-top: 16px;\">\r\n        ${\r\n          pending.length > 0\r\n            ? html`\r\n              <div class=\"muted\" style=\"margin-bottom: 8px;\">Pending</div>\r\n              ${pending.map((req) => renderPendingDevice(req, props))}\r\n            `\r\n            : nothing\r\n        }\r\n        ${\r\n          paired.length > 0\r\n            ? html`\r\n              <div class=\"muted\" style=\"margin-top: 12px; margin-bottom: 8px;\">Paired</div>\r\n              ${paired.map((device) => renderPairedDevice(device, props))}\r\n            `\r\n            : nothing\r\n        }\r\n        ${\r\n          pending.length === 0 && paired.length === 0\r\n            ? html`\r\n                <div class=\"muted\">No paired devices.</div>\r\n              `\r\n            : nothing\r\n        }\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderPendingDevice(req: PendingDevice, props: NodesProps) {\r\n  const name = req.displayName?.trim() || req.deviceId;\r\n  const age = typeof req.ts === \"number\" ? formatRelativeTimestamp(req.ts) : \"n/a\";\r\n  const role = req.role?.trim() ? `role: ${req.role}` : \"role: -\";\r\n  const repair = req.isRepair ? \" · repair\" : \"\";\r\n  const ip = req.remoteIp ? ` · ${req.remoteIp}` : \"\";\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${name}</div>\r\n        <div class=\"list-sub\">${req.deviceId}${ip}</div>\r\n        <div class=\"muted\" style=\"margin-top: 6px;\">\r\n          ${role} · requested ${age}${repair}\r\n        </div>\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <div class=\"row\" style=\"justify-content: flex-end; gap: 8px; flex-wrap: wrap;\">\r\n          <button class=\"btn btn--sm primary\" @click=${() => props.onDeviceApprove(req.requestId)}>\r\n            Approve\r\n          </button>\r\n          <button class=\"btn btn--sm\" @click=${() => props.onDeviceReject(req.requestId)}>\r\n            Reject\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderPairedDevice(device: PairedDevice, props: NodesProps) {\r\n  const name = device.displayName?.trim() || device.deviceId;\r\n  const ip = device.remoteIp ? ` · ${device.remoteIp}` : \"\";\r\n  const roles = `roles: ${formatList(device.roles)}`;\r\n  const scopes = `scopes: ${formatList(device.scopes)}`;\r\n  const tokens = Array.isArray(device.tokens) ? device.tokens : [];\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${name}</div>\r\n        <div class=\"list-sub\">${device.deviceId}${ip}</div>\r\n        <div class=\"muted\" style=\"margin-top: 6px;\">${roles} · ${scopes}</div>\r\n        ${\r\n          tokens.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"margin-top: 6px\">Tokens: none</div>\r\n              `\r\n            : html`\r\n              <div class=\"muted\" style=\"margin-top: 10px;\">Tokens</div>\r\n              <div style=\"display: flex; flex-direction: column; gap: 8px; margin-top: 6px;\">\r\n                ${tokens.map((token) => renderTokenRow(device.deviceId, token, props))}\r\n              </div>\r\n            `\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderTokenRow(deviceId: string, token: DeviceTokenSummary, props: NodesProps) {\r\n  const status = token.revokedAtMs ? \"revoked\" : \"active\";\r\n  const scopes = `scopes: ${formatList(token.scopes)}`;\r\n  const when = formatRelativeTimestamp(\r\n    token.rotatedAtMs ?? token.createdAtMs ?? token.lastUsedAtMs ?? null,\r\n  );\r\n  return html`\r\n    <div class=\"row\" style=\"justify-content: space-between; gap: 8px;\">\r\n      <div class=\"list-sub\">${token.role} · ${status} · ${scopes} · ${when}</div>\r\n      <div class=\"row\" style=\"justify-content: flex-end; gap: 6px; flex-wrap: wrap;\">\r\n        <button\r\n          class=\"btn btn--sm\"\r\n          @click=${() => props.onDeviceRotate(deviceId, token.role, token.scopes)}\r\n        >\r\n          Rotate\r\n        </button>\r\n        ${\r\n          token.revokedAtMs\r\n            ? nothing\r\n            : html`\r\n              <button\r\n                class=\"btn btn--sm danger\"\r\n                @click=${() => props.onDeviceRevoke(deviceId, token.role)}\r\n              >\r\n                Revoke\r\n              </button>\r\n            `\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\ntype BindingAgent = {\r\n  id: string;\r\n  name?: string;\r\n  index: number;\r\n  isDefault: boolean;\r\n  binding?: string | null;\r\n};\r\n\r\ntype BindingNode = {\r\n  id: string;\r\n  label: string;\r\n};\r\n\r\ntype BindingState = {\r\n  ready: boolean;\r\n  disabled: boolean;\r\n  configDirty: boolean;\r\n  configLoading: boolean;\r\n  configSaving: boolean;\r\n  defaultBinding?: string | null;\r\n  agents: BindingAgent[];\r\n  nodes: BindingNode[];\r\n  onBindDefault: (nodeId: string | null) => void;\r\n  onBindAgent: (agentIndex: number, nodeId: string | null) => void;\r\n  onSave: () => void;\r\n  onLoadConfig: () => void;\r\n  formMode: \"form\" | \"raw\";\r\n};\r\n\r\ntype ExecSecurity = \"deny\" | \"allowlist\" | \"full\";\r\ntype ExecAsk = \"off\" | \"on-miss\" | \"always\";\r\n\r\ntype ExecApprovalsResolvedDefaults = {\r\n  security: ExecSecurity;\r\n  ask: ExecAsk;\r\n  askFallback: ExecSecurity;\r\n  autoAllowSkills: boolean;\r\n};\r\n\r\ntype ExecApprovalsAgentOption = {\r\n  id: string;\r\n  name?: string;\r\n  isDefault?: boolean;\r\n};\r\n\r\ntype ExecApprovalsTargetNode = {\r\n  id: string;\r\n  label: string;\r\n};\r\n\r\ntype ExecApprovalsState = {\r\n  ready: boolean;\r\n  disabled: boolean;\r\n  dirty: boolean;\r\n  loading: boolean;\r\n  saving: boolean;\r\n  form: ExecApprovalsFile | null;\r\n  defaults: ExecApprovalsResolvedDefaults;\r\n  selectedScope: string;\r\n  selectedAgent: Record<string, unknown> | null;\r\n  agents: ExecApprovalsAgentOption[];\r\n  allowlist: ExecApprovalsAllowlistEntry[];\r\n  target: \"gateway\" | \"node\";\r\n  targetNodeId: string | null;\r\n  targetNodes: ExecApprovalsTargetNode[];\r\n  onSelectScope: (agentId: string) => void;\r\n  onSelectTarget: (kind: \"gateway\" | \"node\", nodeId: string | null) => void;\r\n  onPatch: (path: Array<string | number>, value: unknown) => void;\r\n  onRemove: (path: Array<string | number>) => void;\r\n  onLoad: () => void;\r\n  onSave: () => void;\r\n};\r\n\r\nconst EXEC_APPROVALS_DEFAULT_SCOPE = \"__defaults__\";\r\n\r\nconst SECURITY_OPTIONS: Array<{ value: ExecSecurity; label: string }> = [\r\n  { value: \"deny\", label: \"Deny\" },\r\n  { value: \"allowlist\", label: \"Allowlist\" },\r\n  { value: \"full\", label: \"Full\" },\r\n];\r\n\r\nconst ASK_OPTIONS: Array<{ value: ExecAsk; label: string }> = [\r\n  { value: \"off\", label: \"Off\" },\r\n  { value: \"on-miss\", label: \"On miss\" },\r\n  { value: \"always\", label: \"Always\" },\r\n];\r\n\r\nfunction resolveBindingsState(props: NodesProps): BindingState {\r\n  const config = props.configForm;\r\n  const nodes = resolveExecNodes(props.nodes);\r\n  const { defaultBinding, agents } = resolveAgentBindings(config);\r\n  const ready = Boolean(config);\r\n  const disabled = props.configSaving || props.configFormMode === \"raw\";\r\n  return {\r\n    ready,\r\n    disabled,\r\n    configDirty: props.configDirty,\r\n    configLoading: props.configLoading,\r\n    configSaving: props.configSaving,\r\n    defaultBinding,\r\n    agents,\r\n    nodes,\r\n    onBindDefault: props.onBindDefault,\r\n    onBindAgent: props.onBindAgent,\r\n    onSave: props.onSaveBindings,\r\n    onLoadConfig: props.onLoadConfig,\r\n    formMode: props.configFormMode,\r\n  };\r\n}\r\n\r\nfunction normalizeSecurity(value?: string): ExecSecurity {\r\n  if (value === \"allowlist\" || value === \"full\" || value === \"deny\") {\r\n    return value;\r\n  }\r\n  return \"deny\";\r\n}\r\n\r\nfunction normalizeAsk(value?: string): ExecAsk {\r\n  if (value === \"always\" || value === \"off\" || value === \"on-miss\") {\r\n    return value;\r\n  }\r\n  return \"on-miss\";\r\n}\r\n\r\nfunction resolveExecApprovalsDefaults(\r\n  form: ExecApprovalsFile | null,\r\n): ExecApprovalsResolvedDefaults {\r\n  const defaults = form?.defaults ?? {};\r\n  return {\r\n    security: normalizeSecurity(defaults.security),\r\n    ask: normalizeAsk(defaults.ask),\r\n    askFallback: normalizeSecurity(defaults.askFallback ?? \"deny\"),\r\n    autoAllowSkills: Boolean(defaults.autoAllowSkills ?? false),\r\n  };\r\n}\r\n\r\nfunction resolveConfigAgents(config: Record<string, unknown> | null): ExecApprovalsAgentOption[] {\r\n  const agentsNode = (config?.agents ?? {}) as Record<string, unknown>;\r\n  const list = Array.isArray(agentsNode.list) ? agentsNode.list : [];\r\n  const agents: ExecApprovalsAgentOption[] = [];\r\n  list.forEach((entry) => {\r\n    if (!entry || typeof entry !== \"object\") {\r\n      return;\r\n    }\r\n    const record = entry as Record<string, unknown>;\r\n    const id = typeof record.id === \"string\" ? record.id.trim() : \"\";\r\n    if (!id) {\r\n      return;\r\n    }\r\n    const name = typeof record.name === \"string\" ? record.name.trim() : undefined;\r\n    const isDefault = record.default === true;\r\n    agents.push({ id, name: name || undefined, isDefault });\r\n  });\r\n  return agents;\r\n}\r\n\r\nfunction resolveExecApprovalsAgents(\r\n  config: Record<string, unknown> | null,\r\n  form: ExecApprovalsFile | null,\r\n): ExecApprovalsAgentOption[] {\r\n  const configAgents = resolveConfigAgents(config);\r\n  const approvalsAgents = Object.keys(form?.agents ?? {});\r\n  const merged = new Map<string, ExecApprovalsAgentOption>();\r\n  configAgents.forEach((agent) => merged.set(agent.id, agent));\r\n  approvalsAgents.forEach((id) => {\r\n    if (merged.has(id)) {\r\n      return;\r\n    }\r\n    merged.set(id, { id });\r\n  });\r\n  const agents = Array.from(merged.values());\r\n  if (agents.length === 0) {\r\n    agents.push({ id: \"main\", isDefault: true });\r\n  }\r\n  agents.sort((a, b) => {\r\n    if (a.isDefault && !b.isDefault) {\r\n      return -1;\r\n    }\r\n    if (!a.isDefault && b.isDefault) {\r\n      return 1;\r\n    }\r\n    const aLabel = a.name?.trim() ? a.name : a.id;\r\n    const bLabel = b.name?.trim() ? b.name : b.id;\r\n    return aLabel.localeCompare(bLabel);\r\n  });\r\n  return agents;\r\n}\r\n\r\nfunction resolveExecApprovalsScope(\r\n  selected: string | null,\r\n  agents: ExecApprovalsAgentOption[],\r\n): string {\r\n  if (selected === EXEC_APPROVALS_DEFAULT_SCOPE) {\r\n    return EXEC_APPROVALS_DEFAULT_SCOPE;\r\n  }\r\n  if (selected && agents.some((agent) => agent.id === selected)) {\r\n    return selected;\r\n  }\r\n  return EXEC_APPROVALS_DEFAULT_SCOPE;\r\n}\r\n\r\nfunction resolveExecApprovalsState(props: NodesProps): ExecApprovalsState {\r\n  const form = props.execApprovalsForm ?? props.execApprovalsSnapshot?.file ?? null;\r\n  const ready = Boolean(form);\r\n  const defaults = resolveExecApprovalsDefaults(form);\r\n  const agents = resolveExecApprovalsAgents(props.configForm, form);\r\n  const targetNodes = resolveExecApprovalsNodes(props.nodes);\r\n  const target = props.execApprovalsTarget;\r\n  let targetNodeId =\r\n    target === \"node\" && props.execApprovalsTargetNodeId ? props.execApprovalsTargetNodeId : null;\r\n  if (target === \"node\" && targetNodeId && !targetNodes.some((node) => node.id === targetNodeId)) {\r\n    targetNodeId = null;\r\n  }\r\n  const selectedScope = resolveExecApprovalsScope(props.execApprovalsSelectedAgent, agents);\r\n  const selectedAgent =\r\n    selectedScope !== EXEC_APPROVALS_DEFAULT_SCOPE\r\n      ? (((form?.agents ?? {})[selectedScope] as Record<string, unknown> | undefined) ?? null)\r\n      : null;\r\n  const allowlist = Array.isArray((selectedAgent as { allowlist?: unknown })?.allowlist)\r\n    ? ((selectedAgent as { allowlist?: ExecApprovalsAllowlistEntry[] }).allowlist ?? [])\r\n    : [];\r\n  return {\r\n    ready,\r\n    disabled: props.execApprovalsSaving || props.execApprovalsLoading,\r\n    dirty: props.execApprovalsDirty,\r\n    loading: props.execApprovalsLoading,\r\n    saving: props.execApprovalsSaving,\r\n    form,\r\n    defaults,\r\n    selectedScope,\r\n    selectedAgent,\r\n    agents,\r\n    allowlist,\r\n    target,\r\n    targetNodeId,\r\n    targetNodes,\r\n    onSelectScope: props.onExecApprovalsSelectAgent,\r\n    onSelectTarget: props.onExecApprovalsTargetChange,\r\n    onPatch: props.onExecApprovalsPatch,\r\n    onRemove: props.onExecApprovalsRemove,\r\n    onLoad: props.onLoadExecApprovals,\r\n    onSave: props.onSaveExecApprovals,\r\n  };\r\n}\r\n\r\nfunction renderBindings(state: BindingState) {\r\n  const supportsBinding = state.nodes.length > 0;\r\n  const defaultValue = state.defaultBinding ?? \"\";\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between; align-items: center;\">\r\n        <div>\r\n          <div class=\"card-title\">Exec node binding</div>\r\n          <div class=\"card-sub\">\r\n            Pin agents to a specific node when using <span class=\"mono\">exec host=node</span>.\r\n          </div>\r\n        </div>\r\n        <button\r\n          class=\"btn\"\r\n          ?disabled=${state.disabled || !state.configDirty}\r\n          @click=${state.onSave}\r\n        >\r\n          ${state.configSaving ? \"Saving…\" : \"Save\"}\r\n        </button>\r\n      </div>\r\n\r\n      ${\r\n        state.formMode === \"raw\"\r\n          ? html`\r\n              <div class=\"callout warn\" style=\"margin-top: 12px\">\r\n                Switch the Config tab to <strong>Form</strong> mode to edit bindings here.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        !state.ready\r\n          ? html`<div class=\"row\" style=\"margin-top: 12px; gap: 12px;\">\r\n            <div class=\"muted\">Load config to edit bindings.</div>\r\n            <button class=\"btn\" ?disabled=${state.configLoading} @click=${state.onLoadConfig}>\r\n              ${state.configLoading ? \"Loading…\" : \"Load config\"}\r\n            </button>\r\n          </div>`\r\n          : html`\r\n            <div class=\"list\" style=\"margin-top: 16px;\">\r\n              <div class=\"list-item\">\r\n                <div class=\"list-main\">\r\n                  <div class=\"list-title\">Default binding</div>\r\n                  <div class=\"list-sub\">Used when agents do not override a node binding.</div>\r\n                </div>\r\n                <div class=\"list-meta\">\r\n                  <label class=\"field\">\r\n                    <span>Node</span>\r\n                    <select\r\n                      ?disabled=${state.disabled || !supportsBinding}\r\n                      @change=${(event: Event) => {\r\n                        const target = event.target as HTMLSelectElement;\r\n                        const value = target.value.trim();\r\n                        state.onBindDefault(value ? value : null);\r\n                      }}\r\n                    >\r\n                      <option value=\"\" ?selected=${defaultValue === \"\"}>Any node</option>\r\n                      ${state.nodes.map(\r\n                        (node) =>\r\n                          html`<option\r\n                            value=${node.id}\r\n                            ?selected=${defaultValue === node.id}\r\n                          >\r\n                            ${node.label}\r\n                          </option>`,\r\n                      )}\r\n                    </select>\r\n                  </label>\r\n                  ${\r\n                    !supportsBinding\r\n                      ? html`\r\n                          <div class=\"muted\">No nodes with system.run available.</div>\r\n                        `\r\n                      : nothing\r\n                  }\r\n                </div>\r\n              </div>\r\n\r\n              ${\r\n                state.agents.length === 0\r\n                  ? html`\r\n                      <div class=\"muted\">No agents found.</div>\r\n                    `\r\n                  : state.agents.map((agent) => renderAgentBinding(agent, state))\r\n              }\r\n            </div>\r\n          `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderExecApprovals(state: ExecApprovalsState) {\r\n  const ready = state.ready;\r\n  const targetReady = state.target !== \"node\" || Boolean(state.targetNodeId);\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between; align-items: center;\">\r\n        <div>\r\n          <div class=\"card-title\">Exec approvals</div>\r\n          <div class=\"card-sub\">\r\n            Allowlist and approval policy for <span class=\"mono\">exec host=gateway/node</span>.\r\n          </div>\r\n        </div>\r\n        <button\r\n          class=\"btn\"\r\n          ?disabled=${state.disabled || !state.dirty || !targetReady}\r\n          @click=${state.onSave}\r\n        >\r\n          ${state.saving ? \"Saving…\" : \"Save\"}\r\n        </button>\r\n      </div>\r\n\r\n      ${renderExecApprovalsTarget(state)}\r\n\r\n      ${\r\n        !ready\r\n          ? html`<div class=\"row\" style=\"margin-top: 12px; gap: 12px;\">\r\n            <div class=\"muted\">Load exec approvals to edit allowlists.</div>\r\n            <button class=\"btn\" ?disabled=${state.loading || !targetReady} @click=${state.onLoad}>\r\n              ${state.loading ? \"Loading…\" : \"Load approvals\"}\r\n            </button>\r\n          </div>`\r\n          : html`\r\n            ${renderExecApprovalsTabs(state)}\r\n            ${renderExecApprovalsPolicy(state)}\r\n            ${\r\n              state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE\r\n                ? nothing\r\n                : renderExecApprovalsAllowlist(state)\r\n            }\r\n          `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderExecApprovalsTarget(state: ExecApprovalsState) {\r\n  const hasNodes = state.targetNodes.length > 0;\r\n  const nodeValue = state.targetNodeId ?? \"\";\r\n  return html`\r\n    <div class=\"list\" style=\"margin-top: 12px;\">\r\n      <div class=\"list-item\">\r\n        <div class=\"list-main\">\r\n          <div class=\"list-title\">Target</div>\r\n          <div class=\"list-sub\">\r\n            Gateway edits local approvals; node edits the selected node.\r\n          </div>\r\n        </div>\r\n        <div class=\"list-meta\">\r\n          <label class=\"field\">\r\n            <span>Host</span>\r\n            <select\r\n              ?disabled=${state.disabled}\r\n              @change=${(event: Event) => {\r\n                const target = event.target as HTMLSelectElement;\r\n                const value = target.value;\r\n                if (value === \"node\") {\r\n                  const first = state.targetNodes[0]?.id ?? null;\r\n                  state.onSelectTarget(\"node\", nodeValue || first);\r\n                } else {\r\n                  state.onSelectTarget(\"gateway\", null);\r\n                }\r\n              }}\r\n            >\r\n              <option value=\"gateway\" ?selected=${state.target === \"gateway\"}>Gateway</option>\r\n              <option value=\"node\" ?selected=${state.target === \"node\"}>Node</option>\r\n            </select>\r\n          </label>\r\n          ${\r\n            state.target === \"node\"\r\n              ? html`\r\n                <label class=\"field\">\r\n                  <span>Node</span>\r\n                  <select\r\n                    ?disabled=${state.disabled || !hasNodes}\r\n                    @change=${(event: Event) => {\r\n                      const target = event.target as HTMLSelectElement;\r\n                      const value = target.value.trim();\r\n                      state.onSelectTarget(\"node\", value ? value : null);\r\n                    }}\r\n                  >\r\n                    <option value=\"\" ?selected=${nodeValue === \"\"}>Select node</option>\r\n                    ${state.targetNodes.map(\r\n                      (node) =>\r\n                        html`<option\r\n                          value=${node.id}\r\n                          ?selected=${nodeValue === node.id}\r\n                        >\r\n                          ${node.label}\r\n                        </option>`,\r\n                    )}\r\n                  </select>\r\n                </label>\r\n              `\r\n              : nothing\r\n          }\r\n        </div>\r\n      </div>\r\n      ${\r\n        state.target === \"node\" && !hasNodes\r\n          ? html`\r\n              <div class=\"muted\">No nodes advertise exec approvals yet.</div>\r\n            `\r\n          : nothing\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderExecApprovalsTabs(state: ExecApprovalsState) {\r\n  return html`\r\n    <div class=\"row\" style=\"margin-top: 12px; gap: 8px; flex-wrap: wrap;\">\r\n      <span class=\"label\">Scope</span>\r\n      <div class=\"row\" style=\"gap: 8px; flex-wrap: wrap;\">\r\n        <button\r\n          class=\"btn btn--sm ${state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE ? \"active\" : \"\"}\"\r\n          @click=${() => state.onSelectScope(EXEC_APPROVALS_DEFAULT_SCOPE)}\r\n        >\r\n          Defaults\r\n        </button>\r\n        ${state.agents.map((agent) => {\r\n          const label = agent.name?.trim() ? `${agent.name} (${agent.id})` : agent.id;\r\n          return html`\r\n            <button\r\n              class=\"btn btn--sm ${state.selectedScope === agent.id ? \"active\" : \"\"}\"\r\n              @click=${() => state.onSelectScope(agent.id)}\r\n            >\r\n              ${label}\r\n            </button>\r\n          `;\r\n        })}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderExecApprovalsPolicy(state: ExecApprovalsState) {\r\n  const isDefaults = state.selectedScope === EXEC_APPROVALS_DEFAULT_SCOPE;\r\n  const defaults = state.defaults;\r\n  const agent = state.selectedAgent ?? {};\r\n  const basePath = isDefaults ? [\"defaults\"] : [\"agents\", state.selectedScope];\r\n  const agentSecurity = typeof agent.security === \"string\" ? agent.security : undefined;\r\n  const agentAsk = typeof agent.ask === \"string\" ? agent.ask : undefined;\r\n  const agentAskFallback = typeof agent.askFallback === \"string\" ? agent.askFallback : undefined;\r\n  const securityValue = isDefaults ? defaults.security : (agentSecurity ?? \"__default__\");\r\n  const askValue = isDefaults ? defaults.ask : (agentAsk ?? \"__default__\");\r\n  const askFallbackValue = isDefaults ? defaults.askFallback : (agentAskFallback ?? \"__default__\");\r\n  const autoOverride =\r\n    typeof agent.autoAllowSkills === \"boolean\" ? agent.autoAllowSkills : undefined;\r\n  const autoEffective = autoOverride ?? defaults.autoAllowSkills;\r\n  const autoIsDefault = autoOverride == null;\r\n\r\n  return html`\r\n    <div class=\"list\" style=\"margin-top: 16px;\">\r\n      <div class=\"list-item\">\r\n        <div class=\"list-main\">\r\n          <div class=\"list-title\">Security</div>\r\n          <div class=\"list-sub\">\r\n            ${isDefaults ? \"Default security mode.\" : `Default: ${defaults.security}.`}\r\n          </div>\r\n        </div>\r\n        <div class=\"list-meta\">\r\n          <label class=\"field\">\r\n            <span>Mode</span>\r\n            <select\r\n              ?disabled=${state.disabled}\r\n              @change=${(event: Event) => {\r\n                const target = event.target as HTMLSelectElement;\r\n                const value = target.value;\r\n                if (!isDefaults && value === \"__default__\") {\r\n                  state.onRemove([...basePath, \"security\"]);\r\n                } else {\r\n                  state.onPatch([...basePath, \"security\"], value);\r\n                }\r\n              }}\r\n            >\r\n              ${\r\n                !isDefaults\r\n                  ? html`<option value=\"__default__\" ?selected=${securityValue === \"__default__\"}>\r\n                    Use default (${defaults.security})\r\n                  </option>`\r\n                  : nothing\r\n              }\r\n              ${SECURITY_OPTIONS.map(\r\n                (option) =>\r\n                  html`<option\r\n                    value=${option.value}\r\n                    ?selected=${securityValue === option.value}\r\n                  >\r\n                    ${option.label}\r\n                  </option>`,\r\n              )}\r\n            </select>\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"list-item\">\r\n        <div class=\"list-main\">\r\n          <div class=\"list-title\">Ask</div>\r\n          <div class=\"list-sub\">\r\n            ${isDefaults ? \"Default prompt policy.\" : `Default: ${defaults.ask}.`}\r\n          </div>\r\n        </div>\r\n        <div class=\"list-meta\">\r\n          <label class=\"field\">\r\n            <span>Mode</span>\r\n            <select\r\n              ?disabled=${state.disabled}\r\n              @change=${(event: Event) => {\r\n                const target = event.target as HTMLSelectElement;\r\n                const value = target.value;\r\n                if (!isDefaults && value === \"__default__\") {\r\n                  state.onRemove([...basePath, \"ask\"]);\r\n                } else {\r\n                  state.onPatch([...basePath, \"ask\"], value);\r\n                }\r\n              }}\r\n            >\r\n              ${\r\n                !isDefaults\r\n                  ? html`<option value=\"__default__\" ?selected=${askValue === \"__default__\"}>\r\n                    Use default (${defaults.ask})\r\n                  </option>`\r\n                  : nothing\r\n              }\r\n              ${ASK_OPTIONS.map(\r\n                (option) =>\r\n                  html`<option\r\n                    value=${option.value}\r\n                    ?selected=${askValue === option.value}\r\n                  >\r\n                    ${option.label}\r\n                  </option>`,\r\n              )}\r\n            </select>\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"list-item\">\r\n        <div class=\"list-main\">\r\n          <div class=\"list-title\">Ask fallback</div>\r\n          <div class=\"list-sub\">\r\n            ${\r\n              isDefaults\r\n                ? \"Applied when the UI prompt is unavailable.\"\r\n                : `Default: ${defaults.askFallback}.`\r\n            }\r\n          </div>\r\n        </div>\r\n        <div class=\"list-meta\">\r\n          <label class=\"field\">\r\n            <span>Fallback</span>\r\n            <select\r\n              ?disabled=${state.disabled}\r\n              @change=${(event: Event) => {\r\n                const target = event.target as HTMLSelectElement;\r\n                const value = target.value;\r\n                if (!isDefaults && value === \"__default__\") {\r\n                  state.onRemove([...basePath, \"askFallback\"]);\r\n                } else {\r\n                  state.onPatch([...basePath, \"askFallback\"], value);\r\n                }\r\n              }}\r\n            >\r\n              ${\r\n                !isDefaults\r\n                  ? html`<option value=\"__default__\" ?selected=${askFallbackValue === \"__default__\"}>\r\n                    Use default (${defaults.askFallback})\r\n                  </option>`\r\n                  : nothing\r\n              }\r\n              ${SECURITY_OPTIONS.map(\r\n                (option) =>\r\n                  html`<option\r\n                    value=${option.value}\r\n                    ?selected=${askFallbackValue === option.value}\r\n                  >\r\n                    ${option.label}\r\n                  </option>`,\r\n              )}\r\n            </select>\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"list-item\">\r\n        <div class=\"list-main\">\r\n          <div class=\"list-title\">Auto-allow skill CLIs</div>\r\n          <div class=\"list-sub\">\r\n            ${\r\n              isDefaults\r\n                ? \"Allow skill executables listed by the Gateway.\"\r\n                : autoIsDefault\r\n                  ? `Using default (${defaults.autoAllowSkills ? \"on\" : \"off\"}).`\r\n                  : `Override (${autoEffective ? \"on\" : \"off\"}).`\r\n            }\r\n          </div>\r\n        </div>\r\n        <div class=\"list-meta\">\r\n          <label class=\"field\">\r\n            <span>Enabled</span>\r\n            <input\r\n              type=\"checkbox\"\r\n              ?disabled=${state.disabled}\r\n              .checked=${autoEffective}\r\n              @change=${(event: Event) => {\r\n                const target = event.target as HTMLInputElement;\r\n                state.onPatch([...basePath, \"autoAllowSkills\"], target.checked);\r\n              }}\r\n            />\r\n          </label>\r\n          ${\r\n            !isDefaults && !autoIsDefault\r\n              ? html`<button\r\n                class=\"btn btn--sm\"\r\n                ?disabled=${state.disabled}\r\n                @click=${() => state.onRemove([...basePath, \"autoAllowSkills\"])}\r\n              >\r\n                Use default\r\n              </button>`\r\n              : nothing\r\n          }\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderExecApprovalsAllowlist(state: ExecApprovalsState) {\r\n  const allowlistPath = [\"agents\", state.selectedScope, \"allowlist\"];\r\n  const entries = state.allowlist;\r\n  return html`\r\n    <div class=\"row\" style=\"margin-top: 18px; justify-content: space-between;\">\r\n      <div>\r\n        <div class=\"card-title\">Allowlist</div>\r\n        <div class=\"card-sub\">Case-insensitive glob patterns.</div>\r\n      </div>\r\n      <button\r\n        class=\"btn btn--sm\"\r\n        ?disabled=${state.disabled}\r\n        @click=${() => {\r\n          const next = [...entries, { pattern: \"\" }];\r\n          state.onPatch(allowlistPath, next);\r\n        }}\r\n      >\r\n        Add pattern\r\n      </button>\r\n    </div>\r\n    <div class=\"list\" style=\"margin-top: 12px;\">\r\n      ${\r\n        entries.length === 0\r\n          ? html`\r\n              <div class=\"muted\">No allowlist entries yet.</div>\r\n            `\r\n          : entries.map((entry, index) => renderAllowlistEntry(state, entry, index))\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderAllowlistEntry(\r\n  state: ExecApprovalsState,\r\n  entry: ExecApprovalsAllowlistEntry,\r\n  index: number,\r\n) {\r\n  const lastUsed = entry.lastUsedAt ? formatRelativeTimestamp(entry.lastUsedAt) : \"never\";\r\n  const lastCommand = entry.lastUsedCommand ? clampText(entry.lastUsedCommand, 120) : null;\r\n  const lastPath = entry.lastResolvedPath ? clampText(entry.lastResolvedPath, 120) : null;\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${entry.pattern?.trim() ? entry.pattern : \"New pattern\"}</div>\r\n        <div class=\"list-sub\">Last used: ${lastUsed}</div>\r\n        ${lastCommand ? html`<div class=\"list-sub mono\">${lastCommand}</div>` : nothing}\r\n        ${lastPath ? html`<div class=\"list-sub mono\">${lastPath}</div>` : nothing}\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <label class=\"field\">\r\n          <span>Pattern</span>\r\n          <input\r\n            type=\"text\"\r\n            .value=${entry.pattern ?? \"\"}\r\n            ?disabled=${state.disabled}\r\n            @input=${(event: Event) => {\r\n              const target = event.target as HTMLInputElement;\r\n              state.onPatch(\r\n                [\"agents\", state.selectedScope, \"allowlist\", index, \"pattern\"],\r\n                target.value,\r\n              );\r\n            }}\r\n          />\r\n        </label>\r\n        <button\r\n          class=\"btn btn--sm danger\"\r\n          ?disabled=${state.disabled}\r\n          @click=${() => {\r\n            if (state.allowlist.length <= 1) {\r\n              state.onRemove([\"agents\", state.selectedScope, \"allowlist\"]);\r\n              return;\r\n            }\r\n            state.onRemove([\"agents\", state.selectedScope, \"allowlist\", index]);\r\n          }}\r\n        >\r\n          Remove\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderAgentBinding(agent: BindingAgent, state: BindingState) {\r\n  const bindingValue = agent.binding ?? \"__default__\";\r\n  const label = agent.name?.trim() ? `${agent.name} (${agent.id})` : agent.id;\r\n  const supportsBinding = state.nodes.length > 0;\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${label}</div>\r\n        <div class=\"list-sub\">\r\n          ${agent.isDefault ? \"default agent\" : \"agent\"} ·\r\n          ${\r\n            bindingValue === \"__default__\"\r\n              ? `uses default (${state.defaultBinding ?? \"any\"})`\r\n              : `override: ${agent.binding}`\r\n          }\r\n        </div>\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <label class=\"field\">\r\n          <span>Binding</span>\r\n          <select\r\n            ?disabled=${state.disabled || !supportsBinding}\r\n            @change=${(event: Event) => {\r\n              const target = event.target as HTMLSelectElement;\r\n              const value = target.value.trim();\r\n              state.onBindAgent(agent.index, value === \"__default__\" ? null : value);\r\n            }}\r\n          >\r\n            <option value=\"__default__\" ?selected=${bindingValue === \"__default__\"}>\r\n              Use default\r\n            </option>\r\n            ${state.nodes.map(\r\n              (node) =>\r\n                html`<option\r\n                  value=${node.id}\r\n                  ?selected=${bindingValue === node.id}\r\n                >\r\n                  ${node.label}\r\n                </option>`,\r\n            )}\r\n          </select>\r\n        </label>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction resolveExecNodes(nodes: Array<Record<string, unknown>>): BindingNode[] {\r\n  const list: BindingNode[] = [];\r\n  for (const node of nodes) {\r\n    const commands = Array.isArray(node.commands) ? node.commands : [];\r\n    const supports = commands.some((cmd) => String(cmd) === \"system.run\");\r\n    if (!supports) {\r\n      continue;\r\n    }\r\n    const nodeId = typeof node.nodeId === \"string\" ? node.nodeId.trim() : \"\";\r\n    if (!nodeId) {\r\n      continue;\r\n    }\r\n    const displayName =\r\n      typeof node.displayName === \"string\" && node.displayName.trim()\r\n        ? node.displayName.trim()\r\n        : nodeId;\r\n    list.push({\r\n      id: nodeId,\r\n      label: displayName === nodeId ? nodeId : `${displayName} · ${nodeId}`,\r\n    });\r\n  }\r\n  list.sort((a, b) => a.label.localeCompare(b.label));\r\n  return list;\r\n}\r\n\r\nfunction resolveExecApprovalsNodes(\r\n  nodes: Array<Record<string, unknown>>,\r\n): ExecApprovalsTargetNode[] {\r\n  const list: ExecApprovalsTargetNode[] = [];\r\n  for (const node of nodes) {\r\n    const commands = Array.isArray(node.commands) ? node.commands : [];\r\n    const supports = commands.some(\r\n      (cmd) =>\r\n        String(cmd) === \"system.execApprovals.get\" || String(cmd) === \"system.execApprovals.set\",\r\n    );\r\n    if (!supports) {\r\n      continue;\r\n    }\r\n    const nodeId = typeof node.nodeId === \"string\" ? node.nodeId.trim() : \"\";\r\n    if (!nodeId) {\r\n      continue;\r\n    }\r\n    const displayName =\r\n      typeof node.displayName === \"string\" && node.displayName.trim()\r\n        ? node.displayName.trim()\r\n        : nodeId;\r\n    list.push({\r\n      id: nodeId,\r\n      label: displayName === nodeId ? nodeId : `${displayName} · ${nodeId}`,\r\n    });\r\n  }\r\n  list.sort((a, b) => a.label.localeCompare(b.label));\r\n  return list;\r\n}\r\n\r\nfunction resolveAgentBindings(config: Record<string, unknown> | null): {\r\n  defaultBinding?: string | null;\r\n  agents: BindingAgent[];\r\n} {\r\n  const fallbackAgent: BindingAgent = {\r\n    id: \"main\",\r\n    name: undefined,\r\n    index: 0,\r\n    isDefault: true,\r\n    binding: null,\r\n  };\r\n  if (!config || typeof config !== \"object\") {\r\n    return { defaultBinding: null, agents: [fallbackAgent] };\r\n  }\r\n  const tools = (config.tools ?? {}) as Record<string, unknown>;\r\n  const exec = (tools.exec ?? {}) as Record<string, unknown>;\r\n  const defaultBinding =\r\n    typeof exec.node === \"string\" && exec.node.trim() ? exec.node.trim() : null;\r\n\r\n  const agentsNode = (config.agents ?? {}) as Record<string, unknown>;\r\n  const list = Array.isArray(agentsNode.list) ? agentsNode.list : [];\r\n  if (list.length === 0) {\r\n    return { defaultBinding, agents: [fallbackAgent] };\r\n  }\r\n\r\n  const agents: BindingAgent[] = [];\r\n  list.forEach((entry, index) => {\r\n    if (!entry || typeof entry !== \"object\") {\r\n      return;\r\n    }\r\n    const record = entry as Record<string, unknown>;\r\n    const id = typeof record.id === \"string\" ? record.id.trim() : \"\";\r\n    if (!id) {\r\n      return;\r\n    }\r\n    const name = typeof record.name === \"string\" ? record.name.trim() : undefined;\r\n    const isDefault = record.default === true;\r\n    const toolsEntry = (record.tools ?? {}) as Record<string, unknown>;\r\n    const execEntry = (toolsEntry.exec ?? {}) as Record<string, unknown>;\r\n    const binding =\r\n      typeof execEntry.node === \"string\" && execEntry.node.trim() ? execEntry.node.trim() : null;\r\n    agents.push({\r\n      id,\r\n      name: name || undefined,\r\n      index,\r\n      isDefault,\r\n      binding,\r\n    });\r\n  });\r\n\r\n  if (agents.length === 0) {\r\n    agents.push(fallbackAgent);\r\n  }\r\n\r\n  return { defaultBinding, agents };\r\n}\r\n\r\nfunction renderNode(node: Record<string, unknown>) {\r\n  const connected = Boolean(node.connected);\r\n  const paired = Boolean(node.paired);\r\n  const title =\r\n    (typeof node.displayName === \"string\" && node.displayName.trim()) ||\r\n    (typeof node.nodeId === \"string\" ? node.nodeId : \"unknown\");\r\n  const caps = Array.isArray(node.caps) ? (node.caps as unknown[]) : [];\r\n  const commands = Array.isArray(node.commands) ? (node.commands as unknown[]) : [];\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">${title}</div>\r\n        <div class=\"list-sub\">\r\n          ${typeof node.nodeId === \"string\" ? node.nodeId : \"\"}\r\n          ${typeof node.remoteIp === \"string\" ? ` · ${node.remoteIp}` : \"\"}\r\n          ${typeof node.version === \"string\" ? ` · ${node.version}` : \"\"}\r\n        </div>\r\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\r\n          <span class=\"chip\">${paired ? \"paired\" : \"unpaired\"}</span>\r\n          <span class=\"chip ${connected ? \"chip-ok\" : \"chip-warn\"}\">\r\n            ${connected ? \"connected\" : \"offline\"}\r\n          </span>\r\n          ${caps.slice(0, 12).map((c) => html`<span class=\"chip\">${String(c)}</span>`)}\r\n          ${commands.slice(0, 8).map((c) => html`<span class=\"chip\">${String(c)}</span>`)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html } from \"lit\";\r\nimport type { GatewayHelloOk } from \"../gateway.ts\";\r\nimport type { UiSettings } from \"../storage.ts\";\r\nimport { formatRelativeTimestamp, formatDurationHuman } from \"../format.ts\";\r\nimport { formatNextRun } from \"../presenter.ts\";\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type OverviewProps = {\r\n  connected: boolean;\r\n  hello: GatewayHelloOk | null;\r\n  settings: UiSettings;\r\n  password: string;\r\n  lastError: string | null;\r\n  presenceCount: number;\r\n  sessionsCount: number | null;\r\n  cronEnabled: boolean | null;\r\n  cronNext: number | null;\r\n  lastChannelsRefresh: number | null;\r\n  onSettingsChange: (next: UiSettings) => void;\r\n  onPasswordChange: (next: string) => void;\r\n  onSessionKeyChange: (next: string) => void;\r\n  onConnect: () => void;\r\n  onRefresh: () => void;\r\n};\r\n\r\nexport function renderOverview(props: OverviewProps) {\r\n  const snapshot = props.hello?.snapshot as\r\n    | { uptimeMs?: number; policy?: { tickIntervalMs?: number } }\r\n    | undefined;\r\n  const uptime = snapshot?.uptimeMs ? formatDurationHuman(snapshot.uptimeMs) : \"n/a\";\r\n  const tick = snapshot?.policy?.tickIntervalMs ? `${snapshot.policy.tickIntervalMs}ms` : \"n/a\";\r\n  const authHint = (() => {\r\n    if (props.connected || !props.lastError) {\r\n      return null;\r\n    }\r\n    const lower = props.lastError.toLowerCase();\r\n    const authFailed = lower.includes(\"unauthorized\") || lower.includes(\"connect failed\");\r\n    if (!authFailed) {\r\n      return null;\r\n    }\r\n    const hasToken = Boolean(props.settings.token.trim());\r\n    const hasPassword = Boolean(props.password.trim());\r\n    if (!hasToken && !hasPassword) {\r\n      return html`\r\n        <div class=\"muted\" style=\"margin-top: 8px\">\r\n          This gateway requires auth. Add a token or password, then click Connect.\r\n          <div style=\"margin-top: 6px\">\r\n            <span class=\"mono\">openclaw dashboard --no-open</span> �?open the Control UI<br />\r\n            <span class=\"mono\">openclaw doctor --generate-gateway-token</span> �?set token\r\n          </div>\r\n          <div style=\"margin-top: 6px\">\r\n            <a\r\n              class=\"session-link\"\r\n              href=\"https://docs.openclaw.ai/web/dashboard\"\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              title=\"Control UI auth docs (opens in new tab)\"\r\n              >Docs: Control UI auth</a\r\n            >\r\n          </div>\r\n        </div>\r\n      `;\r\n    }\r\n    return html`\r\n      <div class=\"muted\" style=\"margin-top: 8px\">\r\n        Auth failed. Update the token or password in Control UI settings, then click Connect.\r\n        <div style=\"margin-top: 6px\">\r\n          <a\r\n            class=\"session-link\"\r\n            href=\"https://docs.openclaw.ai/web/dashboard\"\r\n            target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n            title=\"Control UI auth docs (opens in new tab)\"\r\n            >Docs: Control UI auth</a\r\n          >\r\n        </div>\r\n      </div>\r\n    `;\r\n  })();\r\n  const insecureContextHint = (() => {\r\n    if (props.connected || !props.lastError) {\r\n      return null;\r\n    }\r\n    const isSecureContext = typeof window !== \"undefined\" ? window.isSecureContext : true;\r\n    if (isSecureContext) {\r\n      return null;\r\n    }\r\n    const lower = props.lastError.toLowerCase();\r\n    if (!lower.includes(\"secure context\") && !lower.includes(\"device identity required\")) {\r\n      return null;\r\n    }\r\n    return html`\r\n      <div class=\"muted\" style=\"margin-top: 8px\">\r\n        This page is HTTP, so the browser blocks device identity. Use HTTPS (Tailscale Serve) or open\r\n        <span class=\"mono\">http://127.0.0.1:18789</span> on the gateway host.\r\n        <div style=\"margin-top: 6px\">\r\n          If you must stay on HTTP, set\r\n          <span class=\"mono\">gateway.controlUi.allowInsecureAuth: true</span> (token-only).\r\n        </div>\r\n        <div style=\"margin-top: 6px\">\r\n          <a\r\n            class=\"session-link\"\r\n            href=\"https://docs.openclaw.ai/gateway/tailscale\"\r\n            target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n            title=\"Tailscale Serve docs (opens in new tab)\"\r\n            >Docs: Tailscale Serve</a\r\n          >\r\n          <span class=\"muted\"> · </span>\r\n          <a\r\n            class=\"session-link\"\r\n            href=\"https://docs.openclaw.ai/web/control-ui#insecure-http\"\r\n            target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n            title=\"Insecure HTTP docs (opens in new tab)\"\r\n            >Docs: Insecure HTTP</a\r\n          >\r\n        </div>\r\n      </div>\r\n    `;\r\n  })();\r\n\r\n  return html`\r\n    <section class=\"grid grid-cols-2\">\r\n      <div class=\"card\">\r\n        <div class=\"card-title\">${T(\"Gateway Access\")}</div>\r\n        <div class=\"card-sub\">${T(\"Where the dashboard connects and how it authenticates.\")}</div>\r\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\r\n          <label class=\"field\">\r\n            <span>${T(\"WebSocket URL\")}</span>\r\n            <input\r\n              .value=${props.settings.gatewayUrl}\r\n              @input=${(e: Event) => {\r\n                const v = (e.target as HTMLInputElement).value;\r\n                props.onSettingsChange({ ...props.settings, gatewayUrl: v });\r\n              }}\r\n              placeholder=\"ws://100.x.y.z:18789\"\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>${T(\"Gateway Token\")}</span>\r\n            <input\r\n              .value=${props.settings.token}\r\n              @input=${(e: Event) => {\r\n                const v = (e.target as HTMLInputElement).value;\r\n                props.onSettingsChange({ ...props.settings, token: v });\r\n              }}\r\n              placeholder=\"OPENCLAW_GATEWAY_TOKEN\"\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>${T(\"Password (not stored)\")}</span>\r\n            <input\r\n              type=\"password\"\r\n              .value=${props.password}\r\n              @input=${(e: Event) => {\r\n                const v = (e.target as HTMLInputElement).value;\r\n                props.onPasswordChange(v);\r\n              }}\r\n              placeholder=\"system or shared password\"\r\n            />\r\n          </label>\r\n          <label class=\"field\">\r\n            <span>${T(\"Default Session Key\")}</span>\r\n            <input\r\n              .value=${props.settings.sessionKey}\r\n              @input=${(e: Event) => {\r\n                const v = (e.target as HTMLInputElement).value;\r\n                props.onSessionKeyChange(v);\r\n              }}\r\n            />\r\n          </label>\r\n        </div>\r\n        <div class=\"row\" style=\"margin-top: 14px;\">\r\n          <button class=\"btn\" @click=${() => props.onConnect()}>${T(\"Connect\")}</button>\r\n          <button class=\"btn\" @click=${() => props.onRefresh()}>${T(\"Refresh\")}</button>\r\n          <span class=\"muted\">${T(\"Click Connect to apply connection changes.\")}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card\">\r\n        <div class=\"card-title\">${T(\"Snapshot\")}</div>\r\n        <div class=\"card-sub\">${T(\"Latest gateway handshake information.\")}</div>\r\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">${T(\"Status\")}</div>\r\n            <div class=\"stat-value ${props.connected ? \"ok\" : \"warn\"}\">\r\n              ${props.connected ? T(\"Connected\") : T(\"Disconnected\")}\r\n            </div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">${T(\"Uptime\")}</div>\r\n            <div class=\"stat-value\">${uptime}</div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">${T(\"Tick Interval\")}</div>\r\n            <div class=\"stat-value\">${tick}</div>\r\n          </div>\r\n          <div class=\"stat\">\r\n            <div class=\"stat-label\">${T(\"Last Channels Refresh\")}</div>\r\n            <div class=\"stat-value\">\r\n              ${props.lastChannelsRefresh ? formatRelativeTimestamp(props.lastChannelsRefresh) : T(\"n/a\")}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        ${\r\n          props.lastError\r\n            ? html`<div class=\"callout danger\" style=\"margin-top: 14px;\">\r\n              <div>${props.lastError}</div>\r\n              ${authHint ?? \"\"}\r\n              ${insecureContextHint ?? \"\"}\r\n            </div>`\r\n            : html`\r\n                <div class=\"callout\" style=\"margin-top: 14px\">\r\n                  ${T(\"Use Channels to link WhatsApp, Telegram, Discord, Signal, or iMessage.\")}\r\n                </div>\r\n              `\r\n        }\r\n      </div>\r\n    </section>\r\n\r\n    <section class=\"grid grid-cols-3\" style=\"margin-top: 18px;\">\r\n      <div class=\"card stat-card\">\r\n        <div class=\"stat-label\">${T(\"Instances\")}</div>\r\n        <div class=\"stat-value\">${props.presenceCount}</div>\r\n        <div class=\"muted\">${T(\"Presence beacons in the last 5 minutes.\")}</div>\r\n      </div>\r\n      <div class=\"card stat-card\">\r\n        <div class=\"stat-label\">${T(\"Sessions\")}</div>\r\n        <div class=\"stat-value\">${props.sessionsCount ?? T(\"n/a\")}</div>\r\n        <div class=\"muted\">${T(\"Recent session keys tracked by the gateway.\")}</div>\r\n      </div>\r\n      <div class=\"card stat-card\">\r\n        <div class=\"stat-label\">${T(\"Cron\")}</div>\r\n        <div class=\"stat-value\">\r\n          ${props.cronEnabled == null ? T(\"n/a\") : props.cronEnabled ? T(\"Enabled\") : T(\"Disabled\")}\r\n        </div>\r\n        <div class=\"muted\">${T(\"Next wake\")} ${formatNextRun(props.cronNext)}</div>\r\n      </div>\r\n    </section>\r\n\r\n    <section class=\"card\" style=\"margin-top: 18px;\">\r\n      <div class=\"card-title\">${T(\"Notes\")}</div>\r\n      <div class=\"card-sub\">${T(\"Quick reminders for remote control setups.\")}</div>\r\n      <div class=\"note-grid\" style=\"margin-top: 14px;\">\r\n        <div>\r\n          <div class=\"note-title\">${T(\"Tailscale serve\")}</div>\r\n          <div class=\"muted\">\r\n            ${T(\"Prefer serve mode to keep the gateway on loopback with tailnet auth.\")}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <div class=\"note-title\">${T(\"Session hygiene\")}</div>\r\n          <div class=\"muted\">${T(\"Use /new or sessions.patch to reset context.\")}</div>\r\n        </div>\r\n        <div>\r\n          <div class=\"note-title\">${T(\"Cron reminders\")}</div>\r\n          <div class=\"muted\">${T(\"Use isolated sessions for recurring runs.\")}</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { GatewaySessionRow, SessionsListResult } from \"../types.ts\";\r\nimport { formatRelativeTimestamp } from \"../format.ts\";\r\nimport { pathForTab } from \"../navigation.ts\";\r\nimport { formatSessionTokens } from \"../presenter.ts\";\r\n\r\nexport type SessionsProps = {\r\n  loading: boolean;\r\n  result: SessionsListResult | null;\r\n  error: string | null;\r\n  activeMinutes: string;\r\n  limit: string;\r\n  includeGlobal: boolean;\r\n  includeUnknown: boolean;\r\n  basePath: string;\r\n  onFiltersChange: (next: {\r\n    activeMinutes: string;\r\n    limit: string;\r\n    includeGlobal: boolean;\r\n    includeUnknown: boolean;\r\n  }) => void;\r\n  onRefresh: () => void;\r\n  onPatch: (\r\n    key: string,\r\n    patch: {\r\n      label?: string | null;\r\n      thinkingLevel?: string | null;\r\n      verboseLevel?: string | null;\r\n      reasoningLevel?: string | null;\r\n    },\r\n  ) => void;\r\n  onDelete: (key: string) => void;\r\n};\r\n\r\nconst THINK_LEVELS = [\"\", \"off\", \"minimal\", \"low\", \"medium\", \"high\", \"xhigh\"] as const;\r\nconst BINARY_THINK_LEVELS = [\"\", \"off\", \"on\"] as const;\r\nconst VERBOSE_LEVELS = [\r\n  { value: \"\", label: \"inherit\" },\r\n  { value: \"off\", label: \"off (explicit)\" },\r\n  { value: \"on\", label: \"on\" },\r\n  { value: \"full\", label: \"full\" },\r\n] as const;\r\nconst REASONING_LEVELS = [\"\", \"off\", \"on\", \"stream\"] as const;\r\n\r\nfunction normalizeProviderId(provider?: string | null): string {\r\n  if (!provider) {\r\n    return \"\";\r\n  }\r\n  const normalized = provider.trim().toLowerCase();\r\n  if (normalized === \"z.ai\" || normalized === \"z-ai\") {\r\n    return \"zai\";\r\n  }\r\n  return normalized;\r\n}\r\n\r\nfunction isBinaryThinkingProvider(provider?: string | null): boolean {\r\n  return normalizeProviderId(provider) === \"zai\";\r\n}\r\n\r\nfunction resolveThinkLevelOptions(provider?: string | null): readonly string[] {\r\n  return isBinaryThinkingProvider(provider) ? BINARY_THINK_LEVELS : THINK_LEVELS;\r\n}\r\n\r\nfunction withCurrentOption(options: readonly string[], current: string): string[] {\r\n  if (!current) {\r\n    return [...options];\r\n  }\r\n  if (options.includes(current)) {\r\n    return [...options];\r\n  }\r\n  return [...options, current];\r\n}\r\n\r\nfunction withCurrentLabeledOption(\r\n  options: readonly { value: string; label: string }[],\r\n  current: string,\r\n): Array<{ value: string; label: string }> {\r\n  if (!current) {\r\n    return [...options];\r\n  }\r\n  if (options.some((option) => option.value === current)) {\r\n    return [...options];\r\n  }\r\n  return [...options, { value: current, label: `${current} (custom)` }];\r\n}\r\n\r\nfunction resolveThinkLevelDisplay(value: string, isBinary: boolean): string {\r\n  if (!isBinary) {\r\n    return value;\r\n  }\r\n  if (!value || value === \"off\") {\r\n    return value;\r\n  }\r\n  return \"on\";\r\n}\r\n\r\nfunction resolveThinkLevelPatchValue(value: string, isBinary: boolean): string | null {\r\n  if (!value) {\r\n    return null;\r\n  }\r\n  if (!isBinary) {\r\n    return value;\r\n  }\r\n  if (value === \"on\") {\r\n    return \"low\";\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function renderSessions(props: SessionsProps) {\r\n  const rows = props.result?.sessions ?? [];\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Sessions</div>\r\n          <div class=\"card-sub\">Active session keys and per-session overrides.</div>\r\n        </div>\r\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n          ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"filters\" style=\"margin-top: 14px;\">\r\n        <label class=\"field\">\r\n          <span>Active within (minutes)</span>\r\n          <input\r\n            .value=${props.activeMinutes}\r\n            @input=${(e: Event) =>\r\n              props.onFiltersChange({\r\n                activeMinutes: (e.target as HTMLInputElement).value,\r\n                limit: props.limit,\r\n                includeGlobal: props.includeGlobal,\r\n                includeUnknown: props.includeUnknown,\r\n              })}\r\n          />\r\n        </label>\r\n        <label class=\"field\">\r\n          <span>Limit</span>\r\n          <input\r\n            .value=${props.limit}\r\n            @input=${(e: Event) =>\r\n              props.onFiltersChange({\r\n                activeMinutes: props.activeMinutes,\r\n                limit: (e.target as HTMLInputElement).value,\r\n                includeGlobal: props.includeGlobal,\r\n                includeUnknown: props.includeUnknown,\r\n              })}\r\n          />\r\n        </label>\r\n        <label class=\"field checkbox\">\r\n          <span>Include global</span>\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${props.includeGlobal}\r\n            @change=${(e: Event) =>\r\n              props.onFiltersChange({\r\n                activeMinutes: props.activeMinutes,\r\n                limit: props.limit,\r\n                includeGlobal: (e.target as HTMLInputElement).checked,\r\n                includeUnknown: props.includeUnknown,\r\n              })}\r\n          />\r\n        </label>\r\n        <label class=\"field checkbox\">\r\n          <span>Include unknown</span>\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${props.includeUnknown}\r\n            @change=${(e: Event) =>\r\n              props.onFiltersChange({\r\n                activeMinutes: props.activeMinutes,\r\n                limit: props.limit,\r\n                includeGlobal: props.includeGlobal,\r\n                includeUnknown: (e.target as HTMLInputElement).checked,\r\n              })}\r\n          />\r\n        </label>\r\n      </div>\r\n\r\n      ${\r\n        props.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      <div class=\"muted\" style=\"margin-top: 12px;\">\r\n        ${props.result ? `Store: ${props.result.path}` : \"\"}\r\n      </div>\r\n\r\n      <div class=\"table\" style=\"margin-top: 16px;\">\r\n        <div class=\"table-head\">\r\n          <div>Key</div>\r\n          <div>Label</div>\r\n          <div>Kind</div>\r\n          <div>Updated</div>\r\n          <div>Tokens</div>\r\n          <div>Thinking</div>\r\n          <div>Verbose</div>\r\n          <div>Reasoning</div>\r\n          <div>Actions</div>\r\n        </div>\r\n        ${\r\n          rows.length === 0\r\n            ? html`\r\n                <div class=\"muted\">No sessions found.</div>\r\n              `\r\n            : rows.map((row) =>\r\n                renderRow(row, props.basePath, props.onPatch, props.onDelete, props.loading),\r\n              )\r\n        }\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderRow(\r\n  row: GatewaySessionRow,\r\n  basePath: string,\r\n  onPatch: SessionsProps[\"onPatch\"],\r\n  onDelete: SessionsProps[\"onDelete\"],\r\n  disabled: boolean,\r\n) {\r\n  const updated = row.updatedAt ? formatRelativeTimestamp(row.updatedAt) : \"n/a\";\r\n  const rawThinking = row.thinkingLevel ?? \"\";\r\n  const isBinaryThinking = isBinaryThinkingProvider(row.modelProvider);\r\n  const thinking = resolveThinkLevelDisplay(rawThinking, isBinaryThinking);\r\n  const thinkLevels = withCurrentOption(resolveThinkLevelOptions(row.modelProvider), thinking);\r\n  const verbose = row.verboseLevel ?? \"\";\r\n  const verboseLevels = withCurrentLabeledOption(VERBOSE_LEVELS, verbose);\r\n  const reasoning = row.reasoningLevel ?? \"\";\r\n  const reasoningLevels = withCurrentOption(REASONING_LEVELS, reasoning);\r\n  const displayName =\r\n    typeof row.displayName === \"string\" && row.displayName.trim().length > 0\r\n      ? row.displayName.trim()\r\n      : null;\r\n  const label = typeof row.label === \"string\" ? row.label.trim() : \"\";\r\n  const showDisplayName = Boolean(displayName && displayName !== row.key && displayName !== label);\r\n  const canLink = row.kind !== \"global\";\r\n  const chatUrl = canLink\r\n    ? `${pathForTab(\"chat\", basePath)}?session=${encodeURIComponent(row.key)}`\r\n    : null;\r\n\r\n  return html`\r\n    <div class=\"table-row\">\r\n      <div class=\"mono session-key-cell\">\r\n        ${canLink ? html`<a href=${chatUrl} class=\"session-link\">${row.key}</a>` : row.key}\r\n        ${showDisplayName ? html`<span class=\"muted session-key-display-name\">${displayName}</span>` : nothing}\r\n      </div>\r\n      <div>\r\n        <input\r\n          .value=${row.label ?? \"\"}\r\n          ?disabled=${disabled}\r\n          placeholder=\"(optional)\"\r\n          @change=${(e: Event) => {\r\n            const value = (e.target as HTMLInputElement).value.trim();\r\n            onPatch(row.key, { label: value || null });\r\n          }}\r\n        />\r\n      </div>\r\n      <div>${row.kind}</div>\r\n      <div>${updated}</div>\r\n      <div>${formatSessionTokens(row)}</div>\r\n      <div>\r\n        <select\r\n          ?disabled=${disabled}\r\n          @change=${(e: Event) => {\r\n            const value = (e.target as HTMLSelectElement).value;\r\n            onPatch(row.key, {\r\n              thinkingLevel: resolveThinkLevelPatchValue(value, isBinaryThinking),\r\n            });\r\n          }}\r\n        >\r\n          ${thinkLevels.map(\r\n            (level) =>\r\n              html`<option value=${level} ?selected=${thinking === level}>\r\n                ${level || \"inherit\"}\r\n              </option>`,\r\n          )}\r\n        </select>\r\n      </div>\r\n      <div>\r\n        <select\r\n          ?disabled=${disabled}\r\n          @change=${(e: Event) => {\r\n            const value = (e.target as HTMLSelectElement).value;\r\n            onPatch(row.key, { verboseLevel: value || null });\r\n          }}\r\n        >\r\n          ${verboseLevels.map(\r\n            (level) =>\r\n              html`<option value=${level.value} ?selected=${verbose === level.value}>\r\n                ${level.label}\r\n              </option>`,\r\n          )}\r\n        </select>\r\n      </div>\r\n      <div>\r\n        <select\r\n          ?disabled=${disabled}\r\n          @change=${(e: Event) => {\r\n            const value = (e.target as HTMLSelectElement).value;\r\n            onPatch(row.key, { reasoningLevel: value || null });\r\n          }}\r\n        >\r\n          ${reasoningLevels.map(\r\n            (level) =>\r\n              html`<option value=${level} ?selected=${reasoning === level}>\r\n                ${level || \"inherit\"}\r\n              </option>`,\r\n          )}\r\n        </select>\r\n      </div>\r\n      <div>\r\n        <button class=\"btn danger\" ?disabled=${disabled} @click=${() => onDelete(row.key)}>\r\n          Delete\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","import { html, nothing } from \"lit\";\r\nimport type { SkillMessageMap } from \"../controllers/skills.ts\";\r\nimport type { SkillStatusEntry, SkillStatusReport } from \"../types.ts\";\r\nimport { clampText } from \"../format.ts\";\r\n\r\ntype SkillGroup = {\r\n  id: string;\r\n  label: string;\r\n  skills: SkillStatusEntry[];\r\n};\r\n\r\nconst SKILL_SOURCE_GROUPS: Array<{ id: string; label: string; sources: string[] }> = [\r\n  { id: \"workspace\", label: \"Workspace Skills\", sources: [\"openclaw-workspace\"] },\r\n  { id: \"built-in\", label: \"Built-in Skills\", sources: [\"openclaw-bundled\"] },\r\n  { id: \"installed\", label: \"Installed Skills\", sources: [\"openclaw-managed\"] },\r\n  { id: \"extra\", label: \"Extra Skills\", sources: [\"openclaw-extra\"] },\r\n];\r\n\r\nfunction groupSkills(skills: SkillStatusEntry[]): SkillGroup[] {\r\n  const groups = new Map<string, SkillGroup>();\r\n  for (const def of SKILL_SOURCE_GROUPS) {\r\n    groups.set(def.id, { id: def.id, label: def.label, skills: [] });\r\n  }\r\n  const builtInGroup = SKILL_SOURCE_GROUPS.find((group) => group.id === \"built-in\");\r\n  const other: SkillGroup = { id: \"other\", label: \"Other Skills\", skills: [] };\r\n  for (const skill of skills) {\r\n    const match = skill.bundled\r\n      ? builtInGroup\r\n      : SKILL_SOURCE_GROUPS.find((group) => group.sources.includes(skill.source));\r\n    if (match) {\r\n      groups.get(match.id)?.skills.push(skill);\r\n    } else {\r\n      other.skills.push(skill);\r\n    }\r\n  }\r\n  const ordered = SKILL_SOURCE_GROUPS.map((group) => groups.get(group.id)).filter(\r\n    (group): group is SkillGroup => Boolean(group && group.skills.length > 0),\r\n  );\r\n  if (other.skills.length > 0) {\r\n    ordered.push(other);\r\n  }\r\n  return ordered;\r\n}\r\n\r\nexport type SkillsProps = {\r\n  loading: boolean;\r\n  report: SkillStatusReport | null;\r\n  error: string | null;\r\n  filter: string;\r\n  edits: Record<string, string>;\r\n  busyKey: string | null;\r\n  messages: SkillMessageMap;\r\n  onFilterChange: (next: string) => void;\r\n  onRefresh: () => void;\r\n  onToggle: (skillKey: string, enabled: boolean) => void;\r\n  onEdit: (skillKey: string, value: string) => void;\r\n  onSaveKey: (skillKey: string) => void;\r\n  onInstall: (skillKey: string, name: string, installId: string) => void;\r\n};\r\n\r\nexport function renderSkills(props: SkillsProps) {\r\n  const skills = props.report?.skills ?? [];\r\n  const filter = props.filter.trim().toLowerCase();\r\n  const filtered = filter\r\n    ? skills.filter((skill) =>\r\n        [skill.name, skill.description, skill.source].join(\" \").toLowerCase().includes(filter),\r\n      )\r\n    : skills;\r\n  const groups = groupSkills(filtered);\r\n\r\n  return html`\r\n    <section class=\"card\">\r\n      <div class=\"row\" style=\"justify-content: space-between;\">\r\n        <div>\r\n          <div class=\"card-title\">Skills</div>\r\n          <div class=\"card-sub\">Bundled, managed, and workspace skills.</div>\r\n        </div>\r\n        <button class=\"btn\" ?disabled=${props.loading} @click=${props.onRefresh}>\r\n          ${props.loading ? \"Loading…\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"filters\" style=\"margin-top: 14px;\">\r\n        <label class=\"field\" style=\"flex: 1;\">\r\n          <span>Filter</span>\r\n          <input\r\n            .value=${props.filter}\r\n            @input=${(e: Event) => props.onFilterChange((e.target as HTMLInputElement).value)}\r\n            placeholder=\"Search skills\"\r\n          />\r\n        </label>\r\n        <div class=\"muted\">${filtered.length} shown</div>\r\n      </div>\r\n\r\n      ${\r\n        props.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        filtered.length === 0\r\n          ? html`\r\n              <div class=\"muted\" style=\"margin-top: 16px\">No skills found.</div>\r\n            `\r\n          : html`\r\n            <div class=\"agent-skills-groups\" style=\"margin-top: 16px;\">\r\n              ${groups.map((group) => {\r\n                const collapsedByDefault = group.id === \"workspace\" || group.id === \"built-in\";\r\n                return html`\r\n                  <details class=\"agent-skills-group\" ?open=${!collapsedByDefault}>\r\n                    <summary class=\"agent-skills-header\">\r\n                      <span>${group.label}</span>\r\n                      <span class=\"muted\">${group.skills.length}</span>\r\n                    </summary>\r\n                    <div class=\"list skills-grid\">\r\n                      ${group.skills.map((skill) => renderSkill(skill, props))}\r\n                    </div>\r\n                  </details>\r\n                `;\r\n              })}\r\n            </div>\r\n          `\r\n      }\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderSkill(skill: SkillStatusEntry, props: SkillsProps) {\r\n  const busy = props.busyKey === skill.skillKey;\r\n  const apiKey = props.edits[skill.skillKey] ?? \"\";\r\n  const message = props.messages[skill.skillKey] ?? null;\r\n  const canInstall = skill.install.length > 0 && skill.missing.bins.length > 0;\r\n  const showBundledBadge = Boolean(skill.bundled && skill.source !== \"openclaw-bundled\");\r\n  const missing = [\r\n    ...skill.missing.bins.map((b) => `bin:${b}`),\r\n    ...skill.missing.env.map((e) => `env:${e}`),\r\n    ...skill.missing.config.map((c) => `config:${c}`),\r\n    ...skill.missing.os.map((o) => `os:${o}`),\r\n  ];\r\n  const reasons: string[] = [];\r\n  if (skill.disabled) {\r\n    reasons.push(\"disabled\");\r\n  }\r\n  if (skill.blockedByAllowlist) {\r\n    reasons.push(\"blocked by allowlist\");\r\n  }\r\n  return html`\r\n    <div class=\"list-item\">\r\n      <div class=\"list-main\">\r\n        <div class=\"list-title\">\r\n          ${skill.emoji ? `${skill.emoji} ` : \"\"}${skill.name}\r\n        </div>\r\n        <div class=\"list-sub\">${clampText(skill.description, 140)}</div>\r\n        <div class=\"chip-row\" style=\"margin-top: 6px;\">\r\n          <span class=\"chip\">${skill.source}</span>\r\n          ${\r\n            showBundledBadge\r\n              ? html`\r\n                  <span class=\"chip\">bundled</span>\r\n                `\r\n              : nothing\r\n          }\r\n          <span class=\"chip ${skill.eligible ? \"chip-ok\" : \"chip-warn\"}\">\r\n            ${skill.eligible ? \"eligible\" : \"blocked\"}\r\n          </span>\r\n          ${\r\n            skill.disabled\r\n              ? html`\r\n                  <span class=\"chip chip-warn\">disabled</span>\r\n                `\r\n              : nothing\r\n          }\r\n        </div>\r\n        ${\r\n          missing.length > 0\r\n            ? html`\r\n              <div class=\"muted\" style=\"margin-top: 6px;\">\r\n                Missing: ${missing.join(\", \")}\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n        ${\r\n          reasons.length > 0\r\n            ? html`\r\n              <div class=\"muted\" style=\"margin-top: 6px;\">\r\n                Reason: ${reasons.join(\", \")}\r\n              </div>\r\n            `\r\n            : nothing\r\n        }\r\n      </div>\r\n      <div class=\"list-meta\">\r\n        <div class=\"row\" style=\"justify-content: flex-end; flex-wrap: wrap;\">\r\n          <button\r\n            class=\"btn\"\r\n            ?disabled=${busy}\r\n            @click=${() => props.onToggle(skill.skillKey, skill.disabled)}\r\n          >\r\n            ${skill.disabled ? \"Enable\" : \"Disable\"}\r\n          </button>\r\n          ${\r\n            canInstall\r\n              ? html`<button\r\n                class=\"btn\"\r\n                ?disabled=${busy}\r\n                @click=${() => props.onInstall(skill.skillKey, skill.name, skill.install[0].id)}\r\n              >\r\n                ${busy ? \"Installing…\" : skill.install[0].label}\r\n              </button>`\r\n              : nothing\r\n          }\r\n        </div>\r\n        ${\r\n          message\r\n            ? html`<div\r\n              class=\"muted\"\r\n              style=\"margin-top: 8px; color: ${\r\n                message.kind === \"error\"\r\n                  ? \"var(--danger-color, #d14343)\"\r\n                  : \"var(--success-color, #0a7f5a)\"\r\n              };\"\r\n            >\r\n              ${message.message}\r\n            </div>`\r\n            : nothing\r\n        }\r\n        ${\r\n          skill.primaryEnv\r\n            ? html`\r\n              <div class=\"field\" style=\"margin-top: 10px;\">\r\n                <span>API key</span>\r\n                <input\r\n                  type=\"password\"\r\n                  .value=${apiKey}\r\n                  @input=${(e: Event) =>\r\n                    props.onEdit(skill.skillKey, (e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <button\r\n                class=\"btn primary\"\r\n                style=\"margin-top: 8px;\"\r\n                ?disabled=${busy}\r\n                @click=${() => props.onSaveKey(skill.skillKey)}\r\n              >\r\n                Save key\r\n              </button>\r\n            `\r\n            : nothing\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n","export type UsageQueryTerm = {\r\n  key?: string;\r\n  value: string;\r\n  raw: string;\r\n};\r\n\r\nexport type UsageQueryResult<TSession> = {\r\n  sessions: TSession[];\r\n  warnings: string[];\r\n};\r\n\r\n// Minimal shape required for query filtering. The usage view's real session type contains more fields.\r\nexport type UsageSessionQueryTarget = {\r\n  key: string;\r\n  label?: string;\r\n  sessionId?: string;\r\n  agentId?: string;\r\n  channel?: string;\r\n  chatType?: string;\r\n  modelProvider?: string;\r\n  providerOverride?: string;\r\n  origin?: { provider?: string };\r\n  model?: string;\r\n  contextWeight?: unknown;\r\n  usage?: {\r\n    totalTokens?: number;\r\n    totalCost?: number;\r\n    messageCounts?: { total?: number; errors?: number };\r\n    toolUsage?: { totalCalls?: number; tools?: Array<{ name: string }> };\r\n    modelUsage?: Array<{ provider?: string; model?: string }>;\r\n  } | null;\r\n};\r\n\r\nconst QUERY_KEYS = new Set([\r\n  \"agent\",\r\n  \"channel\",\r\n  \"chat\",\r\n  \"provider\",\r\n  \"model\",\r\n  \"tool\",\r\n  \"label\",\r\n  \"key\",\r\n  \"session\",\r\n  \"id\",\r\n  \"has\",\r\n  \"mintokens\",\r\n  \"maxtokens\",\r\n  \"mincost\",\r\n  \"maxcost\",\r\n  \"minmessages\",\r\n  \"maxmessages\",\r\n]);\r\n\r\nconst normalizeQueryText = (value: string): string => value.trim().toLowerCase();\r\n\r\nconst globToRegex = (pattern: string): RegExp => {\r\n  const escaped = pattern\r\n    .replace(/[.+^${}()|[\\]\\\\]/g, \"\\\\$&\")\r\n    .replace(/\\*/g, \".*\")\r\n    .replace(/\\?/g, \".\");\r\n  return new RegExp(`^${escaped}$`, \"i\");\r\n};\r\n\r\nconst parseQueryNumber = (value: string): number | null => {\r\n  let raw = value.trim().toLowerCase();\r\n  if (!raw) {\r\n    return null;\r\n  }\r\n  if (raw.startsWith(\"$\")) {\r\n    raw = raw.slice(1);\r\n  }\r\n  let multiplier = 1;\r\n  if (raw.endsWith(\"k\")) {\r\n    multiplier = 1_000;\r\n    raw = raw.slice(0, -1);\r\n  } else if (raw.endsWith(\"m\")) {\r\n    multiplier = 1_000_000;\r\n    raw = raw.slice(0, -1);\r\n  }\r\n  const parsed = Number(raw);\r\n  if (!Number.isFinite(parsed)) {\r\n    return null;\r\n  }\r\n  return parsed * multiplier;\r\n};\r\n\r\nexport const extractQueryTerms = (query: string): UsageQueryTerm[] => {\r\n  // Tokenize by whitespace, but allow quoted values with spaces.\r\n  const rawTokens = query.match(/\"[^\"]+\"|\\S+/g) ?? [];\r\n  return rawTokens.map((token) => {\r\n    const cleaned = token.replace(/^\"|\"$/g, \"\");\r\n    const idx = cleaned.indexOf(\":\");\r\n    if (idx > 0) {\r\n      const key = cleaned.slice(0, idx);\r\n      const value = cleaned.slice(idx + 1);\r\n      return { key, value, raw: cleaned };\r\n    }\r\n    return { value: cleaned, raw: cleaned };\r\n  });\r\n};\r\n\r\nconst getSessionText = (session: UsageSessionQueryTarget): string[] => {\r\n  const items: Array<string | undefined> = [session.label, session.key, session.sessionId];\r\n  return items.filter((item): item is string => Boolean(item)).map((item) => item.toLowerCase());\r\n};\r\n\r\nconst getSessionProviders = (session: UsageSessionQueryTarget): string[] => {\r\n  const providers = new Set<string>();\r\n  if (session.modelProvider) {\r\n    providers.add(session.modelProvider.toLowerCase());\r\n  }\r\n  if (session.providerOverride) {\r\n    providers.add(session.providerOverride.toLowerCase());\r\n  }\r\n  if (session.origin?.provider) {\r\n    providers.add(session.origin.provider.toLowerCase());\r\n  }\r\n  for (const entry of session.usage?.modelUsage ?? []) {\r\n    if (entry.provider) {\r\n      providers.add(entry.provider.toLowerCase());\r\n    }\r\n  }\r\n  return Array.from(providers);\r\n};\r\n\r\nconst getSessionModels = (session: UsageSessionQueryTarget): string[] => {\r\n  const models = new Set<string>();\r\n  if (session.model) {\r\n    models.add(session.model.toLowerCase());\r\n  }\r\n  for (const entry of session.usage?.modelUsage ?? []) {\r\n    if (entry.model) {\r\n      models.add(entry.model.toLowerCase());\r\n    }\r\n  }\r\n  return Array.from(models);\r\n};\r\n\r\nconst getSessionTools = (session: UsageSessionQueryTarget): string[] =>\r\n  (session.usage?.toolUsage?.tools ?? []).map((tool) => tool.name.toLowerCase());\r\n\r\nexport const matchesUsageQuery = (\r\n  session: UsageSessionQueryTarget,\r\n  term: UsageQueryTerm,\r\n): boolean => {\r\n  const value = normalizeQueryText(term.value ?? \"\");\r\n  if (!value) {\r\n    return true;\r\n  }\r\n  if (!term.key) {\r\n    return getSessionText(session).some((text) => text.includes(value));\r\n  }\r\n\r\n  const key = normalizeQueryText(term.key);\r\n  switch (key) {\r\n    case \"agent\":\r\n      return session.agentId?.toLowerCase().includes(value) ?? false;\r\n    case \"channel\":\r\n      return session.channel?.toLowerCase().includes(value) ?? false;\r\n    case \"chat\":\r\n      return session.chatType?.toLowerCase().includes(value) ?? false;\r\n    case \"provider\":\r\n      return getSessionProviders(session).some((provider) => provider.includes(value));\r\n    case \"model\":\r\n      return getSessionModels(session).some((model) => model.includes(value));\r\n    case \"tool\":\r\n      return getSessionTools(session).some((tool) => tool.includes(value));\r\n    case \"label\":\r\n      return session.label?.toLowerCase().includes(value) ?? false;\r\n    case \"key\":\r\n    case \"session\":\r\n    case \"id\":\r\n      if (value.includes(\"*\") || value.includes(\"?\")) {\r\n        const regex = globToRegex(value);\r\n        return (\r\n          regex.test(session.key) || (session.sessionId ? regex.test(session.sessionId) : false)\r\n        );\r\n      }\r\n      return (\r\n        session.key.toLowerCase().includes(value) ||\r\n        (session.sessionId?.toLowerCase().includes(value) ?? false)\r\n      );\r\n    case \"has\":\r\n      switch (value) {\r\n        case \"tools\":\r\n          return (session.usage?.toolUsage?.totalCalls ?? 0) > 0;\r\n        case \"errors\":\r\n          return (session.usage?.messageCounts?.errors ?? 0) > 0;\r\n        case \"context\":\r\n          return Boolean(session.contextWeight);\r\n        case \"usage\":\r\n          return Boolean(session.usage);\r\n        case \"model\":\r\n          return getSessionModels(session).length > 0;\r\n        case \"provider\":\r\n          return getSessionProviders(session).length > 0;\r\n        default:\r\n          return true;\r\n      }\r\n    case \"mintokens\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.totalTokens ?? 0) >= threshold;\r\n    }\r\n    case \"maxtokens\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.totalTokens ?? 0) <= threshold;\r\n    }\r\n    case \"mincost\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.totalCost ?? 0) >= threshold;\r\n    }\r\n    case \"maxcost\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.totalCost ?? 0) <= threshold;\r\n    }\r\n    case \"minmessages\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.messageCounts?.total ?? 0) >= threshold;\r\n    }\r\n    case \"maxmessages\": {\r\n      const threshold = parseQueryNumber(value);\r\n      if (threshold === null) {\r\n        return true;\r\n      }\r\n      return (session.usage?.messageCounts?.total ?? 0) <= threshold;\r\n    }\r\n    default:\r\n      return true;\r\n  }\r\n};\r\n\r\nexport const filterSessionsByQuery = <TSession extends UsageSessionQueryTarget>(\r\n  sessions: TSession[],\r\n  query: string,\r\n): UsageQueryResult<TSession> => {\r\n  const terms = extractQueryTerms(query);\r\n  if (terms.length === 0) {\r\n    return { sessions, warnings: [] };\r\n  }\r\n\r\n  const warnings: string[] = [];\r\n  for (const term of terms) {\r\n    if (!term.key) {\r\n      continue;\r\n    }\r\n    const normalizedKey = normalizeQueryText(term.key);\r\n    if (!QUERY_KEYS.has(normalizedKey)) {\r\n      warnings.push(`Unknown filter: ${term.key}`);\r\n      continue;\r\n    }\r\n    if (term.value === \"\") {\r\n      warnings.push(`Missing value for ${term.key}`);\r\n    }\r\n    if (normalizedKey === \"has\") {\r\n      const allowed = new Set([\"tools\", \"errors\", \"context\", \"usage\", \"model\", \"provider\"]);\r\n      if (term.value && !allowed.has(normalizeQueryText(term.value))) {\r\n        warnings.push(`Unknown has:${term.value}`);\r\n      }\r\n    }\r\n    if (\r\n      [\"mintokens\", \"maxtokens\", \"mincost\", \"maxcost\", \"minmessages\", \"maxmessages\"].includes(\r\n        normalizedKey,\r\n      )\r\n    ) {\r\n      if (term.value && parseQueryNumber(term.value) === null) {\r\n        warnings.push(`Invalid number for ${term.key}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  const filtered = sessions.filter((session) =>\r\n    terms.every((term) => matchesUsageQuery(session, term)),\r\n  );\r\n  return { sessions: filtered, warnings };\r\n};\r\n\r\nexport function parseToolSummary(content: string) {\r\n  const lines = content.split(\"\\n\");\r\n  const toolCounts = new Map<string, number>();\r\n  const nonToolLines: string[] = [];\r\n  for (const line of lines) {\r\n    const match = /^\\[Tool:\\s*([^\\]]+)\\]/.exec(line.trim());\r\n    if (match) {\r\n      const name = match[1];\r\n      toolCounts.set(name, (toolCounts.get(name) ?? 0) + 1);\r\n      continue;\r\n    }\r\n    if (line.trim().startsWith(\"[Tool Result]\")) {\r\n      continue;\r\n    }\r\n    nonToolLines.push(line);\r\n  }\r\n  const sortedTools = Array.from(toolCounts.entries()).toSorted((a, b) => b[1] - a[1]);\r\n  const totalCalls = sortedTools.reduce((sum, [, count]) => sum + count, 0);\r\n  const summary =\r\n    sortedTools.length > 0\r\n      ? `Tools: ${sortedTools\r\n          .map(([name, count]) => `${name}×${count}`)\r\n          .join(\", \")} (${totalCalls} calls)`\r\n      : \"\";\r\n  return {\r\n    tools: sortedTools,\r\n    summary,\r\n    cleanContent: nonToolLines.join(\"\\n\").trim(),\r\n  };\r\n}\r\n","export const usageStylesString = `\r\n  .usage-page-header {\r\n    margin: 4px 0 12px;\r\n  }\r\n  .usage-page-title {\r\n    font-size: 28px;\r\n    font-weight: 700;\r\n    letter-spacing: -0.02em;\r\n    margin-bottom: 4px;\r\n  }\r\n  .usage-page-subtitle {\r\n    font-size: 13px;\r\n    color: var(--text-muted);\r\n    margin: 0 0 12px;\r\n  }\r\n  /* ===== FILTERS & HEADER ===== */\r\n  .usage-filters-inline {\r\n    display: flex;\r\n    gap: 8px;\r\n    align-items: center;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-filters-inline select {\r\n    padding: 6px 10px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 13px;\r\n  }\r\n  .usage-filters-inline input[type=\"date\"] {\r\n    padding: 6px 10px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 13px;\r\n  }\r\n  .usage-filters-inline input[type=\"text\"] {\r\n    padding: 6px 10px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 13px;\r\n    min-width: 180px;\r\n  }\r\n  .usage-filters-inline .btn-sm {\r\n    padding: 6px 12px;\r\n    font-size: 14px;\r\n  }\r\n  .usage-refresh-indicator {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 4px 10px;\r\n    background: rgba(255, 77, 77, 0.1);\r\n    border-radius: 4px;\r\n    font-size: 12px;\r\n    color: #ff4d4d;\r\n  }\r\n  .usage-refresh-indicator::before {\r\n    content: \"\";\r\n    width: 10px;\r\n    height: 10px;\r\n    border: 2px solid #ff4d4d;\r\n    border-top-color: transparent;\r\n    border-radius: 50%;\r\n    animation: usage-spin 0.6s linear infinite;\r\n  }\r\n  @keyframes usage-spin {\r\n    to { transform: rotate(360deg); }\r\n  }\r\n  .active-filters {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .filter-chip {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 4px 8px 4px 12px;\r\n    background: var(--accent-subtle);\r\n    border: 1px solid var(--accent);\r\n    border-radius: 16px;\r\n    font-size: 12px;\r\n  }\r\n  .filter-chip-label {\r\n    color: var(--accent);\r\n    font-weight: 500;\r\n  }\r\n  .filter-chip-remove {\r\n    background: none;\r\n    border: none;\r\n    color: var(--accent);\r\n    cursor: pointer;\r\n    padding: 2px 4px;\r\n    font-size: 14px;\r\n    line-height: 1;\r\n    opacity: 0.7;\r\n    transition: opacity 0.15s;\r\n  }\r\n  .filter-chip-remove:hover {\r\n    opacity: 1;\r\n  }\r\n  .filter-clear-btn {\r\n    padding: 4px 10px !important;\r\n    font-size: 12px !important;\r\n    line-height: 1 !important;\r\n    margin-left: 8px;\r\n  }\r\n  .usage-query-bar {\r\n    display: grid;\r\n    grid-template-columns: minmax(220px, 1fr) auto;\r\n    gap: 10px;\r\n    align-items: center;\r\n    /* Keep the dropdown filter row from visually touching the query row. */\r\n    margin-bottom: 10px;\r\n  }\r\n  .usage-query-actions {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    flex-wrap: nowrap;\r\n    justify-self: end;\r\n  }\r\n  .usage-query-actions .btn {\r\n    height: 34px;\r\n    padding: 0 14px;\r\n    border-radius: 999px;\r\n    font-weight: 600;\r\n    font-size: 13px;\r\n    line-height: 1;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    color: var(--text);\r\n    box-shadow: none;\r\n    transition: background 0.15s, border-color 0.15s, color 0.15s;\r\n  }\r\n  .usage-query-actions .btn:hover {\r\n    background: var(--bg);\r\n    border-color: var(--border-strong);\r\n  }\r\n  .usage-action-btn {\r\n    height: 34px;\r\n    padding: 0 14px;\r\n    border-radius: 999px;\r\n    font-weight: 600;\r\n    font-size: 13px;\r\n    line-height: 1;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    color: var(--text);\r\n    box-shadow: none;\r\n    transition: background 0.15s, border-color 0.15s, color 0.15s;\r\n  }\r\n  .usage-action-btn:hover {\r\n    background: var(--bg);\r\n    border-color: var(--border-strong);\r\n  }\r\n  .usage-primary-btn {\r\n    background: #ff4d4d;\r\n    color: #fff;\r\n    border-color: #ff4d4d;\r\n    box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.12);\r\n  }\r\n  .btn.usage-primary-btn {\r\n    background: #ff4d4d !important;\r\n    border-color: #ff4d4d !important;\r\n    color: #fff !important;\r\n  }\r\n  .usage-primary-btn:hover {\r\n    background: #e64545;\r\n    border-color: #e64545;\r\n  }\r\n  .btn.usage-primary-btn:hover {\r\n    background: #e64545 !important;\r\n    border-color: #e64545 !important;\r\n  }\r\n  .usage-primary-btn:disabled {\r\n    background: rgba(255, 77, 77, 0.18);\r\n    border-color: rgba(255, 77, 77, 0.3);\r\n    color: #ff4d4d;\r\n    box-shadow: none;\r\n    cursor: default;\r\n    opacity: 1;\r\n  }\r\n  .usage-primary-btn[disabled] {\r\n    background: rgba(255, 77, 77, 0.18) !important;\r\n    border-color: rgba(255, 77, 77, 0.3) !important;\r\n    color: #ff4d4d !important;\r\n    opacity: 1 !important;\r\n  }\r\n  .usage-secondary-btn {\r\n    background: var(--bg-secondary);\r\n    color: var(--text);\r\n    border-color: var(--border);\r\n  }\r\n  .usage-query-input {\r\n    width: 100%;\r\n    min-width: 220px;\r\n    padding: 6px 10px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 13px;\r\n  }\r\n  .usage-query-suggestions {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 6px;\r\n    margin-top: 6px;\r\n  }\r\n  .usage-query-suggestion {\r\n    padding: 4px 8px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    font-size: 11px;\r\n    color: var(--text);\r\n    cursor: pointer;\r\n    transition: background 0.15s;\r\n  }\r\n  .usage-query-suggestion:hover {\r\n    background: var(--bg-hover);\r\n  }\r\n  .usage-filter-row {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 8px;\r\n    align-items: center;\r\n    margin-top: 14px;\r\n  }\r\n  details.usage-filter-select {\r\n    position: relative;\r\n    border: 1px solid var(--border);\r\n    border-radius: 10px;\r\n    padding: 6px 10px;\r\n    background: var(--bg);\r\n    font-size: 12px;\r\n    min-width: 140px;\r\n  }\r\n  details.usage-filter-select summary {\r\n    cursor: pointer;\r\n    list-style: none;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    gap: 6px;\r\n    font-weight: 500;\r\n  }\r\n  details.usage-filter-select summary::-webkit-details-marker {\r\n    display: none;\r\n  }\r\n  .usage-filter-badge {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-filter-popover {\r\n    position: absolute;\r\n    left: 0;\r\n    top: calc(100% + 6px);\r\n    background: var(--bg);\r\n    border: 1px solid var(--border);\r\n    border-radius: 10px;\r\n    padding: 10px;\r\n    box-shadow: 0 10px 30px rgba(0,0,0,0.08);\r\n    min-width: 220px;\r\n    z-index: 20;\r\n  }\r\n  .usage-filter-actions {\r\n    display: flex;\r\n    gap: 6px;\r\n    margin-bottom: 8px;\r\n  }\r\n  .usage-filter-actions button {\r\n    border-radius: 999px;\r\n    padding: 4px 10px;\r\n    font-size: 11px;\r\n  }\r\n  .usage-filter-options {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 6px;\r\n    max-height: 200px;\r\n    overflow: auto;\r\n  }\r\n  .usage-filter-option {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-size: 12px;\r\n  }\r\n  .usage-query-hint {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-query-chips {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 6px;\r\n    margin-top: 6px;\r\n  }\r\n  .usage-query-chip {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 4px 8px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    font-size: 11px;\r\n  }\r\n  .usage-query-chip button {\r\n    background: none;\r\n    border: none;\r\n    color: var(--text-muted);\r\n    cursor: pointer;\r\n    padding: 0;\r\n    line-height: 1;\r\n  }\r\n  .usage-header {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n    background: var(--bg);\r\n  }\r\n  .usage-header.pinned {\r\n    position: sticky;\r\n    top: 12px;\r\n    z-index: 6;\r\n    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);\r\n  }\r\n  .usage-pin-btn {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 4px 8px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    font-size: 11px;\r\n    color: var(--text);\r\n    cursor: pointer;\r\n  }\r\n  .usage-pin-btn.active {\r\n    background: var(--accent-subtle);\r\n    border-color: var(--accent);\r\n    color: var(--accent);\r\n  }\r\n  .usage-header-row {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    gap: 12px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-header-title {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10px;\r\n  }\r\n  .usage-header-metrics {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-metric-badge {\r\n    display: inline-flex;\r\n    align-items: baseline;\r\n    gap: 6px;\r\n    padding: 2px 8px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: transparent;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-metric-badge strong {\r\n    font-size: 12px;\r\n    color: var(--text);\r\n  }\r\n  .usage-controls {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-controls .active-filters {\r\n    flex: 1 1 100%;\r\n  }\r\n  .usage-controls input[type=\"date\"] {\r\n    min-width: 140px;\r\n  }\r\n  .usage-presets {\r\n    display: inline-flex;\r\n    gap: 6px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-presets .btn {\r\n    padding: 4px 8px;\r\n    font-size: 11px;\r\n  }\r\n  .usage-quick-filters {\r\n    display: flex;\r\n    gap: 8px;\r\n    align-items: center;\r\n    flex-wrap: wrap;\r\n  }\r\n  .usage-select {\r\n    min-width: 120px;\r\n    padding: 6px 10px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 12px;\r\n  }\r\n  .usage-export-menu summary {\r\n    cursor: pointer;\r\n    font-weight: 500;\r\n    color: var(--text);\r\n    list-style: none;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n  }\r\n  .usage-export-menu summary::-webkit-details-marker {\r\n    display: none;\r\n  }\r\n  .usage-export-menu {\r\n    position: relative;\r\n  }\r\n  .usage-export-button {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 6px 10px;\r\n    border-radius: 8px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg);\r\n    font-size: 12px;\r\n  }\r\n  .usage-export-popover {\r\n    position: absolute;\r\n    right: 0;\r\n    top: calc(100% + 6px);\r\n    background: var(--bg);\r\n    border: 1px solid var(--border);\r\n    border-radius: 10px;\r\n    padding: 8px;\r\n    box-shadow: 0 10px 30px rgba(0,0,0,0.08);\r\n    min-width: 160px;\r\n    z-index: 10;\r\n  }\r\n  .usage-export-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 6px;\r\n  }\r\n  .usage-export-item {\r\n    text-align: left;\r\n    padding: 6px 10px;\r\n    border-radius: 8px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    font-size: 12px;\r\n  }\r\n  .usage-summary-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\r\n    gap: 12px;\r\n    margin-top: 12px;\r\n  }\r\n  .usage-summary-card {\r\n    padding: 12px;\r\n    border-radius: 8px;\r\n    background: var(--bg-secondary);\r\n    border: 1px solid var(--border);\r\n  }\r\n  .usage-mosaic {\r\n    margin-top: 16px;\r\n    padding: 16px;\r\n  }\r\n  .usage-mosaic-header {\r\n    display: flex;\r\n    align-items: baseline;\r\n    justify-content: space-between;\r\n    gap: 12px;\r\n    margin-bottom: 12px;\r\n  }\r\n  .usage-mosaic-title {\r\n    font-weight: 600;\r\n  }\r\n  .usage-mosaic-sub {\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-mosaic-grid {\r\n    display: grid;\r\n    grid-template-columns: minmax(200px, 1fr) minmax(260px, 2fr);\r\n    gap: 16px;\r\n    align-items: start;\r\n  }\r\n  .usage-mosaic-section {\r\n    background: var(--bg-subtle);\r\n    border: 1px solid var(--border);\r\n    border-radius: 10px;\r\n    padding: 12px;\r\n  }\r\n  .usage-mosaic-section-title {\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    margin-bottom: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n  }\r\n  .usage-mosaic-total {\r\n    font-size: 20px;\r\n    font-weight: 700;\r\n  }\r\n  .usage-daypart-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));\r\n    gap: 8px;\r\n  }\r\n  .usage-daypart-cell {\r\n    border-radius: 8px;\r\n    padding: 10px;\r\n    color: var(--text);\r\n    background: rgba(255, 77, 77, 0.08);\r\n    border: 1px solid rgba(255, 77, 77, 0.2);\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 4px;\r\n  }\r\n  .usage-daypart-label {\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n  }\r\n  .usage-daypart-value {\r\n    font-size: 14px;\r\n  }\r\n  .usage-hour-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(24, minmax(6px, 1fr));\r\n    gap: 4px;\r\n  }\r\n  .usage-hour-cell {\r\n    height: 28px;\r\n    border-radius: 6px;\r\n    background: rgba(255, 77, 77, 0.1);\r\n    border: 1px solid rgba(255, 77, 77, 0.2);\r\n    cursor: pointer;\r\n    transition: border-color 0.15s, box-shadow 0.15s;\r\n  }\r\n  .usage-hour-cell.selected {\r\n    border-color: rgba(255, 77, 77, 0.8);\r\n    box-shadow: 0 0 0 2px rgba(255, 77, 77, 0.2);\r\n  }\r\n  .usage-hour-labels {\r\n    display: grid;\r\n    grid-template-columns: repeat(6, minmax(0, 1fr));\r\n    gap: 6px;\r\n    margin-top: 8px;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-hour-legend {\r\n    display: flex;\r\n    gap: 8px;\r\n    align-items: center;\r\n    margin-top: 10px;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-hour-legend span {\r\n    display: inline-block;\r\n    width: 14px;\r\n    height: 10px;\r\n    border-radius: 4px;\r\n    background: rgba(255, 77, 77, 0.15);\r\n    border: 1px solid rgba(255, 77, 77, 0.2);\r\n  }\r\n  .usage-calendar-labels {\r\n    display: grid;\r\n    grid-template-columns: repeat(7, minmax(10px, 1fr));\r\n    gap: 6px;\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    margin-bottom: 6px;\r\n  }\r\n  .usage-calendar {\r\n    display: grid;\r\n    grid-template-columns: repeat(7, minmax(10px, 1fr));\r\n    gap: 6px;\r\n  }\r\n  .usage-calendar-cell {\r\n    height: 18px;\r\n    border-radius: 4px;\r\n    border: 1px solid rgba(255, 77, 77, 0.2);\r\n    background: rgba(255, 77, 77, 0.08);\r\n  }\r\n  .usage-calendar-cell.empty {\r\n    background: transparent;\r\n    border-color: transparent;\r\n  }\r\n  .usage-summary-title {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-bottom: 6px;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n  }\r\n  .usage-info {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 16px;\r\n    height: 16px;\r\n    margin-left: 6px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg);\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    cursor: help;\r\n  }\r\n  .usage-summary-value {\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: var(--text-strong);\r\n  }\r\n  .usage-summary-value.good {\r\n    color: #1f8f4e;\r\n  }\r\n  .usage-summary-value.warn {\r\n    color: #c57a00;\r\n  }\r\n  .usage-summary-value.bad {\r\n    color: #c9372c;\r\n  }\r\n  .usage-summary-hint {\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    cursor: help;\r\n    border: 1px solid var(--border);\r\n    border-radius: 999px;\r\n    padding: 0 6px;\r\n    line-height: 16px;\r\n    height: 16px;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .usage-summary-sub {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-top: 4px;\r\n  }\r\n  .usage-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8px;\r\n  }\r\n  .usage-list-item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    gap: 12px;\r\n    font-size: 12px;\r\n    color: var(--text);\r\n    align-items: flex-start;\r\n  }\r\n  .usage-list-value {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: flex-end;\r\n    gap: 2px;\r\n    text-align: right;\r\n  }\r\n  .usage-list-sub {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-list-item.button {\r\n    border: none;\r\n    background: transparent;\r\n    padding: 0;\r\n    text-align: left;\r\n    cursor: pointer;\r\n  }\r\n  .usage-list-item.button:hover {\r\n    color: var(--text-strong);\r\n  }\r\n  .usage-list-item .muted {\r\n    font-size: 11px;\r\n  }\r\n  .usage-error-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n  }\r\n  .usage-error-row {\r\n    display: grid;\r\n    grid-template-columns: 1fr auto;\r\n    gap: 8px;\r\n    align-items: center;\r\n    font-size: 12px;\r\n  }\r\n  .usage-error-date {\r\n    font-weight: 600;\r\n  }\r\n  .usage-error-rate {\r\n    font-variant-numeric: tabular-nums;\r\n  }\r\n  .usage-error-sub {\r\n    grid-column: 1 / -1;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n  }\r\n  .usage-badges {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 6px;\r\n    margin-bottom: 8px;\r\n  }\r\n  .usage-badge {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 2px 8px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 999px;\r\n    font-size: 11px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n  }\r\n  .usage-meta-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n    gap: 12px;\r\n  }\r\n  .usage-meta-item {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 4px;\r\n    font-size: 12px;\r\n  }\r\n  .usage-meta-item span {\r\n    color: var(--text-muted);\r\n    font-size: 11px;\r\n  }\r\n  .usage-insights-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n    gap: 16px;\r\n    margin-top: 12px;\r\n  }\r\n  .usage-insight-card {\r\n    padding: 14px;\r\n    border-radius: 10px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n  }\r\n  .usage-insight-title {\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    margin-bottom: 10px;\r\n  }\r\n  .usage-insight-subtitle {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-top: 6px;\r\n  }\r\n  /* ===== CHART TOGGLE ===== */\r\n  .chart-toggle {\r\n    display: flex;\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    overflow: hidden;\r\n    border: 1px solid var(--border);\r\n  }\r\n  .chart-toggle .toggle-btn {\r\n    padding: 6px 14px;\r\n    font-size: 13px;\r\n    background: transparent;\r\n    border: none;\r\n    color: var(--text-muted);\r\n    cursor: pointer;\r\n    transition: all 0.15s;\r\n  }\r\n  .chart-toggle .toggle-btn:hover {\r\n    color: var(--text);\r\n  }\r\n  .chart-toggle .toggle-btn.active {\r\n    background: #ff4d4d;\r\n    color: white;\r\n  }\r\n  .chart-toggle.small .toggle-btn {\r\n    padding: 4px 8px;\r\n    font-size: 11px;\r\n  }\r\n  .sessions-toggle {\r\n    border-radius: 4px;\r\n  }\r\n  .sessions-toggle .toggle-btn {\r\n    border-radius: 4px;\r\n  }\r\n  .daily-chart-header {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n    gap: 8px;\r\n    margin-bottom: 6px;\r\n  }\r\n\r\n  /* ===== DAILY BAR CHART ===== */\r\n  .daily-chart {\r\n    margin-top: 12px;\r\n  }\r\n  .daily-chart-bars {\r\n    display: flex;\r\n    align-items: flex-end;\r\n    height: 200px;\r\n    gap: 4px;\r\n    padding: 8px 4px 36px;\r\n  }\r\n  .daily-bar-wrapper {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    height: 100%;\r\n    justify-content: flex-end;\r\n    cursor: pointer;\r\n    position: relative;\r\n    border-radius: 4px 4px 0 0;\r\n    transition: background 0.15s;\r\n    min-width: 0;\r\n  }\r\n  .daily-bar-wrapper:hover {\r\n    background: var(--bg-hover);\r\n  }\r\n  .daily-bar-wrapper.selected {\r\n    background: var(--accent-subtle);\r\n  }\r\n  .daily-bar-wrapper.selected .daily-bar {\r\n    background: var(--accent);\r\n  }\r\n  .daily-bar {\r\n    width: 100%;\r\n    max-width: var(--bar-max-width, 32px);\r\n    background: #ff4d4d;\r\n    border-radius: 3px 3px 0 0;\r\n    min-height: 2px;\r\n    transition: all 0.15s;\r\n    overflow: hidden;\r\n  }\r\n  .daily-bar-wrapper:hover .daily-bar {\r\n    background: #cc3d3d;\r\n  }\r\n  .daily-bar-label {\r\n    position: absolute;\r\n    bottom: -28px;\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    white-space: nowrap;\r\n    text-align: center;\r\n    transform: rotate(-35deg);\r\n    transform-origin: top center;\r\n  }\r\n  .daily-bar-total {\r\n    position: absolute;\r\n    top: -16px;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    white-space: nowrap;\r\n  }\r\n  .daily-bar-tooltip {\r\n    position: absolute;\r\n    bottom: calc(100% + 8px);\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    background: var(--bg);\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    padding: 8px 12px;\r\n    font-size: 12px;\r\n    white-space: nowrap;\r\n    z-index: 100;\r\n    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\r\n    pointer-events: none;\r\n    opacity: 0;\r\n    transition: opacity 0.15s;\r\n  }\r\n  .daily-bar-wrapper:hover .daily-bar-tooltip {\r\n    opacity: 1;\r\n  }\r\n\r\n  /* ===== COST/TOKEN BREAKDOWN BAR ===== */\r\n  .cost-breakdown {\r\n    margin-top: 18px;\r\n    padding: 16px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n  }\r\n  .cost-breakdown-header {\r\n    font-weight: 600;\r\n    font-size: 15px;\r\n    letter-spacing: -0.02em;\r\n    margin-bottom: 12px;\r\n    color: var(--text-strong);\r\n  }\r\n  .cost-breakdown-bar {\r\n    height: 28px;\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    overflow: hidden;\r\n    display: flex;\r\n  }\r\n  .cost-segment {\r\n    height: 100%;\r\n    transition: width 0.3s ease;\r\n    position: relative;\r\n  }\r\n  .cost-segment.output {\r\n    background: #ef4444;\r\n  }\r\n  .cost-segment.input {\r\n    background: #f59e0b;\r\n  }\r\n  .cost-segment.cache-write {\r\n    background: #10b981;\r\n  }\r\n  .cost-segment.cache-read {\r\n    background: #06b6d4;\r\n  }\r\n  .cost-breakdown-legend {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 16px;\r\n    margin-top: 12px;\r\n  }\r\n  .cost-breakdown-total {\r\n    margin-top: 10px;\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .legend-item {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-size: 12px;\r\n    color: var(--text);\r\n    cursor: help;\r\n  }\r\n  .legend-dot {\r\n    width: 10px;\r\n    height: 10px;\r\n    border-radius: 2px;\r\n    flex-shrink: 0;\r\n  }\r\n  .legend-dot.output {\r\n    background: #ef4444;\r\n  }\r\n  .legend-dot.input {\r\n    background: #f59e0b;\r\n  }\r\n  .legend-dot.cache-write {\r\n    background: #10b981;\r\n  }\r\n  .legend-dot.cache-read {\r\n    background: #06b6d4;\r\n  }\r\n  .legend-dot.system {\r\n    background: #ff4d4d;\r\n  }\r\n  .legend-dot.skills {\r\n    background: #8b5cf6;\r\n  }\r\n  .legend-dot.tools {\r\n    background: #ec4899;\r\n  }\r\n  .legend-dot.files {\r\n    background: #f59e0b;\r\n  }\r\n  .cost-breakdown-note {\r\n    margin-top: 10px;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    line-height: 1.4;\r\n  }\r\n\r\n  /* ===== SESSION BARS (scrollable list) ===== */\r\n  .session-bars {\r\n    margin-top: 16px;\r\n    max-height: 400px;\r\n    overflow-y: auto;\r\n    border: 1px solid var(--border);\r\n    border-radius: 8px;\r\n    background: var(--bg);\r\n  }\r\n  .session-bar-row {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n    padding: 10px 14px;\r\n    border-bottom: 1px solid var(--border);\r\n    cursor: pointer;\r\n    transition: background 0.15s;\r\n  }\r\n  .session-bar-row:last-child {\r\n    border-bottom: none;\r\n  }\r\n  .session-bar-row:hover {\r\n    background: var(--bg-hover);\r\n  }\r\n  .session-bar-row.selected {\r\n    background: var(--accent-subtle);\r\n  }\r\n  .session-bar-label {\r\n    flex: 1 1 auto;\r\n    min-width: 0;\r\n    font-size: 13px;\r\n    color: var(--text);\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 2px;\r\n  }\r\n  .session-bar-title {\r\n    /* Prefer showing the full name; wrap instead of truncating. */\r\n    white-space: normal;\r\n    overflow-wrap: anywhere;\r\n    word-break: break-word;\r\n  }\r\n  .session-bar-meta {\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    font-weight: 400;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n  .session-bar-track {\r\n    flex: 0 0 90px;\r\n    height: 6px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 4px;\r\n    overflow: hidden;\r\n    opacity: 0.6;\r\n  }\r\n  .session-bar-fill {\r\n    height: 100%;\r\n    background: rgba(255, 77, 77, 0.7);\r\n    border-radius: 4px;\r\n    transition: width 0.3s ease;\r\n  }\r\n  .session-bar-value {\r\n    flex: 0 0 70px;\r\n    text-align: right;\r\n    font-size: 12px;\r\n    font-family: var(--font-mono);\r\n    color: var(--text-muted);\r\n  }\r\n  .session-bar-actions {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    flex: 0 0 auto;\r\n  }\r\n  .session-copy-btn {\r\n    height: 26px;\r\n    padding: 0 10px;\r\n    border-radius: 999px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    font-size: 11px;\r\n    font-weight: 600;\r\n    color: var(--text-muted);\r\n    cursor: pointer;\r\n    transition: background 0.15s, border-color 0.15s, color 0.15s;\r\n  }\r\n  .session-copy-btn:hover {\r\n    background: var(--bg);\r\n    border-color: var(--border-strong);\r\n    color: var(--text);\r\n  }\r\n\r\n  /* ===== TIME SERIES CHART ===== */\r\n  .session-timeseries {\r\n    margin-top: 24px;\r\n    padding: 16px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n  }\r\n  .timeseries-header-row {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 12px;\r\n  }\r\n  .timeseries-controls {\r\n    display: flex;\r\n    gap: 6px;\r\n    align-items: center;\r\n  }\r\n  .timeseries-header {\r\n    font-weight: 600;\r\n    color: var(--text);\r\n  }\r\n  .timeseries-chart {\r\n    width: 100%;\r\n    overflow: hidden;\r\n  }\r\n  .timeseries-svg {\r\n    width: 100%;\r\n    height: auto;\r\n    display: block;\r\n  }\r\n  .timeseries-svg .axis-label {\r\n    font-size: 10px;\r\n    fill: var(--text-muted);\r\n  }\r\n  .timeseries-svg .ts-area {\r\n    fill: #ff4d4d;\r\n    fill-opacity: 0.1;\r\n  }\r\n  .timeseries-svg .ts-line {\r\n    fill: none;\r\n    stroke: #ff4d4d;\r\n    stroke-width: 2;\r\n  }\r\n  .timeseries-svg .ts-dot {\r\n    fill: #ff4d4d;\r\n    transition: r 0.15s, fill 0.15s;\r\n  }\r\n  .timeseries-svg .ts-dot:hover {\r\n    r: 5;\r\n  }\r\n  .timeseries-svg .ts-bar {\r\n    fill: #ff4d4d;\r\n    transition: fill 0.15s;\r\n  }\r\n  .timeseries-svg .ts-bar:hover {\r\n    fill: #cc3d3d;\r\n  }\r\n  .timeseries-svg .ts-bar.output { fill: #ef4444; }\r\n  .timeseries-svg .ts-bar.input { fill: #f59e0b; }\r\n  .timeseries-svg .ts-bar.cache-write { fill: #10b981; }\r\n  .timeseries-svg .ts-bar.cache-read { fill: #06b6d4; }\r\n  .timeseries-summary {\r\n    margin-top: 12px;\r\n    font-size: 13px;\r\n    color: var(--text-muted);\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 8px;\r\n  }\r\n  .timeseries-loading {\r\n    padding: 24px;\r\n    text-align: center;\r\n    color: var(--text-muted);\r\n  }\r\n\r\n  /* ===== SESSION LOGS ===== */\r\n  .session-logs {\r\n    margin-top: 24px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n  }\r\n  .session-logs-header {\r\n    padding: 10px 14px;\r\n    font-weight: 600;\r\n    border-bottom: 1px solid var(--border);\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    font-size: 13px;\r\n    background: var(--bg-secondary);\r\n  }\r\n  .session-logs-loading {\r\n    padding: 24px;\r\n    text-align: center;\r\n    color: var(--text-muted);\r\n  }\r\n  .session-logs-list {\r\n    max-height: 400px;\r\n    overflow-y: auto;\r\n  }\r\n  .session-log-entry {\r\n    padding: 10px 14px;\r\n    border-bottom: 1px solid var(--border);\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 6px;\r\n    background: var(--bg);\r\n  }\r\n  .session-log-entry:last-child {\r\n    border-bottom: none;\r\n  }\r\n  .session-log-entry.user {\r\n    border-left: 3px solid var(--accent);\r\n  }\r\n  .session-log-entry.assistant {\r\n    border-left: 3px solid var(--border-strong);\r\n  }\r\n  .session-log-meta {\r\n    display: flex;\r\n    gap: 8px;\r\n    align-items: center;\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    flex-wrap: wrap;\r\n  }\r\n  .session-log-role {\r\n    font-weight: 600;\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.04em;\r\n    font-size: 10px;\r\n    padding: 2px 6px;\r\n    border-radius: 999px;\r\n    background: var(--bg-secondary);\r\n    border: 1px solid var(--border);\r\n  }\r\n  .session-log-entry.user .session-log-role {\r\n    color: var(--accent);\r\n  }\r\n  .session-log-entry.assistant .session-log-role {\r\n    color: var(--text-muted);\r\n  }\r\n  .session-log-content {\r\n    font-size: 13px;\r\n    line-height: 1.5;\r\n    color: var(--text);\r\n    white-space: pre-wrap;\r\n    word-break: break-word;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n    padding: 8px 10px;\r\n    border: 1px solid var(--border);\r\n    max-height: 220px;\r\n    overflow-y: auto;\r\n  }\r\n\r\n  /* ===== CONTEXT WEIGHT BREAKDOWN ===== */\r\n  .context-weight-breakdown {\r\n    margin-top: 24px;\r\n    padding: 16px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n  }\r\n  .context-weight-breakdown .context-weight-header {\r\n    font-weight: 600;\r\n    font-size: 13px;\r\n    margin-bottom: 4px;\r\n    color: var(--text);\r\n  }\r\n  .context-weight-desc {\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n    margin: 0 0 12px 0;\r\n  }\r\n  .context-stacked-bar {\r\n    height: 24px;\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    overflow: hidden;\r\n    display: flex;\r\n  }\r\n  .context-segment {\r\n    height: 100%;\r\n    transition: width 0.3s ease;\r\n  }\r\n  .context-segment.system {\r\n    background: #ff4d4d;\r\n  }\r\n  .context-segment.skills {\r\n    background: #8b5cf6;\r\n  }\r\n  .context-segment.tools {\r\n    background: #ec4899;\r\n  }\r\n  .context-segment.files {\r\n    background: #f59e0b;\r\n  }\r\n  .context-legend {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 16px;\r\n    margin-top: 12px;\r\n  }\r\n  .context-total {\r\n    margin-top: 10px;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: var(--text-muted);\r\n  }\r\n  .context-details {\r\n    margin-top: 12px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 6px;\r\n    overflow: hidden;\r\n  }\r\n  .context-details summary {\r\n    padding: 10px 14px;\r\n    font-size: 13px;\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    background: var(--bg);\r\n    border-bottom: 1px solid var(--border);\r\n  }\r\n  .context-details[open] summary {\r\n    border-bottom: 1px solid var(--border);\r\n  }\r\n  .context-list {\r\n    max-height: 200px;\r\n    overflow-y: auto;\r\n  }\r\n  .context-list-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    padding: 8px 14px;\r\n    font-size: 11px;\r\n    text-transform: uppercase;\r\n    color: var(--text-muted);\r\n    background: var(--bg-secondary);\r\n    border-bottom: 1px solid var(--border);\r\n  }\r\n  .context-list-item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    padding: 8px 14px;\r\n    font-size: 12px;\r\n    border-bottom: 1px solid var(--border);\r\n  }\r\n  .context-list-item:last-child {\r\n    border-bottom: none;\r\n  }\r\n  .context-list-item .mono {\r\n    font-family: var(--font-mono);\r\n    color: var(--text);\r\n  }\r\n  .context-list-item .muted {\r\n    color: var(--text-muted);\r\n    font-family: var(--font-mono);\r\n  }\r\n\r\n  /* ===== NO CONTEXT NOTE ===== */\r\n  .no-context-note {\r\n    margin-top: 24px;\r\n    padding: 16px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n    font-size: 13px;\r\n    color: var(--text-muted);\r\n    line-height: 1.5;\r\n  }\r\n\r\n  /* ===== TWO COLUMN LAYOUT ===== */\r\n  .usage-grid {\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    gap: 18px;\r\n    margin-top: 18px;\r\n    align-items: stretch;\r\n  }\r\n  .usage-grid-left {\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .usage-grid-right {\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  \r\n  /* ===== LEFT CARD (Daily + Breakdown) ===== */\r\n  .usage-left-card {\r\n    /* inherits background, border, shadow from .card */\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .usage-left-card .daily-chart-bars {\r\n    flex: 1;\r\n    min-height: 200px;\r\n  }\r\n  .usage-left-card .sessions-panel-title {\r\n    font-weight: 600;\r\n    font-size: 14px;\r\n    margin-bottom: 12px;\r\n  }\r\n  \r\n  /* ===== COMPACT DAILY CHART ===== */\r\n  .daily-chart-compact {\r\n    margin-bottom: 16px;\r\n  }\r\n  .daily-chart-compact .sessions-panel-title {\r\n    margin-bottom: 8px;\r\n  }\r\n  .daily-chart-compact .daily-chart-bars {\r\n    height: 100px;\r\n    padding-bottom: 20px;\r\n  }\r\n  \r\n  /* ===== COMPACT COST BREAKDOWN ===== */\r\n  .cost-breakdown-compact {\r\n    padding: 0;\r\n    margin: 0;\r\n    background: transparent;\r\n    border-top: 1px solid var(--border);\r\n    padding-top: 12px;\r\n  }\r\n  .cost-breakdown-compact .cost-breakdown-header {\r\n    margin-bottom: 8px;\r\n  }\r\n  .cost-breakdown-compact .cost-breakdown-legend {\r\n    gap: 12px;\r\n  }\r\n  .cost-breakdown-compact .cost-breakdown-note {\r\n    display: none;\r\n  }\r\n  \r\n  /* ===== SESSIONS CARD ===== */\r\n  .sessions-card {\r\n    /* inherits background, border, shadow from .card */\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .sessions-card-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n  }\r\n  .sessions-card-title {\r\n    font-weight: 600;\r\n    font-size: 14px;\r\n  }\r\n  .sessions-card-count {\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .sessions-card-meta {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    gap: 12px;\r\n    margin: 8px 0 10px;\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .sessions-card-stats {\r\n    display: inline-flex;\r\n    gap: 12px;\r\n  }\r\n  .sessions-sort {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .sessions-sort select {\r\n    padding: 4px 8px;\r\n    border-radius: 6px;\r\n    border: 1px solid var(--border);\r\n    background: var(--bg);\r\n    color: var(--text);\r\n    font-size: 12px;\r\n  }\r\n  .sessions-action-btn {\r\n    height: 28px;\r\n    padding: 0 10px;\r\n    border-radius: 8px;\r\n    font-size: 12px;\r\n    line-height: 1;\r\n  }\r\n  .sessions-action-btn.icon {\r\n    width: 32px;\r\n    padding: 0;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .sessions-card-hint {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-bottom: 8px;\r\n  }\r\n  .sessions-card .session-bars {\r\n    max-height: 280px;\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    border: 1px solid var(--border);\r\n    margin: 0;\r\n    overflow-y: auto;\r\n    padding: 8px;\r\n  }\r\n  .sessions-card .session-bar-row {\r\n    padding: 6px 8px;\r\n    border-radius: 6px;\r\n    margin-bottom: 3px;\r\n    border: 1px solid transparent;\r\n    transition: all 0.15s;\r\n  }\r\n  .sessions-card .session-bar-row:hover {\r\n    border-color: var(--border);\r\n    background: var(--bg-hover);\r\n  }\r\n  .sessions-card .session-bar-row.selected {\r\n    border-color: var(--accent);\r\n    background: var(--accent-subtle);\r\n    box-shadow: inset 0 0 0 1px rgba(255, 77, 77, 0.15);\r\n  }\r\n  .sessions-card .session-bar-label {\r\n    flex: 1 1 auto;\r\n    min-width: 140px;\r\n    font-size: 12px;\r\n  }\r\n  .sessions-card .session-bar-value {\r\n    flex: 0 0 60px;\r\n    font-size: 11px;\r\n    font-weight: 600;\r\n  }\r\n  .sessions-card .session-bar-track {\r\n    flex: 0 0 70px;\r\n    height: 5px;\r\n    opacity: 0.5;\r\n  }\r\n  .sessions-card .session-bar-fill {\r\n    background: rgba(255, 77, 77, 0.55);\r\n  }\r\n  .sessions-clear-btn {\r\n    margin-left: auto;\r\n  }\r\n  \r\n  /* ===== EMPTY DETAIL STATE ===== */\r\n  .session-detail-empty {\r\n    margin-top: 18px;\r\n    background: var(--bg-secondary);\r\n    border-radius: 8px;\r\n    border: 2px dashed var(--border);\r\n    padding: 32px;\r\n    text-align: center;\r\n  }\r\n  .session-detail-empty-title {\r\n    font-size: 15px;\r\n    font-weight: 600;\r\n    color: var(--text);\r\n    margin-bottom: 8px;\r\n  }\r\n  .session-detail-empty-desc {\r\n    font-size: 13px;\r\n    color: var(--text-muted);\r\n    margin-bottom: 16px;\r\n    line-height: 1.5;\r\n  }\r\n  .session-detail-empty-features {\r\n    display: flex;\r\n    justify-content: center;\r\n    gap: 24px;\r\n    flex-wrap: wrap;\r\n  }\r\n  .session-detail-empty-feature {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .session-detail-empty-feature .icon {\r\n    font-size: 16px;\r\n  }\r\n  \r\n  /* ===== SESSION DETAIL PANEL ===== */\r\n  .session-detail-panel {\r\n    margin-top: 12px;\r\n    /* inherits background, border-radius, shadow from .card */\r\n    border: 2px solid var(--accent) !important;\r\n  }\r\n  .session-detail-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 8px 12px;\r\n    border-bottom: 1px solid var(--border);\r\n    cursor: pointer;\r\n  }\r\n  .session-detail-header:hover {\r\n    background: var(--bg-hover);\r\n  }\r\n  .session-detail-title {\r\n    font-weight: 600;\r\n    font-size: 14px;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n  .session-detail-header-left {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n  .session-close-btn {\r\n    background: var(--bg);\r\n    border: 1px solid var(--border);\r\n    color: var(--text);\r\n    cursor: pointer;\r\n    padding: 2px 8px;\r\n    font-size: 16px;\r\n    line-height: 1;\r\n    border-radius: 4px;\r\n    transition: background 0.15s, color 0.15s;\r\n  }\r\n  .session-close-btn:hover {\r\n    background: var(--bg-hover);\r\n    color: var(--text);\r\n    border-color: var(--accent);\r\n  }\r\n  .session-detail-stats {\r\n    display: flex;\r\n    gap: 10px;\r\n    font-size: 12px;\r\n    color: var(--text-muted);\r\n  }\r\n  .session-detail-stats strong {\r\n    color: var(--text);\r\n    font-family: var(--font-mono);\r\n  }\r\n  .session-detail-content {\r\n    padding: 12px;\r\n  }\r\n  .session-summary-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\r\n    gap: 8px;\r\n    margin-bottom: 12px;\r\n  }\r\n  .session-summary-card {\r\n    border: 1px solid var(--border);\r\n    border-radius: 8px;\r\n    padding: 8px;\r\n    background: var(--bg-secondary);\r\n  }\r\n  .session-summary-title {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-bottom: 4px;\r\n  }\r\n  .session-summary-value {\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n  }\r\n  .session-summary-meta {\r\n    font-size: 11px;\r\n    color: var(--text-muted);\r\n    margin-top: 4px;\r\n  }\r\n  .session-detail-row {\r\n    display: grid;\r\n    grid-template-columns: 1fr;\r\n    gap: 10px;\r\n    /* Separate \"Usage Over Time\" from the summary + Top Tools/Model Mix cards above. */\r\n    margin-top: 12px;\r\n    margin-bottom: 10px;\r\n  }\r\n  .session-detail-bottom {\r\n    display: grid;\r\n    grid-template-columns: minmax(0, 1.8fr) minmax(0, 1fr);\r\n    gap: 10px;\r\n    align-items: stretch;\r\n  }\r\n  .session-detail-bottom .session-logs-compact {\r\n    margin: 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .session-detail-bottom .session-logs-compact .session-logs-list {\r\n    flex: 1 1 auto;\r\n    max-height: none;\r\n  }\r\n  .context-details-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8px;\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    border: 1px solid var(--border);\r\n    padding: 12px;\r\n  }\r\n  .context-breakdown-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n    gap: 10px;\r\n    margin-top: 8px;\r\n  }\r\n  .context-breakdown-card {\r\n    border: 1px solid var(--border);\r\n    border-radius: 8px;\r\n    padding: 8px;\r\n    background: var(--bg-secondary);\r\n  }\r\n  .context-breakdown-title {\r\n    font-size: 11px;\r\n    font-weight: 600;\r\n    margin-bottom: 6px;\r\n  }\r\n  .context-breakdown-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 6px;\r\n    font-size: 11px;\r\n  }\r\n  .context-breakdown-item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    gap: 8px;\r\n  }\r\n  .context-breakdown-more {\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    margin-top: 4px;\r\n  }\r\n  .context-breakdown-header {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    gap: 12px;\r\n  }\r\n  .context-expand-btn {\r\n    border: 1px solid var(--border);\r\n    background: var(--bg-secondary);\r\n    color: var(--text-muted);\r\n    font-size: 11px;\r\n    padding: 4px 8px;\r\n    border-radius: 999px;\r\n    cursor: pointer;\r\n    transition: all 0.15s;\r\n  }\r\n  .context-expand-btn:hover {\r\n    color: var(--text);\r\n    border-color: var(--border-strong);\r\n    background: var(--bg);\r\n  }\r\n  \r\n  /* ===== COMPACT TIMESERIES ===== */\r\n  .session-timeseries-compact {\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    border: 1px solid var(--border);\r\n    padding: 12px;\r\n    margin: 0;\r\n  }\r\n  .session-timeseries-compact .timeseries-header-row {\r\n    margin-bottom: 8px;\r\n  }\r\n  .session-timeseries-compact .timeseries-header {\r\n    font-size: 12px;\r\n  }\r\n  .session-timeseries-compact .timeseries-summary {\r\n    font-size: 11px;\r\n    margin-top: 8px;\r\n  }\r\n  \r\n  /* ===== COMPACT CONTEXT ===== */\r\n  .context-weight-compact {\r\n    background: var(--bg);\r\n    border-radius: 6px;\r\n    border: 1px solid var(--border);\r\n    padding: 12px;\r\n    margin: 0;\r\n  }\r\n  .context-weight-compact .context-weight-header {\r\n    font-size: 12px;\r\n    margin-bottom: 4px;\r\n  }\r\n  .context-weight-compact .context-weight-desc {\r\n    font-size: 11px;\r\n    margin-bottom: 8px;\r\n  }\r\n  .context-weight-compact .context-stacked-bar {\r\n    height: 16px;\r\n  }\r\n  .context-weight-compact .context-legend {\r\n    font-size: 11px;\r\n    gap: 10px;\r\n    margin-top: 8px;\r\n  }\r\n  .context-weight-compact .context-total {\r\n    font-size: 11px;\r\n    margin-top: 6px;\r\n  }\r\n  .context-weight-compact .context-details {\r\n    margin-top: 8px;\r\n  }\r\n  .context-weight-compact .context-details summary {\r\n    font-size: 12px;\r\n    padding: 6px 10px;\r\n  }\r\n  \r\n  /* ===== COMPACT LOGS ===== */\r\n  .session-logs-compact {\r\n    background: var(--bg);\r\n    border-radius: 10px;\r\n    border: 1px solid var(--border);\r\n    overflow: hidden;\r\n    margin: 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .session-logs-compact .session-logs-header {\r\n    padding: 10px 12px;\r\n    font-size: 12px;\r\n  }\r\n  .session-logs-compact .session-logs-list {\r\n    max-height: none;\r\n    flex: 1 1 auto;\r\n    overflow: auto;\r\n  }\r\n  .session-logs-compact .session-log-entry {\r\n    padding: 8px 12px;\r\n  }\r\n  .session-logs-compact .session-log-content {\r\n    font-size: 12px;\r\n    max-height: 160px;\r\n  }\r\n  .session-log-tools {\r\n    margin-top: 6px;\r\n    border: 1px solid var(--border);\r\n    border-radius: 8px;\r\n    background: var(--bg-secondary);\r\n    padding: 6px 8px;\r\n    font-size: 11px;\r\n    color: var(--text);\r\n  }\r\n  .session-log-tools summary {\r\n    cursor: pointer;\r\n    list-style: none;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-weight: 600;\r\n  }\r\n  .session-log-tools summary::-webkit-details-marker {\r\n    display: none;\r\n  }\r\n  .session-log-tools-list {\r\n    margin-top: 6px;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 6px;\r\n  }\r\n  .session-log-tools-pill {\r\n    border: 1px solid var(--border);\r\n    border-radius: 999px;\r\n    padding: 2px 8px;\r\n    font-size: 10px;\r\n    background: var(--bg);\r\n    color: var(--text);\r\n  }\r\n\r\n  /* ===== RESPONSIVE ===== */\r\n  @media (max-width: 900px) {\r\n    .usage-grid {\r\n      grid-template-columns: 1fr;\r\n    }\r\n    .session-detail-row {\r\n      grid-template-columns: 1fr;\r\n    }\r\n  }\r\n  @media (max-width: 600px) {\r\n    .session-bar-label {\r\n      flex: 0 0 100px;\r\n    }\r\n    .cost-breakdown-legend {\r\n      gap: 10px;\r\n    }\r\n    .legend-item {\r\n      font-size: 11px;\r\n    }\r\n    .daily-chart-bars {\r\n      height: 170px;\r\n      gap: 6px;\r\n      padding-bottom: 40px;\r\n    }\r\n    .daily-bar-label {\r\n      font-size: 8px;\r\n      bottom: -30px;\r\n      transform: rotate(-45deg);\r\n    }\r\n    .usage-mosaic-grid {\r\n      grid-template-columns: 1fr;\r\n    }\r\n    .usage-hour-grid {\r\n      grid-template-columns: repeat(12, minmax(10px, 1fr));\r\n    }\r\n    .usage-hour-cell {\r\n      height: 22px;\r\n    }\r\n  }\r\n`;\r\n","import { html, svg, nothing } from \"lit\";\r\nimport { formatDurationCompact } from \"../../../../src/infra/format-time/format-duration.ts\";\r\nimport { extractQueryTerms, filterSessionsByQuery, parseToolSummary } from \"../usage-helpers.ts\";\r\nimport { usageStylesString } from \"./usageStyles.ts\";\r\nimport {\r\n  UsageSessionEntry,\r\n  UsageTotals,\r\n  UsageAggregates,\r\n  CostDailyEntry,\r\n  UsageColumnId,\r\n  TimeSeriesPoint,\r\n  SessionLogEntry,\r\n  SessionLogRole,\r\n  UsageProps,\r\n} from \"./usageTypes.ts\";\r\n\r\nimport { T } from \"../../i18n.ts\";\r\n\r\nexport type { UsageColumnId, SessionLogEntry, SessionLogRole };\r\n\r\n// ~4 chars per token is a rough approximation\r\nconst CHARS_PER_TOKEN = 4;\r\n\r\nfunction charsToTokens(chars: number): number {\r\n  return Math.round(chars / CHARS_PER_TOKEN);\r\n}\r\n\r\nfunction formatTokens(n: number): string {\r\n  if (n >= 1_000_000) {\r\n    return `${(n / 1_000_000).toFixed(1)}M`;\r\n  }\r\n  if (n >= 1_000) {\r\n    return `${(n / 1_000).toFixed(1)}K`;\r\n  }\r\n  return String(n);\r\n}\r\n\r\nfunction formatHourLabel(hour: number): string {\r\n  const date = new Date();\r\n  date.setHours(hour, 0, 0, 0);\r\n  return date.toLocaleTimeString(undefined, { hour: \"numeric\" });\r\n}\r\n\r\nfunction buildPeakErrorHours(sessions: UsageSessionEntry[], timeZone: \"local\" | \"utc\") {\r\n  const hourErrors = Array.from({ length: 24 }, () => 0);\r\n  const hourMsgs = Array.from({ length: 24 }, () => 0);\r\n\r\n  for (const session of sessions) {\r\n    const usage = session.usage;\r\n    if (!usage?.messageCounts || usage.messageCounts.total === 0) {\r\n      continue;\r\n    }\r\n    const start = usage.firstActivity ?? session.updatedAt;\r\n    const end = usage.lastActivity ?? session.updatedAt;\r\n    if (!start || !end) {\r\n      continue;\r\n    }\r\n    const startMs = Math.min(start, end);\r\n    const endMs = Math.max(start, end);\r\n    const durationMs = Math.max(endMs - startMs, 1);\r\n    const totalMinutes = durationMs / 60000;\r\n\r\n    let cursor = startMs;\r\n    while (cursor < endMs) {\r\n      const date = new Date(cursor);\r\n      const hour = getZonedHour(date, timeZone);\r\n      const nextHour = setToHourEnd(date, timeZone);\r\n      const nextMs = Math.min(nextHour.getTime(), endMs);\r\n      const minutes = Math.max((nextMs - cursor) / 60000, 0);\r\n      const share = minutes / totalMinutes;\r\n      hourErrors[hour] += usage.messageCounts.errors * share;\r\n      hourMsgs[hour] += usage.messageCounts.total * share;\r\n      cursor = nextMs + 1;\r\n    }\r\n  }\r\n\r\n  return hourMsgs\r\n    .map((msgs, hour) => {\r\n      const errors = hourErrors[hour];\r\n      const rate = msgs > 0 ? errors / msgs : 0;\r\n      return {\r\n        hour,\r\n        rate,\r\n        errors,\r\n        msgs,\r\n      };\r\n    })\r\n    .filter((entry) => entry.msgs > 0 && entry.errors > 0)\r\n    .toSorted((a, b) => b.rate - a.rate)\r\n    .slice(0, 5)\r\n    .map((entry) => ({\r\n      label: formatHourLabel(entry.hour),\r\n      value: `${(entry.rate * 100).toFixed(2)}%`,\r\n      sub: `${Math.round(entry.errors)} errors Â· ${Math.round(entry.msgs)} msgs`,\r\n    }));\r\n}\r\n\r\ntype UsageMosaicStats = {\r\n  hasData: boolean;\r\n  totalTokens: number;\r\n  hourTotals: number[];\r\n  weekdayTotals: Array<{ label: string; tokens: number }>;\r\n};\r\n\r\nconst WEEKDAYS = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\n\r\nfunction getZonedHour(date: Date, zone: \"local\" | \"utc\"): number {\r\n  return zone === \"utc\" ? date.getUTCHours() : date.getHours();\r\n}\r\n\r\nfunction getZonedWeekday(date: Date, zone: \"local\" | \"utc\"): number {\r\n  return zone === \"utc\" ? date.getUTCDay() : date.getDay();\r\n}\r\n\r\nfunction setToHourEnd(date: Date, zone: \"local\" | \"utc\"): Date {\r\n  const next = new Date(date);\r\n  if (zone === \"utc\") {\r\n    next.setUTCMinutes(59, 59, 999);\r\n  } else {\r\n    next.setMinutes(59, 59, 999);\r\n  }\r\n  return next;\r\n}\r\n\r\nfunction buildUsageMosaicStats(\r\n  sessions: UsageSessionEntry[],\r\n  timeZone: \"local\" | \"utc\",\r\n): UsageMosaicStats {\r\n  const hourTotals = Array.from({ length: 24 }, () => 0);\r\n  const weekdayTotals = Array.from({ length: 7 }, () => 0);\r\n  let totalTokens = 0;\r\n  let hasData = false;\r\n\r\n  for (const session of sessions) {\r\n    const usage = session.usage;\r\n    if (!usage || !usage.totalTokens || usage.totalTokens <= 0) {\r\n      continue;\r\n    }\r\n    totalTokens += usage.totalTokens;\r\n\r\n    const start = usage.firstActivity ?? session.updatedAt;\r\n    const end = usage.lastActivity ?? session.updatedAt;\r\n    if (!start || !end) {\r\n      continue;\r\n    }\r\n    hasData = true;\r\n\r\n    const startMs = Math.min(start, end);\r\n    const endMs = Math.max(start, end);\r\n    const durationMs = Math.max(endMs - startMs, 1);\r\n    const totalMinutes = durationMs / 60000;\r\n\r\n    let cursor = startMs;\r\n    while (cursor < endMs) {\r\n      const date = new Date(cursor);\r\n      const hour = getZonedHour(date, timeZone);\r\n      const weekday = getZonedWeekday(date, timeZone);\r\n      const nextHour = setToHourEnd(date, timeZone);\r\n      const nextMs = Math.min(nextHour.getTime(), endMs);\r\n      const minutes = Math.max((nextMs - cursor) / 60000, 0);\r\n      const share = minutes / totalMinutes;\r\n      hourTotals[hour] += usage.totalTokens * share;\r\n      weekdayTotals[weekday] += usage.totalTokens * share;\r\n      cursor = nextMs + 1;\r\n    }\r\n  }\r\n\r\n  const weekdayLabels = WEEKDAYS.map((label, index) => ({\r\n    label,\r\n    tokens: weekdayTotals[index],\r\n  }));\r\n\r\n  return {\r\n    hasData,\r\n    totalTokens,\r\n    hourTotals,\r\n    weekdayTotals: weekdayLabels,\r\n  };\r\n}\r\n\r\nfunction renderUsageMosaic(\r\n  sessions: UsageSessionEntry[],\r\n  timeZone: \"local\" | \"utc\",\r\n  selectedHours: number[],\r\n  onSelectHour: (hour: number, shiftKey: boolean) => void,\r\n) {\r\n  const stats = buildUsageMosaicStats(sessions, timeZone);\r\n  if (!stats.hasData) {\r\n    return html`\r\n      <div class=\"card usage-mosaic\">\r\n        <div class=\"usage-mosaic-header\">\r\n          <div>\r\n            <div class=\"usage-mosaic-title\">Activity by Time</div>\r\n            <div class=\"usage-mosaic-sub\">Estimates require session timestamps.</div>\r\n          </div>\r\n          <div class=\"usage-mosaic-total\">${formatTokens(0)} tokens</div>\r\n        </div>\r\n        <div class=\"muted\" style=\"padding: 12px; text-align: center;\">No timeline data yet.</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const maxHour = Math.max(...stats.hourTotals, 1);\r\n  const maxWeekday = Math.max(...stats.weekdayTotals.map((d) => d.tokens), 1);\r\n\r\n  return html`\r\n    <div class=\"card usage-mosaic\">\r\n      <div class=\"usage-mosaic-header\">\r\n        <div>\r\n          <div class=\"usage-mosaic-title\">Activity by Time</div>\r\n          <div class=\"usage-mosaic-sub\">\r\n            Estimated from session spans (first/last activity). Time zone: ${timeZone === \"utc\" ? \"UTC\" : \"Local\"}.\r\n          </div>\r\n        </div>\r\n        <div class=\"usage-mosaic-total\">${formatTokens(stats.totalTokens)} tokens</div>\r\n      </div>\r\n      <div class=\"usage-mosaic-grid\">\r\n        <div class=\"usage-mosaic-section\">\r\n          <div class=\"usage-mosaic-section-title\">Day of Week</div>\r\n          <div class=\"usage-daypart-grid\">\r\n            ${stats.weekdayTotals.map((part) => {\r\n              const intensity = Math.min(part.tokens / maxWeekday, 1);\r\n              const bg =\r\n                part.tokens > 0 ? `rgba(255, 77, 77, ${0.12 + intensity * 0.6})` : \"transparent\";\r\n              return html`\r\n                <div class=\"usage-daypart-cell\" style=\"background: ${bg};\">\r\n                  <div class=\"usage-daypart-label\">${part.label}</div>\r\n                  <div class=\"usage-daypart-value\">${formatTokens(part.tokens)}</div>\r\n                </div>\r\n              `;\r\n            })}\r\n          </div>\r\n        </div>\r\n        <div class=\"usage-mosaic-section\">\r\n          <div class=\"usage-mosaic-section-title\">\r\n            <span>Hours</span>\r\n            <span class=\"usage-mosaic-sub\">0 â?23</span>\r\n          </div>\r\n          <div class=\"usage-hour-grid\">\r\n            ${stats.hourTotals.map((value, hour) => {\r\n              const intensity = Math.min(value / maxHour, 1);\r\n              const bg = value > 0 ? `rgba(255, 77, 77, ${0.08 + intensity * 0.7})` : \"transparent\";\r\n              const title = `${hour}:00 Â· ${formatTokens(value)} tokens`;\r\n              const border = intensity > 0.7 ? \"rgba(255, 77, 77, 0.6)\" : \"rgba(255, 77, 77, 0.2)\";\r\n              const selected = selectedHours.includes(hour);\r\n              return html`\r\n                <div\r\n                  class=\"usage-hour-cell ${selected ? \"selected\" : \"\"}\"\r\n                  style=\"background: ${bg}; border-color: ${border};\"\r\n                  title=\"${title}\"\r\n                  @click=${(e: MouseEvent) => onSelectHour(hour, e.shiftKey)}\r\n                ></div>\r\n              `;\r\n            })}\r\n          </div>\r\n          <div class=\"usage-hour-labels\">\r\n            <span>Midnight</span>\r\n            <span>4am</span>\r\n            <span>8am</span>\r\n            <span>Noon</span>\r\n            <span>4pm</span>\r\n            <span>8pm</span>\r\n          </div>\r\n          <div class=\"usage-hour-legend\">\r\n            <span></span>\r\n            Low â?High token density\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction formatCost(n: number, decimals = 2): string {\r\n  return `$${n.toFixed(decimals)}`;\r\n}\r\n\r\nfunction formatIsoDate(date: Date): string {\r\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}-${String(date.getDate()).padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction parseYmdDate(dateStr: string): Date | null {\r\n  const match = /^(\\d{4})-(\\d{2})-(\\d{2})$/.exec(dateStr);\r\n  if (!match) {\r\n    return null;\r\n  }\r\n  const [, y, m, d] = match;\r\n  const date = new Date(Date.UTC(Number(y), Number(m) - 1, Number(d)));\r\n  return Number.isNaN(date.valueOf()) ? null : date;\r\n}\r\n\r\nfunction formatDayLabel(dateStr: string): string {\r\n  const date = parseYmdDate(dateStr);\r\n  if (!date) {\r\n    return dateStr;\r\n  }\r\n  return date.toLocaleDateString(undefined, { month: \"short\", day: \"numeric\" });\r\n}\r\n\r\nfunction formatFullDate(dateStr: string): string {\r\n  const date = parseYmdDate(dateStr);\r\n  if (!date) {\r\n    return dateStr;\r\n  }\r\n  return date.toLocaleDateString(undefined, { month: \"long\", day: \"numeric\", year: \"numeric\" });\r\n}\r\n\r\nfunction downloadTextFile(filename: string, content: string, type = \"text/plain\") {\r\n  const blob = new Blob([content], { type });\r\n  const url = URL.createObjectURL(blob);\r\n  const anchor = document.createElement(\"a\");\r\n  anchor.href = url;\r\n  anchor.download = filename;\r\n  anchor.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nfunction csvEscape(value: string): string {\r\n  if (value.includes('\"') || value.includes(\",\") || value.includes(\"\\n\")) {\r\n    return `\"${value.replace(/\"/g, '\"\"')}\"`;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction toCsvRow(values: Array<string | number | undefined | null>): string {\r\n  return values\r\n    .map((val) => {\r\n      if (val === undefined || val === null) {\r\n        return \"\";\r\n      }\r\n      return csvEscape(String(val));\r\n    })\r\n    .join(\",\");\r\n}\r\n\r\nconst emptyUsageTotals = (): UsageTotals => ({\r\n  input: 0,\r\n  output: 0,\r\n  cacheRead: 0,\r\n  cacheWrite: 0,\r\n  totalTokens: 0,\r\n  totalCost: 0,\r\n  inputCost: 0,\r\n  outputCost: 0,\r\n  cacheReadCost: 0,\r\n  cacheWriteCost: 0,\r\n  missingCostEntries: 0,\r\n});\r\n\r\nconst mergeUsageTotals = (target: UsageTotals, source: Partial<UsageTotals>) => {\r\n  target.input += source.input ?? 0;\r\n  target.output += source.output ?? 0;\r\n  target.cacheRead += source.cacheRead ?? 0;\r\n  target.cacheWrite += source.cacheWrite ?? 0;\r\n  target.totalTokens += source.totalTokens ?? 0;\r\n  target.totalCost += source.totalCost ?? 0;\r\n  target.inputCost += source.inputCost ?? 0;\r\n  target.outputCost += source.outputCost ?? 0;\r\n  target.cacheReadCost += source.cacheReadCost ?? 0;\r\n  target.cacheWriteCost += source.cacheWriteCost ?? 0;\r\n  target.missingCostEntries += source.missingCostEntries ?? 0;\r\n};\r\n\r\nconst buildAggregatesFromSessions = (\r\n  sessions: UsageSessionEntry[],\r\n  fallback?: UsageAggregates | null,\r\n): UsageAggregates => {\r\n  if (sessions.length === 0) {\r\n    return (\r\n      fallback ?? {\r\n        messages: { total: 0, user: 0, assistant: 0, toolCalls: 0, toolResults: 0, errors: 0 },\r\n        tools: { totalCalls: 0, uniqueTools: 0, tools: [] },\r\n        byModel: [],\r\n        byProvider: [],\r\n        byAgent: [],\r\n        byChannel: [],\r\n        daily: [],\r\n      }\r\n    );\r\n  }\r\n\r\n  const messages = { total: 0, user: 0, assistant: 0, toolCalls: 0, toolResults: 0, errors: 0 };\r\n  const toolMap = new Map<string, number>();\r\n  const modelMap = new Map<\r\n    string,\r\n    { provider?: string; model?: string; count: number; totals: UsageTotals }\r\n  >();\r\n  const providerMap = new Map<\r\n    string,\r\n    { provider?: string; model?: string; count: number; totals: UsageTotals }\r\n  >();\r\n  const agentMap = new Map<string, UsageTotals>();\r\n  const channelMap = new Map<string, UsageTotals>();\r\n  const dailyMap = new Map<\r\n    string,\r\n    {\r\n      date: string;\r\n      tokens: number;\r\n      cost: number;\r\n      messages: number;\r\n      toolCalls: number;\r\n      errors: number;\r\n    }\r\n  >();\r\n  const dailyLatencyMap = new Map<\r\n    string,\r\n    { date: string; count: number; sum: number; min: number; max: number; p95Max: number }\r\n  >();\r\n  const modelDailyMap = new Map<\r\n    string,\r\n    { date: string; provider?: string; model?: string; tokens: number; cost: number; count: number }\r\n  >();\r\n  const latencyTotals = { count: 0, sum: 0, min: Number.POSITIVE_INFINITY, max: 0, p95Max: 0 };\r\n\r\n  for (const session of sessions) {\r\n    const usage = session.usage;\r\n    if (!usage) {\r\n      continue;\r\n    }\r\n    if (usage.messageCounts) {\r\n      messages.total += usage.messageCounts.total;\r\n      messages.user += usage.messageCounts.user;\r\n      messages.assistant += usage.messageCounts.assistant;\r\n      messages.toolCalls += usage.messageCounts.toolCalls;\r\n      messages.toolResults += usage.messageCounts.toolResults;\r\n      messages.errors += usage.messageCounts.errors;\r\n    }\r\n\r\n    if (usage.toolUsage) {\r\n      for (const tool of usage.toolUsage.tools) {\r\n        toolMap.set(tool.name, (toolMap.get(tool.name) ?? 0) + tool.count);\r\n      }\r\n    }\r\n\r\n    if (usage.modelUsage) {\r\n      for (const entry of usage.modelUsage) {\r\n        const modelKey = `${entry.provider ?? \"unknown\"}::${entry.model ?? \"unknown\"}`;\r\n        const modelExisting = modelMap.get(modelKey) ?? {\r\n          provider: entry.provider,\r\n          model: entry.model,\r\n          count: 0,\r\n          totals: emptyUsageTotals(),\r\n        };\r\n        modelExisting.count += entry.count;\r\n        mergeUsageTotals(modelExisting.totals, entry.totals);\r\n        modelMap.set(modelKey, modelExisting);\r\n\r\n        const providerKey = entry.provider ?? \"unknown\";\r\n        const providerExisting = providerMap.get(providerKey) ?? {\r\n          provider: entry.provider,\r\n          model: undefined,\r\n          count: 0,\r\n          totals: emptyUsageTotals(),\r\n        };\r\n        providerExisting.count += entry.count;\r\n        mergeUsageTotals(providerExisting.totals, entry.totals);\r\n        providerMap.set(providerKey, providerExisting);\r\n      }\r\n    }\r\n\r\n    if (usage.latency) {\r\n      const { count, avgMs, minMs, maxMs, p95Ms } = usage.latency;\r\n      if (count > 0) {\r\n        latencyTotals.count += count;\r\n        latencyTotals.sum += avgMs * count;\r\n        latencyTotals.min = Math.min(latencyTotals.min, minMs);\r\n        latencyTotals.max = Math.max(latencyTotals.max, maxMs);\r\n        latencyTotals.p95Max = Math.max(latencyTotals.p95Max, p95Ms);\r\n      }\r\n    }\r\n\r\n    if (session.agentId) {\r\n      const totals = agentMap.get(session.agentId) ?? emptyUsageTotals();\r\n      mergeUsageTotals(totals, usage);\r\n      agentMap.set(session.agentId, totals);\r\n    }\r\n    if (session.channel) {\r\n      const totals = channelMap.get(session.channel) ?? emptyUsageTotals();\r\n      mergeUsageTotals(totals, usage);\r\n      channelMap.set(session.channel, totals);\r\n    }\r\n\r\n    for (const day of usage.dailyBreakdown ?? []) {\r\n      const daily = dailyMap.get(day.date) ?? {\r\n        date: day.date,\r\n        tokens: 0,\r\n        cost: 0,\r\n        messages: 0,\r\n        toolCalls: 0,\r\n        errors: 0,\r\n      };\r\n      daily.tokens += day.tokens;\r\n      daily.cost += day.cost;\r\n      dailyMap.set(day.date, daily);\r\n    }\r\n    for (const day of usage.dailyMessageCounts ?? []) {\r\n      const daily = dailyMap.get(day.date) ?? {\r\n        date: day.date,\r\n        tokens: 0,\r\n        cost: 0,\r\n        messages: 0,\r\n        toolCalls: 0,\r\n        errors: 0,\r\n      };\r\n      daily.messages += day.total;\r\n      daily.toolCalls += day.toolCalls;\r\n      daily.errors += day.errors;\r\n      dailyMap.set(day.date, daily);\r\n    }\r\n    for (const day of usage.dailyLatency ?? []) {\r\n      const existing = dailyLatencyMap.get(day.date) ?? {\r\n        date: day.date,\r\n        count: 0,\r\n        sum: 0,\r\n        min: Number.POSITIVE_INFINITY,\r\n        max: 0,\r\n        p95Max: 0,\r\n      };\r\n      existing.count += day.count;\r\n      existing.sum += day.avgMs * day.count;\r\n      existing.min = Math.min(existing.min, day.minMs);\r\n      existing.max = Math.max(existing.max, day.maxMs);\r\n      existing.p95Max = Math.max(existing.p95Max, day.p95Ms);\r\n      dailyLatencyMap.set(day.date, existing);\r\n    }\r\n    for (const day of usage.dailyModelUsage ?? []) {\r\n      const key = `${day.date}::${day.provider ?? \"unknown\"}::${day.model ?? \"unknown\"}`;\r\n      const existing = modelDailyMap.get(key) ?? {\r\n        date: day.date,\r\n        provider: day.provider,\r\n        model: day.model,\r\n        tokens: 0,\r\n        cost: 0,\r\n        count: 0,\r\n      };\r\n      existing.tokens += day.tokens;\r\n      existing.cost += day.cost;\r\n      existing.count += day.count;\r\n      modelDailyMap.set(key, existing);\r\n    }\r\n  }\r\n\r\n  return {\r\n    messages,\r\n    tools: {\r\n      totalCalls: Array.from(toolMap.values()).reduce((sum, count) => sum + count, 0),\r\n      uniqueTools: toolMap.size,\r\n      tools: Array.from(toolMap.entries())\r\n        .map(([name, count]) => ({ name, count }))\r\n        .toSorted((a, b) => b.count - a.count),\r\n    },\r\n    byModel: Array.from(modelMap.values()).toSorted(\r\n      (a, b) => b.totals.totalCost - a.totals.totalCost,\r\n    ),\r\n    byProvider: Array.from(providerMap.values()).toSorted(\r\n      (a, b) => b.totals.totalCost - a.totals.totalCost,\r\n    ),\r\n    byAgent: Array.from(agentMap.entries())\r\n      .map(([agentId, totals]) => ({ agentId, totals }))\r\n      .toSorted((a, b) => b.totals.totalCost - a.totals.totalCost),\r\n    byChannel: Array.from(channelMap.entries())\r\n      .map(([channel, totals]) => ({ channel, totals }))\r\n      .toSorted((a, b) => b.totals.totalCost - a.totals.totalCost),\r\n    latency:\r\n      latencyTotals.count > 0\r\n        ? {\r\n            count: latencyTotals.count,\r\n            avgMs: latencyTotals.sum / latencyTotals.count,\r\n            minMs: latencyTotals.min === Number.POSITIVE_INFINITY ? 0 : latencyTotals.min,\r\n            maxMs: latencyTotals.max,\r\n            p95Ms: latencyTotals.p95Max,\r\n          }\r\n        : undefined,\r\n    dailyLatency: Array.from(dailyLatencyMap.values())\r\n      .map((entry) => ({\r\n        date: entry.date,\r\n        count: entry.count,\r\n        avgMs: entry.count ? entry.sum / entry.count : 0,\r\n        minMs: entry.min === Number.POSITIVE_INFINITY ? 0 : entry.min,\r\n        maxMs: entry.max,\r\n        p95Ms: entry.p95Max,\r\n      }))\r\n      .toSorted((a, b) => a.date.localeCompare(b.date)),\r\n    modelDaily: Array.from(modelDailyMap.values()).toSorted(\r\n      (a, b) => a.date.localeCompare(b.date) || b.cost - a.cost,\r\n    ),\r\n    daily: Array.from(dailyMap.values()).toSorted((a, b) => a.date.localeCompare(b.date)),\r\n  };\r\n};\r\n\r\ntype UsageInsightStats = {\r\n  durationSumMs: number;\r\n  durationCount: number;\r\n  avgDurationMs: number;\r\n  throughputTokensPerMin?: number;\r\n  throughputCostPerMin?: number;\r\n  errorRate: number;\r\n  peakErrorDay?: { date: string; errors: number; messages: number; rate: number };\r\n};\r\n\r\nconst buildUsageInsightStats = (\r\n  sessions: UsageSessionEntry[],\r\n  totals: UsageTotals | null,\r\n  aggregates: UsageAggregates,\r\n): UsageInsightStats => {\r\n  let durationSumMs = 0;\r\n  let durationCount = 0;\r\n  for (const session of sessions) {\r\n    const duration = session.usage?.durationMs ?? 0;\r\n    if (duration > 0) {\r\n      durationSumMs += duration;\r\n      durationCount += 1;\r\n    }\r\n  }\r\n\r\n  const avgDurationMs = durationCount ? durationSumMs / durationCount : 0;\r\n  const throughputTokensPerMin =\r\n    totals && durationSumMs > 0 ? totals.totalTokens / (durationSumMs / 60000) : undefined;\r\n  const throughputCostPerMin =\r\n    totals && durationSumMs > 0 ? totals.totalCost / (durationSumMs / 60000) : undefined;\r\n\r\n  const errorRate = aggregates.messages.total\r\n    ? aggregates.messages.errors / aggregates.messages.total\r\n    : 0;\r\n  const peakErrorDay = aggregates.daily\r\n    .filter((day) => day.messages > 0 && day.errors > 0)\r\n    .map((day) => ({\r\n      date: day.date,\r\n      errors: day.errors,\r\n      messages: day.messages,\r\n      rate: day.errors / day.messages,\r\n    }))\r\n    .toSorted((a, b) => b.rate - a.rate || b.errors - a.errors)[0];\r\n\r\n  return {\r\n    durationSumMs,\r\n    durationCount,\r\n    avgDurationMs,\r\n    throughputTokensPerMin,\r\n    throughputCostPerMin,\r\n    errorRate,\r\n    peakErrorDay,\r\n  };\r\n};\r\n\r\nconst buildSessionsCsv = (sessions: UsageSessionEntry[]): string => {\r\n  const rows = [\r\n    toCsvRow([\r\n      \"key\",\r\n      \"label\",\r\n      \"agentId\",\r\n      \"channel\",\r\n      \"provider\",\r\n      \"model\",\r\n      \"updatedAt\",\r\n      \"durationMs\",\r\n      \"messages\",\r\n      \"errors\",\r\n      \"toolCalls\",\r\n      \"inputTokens\",\r\n      \"outputTokens\",\r\n      \"cacheReadTokens\",\r\n      \"cacheWriteTokens\",\r\n      \"totalTokens\",\r\n      \"totalCost\",\r\n    ]),\r\n  ];\r\n\r\n  for (const session of sessions) {\r\n    const usage = session.usage;\r\n    rows.push(\r\n      toCsvRow([\r\n        session.key,\r\n        session.label ?? \"\",\r\n        session.agentId ?? \"\",\r\n        session.channel ?? \"\",\r\n        session.modelProvider ?? session.providerOverride ?? \"\",\r\n        session.model ?? session.modelOverride ?? \"\",\r\n        session.updatedAt ? new Date(session.updatedAt).toISOString() : \"\",\r\n        usage?.durationMs ?? \"\",\r\n        usage?.messageCounts?.total ?? \"\",\r\n        usage?.messageCounts?.errors ?? \"\",\r\n        usage?.messageCounts?.toolCalls ?? \"\",\r\n        usage?.input ?? \"\",\r\n        usage?.output ?? \"\",\r\n        usage?.cacheRead ?? \"\",\r\n        usage?.cacheWrite ?? \"\",\r\n        usage?.totalTokens ?? \"\",\r\n        usage?.totalCost ?? \"\",\r\n      ]),\r\n    );\r\n  }\r\n\r\n  return rows.join(\"\\n\");\r\n};\r\n\r\nconst buildDailyCsv = (daily: CostDailyEntry[]): string => {\r\n  const rows = [\r\n    toCsvRow([\r\n      \"date\",\r\n      \"inputTokens\",\r\n      \"outputTokens\",\r\n      \"cacheReadTokens\",\r\n      \"cacheWriteTokens\",\r\n      \"totalTokens\",\r\n      \"inputCost\",\r\n      \"outputCost\",\r\n      \"cacheReadCost\",\r\n      \"cacheWriteCost\",\r\n      \"totalCost\",\r\n    ]),\r\n  ];\r\n\r\n  for (const day of daily) {\r\n    rows.push(\r\n      toCsvRow([\r\n        day.date,\r\n        day.input,\r\n        day.output,\r\n        day.cacheRead,\r\n        day.cacheWrite,\r\n        day.totalTokens,\r\n        day.inputCost ?? \"\",\r\n        day.outputCost ?? \"\",\r\n        day.cacheReadCost ?? \"\",\r\n        day.cacheWriteCost ?? \"\",\r\n        day.totalCost,\r\n      ]),\r\n    );\r\n  }\r\n\r\n  return rows.join(\"\\n\");\r\n};\r\n\r\ntype QuerySuggestion = {\r\n  label: string;\r\n  value: string;\r\n};\r\n\r\nconst buildQuerySuggestions = (\r\n  query: string,\r\n  sessions: UsageSessionEntry[],\r\n  aggregates?: UsageAggregates | null,\r\n): QuerySuggestion[] => {\r\n  const trimmed = query.trim();\r\n  if (!trimmed) {\r\n    return [];\r\n  }\r\n  const tokens = trimmed.length ? trimmed.split(/\\s+/) : [];\r\n  const lastToken = tokens.length ? tokens[tokens.length - 1] : \"\";\r\n  const [rawKey, rawValue] = lastToken.includes(\":\")\r\n    ? [lastToken.slice(0, lastToken.indexOf(\":\")), lastToken.slice(lastToken.indexOf(\":\") + 1)]\r\n    : [\"\", \"\"];\r\n\r\n  const key = rawKey.toLowerCase();\r\n  const value = rawValue.toLowerCase();\r\n\r\n  const unique = (items: Array<string | undefined>): string[] => {\r\n    const set = new Set<string>();\r\n    for (const item of items) {\r\n      if (item) {\r\n        set.add(item);\r\n      }\r\n    }\r\n    return Array.from(set);\r\n  };\r\n\r\n  const agents = unique(sessions.map((s) => s.agentId)).slice(0, 6);\r\n  const channels = unique(sessions.map((s) => s.channel)).slice(0, 6);\r\n  const providers = unique([\r\n    ...sessions.map((s) => s.modelProvider),\r\n    ...sessions.map((s) => s.providerOverride),\r\n    ...(aggregates?.byProvider.map((p) => p.provider) ?? []),\r\n  ]).slice(0, 6);\r\n  const models = unique([\r\n    ...sessions.map((s) => s.model),\r\n    ...(aggregates?.byModel.map((m) => m.model) ?? []),\r\n  ]).slice(0, 6);\r\n  const tools = unique(aggregates?.tools.tools.map((t) => t.name) ?? []).slice(0, 6);\r\n\r\n  if (!key) {\r\n    return [\r\n      { label: \"agent:\", value: \"agent:\" },\r\n      { label: \"channel:\", value: \"channel:\" },\r\n      { label: \"provider:\", value: \"provider:\" },\r\n      { label: \"model:\", value: \"model:\" },\r\n      { label: \"tool:\", value: \"tool:\" },\r\n      { label: \"has:errors\", value: \"has:errors\" },\r\n      { label: \"has:tools\", value: \"has:tools\" },\r\n      { label: \"minTokens:\", value: \"minTokens:\" },\r\n      { label: \"maxCost:\", value: \"maxCost:\" },\r\n    ];\r\n  }\r\n\r\n  const suggestions: QuerySuggestion[] = [];\r\n  const addValues = (prefix: string, values: string[]) => {\r\n    for (const val of values) {\r\n      if (!value || val.toLowerCase().includes(value)) {\r\n        suggestions.push({ label: `${prefix}:${val}`, value: `${prefix}:${val}` });\r\n      }\r\n    }\r\n  };\r\n\r\n  switch (key) {\r\n    case \"agent\":\r\n      addValues(\"agent\", agents);\r\n      break;\r\n    case \"channel\":\r\n      addValues(\"channel\", channels);\r\n      break;\r\n    case \"provider\":\r\n      addValues(\"provider\", providers);\r\n      break;\r\n    case \"model\":\r\n      addValues(\"model\", models);\r\n      break;\r\n    case \"tool\":\r\n      addValues(\"tool\", tools);\r\n      break;\r\n    case \"has\":\r\n      [\"errors\", \"tools\", \"context\", \"usage\", \"model\", \"provider\"].forEach((entry) => {\r\n        if (!value || entry.includes(value)) {\r\n          suggestions.push({ label: `has:${entry}`, value: `has:${entry}` });\r\n        }\r\n      });\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  return suggestions;\r\n};\r\n\r\nconst applySuggestionToQuery = (query: string, suggestion: string): string => {\r\n  const trimmed = query.trim();\r\n  if (!trimmed) {\r\n    return `${suggestion} `;\r\n  }\r\n  const tokens = trimmed.split(/\\s+/);\r\n  tokens[tokens.length - 1] = suggestion;\r\n  return `${tokens.join(\" \")} `;\r\n};\r\n\r\nconst normalizeQueryText = (value: string): string => value.trim().toLowerCase();\r\n\r\nconst addQueryToken = (query: string, token: string): string => {\r\n  const trimmed = query.trim();\r\n  if (!trimmed) {\r\n    return `${token} `;\r\n  }\r\n  const tokens = trimmed.split(/\\s+/);\r\n  const last = tokens[tokens.length - 1] ?? \"\";\r\n  const tokenKey = token.includes(\":\") ? token.split(\":\")[0] : null;\r\n  const lastKey = last.includes(\":\") ? last.split(\":\")[0] : null;\r\n  if (last.endsWith(\":\") && tokenKey && lastKey === tokenKey) {\r\n    tokens[tokens.length - 1] = token;\r\n    return `${tokens.join(\" \")} `;\r\n  }\r\n  if (tokens.includes(token)) {\r\n    return `${tokens.join(\" \")} `;\r\n  }\r\n  return `${tokens.join(\" \")} ${token} `;\r\n};\r\n\r\nconst removeQueryToken = (query: string, token: string): string => {\r\n  const tokens = query.trim().split(/\\s+/).filter(Boolean);\r\n  const next = tokens.filter((entry) => entry !== token);\r\n  return next.length ? `${next.join(\" \")} ` : \"\";\r\n};\r\n\r\nconst setQueryTokensForKey = (query: string, key: string, values: string[]): string => {\r\n  const normalizedKey = normalizeQueryText(key);\r\n  const tokens = extractQueryTerms(query)\r\n    .filter((term) => normalizeQueryText(term.key ?? \"\") !== normalizedKey)\r\n    .map((term) => term.raw);\r\n  const next = [...tokens, ...values.map((value) => `${key}:${value}`)];\r\n  return next.length ? `${next.join(\" \")} ` : \"\";\r\n};\r\n\r\nfunction pct(part: number, total: number): number {\r\n  if (total === 0) {\r\n    return 0;\r\n  }\r\n  return (part / total) * 100;\r\n}\r\n\r\nfunction getCostBreakdown(totals: UsageTotals) {\r\n  // Use actual costs from API data (already aggregated in backend)\r\n  const totalCost = totals.totalCost || 0;\r\n\r\n  return {\r\n    input: {\r\n      tokens: totals.input,\r\n      cost: totals.inputCost || 0,\r\n      pct: pct(totals.inputCost || 0, totalCost),\r\n    },\r\n    output: {\r\n      tokens: totals.output,\r\n      cost: totals.outputCost || 0,\r\n      pct: pct(totals.outputCost || 0, totalCost),\r\n    },\r\n    cacheRead: {\r\n      tokens: totals.cacheRead,\r\n      cost: totals.cacheReadCost || 0,\r\n      pct: pct(totals.cacheReadCost || 0, totalCost),\r\n    },\r\n    cacheWrite: {\r\n      tokens: totals.cacheWrite,\r\n      cost: totals.cacheWriteCost || 0,\r\n      pct: pct(totals.cacheWriteCost || 0, totalCost),\r\n    },\r\n    totalCost,\r\n  };\r\n}\r\n\r\nfunction renderFilterChips(\r\n  selectedDays: string[],\r\n  selectedHours: number[],\r\n  selectedSessions: string[],\r\n  sessions: UsageSessionEntry[],\r\n  onClearDays: () => void,\r\n  onClearHours: () => void,\r\n  onClearSessions: () => void,\r\n  onClearFilters: () => void,\r\n) {\r\n  const hasFilters =\r\n    selectedDays.length > 0 || selectedHours.length > 0 || selectedSessions.length > 0;\r\n  if (!hasFilters) {\r\n    return nothing;\r\n  }\r\n\r\n  const selectedSession =\r\n    selectedSessions.length === 1 ? sessions.find((s) => s.key === selectedSessions[0]) : null;\r\n  const sessionsLabel = selectedSession\r\n    ? (selectedSession.label || selectedSession.key).slice(0, 20) +\r\n      (selectedSession.label || selectedSession.key).length > 20 ? \"…\" : \"\"\r\n    : selectedSessions.length === 1\r\n      ? selectedSessions[0].slice(0, 8) + \"…\"\r\n      : `${selectedSessions.length} sessions`;\r\n  const sessionsFullName = selectedSession\r\n    ? selectedSession.label || selectedSession.key\r\n    : selectedSessions.length === 1\r\n      ? selectedSessions[0]\r\n      : selectedSessions.join(\", \");\r\n\r\n  const daysLabel = selectedDays.length === 1 ? selectedDays[0] : `${selectedDays.length} days`;\r\n  const hoursLabel =\r\n    selectedHours.length === 1 ? `${selectedHours[0]}:00` : `${selectedHours.length} hours`;\r\n\r\n  return html`\r\n    <div class=\"active-filters\">\r\n      ${\r\n        selectedDays.length > 0\r\n          ? html`\r\n            <div class=\"filter-chip\">\r\n              <span class=\"filter-chip-label\">Days: ${daysLabel}</span>\r\n              <button class=\"filter-chip-remove\" @click=${onClearDays} title=\"Remove filter\">Ã</button>\r\n            </div>\r\n          `\r\n          : nothing\r\n      }\r\n      ${\r\n        selectedHours.length > 0\r\n          ? html`\r\n            <div class=\"filter-chip\">\r\n              <span class=\"filter-chip-label\">Hours: ${hoursLabel}</span>\r\n              <button class=\"filter-chip-remove\" @click=${onClearHours} title=\"Remove filter\">Ã</button>\r\n            </div>\r\n          `\r\n          : nothing\r\n      }\r\n      ${\r\n        selectedSessions.length > 0\r\n          ? html`\r\n            <div class=\"filter-chip\" title=\"${sessionsFullName}\">\r\n              <span class=\"filter-chip-label\">Session: ${sessionsLabel}</span>\r\n              <button class=\"filter-chip-remove\" @click=${onClearSessions} title=\"Remove filter\">Ã</button>\r\n            </div>\r\n          `\r\n          : nothing\r\n      }\r\n      ${\r\n        (selectedDays.length > 0 || selectedHours.length > 0) && selectedSessions.length > 0\r\n          ? html`\r\n            <button class=\"btn btn-sm filter-clear-btn\" @click=${onClearFilters}>\r\n              Clear All\r\n            </button>\r\n          `\r\n          : nothing\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderDailyChartCompact(\r\n  daily: CostDailyEntry[],\r\n  selectedDays: string[],\r\n  chartMode: \"tokens\" | \"cost\",\r\n  dailyChartMode: \"total\" | \"by-type\",\r\n  onDailyChartModeChange: (mode: \"total\" | \"by-type\") => void,\r\n  onSelectDay: (day: string, shiftKey: boolean) => void,\r\n) {\r\n  if (!daily.length) {\r\n    return html`\r\n      <div class=\"daily-chart-compact\">\r\n        <div class=\"sessions-panel-title\">Daily Usage</div>\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">No data</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const isTokenMode = chartMode === \"tokens\";\r\n  const values = daily.map((d) => (isTokenMode ? d.totalTokens : d.totalCost));\r\n  const maxValue = Math.max(...values, isTokenMode ? 1 : 0.0001);\r\n\r\n  // Calculate bar width based on number of days\r\n  const barMaxWidth = daily.length > 30 ? 12 : daily.length > 20 ? 18 : daily.length > 14 ? 24 : 32;\r\n  const showTotals = daily.length <= 14;\r\n\r\n  return html`\r\n    <div class=\"daily-chart-compact\">\r\n      <div class=\"daily-chart-header\">\r\n        <div class=\"chart-toggle small sessions-toggle\">\r\n          <button\r\n            class=\"toggle-btn ${dailyChartMode === \"total\" ? \"active\" : \"\"}\"\r\n            @click=${() => onDailyChartModeChange(\"total\")}\r\n          >\r\n            Total\r\n          </button>\r\n          <button\r\n            class=\"toggle-btn ${dailyChartMode === \"by-type\" ? \"active\" : \"\"}\"\r\n            @click=${() => onDailyChartModeChange(\"by-type\")}\r\n          >\r\n            By Type\r\n          </button>\r\n        </div>\r\n        <div class=\"card-title\">Daily ${isTokenMode ? \"Token\" : \"Cost\"} Usage</div>\r\n      </div>\r\n      <div class=\"daily-chart\">\r\n        <div class=\"daily-chart-bars\" style=\"--bar-max-width: ${barMaxWidth}px\">\r\n          ${daily.map((d, idx) => {\r\n            const value = values[idx];\r\n            const heightPct = (value / maxValue) * 100;\r\n            const isSelected = selectedDays.includes(d.date);\r\n            const label = formatDayLabel(d.date);\r\n            // Shorter label for many days (just day number)\r\n            const shortLabel = daily.length > 20 ? String(parseInt(d.date.slice(8), 10)) : label;\r\n            const labelStyle = daily.length > 20 ? \"font-size: 8px\" : \"\";\r\n            const segments =\r\n              dailyChartMode === \"by-type\"\r\n                ? isTokenMode\r\n                  ? [\r\n                      { value: d.output, class: \"output\" },\r\n                      { value: d.input, class: \"input\" },\r\n                      { value: d.cacheWrite, class: \"cache-write\" },\r\n                      { value: d.cacheRead, class: \"cache-read\" },\r\n                    ]\r\n                  : [\r\n                      { value: d.outputCost ?? 0, class: \"output\" },\r\n                      { value: d.inputCost ?? 0, class: \"input\" },\r\n                      { value: d.cacheWriteCost ?? 0, class: \"cache-write\" },\r\n                      { value: d.cacheReadCost ?? 0, class: \"cache-read\" },\r\n                    ]\r\n                : [];\r\n            const breakdownLines =\r\n              dailyChartMode === \"by-type\"\r\n                ? isTokenMode\r\n                  ? [\r\n                      `Output ${formatTokens(d.output)}`,\r\n                      `Input ${formatTokens(d.input)}`,\r\n                      `Cache write ${formatTokens(d.cacheWrite)}`,\r\n                      `Cache read ${formatTokens(d.cacheRead)}`,\r\n                    ]\r\n                  : [\r\n                      `Output ${formatCost(d.outputCost ?? 0)}`,\r\n                      `Input ${formatCost(d.inputCost ?? 0)}`,\r\n                      `Cache write ${formatCost(d.cacheWriteCost ?? 0)}`,\r\n                      `Cache read ${formatCost(d.cacheReadCost ?? 0)}`,\r\n                    ]\r\n                : [];\r\n            const totalLabel = isTokenMode ? formatTokens(d.totalTokens) : formatCost(d.totalCost);\r\n            return html`\r\n              <div\r\n                class=\"daily-bar-wrapper ${isSelected ? \"selected\" : \"\"}\"\r\n                @click=${(e: MouseEvent) => onSelectDay(d.date, e.shiftKey)}\r\n              >\r\n                ${\r\n                  dailyChartMode === \"by-type\"\r\n                    ? html`\r\n                        <div\r\n                          class=\"daily-bar\"\r\n                          style=\"height: ${heightPct.toFixed(1)}%; display: flex; flex-direction: column;\"\r\n                        >\r\n                          ${(() => {\r\n                            const total = segments.reduce((sum, seg) => sum + seg.value, 0) || 1;\r\n                            return segments.map(\r\n                              (seg) => html`\r\n                                <div\r\n                                  class=\"cost-segment ${seg.class}\"\r\n                                  style=\"height: ${(seg.value / total) * 100}%\"\r\n                                ></div>\r\n                              `,\r\n                            );\r\n                          })()}\r\n                        </div>\r\n                      `\r\n                    : html`\r\n                        <div class=\"daily-bar\" style=\"height: ${heightPct.toFixed(1)}%\"></div>\r\n                      `\r\n                }\r\n                ${showTotals ? html`<div class=\"daily-bar-total\">${totalLabel}</div>` : nothing}\r\n                <div class=\"daily-bar-label\" style=\"${labelStyle}\">${shortLabel}</div>\r\n                <div class=\"daily-bar-tooltip\">\r\n                  <strong>${formatFullDate(d.date)}</strong><br />\r\n                  ${formatTokens(d.totalTokens)} tokens<br />\r\n                  ${formatCost(d.totalCost)}\r\n                  ${\r\n                    breakdownLines.length\r\n                      ? html`${breakdownLines.map((line) => html`<div>${line}</div>`)}`\r\n                      : nothing\r\n                  }\r\n                </div>\r\n              </div>\r\n            `;\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderCostBreakdownCompact(totals: UsageTotals, mode: \"tokens\" | \"cost\") {\r\n  const breakdown = getCostBreakdown(totals);\r\n  const isTokenMode = mode === \"tokens\";\r\n  const totalTokens = totals.totalTokens || 1;\r\n  const tokenPcts = {\r\n    output: pct(totals.output, totalTokens),\r\n    input: pct(totals.input, totalTokens),\r\n    cacheWrite: pct(totals.cacheWrite, totalTokens),\r\n    cacheRead: pct(totals.cacheRead, totalTokens),\r\n  };\r\n\r\n  return html`\r\n    <div class=\"cost-breakdown cost-breakdown-compact\">\r\n      <div class=\"cost-breakdown-header\">${isTokenMode ? \"Tokens\" : \"Cost\"} by Type</div>\r\n      <div class=\"cost-breakdown-bar\">\r\n        <div class=\"cost-segment output\" style=\"width: ${(isTokenMode ? tokenPcts.output : breakdown.output.pct).toFixed(1)}%\"\r\n          title=\"Output: ${isTokenMode ? formatTokens(totals.output) : formatCost(breakdown.output.cost)}\"></div>\r\n        <div class=\"cost-segment input\" style=\"width: ${(isTokenMode ? tokenPcts.input : breakdown.input.pct).toFixed(1)}%\"\r\n          title=\"Input: ${isTokenMode ? formatTokens(totals.input) : formatCost(breakdown.input.cost)}\"></div>\r\n        <div class=\"cost-segment cache-write\" style=\"width: ${(isTokenMode ? tokenPcts.cacheWrite : breakdown.cacheWrite.pct).toFixed(1)}%\"\r\n          title=\"Cache Write: ${isTokenMode ? formatTokens(totals.cacheWrite) : formatCost(breakdown.cacheWrite.cost)}\"></div>\r\n        <div class=\"cost-segment cache-read\" style=\"width: ${(isTokenMode ? tokenPcts.cacheRead : breakdown.cacheRead.pct).toFixed(1)}%\"\r\n          title=\"Cache Read: ${isTokenMode ? formatTokens(totals.cacheRead) : formatCost(breakdown.cacheRead.cost)}\"></div>\r\n      </div>\r\n      <div class=\"cost-breakdown-legend\">\r\n        <span class=\"legend-item\"><span class=\"legend-dot output\"></span>Output ${isTokenMode ? formatTokens(totals.output) : formatCost(breakdown.output.cost)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot input\"></span>Input ${isTokenMode ? formatTokens(totals.input) : formatCost(breakdown.input.cost)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot cache-write\"></span>Cache Write ${isTokenMode ? formatTokens(totals.cacheWrite) : formatCost(breakdown.cacheWrite.cost)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot cache-read\"></span>Cache Read ${isTokenMode ? formatTokens(totals.cacheRead) : formatCost(breakdown.cacheRead.cost)}</span>\r\n      </div>\r\n      <div class=\"cost-breakdown-total\">\r\n        Total: ${isTokenMode ? formatTokens(totals.totalTokens) : formatCost(totals.totalCost)}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderInsightList(\r\n  title: string,\r\n  items: Array<{ label: string; value: string; sub?: string }>,\r\n  emptyLabel: string,\r\n) {\r\n  return html`\r\n    <div class=\"usage-insight-card\">\r\n      <div class=\"usage-insight-title\">${title}</div>\r\n      ${\r\n        items.length === 0\r\n          ? html`<div class=\"muted\">${emptyLabel}</div>`\r\n          : html`\r\n              <div class=\"usage-list\">\r\n                ${items.map(\r\n                  (item) => html`\r\n                    <div class=\"usage-list-item\">\r\n                      <span>${item.label}</span>\r\n                      <span class=\"usage-list-value\">\r\n                        <span>${item.value}</span>\r\n                        ${item.sub ? html`<span class=\"usage-list-sub\">${item.sub}</span>` : nothing}\r\n                      </span>\r\n                    </div>\r\n                  `,\r\n                )}\r\n              </div>\r\n            `\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderPeakErrorList(\r\n  title: string,\r\n  items: Array<{ label: string; value: string; sub?: string }>,\r\n  emptyLabel: string,\r\n) {\r\n  return html`\r\n    <div class=\"usage-insight-card\">\r\n      <div class=\"usage-insight-title\">${title}</div>\r\n      ${\r\n        items.length === 0\r\n          ? html`<div class=\"muted\">${emptyLabel}</div>`\r\n          : html`\r\n              <div class=\"usage-error-list\">\r\n                ${items.map(\r\n                  (item) => html`\r\n                    <div class=\"usage-error-row\">\r\n                      <div class=\"usage-error-date\">${item.label}</div>\r\n                      <div class=\"usage-error-rate\">${item.value}</div>\r\n                      ${item.sub ? html`<div class=\"usage-error-sub\">${item.sub}</div>` : nothing}\r\n                    </div>\r\n                  `,\r\n                )}\r\n              </div>\r\n            `\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderUsageInsights(\r\n  totals: UsageTotals | null,\r\n  aggregates: UsageAggregates,\r\n  stats: UsageInsightStats,\r\n  showCostHint: boolean,\r\n  errorHours: Array<{ label: string; value: string; sub?: string }>,\r\n  sessionCount: number,\r\n  totalSessions: number,\r\n) {\r\n  if (!totals) {\r\n    return nothing;\r\n  }\r\n\r\n  const avgTokens = aggregates.messages.total\r\n    ? Math.round(totals.totalTokens / aggregates.messages.total)\r\n    : 0;\r\n  const avgCost = aggregates.messages.total ? totals.totalCost / aggregates.messages.total : 0;\r\n  const cacheBase = totals.input + totals.cacheRead;\r\n  const cacheHitRate = cacheBase > 0 ? totals.cacheRead / cacheBase : 0;\r\n  const cacheHitLabel = cacheBase > 0 ? `${(cacheHitRate * 100).toFixed(1)}%` : \"—\";\r\n  const errorRatePct = stats.errorRate * 100;\r\n  const throughputLabel =\r\n    stats.throughputTokensPerMin !== undefined\r\n      ? `${formatTokens(Math.round(stats.throughputTokensPerMin))} tok/min`\r\n      : \"—\";\r\n  const throughputCostLabel =\r\n    stats.throughputCostPerMin !== undefined\r\n      ? `${formatCost(stats.throughputCostPerMin, 4)} / min`\r\n      : \"—\";\r\n  const avgDurationLabel =\r\n    stats.durationCount > 0\r\n      ? (formatDurationCompact(stats.avgDurationMs, { spaced: true }) ?? \"—\")\r\n      : \"—\";\r\n  const cacheHint = \"Cache hit rate = cache read / (input + cache read). Higher is better.\";\r\n  const errorHint = \"Error rate = errors / total messages. Lower is better.\";\r\n  const throughputHint = \"Throughput shows tokens per minute over active time. Higher is better.\";\r\n  const tokensHint = \"Average tokens per message in this range.\";\r\n  const costHint = showCostHint\r\n    ? \"Average cost per message when providers report costs. Cost data is missing for some or all sessions in this range.\"\r\n    : \"Average cost per message when providers report costs.\";\r\n\r\n  const errorDays = aggregates.daily\r\n    .filter((day) => day.messages > 0 && day.errors > 0)\r\n    .map((day) => {\r\n      const rate = day.errors / day.messages;\r\n      return {\r\n        label: formatDayLabel(day.date),\r\n        value: `${(rate * 100).toFixed(2)}%`,\r\n        sub: `${day.errors} errors Â· ${day.messages} msgs Â· ${formatTokens(day.tokens)}`,\r\n        rate,\r\n      };\r\n    })\r\n    .toSorted((a, b) => b.rate - a.rate)\r\n    .slice(0, 5)\r\n    .map(({ rate: _rate, ...rest }) => rest);\r\n\r\n  const topModels = aggregates.byModel.slice(0, 5).map((entry) => ({\r\n    label: entry.model ?? \"unknown\",\r\n    value: formatCost(entry.totals.totalCost),\r\n    sub: `${formatTokens(entry.totals.totalTokens)} Â· ${entry.count} msgs`,\r\n  }));\r\n  const topProviders = aggregates.byProvider.slice(0, 5).map((entry) => ({\r\n    label: entry.provider ?? \"unknown\",\r\n    value: formatCost(entry.totals.totalCost),\r\n    sub: `${formatTokens(entry.totals.totalTokens)} Â· ${entry.count} msgs`,\r\n  }));\r\n  const topTools = aggregates.tools.tools.slice(0, 6).map((tool) => ({\r\n    label: tool.name,\r\n    value: `${tool.count}`,\r\n    sub: \"calls\",\r\n  }));\r\n  const topAgents = aggregates.byAgent.slice(0, 5).map((entry) => ({\r\n    label: entry.agentId,\r\n    value: formatCost(entry.totals.totalCost),\r\n    sub: formatTokens(entry.totals.totalTokens),\r\n  }));\r\n  const topChannels = aggregates.byChannel.slice(0, 5).map((entry) => ({\r\n    label: entry.channel,\r\n    value: formatCost(entry.totals.totalCost),\r\n    sub: formatTokens(entry.totals.totalTokens),\r\n  }));\r\n\r\n  return html`\r\n    <section class=\"card\" style=\"margin-top: 16px;\">\r\n      <div class=\"card-title\">Usage Overview</div>\r\n      <div class=\"usage-summary-grid\">\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Messages\r\n            <span class=\"usage-summary-hint\" title=\"Total user + assistant messages in range.\">?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${aggregates.messages.total}</div>\r\n          <div class=\"usage-summary-sub\">\r\n            ${aggregates.messages.user} user Â· ${aggregates.messages.assistant} assistant\r\n          </div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Tool Calls\r\n            <span class=\"usage-summary-hint\" title=\"Total tool call count across sessions.\">?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${aggregates.tools.totalCalls}</div>\r\n          <div class=\"usage-summary-sub\">${aggregates.tools.uniqueTools} tools used</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Errors\r\n            <span class=\"usage-summary-hint\" title=\"Total message/tool errors in range.\">?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${aggregates.messages.errors}</div>\r\n          <div class=\"usage-summary-sub\">${aggregates.messages.toolResults} tool results</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Avg Tokens / Msg\r\n            <span class=\"usage-summary-hint\" title=${tokensHint}>?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${formatTokens(avgTokens)}</div>\r\n          <div class=\"usage-summary-sub\">Across ${aggregates.messages.total || 0} messages</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Avg Cost / Msg\r\n            <span class=\"usage-summary-hint\" title=${costHint}>?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${formatCost(avgCost, 4)}</div>\r\n          <div class=\"usage-summary-sub\">${formatCost(totals.totalCost)} total</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Sessions\r\n            <span class=\"usage-summary-hint\" title=\"Distinct sessions in the range.\">?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${sessionCount}</div>\r\n          <div class=\"usage-summary-sub\">of ${totalSessions} in range</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Throughput\r\n            <span class=\"usage-summary-hint\" title=${throughputHint}>?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value\">${throughputLabel}</div>\r\n          <div class=\"usage-summary-sub\">${throughputCostLabel}</div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Error Rate\r\n            <span class=\"usage-summary-hint\" title=${errorHint}>?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value ${errorRatePct > 5 ? \"bad\" : errorRatePct > 1 ? \"warn\" : \"good\"}\">${errorRatePct.toFixed(2)}%</div>\r\n          <div class=\"usage-summary-sub\">\r\n            ${aggregates.messages.errors} errors Â· ${avgDurationLabel} avg session\r\n          </div>\r\n        </div>\r\n        <div class=\"usage-summary-card\">\r\n          <div class=\"usage-summary-title\">\r\n            Cache Hit Rate\r\n            <span class=\"usage-summary-hint\" title=${cacheHint}>?</span>\r\n          </div>\r\n          <div class=\"usage-summary-value ${cacheHitRate > 0.6 ? \"good\" : cacheHitRate > 0.3 ? \"warn\" : \"bad\"}\">${cacheHitLabel}</div>\r\n          <div class=\"usage-summary-sub\">\r\n            ${formatTokens(totals.cacheRead)} cached Â· ${formatTokens(cacheBase)} prompt\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"usage-insights-grid\">\r\n        ${renderInsightList(\"Top Models\", topModels, \"No model data\")}\r\n        ${renderInsightList(\"Top Providers\", topProviders, \"No provider data\")}\r\n        ${renderInsightList(\"Top Tools\", topTools, \"No tool calls\")}\r\n        ${renderInsightList(\"Top Agents\", topAgents, \"No agent data\")}\r\n        ${renderInsightList(\"Top Channels\", topChannels, \"No channel data\")}\r\n        ${renderPeakErrorList(\"Peak Error Days\", errorDays, \"No error data\")}\r\n        ${renderPeakErrorList(\"Peak Error Hours\", errorHours, \"No error data\")}\r\n      </div>\r\n    </section>\r\n  `;\r\n}\r\n\r\nfunction renderSessionsCard(\r\n  sessions: UsageSessionEntry[],\r\n  selectedSessions: string[],\r\n  selectedDays: string[],\r\n  isTokenMode: boolean,\r\n  sessionSort: \"tokens\" | \"cost\" | \"recent\" | \"messages\" | \"errors\",\r\n  sessionSortDir: \"asc\" | \"desc\",\r\n  recentSessions: string[],\r\n  sessionsTab: \"all\" | \"recent\",\r\n  onSelectSession: (key: string, shiftKey: boolean) => void,\r\n  onSessionSortChange: (sort: \"tokens\" | \"cost\" | \"recent\" | \"messages\" | \"errors\") => void,\r\n  onSessionSortDirChange: (dir: \"asc\" | \"desc\") => void,\r\n  onSessionsTabChange: (tab: \"all\" | \"recent\") => void,\r\n  visibleColumns: UsageColumnId[],\r\n  totalSessions: number,\r\n  onClearSessions: () => void,\r\n) {\r\n  const showColumn = (id: UsageColumnId) => visibleColumns.includes(id);\r\n  const formatSessionListLabel = (s: UsageSessionEntry): string => {\r\n    const raw = s.label || s.key;\r\n    // Agent session keys often include a token query param; remove it for readability.\r\n    if (raw.startsWith(\"agent:\") && raw.includes(\"?token=\")) {\r\n      return raw.slice(0, raw.indexOf(\"?token=\"));\r\n    }\r\n    return raw;\r\n  };\r\n  const copySessionName = async (s: UsageSessionEntry) => {\r\n    const text = formatSessionListLabel(s);\r\n    try {\r\n      await navigator.clipboard.writeText(text);\r\n    } catch {\r\n      // Best effort; clipboard can fail on insecure contexts or denied permission.\r\n    }\r\n  };\r\n\r\n  const buildSessionMeta = (s: UsageSessionEntry): string[] => {\r\n    const parts: string[] = [];\r\n    if (showColumn(\"channel\") && s.channel) {\r\n      parts.push(`channel:${s.channel}`);\r\n    }\r\n    if (showColumn(\"agent\") && s.agentId) {\r\n      parts.push(`agent:${s.agentId}`);\r\n    }\r\n    if (showColumn(\"provider\") && (s.modelProvider || s.providerOverride)) {\r\n      parts.push(`provider:${s.modelProvider ?? s.providerOverride}`);\r\n    }\r\n    if (showColumn(\"model\") && s.model) {\r\n      parts.push(`model:${s.model}`);\r\n    }\r\n    if (showColumn(\"messages\") && s.usage?.messageCounts) {\r\n      parts.push(`msgs:${s.usage.messageCounts.total}`);\r\n    }\r\n    if (showColumn(\"tools\") && s.usage?.toolUsage) {\r\n      parts.push(`tools:${s.usage.toolUsage.totalCalls}`);\r\n    }\r\n    if (showColumn(\"errors\") && s.usage?.messageCounts) {\r\n      parts.push(`errors:${s.usage.messageCounts.errors}`);\r\n    }\r\n    if (showColumn(\"duration\") && s.usage?.durationMs) {\r\n      parts.push(`dur:${formatDurationCompact(s.usage.durationMs, { spaced: true }) ?? \"\"}`);\r\n    }\r\n    return parts;\r\n  };\r\n\r\n  // Helper to get session value (filtered by days if selected)\r\n  const getSessionValue = (s: UsageSessionEntry): number => {\r\n    const usage = s.usage;\r\n    if (!usage) {\r\n      return 0;\r\n    }\r\n\r\n    // If days are selected and session has daily breakdown, compute filtered total\r\n    if (selectedDays.length > 0 && usage.dailyBreakdown && usage.dailyBreakdown.length > 0) {\r\n      const filteredDays = usage.dailyBreakdown.filter((d) => selectedDays.includes(d.date));\r\n      return isTokenMode\r\n        ? filteredDays.reduce((sum, d) => sum + d.tokens, 0)\r\n        : filteredDays.reduce((sum, d) => sum + d.cost, 0);\r\n    }\r\n\r\n    // Otherwise use total\r\n    return isTokenMode ? (usage.totalTokens ?? 0) : (usage.totalCost ?? 0);\r\n  };\r\n\r\n  const sortedSessions = [...sessions].toSorted((a, b) => {\r\n    switch (sessionSort) {\r\n      case \"recent\":\r\n        return (b.updatedAt ?? 0) - (a.updatedAt ?? 0);\r\n      case \"messages\":\r\n        return (b.usage?.messageCounts?.total ?? 0) - (a.usage?.messageCounts?.total ?? 0);\r\n      case \"errors\":\r\n        return (b.usage?.messageCounts?.errors ?? 0) - (a.usage?.messageCounts?.errors ?? 0);\r\n      case \"cost\":\r\n        return getSessionValue(b) - getSessionValue(a);\r\n      case \"tokens\":\r\n      default:\r\n        return getSessionValue(b) - getSessionValue(a);\r\n    }\r\n  });\r\n  const sortedWithDir = sessionSortDir === \"asc\" ? sortedSessions.toReversed() : sortedSessions;\r\n\r\n  const totalValue = sortedWithDir.reduce((sum, session) => sum + getSessionValue(session), 0);\r\n  const avgValue = sortedWithDir.length ? totalValue / sortedWithDir.length : 0;\r\n  const totalErrors = sortedWithDir.reduce(\r\n    (sum, session) => sum + (session.usage?.messageCounts?.errors ?? 0),\r\n    0,\r\n  );\r\n\r\n  const selectedSet = new Set(selectedSessions);\r\n  const selectedEntries = sortedWithDir.filter((s) => selectedSet.has(s.key));\r\n  const selectedCount = selectedEntries.length;\r\n  const sessionMap = new Map(sortedWithDir.map((s) => [s.key, s]));\r\n  const recentEntries = recentSessions\r\n    .map((key) => sessionMap.get(key))\r\n    .filter((entry): entry is UsageSessionEntry => Boolean(entry));\r\n\r\n  return html`\r\n    <div class=\"card sessions-card\">\r\n      <div class=\"sessions-card-header\">\r\n        <div class=\"card-title\">Sessions</div>\r\n        <div class=\"sessions-card-count\">\r\n          ${sessions.length} shown${totalSessions !== sessions.length ? ` Â· ${totalSessions} total` : \"\"}\r\n        </div>\r\n      </div>\r\n      <div class=\"sessions-card-meta\">\r\n        <div class=\"sessions-card-stats\">\r\n          <span>${isTokenMode ? formatTokens(avgValue) : formatCost(avgValue)} avg</span>\r\n          <span>${totalErrors} errors</span>\r\n        </div>\r\n        <div class=\"chart-toggle small\">\r\n          <button\r\n            class=\"toggle-btn ${sessionsTab === \"all\" ? \"active\" : \"\"}\"\r\n            @click=${() => onSessionsTabChange(\"all\")}\r\n          >\r\n            All\r\n          </button>\r\n          <button\r\n            class=\"toggle-btn ${sessionsTab === \"recent\" ? \"active\" : \"\"}\"\r\n            @click=${() => onSessionsTabChange(\"recent\")}\r\n          >\r\n            Recently viewed\r\n          </button>\r\n        </div>\r\n        <label class=\"sessions-sort\">\r\n          <span>Sort</span>\r\n          <select\r\n            @change=${(e: Event) => onSessionSortChange((e.target as HTMLSelectElement).value as typeof sessionSort)}\r\n          >\r\n            <option value=\"cost\" ?selected=${sessionSort === \"cost\"}>Cost</option>\r\n            <option value=\"errors\" ?selected=${sessionSort === \"errors\"}>Errors</option>\r\n            <option value=\"messages\" ?selected=${sessionSort === \"messages\"}>Messages</option>\r\n            <option value=\"recent\" ?selected=${sessionSort === \"recent\"}>Recent</option>\r\n            <option value=\"tokens\" ?selected=${sessionSort === \"tokens\"}>Tokens</option>\r\n          </select>\r\n        </label>\r\n        <button\r\n          class=\"btn btn-sm sessions-action-btn icon\"\r\n          @click=${() => onSessionSortDirChange(sessionSortDir === \"desc\" ? \"asc\" : \"desc\")}\r\n          title=${sessionSortDir === \"desc\" ? \"Descending\" : \"Ascending\"}\r\n        >\r\n          ${sessionSortDir === \"desc\" ? \"↑\" : \"↓\"}\r\n        </button>\r\n        ${\r\n          selectedCount > 0\r\n            ? html`\r\n                <button class=\"btn btn-sm sessions-action-btn sessions-clear-btn\" @click=${onClearSessions}>\r\n                  Clear Selection\r\n                </button>\r\n              `\r\n            : nothing\r\n        }\r\n      </div>\r\n      ${\r\n        sessionsTab === \"recent\"\r\n          ? recentEntries.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"padding: 20px; text-align: center\">No recent sessions</div>\r\n              `\r\n            : html`\r\n                <div class=\"session-bars\" style=\"max-height: 220px; margin-top: 6px;\">\r\n                  ${recentEntries.map((s) => {\r\n                    const value = getSessionValue(s);\r\n                    const isSelected = selectedSet.has(s.key);\r\n                    const displayLabel = formatSessionListLabel(s);\r\n                    const meta = buildSessionMeta(s);\r\n                    return html`\r\n                      <div\r\n                        class=\"session-bar-row ${isSelected ? \"selected\" : \"\"}\"\r\n                        @click=${(e: MouseEvent) => onSelectSession(s.key, e.shiftKey)}\r\n                        title=\"${s.key}\"\r\n                      >\r\n                        <div class=\"session-bar-label\">\r\n                          <div class=\"session-bar-title\">${displayLabel}</div>\r\n                          ${meta.length > 0 ? html`<div class=\"session-bar-meta\">${meta.join(\" Â· \")}</div>` : nothing}\r\n                        </div>\r\n                        <div class=\"session-bar-track\" style=\"display: none;\"></div>\r\n                        <div class=\"session-bar-actions\">\r\n                          <button\r\n                            class=\"session-copy-btn\"\r\n                            title=\"Copy session name\"\r\n                            @click=${(e: MouseEvent) => {\r\n                              e.stopPropagation();\r\n                              void copySessionName(s);\r\n                            }}\r\n                          >\r\n                            Copy\r\n                          </button>\r\n                          <div class=\"session-bar-value\">${isTokenMode ? formatTokens(value) : formatCost(value)}</div>\r\n                        </div>\r\n                      </div>\r\n                    `;\r\n                  })}\r\n                </div>\r\n              `\r\n          : sessions.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"padding: 20px; text-align: center\">No sessions in range</div>\r\n              `\r\n            : html`\r\n                <div class=\"session-bars\">\r\n                  ${sortedWithDir.slice(0, 50).map((s) => {\r\n                    const value = getSessionValue(s);\r\n                    const isSelected = selectedSessions.includes(s.key);\r\n                    const displayLabel = formatSessionListLabel(s);\r\n                    const meta = buildSessionMeta(s);\r\n\r\n                    return html`\r\n                      <div\r\n                        class=\"session-bar-row ${isSelected ? \"selected\" : \"\"}\"\r\n                        @click=${(e: MouseEvent) => onSelectSession(s.key, e.shiftKey)}\r\n                        title=\"${s.key}\"\r\n                      >\r\n                        <div class=\"session-bar-label\">\r\n                          <div class=\"session-bar-title\">${displayLabel}</div>\r\n                          ${meta.length > 0 ? html`<div class=\"session-bar-meta\">${meta.join(\" Â· \")}</div>` : nothing}\r\n                        </div>\r\n                        <div class=\"session-bar-track\" style=\"display: none;\"></div>\r\n                        <div class=\"session-bar-actions\">\r\n                          <button\r\n                            class=\"session-copy-btn\"\r\n                            title=\"Copy session name\"\r\n                            @click=${(e: MouseEvent) => {\r\n                              e.stopPropagation();\r\n                              void copySessionName(s);\r\n                            }}\r\n                          >\r\n                            Copy\r\n                          </button>\r\n                          <div class=\"session-bar-value\">${isTokenMode ? formatTokens(value) : formatCost(value)}</div>\r\n                        </div>\r\n                      </div>\r\n                    `;\r\n                  })}\r\n                  ${sessions.length > 50 ? html`<div class=\"muted\" style=\"padding: 8px; text-align: center; font-size: 11px;\">+${sessions.length - 50} more</div>` : nothing}\r\n                </div>\r\n              `\r\n      }\r\n      ${\r\n        selectedCount > 1\r\n          ? html`\r\n              <div style=\"margin-top: 10px;\">\r\n                <div class=\"sessions-card-count\">Selected (${selectedCount})</div>\r\n                <div class=\"session-bars\" style=\"max-height: 160px; margin-top: 6px;\">\r\n                  ${selectedEntries.map((s) => {\r\n                    const value = getSessionValue(s);\r\n                    const displayLabel = formatSessionListLabel(s);\r\n                    const meta = buildSessionMeta(s);\r\n                    return html`\r\n                      <div\r\n                        class=\"session-bar-row selected\"\r\n                        @click=${(e: MouseEvent) => onSelectSession(s.key, e.shiftKey)}\r\n                        title=\"${s.key}\"\r\n                      >\r\n                        <div class=\"session-bar-label\">\r\n                          <div class=\"session-bar-title\">${displayLabel}</div>\r\n                          ${meta.length > 0 ? html`<div class=\"session-bar-meta\">${meta.join(\" Â· \")}</div>` : nothing}\r\n                        </div>\r\n                  <div class=\"session-bar-track\" style=\"display: none;\"></div>\r\n                        <div class=\"session-bar-actions\">\r\n                          <button\r\n                            class=\"session-copy-btn\"\r\n                            title=\"Copy session name\"\r\n                            @click=${(e: MouseEvent) => {\r\n                              e.stopPropagation();\r\n                              void copySessionName(s);\r\n                            }}\r\n                          >\r\n                            Copy\r\n                          </button>\r\n                          <div class=\"session-bar-value\">${isTokenMode ? formatTokens(value) : formatCost(value)}</div>\r\n                        </div>\r\n                      </div>\r\n                    `;\r\n                  })}\r\n                </div>\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderEmptyDetailState() {\r\n  return nothing;\r\n}\r\n\r\nfunction renderSessionSummary(session: UsageSessionEntry) {\r\n  const usage = session.usage;\r\n  if (!usage) {\r\n    return html`\r\n      <div class=\"muted\">No usage data for this session.</div>\r\n    `;\r\n  }\r\n\r\n  const formatTs = (ts?: number): string => (ts ? new Date(ts).toLocaleString() : \"\");\r\n\r\n  const badges: string[] = [];\r\n  if (session.channel) {\r\n    badges.push(`channel:${session.channel}`);\r\n  }\r\n  if (session.agentId) {\r\n    badges.push(`agent:${session.agentId}`);\r\n  }\r\n  if (session.modelProvider || session.providerOverride) {\r\n    badges.push(`provider:${session.modelProvider ?? session.providerOverride}`);\r\n  }\r\n  if (session.model) {\r\n    badges.push(`model:${session.model}`);\r\n  }\r\n\r\n  const toolItems =\r\n    usage.toolUsage?.tools.slice(0, 6).map((tool) => ({\r\n      label: tool.name,\r\n      value: `${tool.count}`,\r\n      sub: \"calls\",\r\n    })) ?? [];\r\n  const modelItems =\r\n    usage.modelUsage?.slice(0, 6).map((entry) => ({\r\n      label: entry.model ?? \"unknown\",\r\n      value: formatCost(entry.totals.totalCost),\r\n      sub: formatTokens(entry.totals.totalTokens),\r\n    })) ?? [];\r\n\r\n  return html`\r\n    ${badges.length > 0 ? html`<div class=\"usage-badges\">${badges.map((b) => html`<span class=\"usage-badge\">${b}</span>`)}</div>` : nothing}\r\n    <div class=\"session-summary-grid\">\r\n      <div class=\"session-summary-card\">\r\n        <div class=\"session-summary-title\">Messages</div>\r\n        <div class=\"session-summary-value\">${usage.messageCounts?.total ?? 0}</div>\r\n        <div class=\"session-summary-meta\">${usage.messageCounts?.user ?? 0} user Â· ${usage.messageCounts?.assistant ?? 0} assistant</div>\r\n      </div>\r\n      <div class=\"session-summary-card\">\r\n        <div class=\"session-summary-title\">Tool Calls</div>\r\n        <div class=\"session-summary-value\">${usage.toolUsage?.totalCalls ?? 0}</div>\r\n        <div class=\"session-summary-meta\">${usage.toolUsage?.uniqueTools ?? 0} tools</div>\r\n      </div>\r\n      <div class=\"session-summary-card\">\r\n        <div class=\"session-summary-title\">Errors</div>\r\n        <div class=\"session-summary-value\">${usage.messageCounts?.errors ?? 0}</div>\r\n        <div class=\"session-summary-meta\">${usage.messageCounts?.toolResults ?? 0} tool results</div>\r\n      </div>\r\n      <div class=\"session-summary-card\">\r\n        <div class=\"session-summary-title\">Duration</div>\r\n        <div class=\"session-summary-value\">${formatDurationCompact(usage.durationMs, { spaced: true }) ?? \"\"}</div>\r\n        <div class=\"session-summary-meta\">${formatTs(usage.firstActivity)} - ${formatTs(usage.lastActivity)}</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"usage-insights-grid\" style=\"margin-top: 12px;\">\r\n      ${renderInsightList(\"Top Tools\", toolItems, \"No tool calls\")}\r\n      ${renderInsightList(\"Model Mix\", modelItems, \"No model data\")}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSessionDetailPanel(\r\n  session: UsageSessionEntry,\r\n  timeSeries: { points: TimeSeriesPoint[] } | null,\r\n  timeSeriesLoading: boolean,\r\n  timeSeriesMode: \"cumulative\" | \"per-turn\",\r\n  onTimeSeriesModeChange: (mode: \"cumulative\" | \"per-turn\") => void,\r\n  timeSeriesBreakdownMode: \"total\" | \"by-type\",\r\n  onTimeSeriesBreakdownChange: (mode: \"total\" | \"by-type\") => void,\r\n  startDate: string,\r\n  endDate: string,\r\n  selectedDays: string[],\r\n  sessionLogs: SessionLogEntry[] | null,\r\n  sessionLogsLoading: boolean,\r\n  sessionLogsExpanded: boolean,\r\n  onToggleSessionLogsExpanded: () => void,\r\n  logFilters: {\r\n    roles: SessionLogRole[];\r\n    tools: string[];\r\n    hasTools: boolean;\r\n    query: string;\r\n  },\r\n  onLogFilterRolesChange: (next: SessionLogRole[]) => void,\r\n  onLogFilterToolsChange: (next: string[]) => void,\r\n  onLogFilterHasToolsChange: (next: boolean) => void,\r\n  onLogFilterQueryChange: (next: string) => void,\r\n  onLogFilterClear: () => void,\r\n  contextExpanded: boolean,\r\n  onToggleContextExpanded: () => void,\r\n  onClose: () => void,\r\n) {\r\n  const label = session.label || session.key;\r\n  const displayLabel = label.length > 50 ? label.slice(0, 50) + \"…\" : label;\r\n  const usage = session.usage;\r\n\r\n  return html`\r\n    <div class=\"card session-detail-panel\">\r\n      <div class=\"session-detail-header\">\r\n        <div class=\"session-detail-header-left\">\r\n          <div class=\"session-detail-title\">${displayLabel}</div>\r\n        </div>\r\n        <div class=\"session-detail-stats\">\r\n          ${\r\n            usage\r\n              ? html`\r\n            <span><strong>${formatTokens(usage.totalTokens)}</strong> tokens</span>\r\n            <span><strong>${formatCost(usage.totalCost)}</strong></span>\r\n          `\r\n              : nothing\r\n          }\r\n        </div>\r\n        <button class=\"session-close-btn\" @click=${onClose} title=\"Close session details\">Ã</button>\r\n      </div>\r\n      <div class=\"session-detail-content\">\r\n        ${renderSessionSummary(session)}\r\n        <div class=\"session-detail-row\">\r\n          ${renderTimeSeriesCompact(\r\n            timeSeries,\r\n            timeSeriesLoading,\r\n            timeSeriesMode,\r\n            onTimeSeriesModeChange,\r\n            timeSeriesBreakdownMode,\r\n            onTimeSeriesBreakdownChange,\r\n            startDate,\r\n            endDate,\r\n            selectedDays,\r\n          )}\r\n        </div>\r\n        <div class=\"session-detail-bottom\">\r\n          ${renderSessionLogsCompact(\r\n            sessionLogs,\r\n            sessionLogsLoading,\r\n            sessionLogsExpanded,\r\n            onToggleSessionLogsExpanded,\r\n            logFilters,\r\n            onLogFilterRolesChange,\r\n            onLogFilterToolsChange,\r\n            onLogFilterHasToolsChange,\r\n            onLogFilterQueryChange,\r\n            onLogFilterClear,\r\n          )}\r\n          ${renderContextPanel(session.contextWeight, usage, contextExpanded, onToggleContextExpanded)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderTimeSeriesCompact(\r\n  timeSeries: { points: TimeSeriesPoint[] } | null,\r\n  loading: boolean,\r\n  mode: \"cumulative\" | \"per-turn\",\r\n  onModeChange: (mode: \"cumulative\" | \"per-turn\") => void,\r\n  breakdownMode: \"total\" | \"by-type\",\r\n  onBreakdownChange: (mode: \"total\" | \"by-type\") => void,\r\n  startDate?: string,\r\n  endDate?: string,\r\n  selectedDays?: string[],\r\n) {\r\n  if (loading) {\r\n    return html`\r\n      <div class=\"session-timeseries-compact\">\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">Loading...</div>\r\n      </div>\r\n    `;\r\n  }\r\n  if (!timeSeries || timeSeries.points.length < 2) {\r\n    return html`\r\n      <div class=\"session-timeseries-compact\">\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">No timeline data</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // Filter and recalculate (same logic as main function)\r\n  let points = timeSeries.points;\r\n  if (startDate || endDate || (selectedDays && selectedDays.length > 0)) {\r\n    const startTs = startDate ? new Date(startDate + \"T00:00:00\").getTime() : 0;\r\n    const endTs = endDate ? new Date(endDate + \"T23:59:59\").getTime() : Infinity;\r\n    points = timeSeries.points.filter((p) => {\r\n      if (p.timestamp < startTs || p.timestamp > endTs) {\r\n        return false;\r\n      }\r\n      if (selectedDays && selectedDays.length > 0) {\r\n        const d = new Date(p.timestamp);\r\n        const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`;\r\n        return selectedDays.includes(dateStr);\r\n      }\r\n      return true;\r\n    });\r\n  }\r\n  if (points.length < 2) {\r\n    return html`\r\n      <div class=\"session-timeseries-compact\">\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">No data in range</div>\r\n      </div>\r\n    `;\r\n  }\r\n  let cumTokens = 0,\r\n    cumCost = 0;\r\n  let sumOutput = 0;\r\n  let sumInput = 0;\r\n  let sumCacheRead = 0;\r\n  let sumCacheWrite = 0;\r\n  points = points.map((p) => {\r\n    cumTokens += p.totalTokens;\r\n    cumCost += p.cost;\r\n    sumOutput += p.output;\r\n    sumInput += p.input;\r\n    sumCacheRead += p.cacheRead;\r\n    sumCacheWrite += p.cacheWrite;\r\n    return { ...p, cumulativeTokens: cumTokens, cumulativeCost: cumCost };\r\n  });\r\n\r\n  const width = 400,\r\n    height = 80;\r\n  const padding = { top: 16, right: 10, bottom: 20, left: 40 };\r\n  const chartWidth = width - padding.left - padding.right;\r\n  const chartHeight = height - padding.top - padding.bottom;\r\n  const isCumulative = mode === \"cumulative\";\r\n  const breakdownByType = mode === \"per-turn\" && breakdownMode === \"by-type\";\r\n  const totalTypeTokens = sumOutput + sumInput + sumCacheRead + sumCacheWrite;\r\n  const barTotals = points.map((p) =>\r\n    isCumulative\r\n      ? p.cumulativeTokens\r\n      : breakdownByType\r\n        ? p.input + p.output + p.cacheRead + p.cacheWrite\r\n        : p.totalTokens,\r\n  );\r\n  const maxValue = Math.max(...barTotals, 1);\r\n  const barWidth = Math.max(2, Math.min(8, (chartWidth / points.length) * 0.7));\r\n  const barGap = Math.max(1, (chartWidth - barWidth * points.length) / (points.length - 1 || 1));\r\n\r\n  return html`\r\n    <div class=\"session-timeseries-compact\">\r\n      <div class=\"timeseries-header-row\">\r\n        <div class=\"card-title\" style=\"font-size: 13px;\">Usage Over Time</div>\r\n        <div class=\"timeseries-controls\">\r\n          <div class=\"chart-toggle small\">\r\n            <button\r\n              class=\"toggle-btn ${!isCumulative ? \"active\" : \"\"}\"\r\n              @click=${() => onModeChange(\"per-turn\")}\r\n            >\r\n              Per Turn\r\n            </button>\r\n            <button\r\n              class=\"toggle-btn ${isCumulative ? \"active\" : \"\"}\"\r\n              @click=${() => onModeChange(\"cumulative\")}\r\n            >\r\n              Cumulative\r\n            </button>\r\n          </div>\r\n          ${\r\n            !isCumulative\r\n              ? html`\r\n                  <div class=\"chart-toggle small\">\r\n                    <button\r\n                      class=\"toggle-btn ${breakdownMode === \"total\" ? \"active\" : \"\"}\"\r\n                      @click=${() => onBreakdownChange(\"total\")}\r\n                    >\r\n                      Total\r\n                    </button>\r\n                    <button\r\n                      class=\"toggle-btn ${breakdownMode === \"by-type\" ? \"active\" : \"\"}\"\r\n                      @click=${() => onBreakdownChange(\"by-type\")}\r\n                    >\r\n                      By Type\r\n                    </button>\r\n                  </div>\r\n                `\r\n              : nothing\r\n          }\r\n        </div>\r\n      </div>\r\n      <svg viewBox=\"0 0 ${width} ${height + 15}\" class=\"timeseries-svg\" style=\"width: 100%; height: auto;\">\r\n        <!-- Y axis -->\r\n        <line x1=\"${padding.left}\" y1=\"${padding.top}\" x2=\"${padding.left}\" y2=\"${padding.top + chartHeight}\" stroke=\"var(--border)\" />\r\n        <!-- X axis -->\r\n        <line x1=\"${padding.left}\" y1=\"${padding.top + chartHeight}\" x2=\"${width - padding.right}\" y2=\"${padding.top + chartHeight}\" stroke=\"var(--border)\" />\r\n        <!-- Y axis labels -->\r\n        <text x=\"${padding.left - 4}\" y=\"${padding.top + 4}\" text-anchor=\"end\" class=\"axis-label\" style=\"font-size: 9px; fill: var(--text-muted)\">${formatTokens(maxValue)}</text>\r\n        <text x=\"${padding.left - 4}\" y=\"${padding.top + chartHeight}\" text-anchor=\"end\" class=\"axis-label\" style=\"font-size: 9px; fill: var(--text-muted)\">0</text>\r\n        <!-- X axis labels (first and last) -->\r\n        ${\r\n          points.length > 0\r\n            ? svg`\r\n          <text x=\"${padding.left}\" y=\"${padding.top + chartHeight + 12}\" text-anchor=\"start\" style=\"font-size: 8px; fill: var(--text-muted)\">${new Date(points[0].timestamp).toLocaleDateString(undefined, { month: \"short\", day: \"numeric\" })}</text>\r\n          <text x=\"${width - padding.right}\" y=\"${padding.top + chartHeight + 12}\" text-anchor=\"end\" style=\"font-size: 8px; fill: var(--text-muted)\">${new Date(points[points.length - 1].timestamp).toLocaleDateString(undefined, { month: \"short\", day: \"numeric\" })}</text>\r\n        `\r\n            : nothing\r\n        }\r\n        <!-- Bars -->\r\n        ${points.map((p, i) => {\r\n          const val = barTotals[i];\r\n          const x = padding.left + i * (barWidth + barGap);\r\n          const barHeight = (val / maxValue) * chartHeight;\r\n          const y = padding.top + chartHeight - barHeight;\r\n          const date = new Date(p.timestamp);\r\n          const tooltipLines = [\r\n            date.toLocaleDateString(undefined, {\r\n              month: \"short\",\r\n              day: \"numeric\",\r\n              hour: \"2-digit\",\r\n              minute: \"2-digit\",\r\n            }),\r\n            `${formatTokens(val)} tokens`,\r\n          ];\r\n          if (breakdownByType) {\r\n            tooltipLines.push(`Output ${formatTokens(p.output)}`);\r\n            tooltipLines.push(`Input ${formatTokens(p.input)}`);\r\n            tooltipLines.push(`Cache write ${formatTokens(p.cacheWrite)}`);\r\n            tooltipLines.push(`Cache read ${formatTokens(p.cacheRead)}`);\r\n          }\r\n          const tooltip = tooltipLines.join(\" Â· \");\r\n          if (!breakdownByType) {\r\n            return svg`<rect x=\"${x}\" y=\"${y}\" width=\"${barWidth}\" height=\"${barHeight}\" class=\"ts-bar\" rx=\"1\" style=\"cursor: pointer;\"><title>${tooltip}</title></rect>`;\r\n          }\r\n          const segments = [\r\n            { value: p.output, class: \"output\" },\r\n            { value: p.input, class: \"input\" },\r\n            { value: p.cacheWrite, class: \"cache-write\" },\r\n            { value: p.cacheRead, class: \"cache-read\" },\r\n          ];\r\n          let yCursor = padding.top + chartHeight;\r\n          return svg`\r\n            ${segments.map((seg) => {\r\n              if (seg.value <= 0 || val <= 0) {\r\n                return nothing;\r\n              }\r\n              const segHeight = barHeight * (seg.value / val);\r\n              yCursor -= segHeight;\r\n              return svg`<rect x=\"${x}\" y=\"${yCursor}\" width=\"${barWidth}\" height=\"${segHeight}\" class=\"ts-bar ${seg.class}\" rx=\"1\"><title>${tooltip}</title></rect>`;\r\n            })}\r\n          `;\r\n        })}\r\n      </svg>\r\n      <div class=\"timeseries-summary\">${points.length} msgs Â· ${formatTokens(cumTokens)} Â· ${formatCost(cumCost)}</div>\r\n      ${\r\n        breakdownByType\r\n          ? html`\r\n              <div style=\"margin-top: 8px;\">\r\n                <div class=\"card-title\" style=\"font-size: 12px; margin-bottom: 6px;\">Tokens by Type</div>\r\n                <div class=\"cost-breakdown-bar\" style=\"height: 18px;\">\r\n                  <div class=\"cost-segment output\" style=\"width: ${pct(sumOutput, totalTypeTokens).toFixed(1)}%\"></div>\r\n                  <div class=\"cost-segment input\" style=\"width: ${pct(sumInput, totalTypeTokens).toFixed(1)}%\"></div>\r\n                  <div class=\"cost-segment cache-write\" style=\"width: ${pct(sumCacheWrite, totalTypeTokens).toFixed(1)}%\"></div>\r\n                  <div class=\"cost-segment cache-read\" style=\"width: ${pct(sumCacheRead, totalTypeTokens).toFixed(1)}%\"></div>\r\n                </div>\r\n                <div class=\"cost-breakdown-legend\">\r\n                  <div class=\"legend-item\" title=\"Assistant output tokens\">\r\n                    <span class=\"legend-dot output\"></span>Output ${formatTokens(sumOutput)}\r\n                  </div>\r\n                  <div class=\"legend-item\" title=\"User + tool input tokens\">\r\n                    <span class=\"legend-dot input\"></span>Input ${formatTokens(sumInput)}\r\n                  </div>\r\n                  <div class=\"legend-item\" title=\"Tokens written to cache\">\r\n                    <span class=\"legend-dot cache-write\"></span>Cache Write ${formatTokens(sumCacheWrite)}\r\n                  </div>\r\n                  <div class=\"legend-item\" title=\"Tokens read from cache\">\r\n                    <span class=\"legend-dot cache-read\"></span>Cache Read ${formatTokens(sumCacheRead)}\r\n                  </div>\r\n                </div>\r\n                <div class=\"cost-breakdown-total\">Total: ${formatTokens(totalTypeTokens)}</div>\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderContextPanel(\r\n  contextWeight: UsageSessionEntry[\"contextWeight\"],\r\n  usage: UsageSessionEntry[\"usage\"],\r\n  expanded: boolean,\r\n  onToggleExpanded: () => void,\r\n) {\r\n  if (!contextWeight) {\r\n    return html`\r\n      <div class=\"context-details-panel\">\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">No context data</div>\r\n      </div>\r\n    `;\r\n  }\r\n  const systemTokens = charsToTokens(contextWeight.systemPrompt.chars);\r\n  const skillsTokens = charsToTokens(contextWeight.skills.promptChars);\r\n  const toolsTokens = charsToTokens(\r\n    contextWeight.tools.listChars + contextWeight.tools.schemaChars,\r\n  );\r\n  const filesTokens = charsToTokens(\r\n    contextWeight.injectedWorkspaceFiles.reduce((sum, f) => sum + f.injectedChars, 0),\r\n  );\r\n  const totalContextTokens = systemTokens + skillsTokens + toolsTokens + filesTokens;\r\n\r\n  let contextPct = \"\";\r\n  if (usage && usage.totalTokens > 0) {\r\n    const inputTokens = usage.input + usage.cacheRead;\r\n    if (inputTokens > 0) {\r\n      contextPct = `~${Math.min((totalContextTokens / inputTokens) * 100, 100).toFixed(0)}% of input`;\r\n    }\r\n  }\r\n\r\n  const skillsList = contextWeight.skills.entries.toSorted((a, b) => b.blockChars - a.blockChars);\r\n  const toolsList = contextWeight.tools.entries.toSorted(\r\n    (a, b) => b.summaryChars + b.schemaChars - (a.summaryChars + a.schemaChars),\r\n  );\r\n  const filesList = contextWeight.injectedWorkspaceFiles.toSorted(\r\n    (a, b) => b.injectedChars - a.injectedChars,\r\n  );\r\n  const defaultLimit = 4;\r\n  const showAll = expanded;\r\n  const skillsTop = showAll ? skillsList : skillsList.slice(0, defaultLimit);\r\n  const toolsTop = showAll ? toolsList : toolsList.slice(0, defaultLimit);\r\n  const filesTop = showAll ? filesList : filesList.slice(0, defaultLimit);\r\n  const hasMore =\r\n    skillsList.length > defaultLimit ||\r\n    toolsList.length > defaultLimit ||\r\n    filesList.length > defaultLimit;\r\n\r\n  return html`\r\n    <div class=\"context-details-panel\">\r\n      <div class=\"context-breakdown-header\">\r\n        <div class=\"card-title\" style=\"font-size: 13px;\">System Prompt Breakdown</div>\r\n        ${\r\n          hasMore\r\n            ? html`<button class=\"context-expand-btn\" @click=${onToggleExpanded}>\r\n                ${showAll ? \"Collapse\" : \"Expand all\"}\r\n              </button>`\r\n            : nothing\r\n        }\r\n      </div>\r\n      <p class=\"context-weight-desc\">${contextPct || \"Base context per message\"}</p>\r\n      <div class=\"context-stacked-bar\">\r\n        <div class=\"context-segment system\" style=\"width: ${pct(systemTokens, totalContextTokens).toFixed(1)}%\" title=\"System: ~${formatTokens(systemTokens)}\"></div>\r\n        <div class=\"context-segment skills\" style=\"width: ${pct(skillsTokens, totalContextTokens).toFixed(1)}%\" title=\"Skills: ~${formatTokens(skillsTokens)}\"></div>\r\n        <div class=\"context-segment tools\" style=\"width: ${pct(toolsTokens, totalContextTokens).toFixed(1)}%\" title=\"Tools: ~${formatTokens(toolsTokens)}\"></div>\r\n        <div class=\"context-segment files\" style=\"width: ${pct(filesTokens, totalContextTokens).toFixed(1)}%\" title=\"Files: ~${formatTokens(filesTokens)}\"></div>\r\n      </div>\r\n      <div class=\"context-legend\">\r\n        <span class=\"legend-item\"><span class=\"legend-dot system\"></span>Sys ~${formatTokens(systemTokens)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot skills\"></span>Skills ~${formatTokens(skillsTokens)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot tools\"></span>Tools ~${formatTokens(toolsTokens)}</span>\r\n        <span class=\"legend-item\"><span class=\"legend-dot files\"></span>Files ~${formatTokens(filesTokens)}</span>\r\n      </div>\r\n      <div class=\"context-total\">Total: ~${formatTokens(totalContextTokens)}</div>\r\n      <div class=\"context-breakdown-grid\">\r\n        ${\r\n          skillsList.length > 0\r\n            ? (() => {\r\n                const more = skillsList.length - skillsTop.length;\r\n                return html`\r\n                  <div class=\"context-breakdown-card\">\r\n                    <div class=\"context-breakdown-title\">Skills (${skillsList.length})</div>\r\n                    <div class=\"context-breakdown-list\">\r\n                      ${skillsTop.map(\r\n                        (s) => html`\r\n                          <div class=\"context-breakdown-item\">\r\n                            <span class=\"mono\">${s.name}</span>\r\n                            <span class=\"muted\">~${formatTokens(charsToTokens(s.blockChars))}</span>\r\n                          </div>\r\n                        `,\r\n                      )}\r\n                    </div>\r\n                    ${\r\n                      more > 0\r\n                        ? html`<div class=\"context-breakdown-more\">+${more} more</div>`\r\n                        : nothing\r\n                    }\r\n                  </div>\r\n                `;\r\n              })()\r\n            : nothing\r\n        }\r\n        ${\r\n          toolsList.length > 0\r\n            ? (() => {\r\n                const more = toolsList.length - toolsTop.length;\r\n                return html`\r\n                  <div class=\"context-breakdown-card\">\r\n                    <div class=\"context-breakdown-title\">Tools (${toolsList.length})</div>\r\n                    <div class=\"context-breakdown-list\">\r\n                      ${toolsTop.map(\r\n                        (t) => html`\r\n                          <div class=\"context-breakdown-item\">\r\n                            <span class=\"mono\">${t.name}</span>\r\n                            <span class=\"muted\">~${formatTokens(charsToTokens(t.summaryChars + t.schemaChars))}</span>\r\n                          </div>\r\n                        `,\r\n                      )}\r\n                    </div>\r\n                    ${\r\n                      more > 0\r\n                        ? html`<div class=\"context-breakdown-more\">+${more} more</div>`\r\n                        : nothing\r\n                    }\r\n                  </div>\r\n                `;\r\n              })()\r\n            : nothing\r\n        }\r\n        ${\r\n          filesList.length > 0\r\n            ? (() => {\r\n                const more = filesList.length - filesTop.length;\r\n                return html`\r\n                  <div class=\"context-breakdown-card\">\r\n                    <div class=\"context-breakdown-title\">Files (${filesList.length})</div>\r\n                    <div class=\"context-breakdown-list\">\r\n                      ${filesTop.map(\r\n                        (f) => html`\r\n                          <div class=\"context-breakdown-item\">\r\n                            <span class=\"mono\">${f.name}</span>\r\n                            <span class=\"muted\">~${formatTokens(charsToTokens(f.injectedChars))}</span>\r\n                          </div>\r\n                        `,\r\n                      )}\r\n                    </div>\r\n                    ${\r\n                      more > 0\r\n                        ? html`<div class=\"context-breakdown-more\">+${more} more</div>`\r\n                        : nothing\r\n                    }\r\n                  </div>\r\n                `;\r\n              })()\r\n            : nothing\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSessionLogsCompact(\r\n  logs: SessionLogEntry[] | null,\r\n  loading: boolean,\r\n  expandedAll: boolean,\r\n  onToggleExpandedAll: () => void,\r\n  filters: {\r\n    roles: SessionLogRole[];\r\n    tools: string[];\r\n    hasTools: boolean;\r\n    query: string;\r\n  },\r\n  onFilterRolesChange: (next: SessionLogRole[]) => void,\r\n  onFilterToolsChange: (next: string[]) => void,\r\n  onFilterHasToolsChange: (next: boolean) => void,\r\n  onFilterQueryChange: (next: string) => void,\r\n  onFilterClear: () => void,\r\n) {\r\n  if (loading) {\r\n    return html`\r\n      <div class=\"session-logs-compact\">\r\n        <div class=\"session-logs-header\">Conversation</div>\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">Loading...</div>\r\n      </div>\r\n    `;\r\n  }\r\n  if (!logs || logs.length === 0) {\r\n    return html`\r\n      <div class=\"session-logs-compact\">\r\n        <div class=\"session-logs-header\">Conversation</div>\r\n        <div class=\"muted\" style=\"padding: 20px; text-align: center\">No messages</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const normalizedQuery = filters.query.trim().toLowerCase();\r\n  const entries = logs.map((log) => {\r\n    const toolInfo = parseToolSummary(log.content);\r\n    const cleanContent = toolInfo.cleanContent || log.content;\r\n    return { log, toolInfo, cleanContent };\r\n  });\r\n  const toolOptions = Array.from(\r\n    new Set(entries.flatMap((entry) => entry.toolInfo.tools.map(([name]) => name))),\r\n  ).toSorted((a, b) => a.localeCompare(b));\r\n  const filteredEntries = entries.filter((entry) => {\r\n    if (filters.roles.length > 0 && !filters.roles.includes(entry.log.role)) {\r\n      return false;\r\n    }\r\n    if (filters.hasTools && entry.toolInfo.tools.length === 0) {\r\n      return false;\r\n    }\r\n    if (filters.tools.length > 0) {\r\n      const matchesTool = entry.toolInfo.tools.some(([name]) => filters.tools.includes(name));\r\n      if (!matchesTool) {\r\n        return false;\r\n      }\r\n    }\r\n    if (normalizedQuery) {\r\n      const haystack = entry.cleanContent.toLowerCase();\r\n      if (!haystack.includes(normalizedQuery)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  });\r\n  const displayedCount =\r\n    filters.roles.length > 0 || filters.tools.length > 0 || filters.hasTools || normalizedQuery\r\n      ? `${filteredEntries.length} of ${logs.length}`\r\n      : `${logs.length}`;\r\n\r\n  const roleSelected = new Set(filters.roles);\r\n  const toolSelected = new Set(filters.tools);\r\n\r\n  return html`\r\n    <div class=\"session-logs-compact\">\r\n      <div class=\"session-logs-header\">\r\n        <span>Conversation <span style=\"font-weight: normal; color: var(--text-muted);\">(${displayedCount} messages)</span></span>\r\n        <button class=\"btn btn-sm usage-action-btn usage-secondary-btn\" @click=${onToggleExpandedAll}>\r\n          ${expandedAll ? \"Collapse All\" : \"Expand All\"}\r\n        </button>\r\n      </div>\r\n      <div class=\"usage-filters-inline\" style=\"margin: 10px 12px;\">\r\n        <select\r\n          multiple\r\n          size=\"4\"\r\n          @change=${(event: Event) =>\r\n            onFilterRolesChange(\r\n              Array.from((event.target as HTMLSelectElement).selectedOptions).map(\r\n                (option) => option.value as SessionLogRole,\r\n              ),\r\n            )}\r\n        >\r\n          <option value=\"user\" ?selected=${roleSelected.has(\"user\")}>User</option>\r\n          <option value=\"assistant\" ?selected=${roleSelected.has(\"assistant\")}>Assistant</option>\r\n          <option value=\"tool\" ?selected=${roleSelected.has(\"tool\")}>Tool</option>\r\n          <option value=\"toolResult\" ?selected=${roleSelected.has(\"toolResult\")}>Tool result</option>\r\n        </select>\r\n        <select\r\n          multiple\r\n          size=\"4\"\r\n          @change=${(event: Event) =>\r\n            onFilterToolsChange(\r\n              Array.from((event.target as HTMLSelectElement).selectedOptions).map(\r\n                (option) => option.value,\r\n              ),\r\n            )}\r\n        >\r\n          ${toolOptions.map(\r\n            (tool) =>\r\n              html`<option value=${tool} ?selected=${toolSelected.has(tool)}>${tool}</option>`,\r\n          )}\r\n        </select>\r\n        <label class=\"usage-filters-inline\" style=\"gap: 6px;\">\r\n          <input\r\n            type=\"checkbox\"\r\n            .checked=${filters.hasTools}\r\n            @change=${(event: Event) =>\r\n              onFilterHasToolsChange((event.target as HTMLInputElement).checked)}\r\n          />\r\n          Has tools\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search conversation\"\r\n          .value=${filters.query}\r\n          @input=${(event: Event) => onFilterQueryChange((event.target as HTMLInputElement).value)}\r\n        />\r\n        <button class=\"btn btn-sm usage-action-btn usage-secondary-btn\" @click=${onFilterClear}>\r\n          Clear\r\n        </button>\r\n      </div>\r\n      <div class=\"session-logs-list\">\r\n        ${filteredEntries.map((entry) => {\r\n          const { log, toolInfo, cleanContent } = entry;\r\n          const roleClass = log.role === \"user\" ? \"user\" : \"assistant\";\r\n          const roleLabel =\r\n            log.role === \"user\" ? \"You\" : log.role === \"assistant\" ? \"Assistant\" : \"Tool\";\r\n          return html`\r\n          <div class=\"session-log-entry ${roleClass}\">\r\n            <div class=\"session-log-meta\">\r\n              <span class=\"session-log-role\">${roleLabel}</span>\r\n              <span>${new Date(log.timestamp).toLocaleString()}</span>\r\n              ${log.tokens ? html`<span>${formatTokens(log.tokens)}</span>` : nothing}\r\n            </div>\r\n            <div class=\"session-log-content\">${cleanContent}</div>\r\n            ${\r\n              toolInfo.tools.length > 0\r\n                ? html`\r\n                    <details class=\"session-log-tools\" ?open=${expandedAll}>\r\n                      <summary>${toolInfo.summary}</summary>\r\n                      <div class=\"session-log-tools-list\">\r\n                        ${toolInfo.tools.map(\r\n                          ([name, count]) => html`\r\n                            <span class=\"session-log-tools-pill\">${name} Ã ${count}</span>\r\n                          `,\r\n                        )}\r\n                      </div>\r\n                    </details>\r\n                  `\r\n                : nothing\r\n            }\r\n          </div>\r\n        `;\r\n        })}\r\n        ${\r\n          filteredEntries.length === 0\r\n            ? html`\r\n                <div class=\"muted\" style=\"padding: 12px\">No messages match the filters.</div>\r\n              `\r\n            : nothing\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function renderUsage(props: UsageProps) {\r\n  // Show loading skeleton if loading and no data yet\r\n  if (props.loading && !props.totals) {\r\n    // Use inline styles since main stylesheet hasn't loaded yet on initial render\r\n    return html`\r\n      <style>\r\n        @keyframes initial-spin {\r\n          to { transform: rotate(360deg); }\r\n        }\r\n        @keyframes initial-pulse {\r\n          0%, 100% { opacity: 1; }\r\n          50% { opacity: 0.7; }\r\n        }\r\n      </style>\r\n      <section class=\"card\">\r\n        <div class=\"row\" style=\"justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 12px;\">\r\n          <div style=\"flex: 1; min-width: 250px;\">\r\n            <div style=\"display: flex; align-items: center; gap: 10px; margin-bottom: 2px;\">\r\n              <div class=\"card-title\" style=\"margin: 0;\">Token Usage</div>\r\n              <span style=\"\r\n                display: inline-flex;\r\n                align-items: center;\r\n                gap: 6px;\r\n                padding: 4px 10px;\r\n                background: rgba(255, 77, 77, 0.1);\r\n                border-radius: 4px;\r\n                font-size: 12px;\r\n                color: #ff4d4d;\r\n              \">\r\n                <span style=\"\r\n                  width: 10px;\r\n                  height: 10px;\r\n                  border: 2px solid #ff4d4d;\r\n                  border-top-color: transparent;\r\n                  border-radius: 50%;\r\n                  animation: initial-spin 0.6s linear infinite;\r\n                \"></span>\r\n                Loading\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div style=\"display: flex; flex-direction: column; align-items: flex-end; gap: 8px;\">\r\n            <div style=\"display: flex; gap: 8px; align-items: center;\">\r\n              <input type=\"date\" .value=${props.startDate} disabled style=\"padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-size: 13px; opacity: 0.6;\" />\r\n              <span style=\"color: var(--text-muted);\">to</span>\r\n              <input type=\"date\" .value=${props.endDate} disabled style=\"padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); font-size: 13px; opacity: 0.6;\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  const isTokenMode = props.chartMode === \"tokens\";\r\n  const hasQuery = props.query.trim().length > 0;\r\n  const hasDraftQuery = props.queryDraft.trim().length > 0;\r\n  // (intentionally no global Clear button in the header; chips + query clear handle this)\r\n\r\n  // Sort sessions by tokens or cost depending on mode\r\n  const sortedSessions = [...props.sessions].toSorted((a, b) => {\r\n    const valA = isTokenMode ? (a.usage?.totalTokens ?? 0) : (a.usage?.totalCost ?? 0);\r\n    const valB = isTokenMode ? (b.usage?.totalTokens ?? 0) : (b.usage?.totalCost ?? 0);\r\n    return valB - valA;\r\n  });\r\n\r\n  // Filter sessions by selected days\r\n  const dayFilteredSessions =\r\n    props.selectedDays.length > 0\r\n      ? sortedSessions.filter((s) => {\r\n          if (s.usage?.activityDates?.length) {\r\n            return s.usage.activityDates.some((d) => props.selectedDays.includes(d));\r\n          }\r\n          if (!s.updatedAt) {\r\n            return false;\r\n          }\r\n          const d = new Date(s.updatedAt);\r\n          const sessionDate = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`;\r\n          return props.selectedDays.includes(sessionDate);\r\n        })\r\n      : sortedSessions;\r\n\r\n  const sessionTouchesHours = (session: UsageSessionEntry, hours: number[]): boolean => {\r\n    if (hours.length === 0) {\r\n      return true;\r\n    }\r\n    const usage = session.usage;\r\n    const start = usage?.firstActivity ?? session.updatedAt;\r\n    const end = usage?.lastActivity ?? session.updatedAt;\r\n    if (!start || !end) {\r\n      return false;\r\n    }\r\n    const startMs = Math.min(start, end);\r\n    const endMs = Math.max(start, end);\r\n    let cursor = startMs;\r\n    while (cursor <= endMs) {\r\n      const date = new Date(cursor);\r\n      const hour = getZonedHour(date, props.timeZone);\r\n      if (hours.includes(hour)) {\r\n        return true;\r\n      }\r\n      const nextHour = setToHourEnd(date, props.timeZone);\r\n      const nextMs = Math.min(nextHour.getTime(), endMs);\r\n      cursor = nextMs + 1;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const hourFilteredSessions =\r\n    props.selectedHours.length > 0\r\n      ? dayFilteredSessions.filter((s) => sessionTouchesHours(s, props.selectedHours))\r\n      : dayFilteredSessions;\r\n\r\n  // Filter sessions by query (client-side)\r\n  const queryResult = filterSessionsByQuery(hourFilteredSessions, props.query);\r\n  const filteredSessions = queryResult.sessions;\r\n  const queryWarnings = queryResult.warnings;\r\n  const querySuggestions = buildQuerySuggestions(\r\n    props.queryDraft,\r\n    sortedSessions,\r\n    props.aggregates,\r\n  );\r\n  const queryTerms = extractQueryTerms(props.query);\r\n  const selectedValuesFor = (key: string): string[] => {\r\n    const normalized = normalizeQueryText(key);\r\n    return queryTerms\r\n      .filter((term) => normalizeQueryText(term.key ?? \"\") === normalized)\r\n      .map((term) => term.value)\r\n      .filter(Boolean);\r\n  };\r\n  const unique = (items: Array<string | undefined>) => {\r\n    const set = new Set<string>();\r\n    for (const item of items) {\r\n      if (item) {\r\n        set.add(item);\r\n      }\r\n    }\r\n    return Array.from(set);\r\n  };\r\n  const agentOptions = unique(sortedSessions.map((s) => s.agentId)).slice(0, 12);\r\n  const channelOptions = unique(sortedSessions.map((s) => s.channel)).slice(0, 12);\r\n  const providerOptions = unique([\r\n    ...sortedSessions.map((s) => s.modelProvider),\r\n    ...sortedSessions.map((s) => s.providerOverride),\r\n    ...(props.aggregates?.byProvider.map((entry) => entry.provider) ?? []),\r\n  ]).slice(0, 12);\r\n  const modelOptions = unique([\r\n    ...sortedSessions.map((s) => s.model),\r\n    ...(props.aggregates?.byModel.map((entry) => entry.model) ?? []),\r\n  ]).slice(0, 12);\r\n  const toolOptions = unique(props.aggregates?.tools.tools.map((tool) => tool.name) ?? []).slice(\r\n    0,\r\n    12,\r\n  );\r\n\r\n  // Get first selected session for detail view (timeseries, logs)\r\n  const primarySelectedEntry =\r\n    props.selectedSessions.length === 1\r\n      ? (props.sessions.find((s) => s.key === props.selectedSessions[0]) ??\r\n        filteredSessions.find((s) => s.key === props.selectedSessions[0]))\r\n      : null;\r\n\r\n  // Compute totals from sessions\r\n  const computeSessionTotals = (sessions: UsageSessionEntry[]): UsageTotals => {\r\n    return sessions.reduce(\r\n      (acc, s) => {\r\n        if (s.usage) {\r\n          acc.input += s.usage.input;\r\n          acc.output += s.usage.output;\r\n          acc.cacheRead += s.usage.cacheRead;\r\n          acc.cacheWrite += s.usage.cacheWrite;\r\n          acc.totalTokens += s.usage.totalTokens;\r\n          acc.totalCost += s.usage.totalCost;\r\n          acc.inputCost += s.usage.inputCost ?? 0;\r\n          acc.outputCost += s.usage.outputCost ?? 0;\r\n          acc.cacheReadCost += s.usage.cacheReadCost ?? 0;\r\n          acc.cacheWriteCost += s.usage.cacheWriteCost ?? 0;\r\n          acc.missingCostEntries += s.usage.missingCostEntries ?? 0;\r\n        }\r\n        return acc;\r\n      },\r\n      {\r\n        input: 0,\r\n        output: 0,\r\n        cacheRead: 0,\r\n        cacheWrite: 0,\r\n        totalTokens: 0,\r\n        totalCost: 0,\r\n        inputCost: 0,\r\n        outputCost: 0,\r\n        cacheReadCost: 0,\r\n        cacheWriteCost: 0,\r\n        missingCostEntries: 0,\r\n      },\r\n    );\r\n  };\r\n\r\n  // Compute totals from daily data for selected days (more accurate than session totals)\r\n  const computeDailyTotals = (days: string[]): UsageTotals => {\r\n    const matchingDays = props.costDaily.filter((d) => days.includes(d.date));\r\n    return matchingDays.reduce(\r\n      (acc, d) => {\r\n        acc.input += d.input;\r\n        acc.output += d.output;\r\n        acc.cacheRead += d.cacheRead;\r\n        acc.cacheWrite += d.cacheWrite;\r\n        acc.totalTokens += d.totalTokens;\r\n        acc.totalCost += d.totalCost;\r\n        acc.inputCost += d.inputCost ?? 0;\r\n        acc.outputCost += d.outputCost ?? 0;\r\n        acc.cacheReadCost += d.cacheReadCost ?? 0;\r\n        acc.cacheWriteCost += d.cacheWriteCost ?? 0;\r\n        return acc;\r\n      },\r\n      {\r\n        input: 0,\r\n        output: 0,\r\n        cacheRead: 0,\r\n        cacheWrite: 0,\r\n        totalTokens: 0,\r\n        totalCost: 0,\r\n        inputCost: 0,\r\n        outputCost: 0,\r\n        cacheReadCost: 0,\r\n        cacheWriteCost: 0,\r\n        missingCostEntries: 0,\r\n      },\r\n    );\r\n  };\r\n\r\n  // Compute display totals and count based on filters\r\n  let displayTotals: UsageTotals | null;\r\n  let displaySessionCount: number;\r\n  const totalSessions = sortedSessions.length;\r\n\r\n  if (props.selectedSessions.length > 0) {\r\n    // Sessions selected - compute totals from selected sessions\r\n    const selectedSessionEntries = filteredSessions.filter((s) =>\r\n      props.selectedSessions.includes(s.key),\r\n    );\r\n    displayTotals = computeSessionTotals(selectedSessionEntries);\r\n    displaySessionCount = selectedSessionEntries.length;\r\n  } else if (props.selectedDays.length > 0 && props.selectedHours.length === 0) {\r\n    // Days selected - use daily aggregates for accurate per-day totals\r\n    displayTotals = computeDailyTotals(props.selectedDays);\r\n    displaySessionCount = filteredSessions.length;\r\n  } else if (props.selectedHours.length > 0) {\r\n    displayTotals = computeSessionTotals(filteredSessions);\r\n    displaySessionCount = filteredSessions.length;\r\n  } else if (hasQuery) {\r\n    displayTotals = computeSessionTotals(filteredSessions);\r\n    displaySessionCount = filteredSessions.length;\r\n  } else {\r\n    // No filters - show all\r\n    displayTotals = props.totals;\r\n    displaySessionCount = totalSessions;\r\n  }\r\n\r\n  const aggregateSessions =\r\n    props.selectedSessions.length > 0\r\n      ? filteredSessions.filter((s) => props.selectedSessions.includes(s.key))\r\n      : hasQuery || props.selectedHours.length > 0\r\n        ? filteredSessions\r\n        : props.selectedDays.length > 0\r\n          ? dayFilteredSessions\r\n          : sortedSessions;\r\n  const activeAggregates = buildAggregatesFromSessions(aggregateSessions, props.aggregates);\r\n\r\n  // Filter daily chart data if sessions are selected\r\n  const filteredDaily =\r\n    props.selectedSessions.length > 0\r\n      ? (() => {\r\n          const selectedEntries = filteredSessions.filter((s) =>\r\n            props.selectedSessions.includes(s.key),\r\n          );\r\n          const allActivityDates = new Set<string>();\r\n          for (const entry of selectedEntries) {\r\n            for (const date of entry.usage?.activityDates ?? []) {\r\n              allActivityDates.add(date);\r\n            }\r\n          }\r\n          return allActivityDates.size > 0\r\n            ? props.costDaily.filter((d) => allActivityDates.has(d.date))\r\n            : props.costDaily;\r\n        })()\r\n      : props.costDaily;\r\n\r\n  const insightStats = buildUsageInsightStats(aggregateSessions, displayTotals, activeAggregates);\r\n  const isEmpty = !props.loading && !props.totals && props.sessions.length === 0;\r\n  const hasMissingCost =\r\n    (displayTotals?.missingCostEntries ?? 0) > 0 ||\r\n    (displayTotals\r\n      ? displayTotals.totalTokens > 0 &&\r\n        displayTotals.totalCost === 0 &&\r\n        displayTotals.input +\r\n          displayTotals.output +\r\n          displayTotals.cacheRead +\r\n          displayTotals.cacheWrite >\r\n          0\r\n      : false);\r\n  const datePresets = [\r\n    { label: \"Today\", days: 1 },\r\n    { label: \"7d\", days: 7 },\r\n    { label: \"30d\", days: 30 },\r\n  ];\r\n  const applyPreset = (days: number) => {\r\n    const end = new Date();\r\n    const start = new Date();\r\n    start.setDate(start.getDate() - (days - 1));\r\n    props.onStartDateChange(formatIsoDate(start));\r\n    props.onEndDateChange(formatIsoDate(end));\r\n  };\r\n  const renderFilterSelect = (key: string, label: string, options: string[]) => {\r\n    if (options.length === 0) {\r\n      return nothing;\r\n    }\r\n    const selected = selectedValuesFor(key);\r\n    const selectedSet = new Set(selected.map((value) => normalizeQueryText(value)));\r\n    const allSelected =\r\n      options.length > 0 && options.every((value) => selectedSet.has(normalizeQueryText(value)));\r\n    const selectedCount = selected.length;\r\n    return html`\r\n      <details\r\n        class=\"usage-filter-select\"\r\n        @toggle=${(e: Event) => {\r\n          const el = e.currentTarget as HTMLDetailsElement;\r\n          if (!el.open) {\r\n            return;\r\n          }\r\n          const onClick = (ev: MouseEvent) => {\r\n            const path = ev.composedPath();\r\n            if (!path.includes(el)) {\r\n              el.open = false;\r\n              window.removeEventListener(\"click\", onClick, true);\r\n            }\r\n          };\r\n          window.addEventListener(\"click\", onClick, true);\r\n        }}\r\n      >\r\n        <summary>\r\n          <span>${label}</span>\r\n          ${\r\n            selectedCount > 0\r\n              ? html`<span class=\"usage-filter-badge\">${selectedCount}</span>`\r\n              : html`\r\n                  <span class=\"usage-filter-badge\">All</span>\r\n                `\r\n          }\r\n        </summary>\r\n        <div class=\"usage-filter-popover\">\r\n          <div class=\"usage-filter-actions\">\r\n            <button\r\n              class=\"btn btn-sm\"\r\n              @click=${(e: Event) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                props.onQueryDraftChange(setQueryTokensForKey(props.queryDraft, key, options));\r\n              }}\r\n              ?disabled=${allSelected}\r\n            >\r\n              Select All\r\n            </button>\r\n            <button\r\n              class=\"btn btn-sm\"\r\n              @click=${(e: Event) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                props.onQueryDraftChange(setQueryTokensForKey(props.queryDraft, key, []));\r\n              }}\r\n              ?disabled=${selectedCount === 0}\r\n            >\r\n              Clear\r\n            </button>\r\n          </div>\r\n          <div class=\"usage-filter-options\">\r\n            ${options.map((value) => {\r\n              const checked = selectedSet.has(normalizeQueryText(value));\r\n              return html`\r\n                <label class=\"usage-filter-option\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    .checked=${checked}\r\n                    @change=${(e: Event) => {\r\n                      const target = e.target as HTMLInputElement;\r\n                      const token = `${key}:${value}`;\r\n                      props.onQueryDraftChange(\r\n                        target.checked\r\n                          ? addQueryToken(props.queryDraft, token)\r\n                          : removeQueryToken(props.queryDraft, token),\r\n                      );\r\n                    }}\r\n                  />\r\n                  <span>${value}</span>\r\n                </label>\r\n              `;\r\n            })}\r\n          </div>\r\n        </div>\r\n      </details>\r\n    `;\r\n  };\r\n  const exportStamp = formatIsoDate(new Date());\r\n\r\n  return html`\r\n    <style>${usageStylesString}</style>\r\n\r\n    <section class=\"usage-page-header\">\r\n      <div class=\"usage-page-title\">Usage</div>\r\n      <div class=\"usage-page-subtitle\">See where tokens go, when sessions spike, and what drives cost.</div>\r\n    </section>\r\n\r\n    <section class=\"card usage-header ${props.headerPinned ? \"pinned\" : \"\"}\">\r\n      <div class=\"usage-header-row\">\r\n        <div class=\"usage-header-title\">\r\n          <div class=\"card-title\" style=\"margin: 0;\">Filters</div>\r\n          ${\r\n            props.loading\r\n              ? html`\r\n                  <span class=\"usage-refresh-indicator\">Loading</span>\r\n                `\r\n              : nothing\r\n          }\r\n          ${\r\n            isEmpty\r\n              ? html`\r\n                  <span class=\"usage-query-hint\">Select a date range and click Refresh to load usage.</span>\r\n                `\r\n              : nothing\r\n          }\r\n        </div>\r\n        <div class=\"usage-header-metrics\">\r\n          ${\r\n            displayTotals\r\n              ? html`\r\n                <span class=\"usage-metric-badge\">\r\n                  <strong>${formatTokens(displayTotals.totalTokens)}</strong> tokens\r\n                </span>\r\n                <span class=\"usage-metric-badge\">\r\n                  <strong>${formatCost(displayTotals.totalCost)}</strong> cost\r\n                </span>\r\n                <span class=\"usage-metric-badge\">\r\n                  <strong>${displaySessionCount}</strong>\r\n                  session${displaySessionCount !== 1 ? \"s\" : \"\"}\r\n                </span>\r\n              `\r\n              : nothing\r\n          }\r\n          <button\r\n            class=\"usage-pin-btn ${props.headerPinned ? \"active\" : \"\"}\"\r\n            title=${props.headerPinned ? \"Unpin filters\" : \"Pin filters\"}\r\n            @click=${props.onToggleHeaderPinned}\r\n          >\r\n            ${props.headerPinned ? \"Pinned\" : \"Pin\"}\r\n          </button>\r\n          <details\r\n            class=\"usage-export-menu\"\r\n            @toggle=${(e: Event) => {\r\n              const el = e.currentTarget as HTMLDetailsElement;\r\n              if (!el.open) {\r\n                return;\r\n              }\r\n              const onClick = (ev: MouseEvent) => {\r\n                const path = ev.composedPath();\r\n                if (!path.includes(el)) {\r\n                  el.open = false;\r\n                  window.removeEventListener(\"click\", onClick, true);\r\n                }\r\n              };\r\n              window.addEventListener(\"click\", onClick, true);\r\n            }}\r\n          >\r\n            <summary class=\"usage-export-button\">Export â?/summary>\r\n            <div class=\"usage-export-popover\">\r\n              <div class=\"usage-export-list\">\r\n                <button\r\n                  class=\"usage-export-item\"\r\n                  @click=${() =>\r\n                    downloadTextFile(\r\n                      `openclaw-usage-sessions-${exportStamp}.csv`,\r\n                      buildSessionsCsv(filteredSessions),\r\n                      \"text/csv\",\r\n                    )}\r\n                  ?disabled=${filteredSessions.length === 0}\r\n                >\r\n                  Sessions CSV\r\n                </button>\r\n                <button\r\n                  class=\"usage-export-item\"\r\n                  @click=${() =>\r\n                    downloadTextFile(\r\n                      `openclaw-usage-daily-${exportStamp}.csv`,\r\n                      buildDailyCsv(filteredDaily),\r\n                      \"text/csv\",\r\n                    )}\r\n                  ?disabled=${filteredDaily.length === 0}\r\n                >\r\n                  Daily CSV\r\n                </button>\r\n                <button\r\n                  class=\"usage-export-item\"\r\n                  @click=${() =>\r\n                    downloadTextFile(\r\n                      `openclaw-usage-${exportStamp}.json`,\r\n                      JSON.stringify(\r\n                        {\r\n                          totals: displayTotals,\r\n                          sessions: filteredSessions,\r\n                          daily: filteredDaily,\r\n                          aggregates: activeAggregates,\r\n                        },\r\n                        null,\r\n                        2,\r\n                      ),\r\n                      \"application/json\",\r\n                    )}\r\n                  ?disabled=${filteredSessions.length === 0 && filteredDaily.length === 0}\r\n                >\r\n                  JSON\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </details>\r\n        </div>\r\n      </div>\r\n      <div class=\"usage-header-row\">\r\n        <div class=\"usage-controls\">\r\n          ${renderFilterChips(\r\n            props.selectedDays,\r\n            props.selectedHours,\r\n            props.selectedSessions,\r\n            props.sessions,\r\n            props.onClearDays,\r\n            props.onClearHours,\r\n            props.onClearSessions,\r\n            props.onClearFilters,\r\n          )}\r\n          <div class=\"usage-presets\">\r\n            ${datePresets.map(\r\n              (preset) => html`\r\n                <button class=\"btn btn-sm\" @click=${() => applyPreset(preset.days)}>\r\n                  ${preset.label}\r\n                </button>\r\n              `,\r\n            )}\r\n          </div>\r\n          <input\r\n            type=\"date\"\r\n            .value=${props.startDate}\r\n            title=\"Start Date\"\r\n            @change=${(e: Event) => props.onStartDateChange((e.target as HTMLInputElement).value)}\r\n          />\r\n          <span style=\"color: var(--text-muted);\">to</span>\r\n          <input\r\n            type=\"date\"\r\n            .value=${props.endDate}\r\n            title=\"End Date\"\r\n            @change=${(e: Event) => props.onEndDateChange((e.target as HTMLInputElement).value)}\r\n          />\r\n          <select\r\n            title=\"Time zone\"\r\n            .value=${props.timeZone}\r\n            @change=${(e: Event) =>\r\n              props.onTimeZoneChange((e.target as HTMLSelectElement).value as \"local\" | \"utc\")}\r\n          >\r\n            <option value=\"local\">Local</option>\r\n            <option value=\"utc\">UTC</option>\r\n          </select>\r\n          <div class=\"chart-toggle\">\r\n            <button\r\n              class=\"toggle-btn ${isTokenMode ? \"active\" : \"\"}\"\r\n              @click=${() => props.onChartModeChange(\"tokens\")}\r\n            >\r\n              Tokens\r\n            </button>\r\n            <button\r\n              class=\"toggle-btn ${!isTokenMode ? \"active\" : \"\"}\"\r\n              @click=${() => props.onChartModeChange(\"cost\")}\r\n            >\r\n              Cost\r\n            </button>\r\n          </div>\r\n          <button\r\n            class=\"btn btn-sm usage-action-btn usage-primary-btn\"\r\n            @click=${props.onRefresh}\r\n            ?disabled=${props.loading}\r\n          >\r\n            Refresh\r\n          </button>\r\n        </div>\r\n        \r\n      </div>\r\n\r\n      <div style=\"margin-top: 12px;\">\r\n          <div class=\"usage-query-bar\">\r\n          <input\r\n            class=\"usage-query-input\"\r\n            type=\"text\"\r\n            .value=${props.queryDraft}\r\n            placeholder=\"Filter sessions (e.g. key:agent:main:cron* model:gpt-4o has:errors minTokens:2000)\"\r\n            @input=${(e: Event) => props.onQueryDraftChange((e.target as HTMLInputElement).value)}\r\n            @keydown=${(e: KeyboardEvent) => {\r\n              if (e.key === \"Enter\") {\r\n                e.preventDefault();\r\n                props.onApplyQuery();\r\n              }\r\n            }}\r\n          />\r\n          <div class=\"usage-query-actions\">\r\n            <button\r\n              class=\"btn btn-sm usage-action-btn usage-secondary-btn\"\r\n              @click=${props.onApplyQuery}\r\n              ?disabled=${props.loading || (!hasDraftQuery && !hasQuery)}\r\n            >\r\n              Filter (client-side)\r\n            </button>\r\n            ${\r\n              hasDraftQuery || hasQuery\r\n                ? html`<button class=\"btn btn-sm usage-action-btn usage-secondary-btn\" @click=${props.onClearQuery}>Clear</button>`\r\n                : nothing\r\n            }\r\n            <span class=\"usage-query-hint\">\r\n              ${\r\n                hasQuery\r\n                  ? `${filteredSessions.length} of ${totalSessions} sessions match`\r\n                  : `${totalSessions} sessions in range`\r\n              }\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div class=\"usage-filter-row\">\r\n          ${renderFilterSelect(\"agent\", \"Agent\", agentOptions)}\r\n          ${renderFilterSelect(\"channel\", \"Channel\", channelOptions)}\r\n          ${renderFilterSelect(\"provider\", \"Provider\", providerOptions)}\r\n          ${renderFilterSelect(\"model\", \"Model\", modelOptions)}\r\n          ${renderFilterSelect(\"tool\", \"Tool\", toolOptions)}\r\n          <span class=\"usage-query-hint\">\r\n            Tip: use filters or click bars to filter days.\r\n          </span>\r\n        </div>\r\n        ${\r\n          queryTerms.length > 0\r\n            ? html`\r\n                <div class=\"usage-query-chips\">\r\n                  ${queryTerms.map((term) => {\r\n                    const label = term.raw;\r\n                    return html`\r\n                      <span class=\"usage-query-chip\">\r\n                        ${label}\r\n                        <button\r\n                          title=\"Remove filter\"\r\n                          @click=${() =>\r\n                            props.onQueryDraftChange(removeQueryToken(props.queryDraft, label))}\r\n                        >\r\n                          Ã\r\n                        </button>\r\n                      </span>\r\n                    `;\r\n                  })}\r\n                </div>\r\n              `\r\n            : nothing\r\n        }\r\n        ${\r\n          querySuggestions.length > 0\r\n            ? html`\r\n                <div class=\"usage-query-suggestions\">\r\n                  ${querySuggestions.map(\r\n                    (suggestion) => html`\r\n                      <button\r\n                        class=\"usage-query-suggestion\"\r\n                        @click=${() =>\r\n                          props.onQueryDraftChange(\r\n                            applySuggestionToQuery(props.queryDraft, suggestion.value),\r\n                          )}\r\n                      >\r\n                        ${suggestion.label}\r\n                      </button>\r\n                    `,\r\n                  )}\r\n                </div>\r\n              `\r\n            : nothing\r\n        }\r\n        ${\r\n          queryWarnings.length > 0\r\n            ? html`\r\n                <div class=\"callout warning\" style=\"margin-top: 8px;\">\r\n                  ${queryWarnings.join(\" Â· \")}\r\n                </div>\r\n              `\r\n            : nothing\r\n        }\r\n      </div>\r\n\r\n      ${\r\n        props.error\r\n          ? html`<div class=\"callout danger\" style=\"margin-top: 12px;\">${props.error}</div>`\r\n          : nothing\r\n      }\r\n\r\n      ${\r\n        props.sessionsLimitReached\r\n          ? html`\r\n              <div class=\"callout warning\" style=\"margin-top: 12px\">\r\n                Showing first 1,000 sessions. Narrow date range for complete results.\r\n              </div>\r\n            `\r\n          : nothing\r\n      }\r\n    </section>\r\n\r\n    ${renderUsageInsights(\r\n      displayTotals,\r\n      activeAggregates,\r\n      insightStats,\r\n      hasMissingCost,\r\n      buildPeakErrorHours(aggregateSessions, props.timeZone),\r\n      displaySessionCount,\r\n      totalSessions,\r\n    )}\r\n\r\n    ${renderUsageMosaic(aggregateSessions, props.timeZone, props.selectedHours, props.onSelectHour)}\r\n\r\n    <!-- Two-column layout: Daily+Breakdown on left, Sessions on right -->\r\n    <div class=\"usage-grid\">\r\n      <div class=\"usage-grid-left\">\r\n        <div class=\"card usage-left-card\">\r\n          ${renderDailyChartCompact(\r\n            filteredDaily,\r\n            props.selectedDays,\r\n            props.chartMode,\r\n            props.dailyChartMode,\r\n            props.onDailyChartModeChange,\r\n            props.onSelectDay,\r\n          )}\r\n          ${displayTotals ? renderCostBreakdownCompact(displayTotals, props.chartMode) : nothing}\r\n        </div>\r\n      </div>\r\n      <div class=\"usage-grid-right\">\r\n        ${renderSessionsCard(\r\n          filteredSessions,\r\n          props.selectedSessions,\r\n          props.selectedDays,\r\n          isTokenMode,\r\n          props.sessionSort,\r\n          props.sessionSortDir,\r\n          props.recentSessions,\r\n          props.sessionsTab,\r\n          props.onSelectSession,\r\n          props.onSessionSortChange,\r\n          props.onSessionSortDirChange,\r\n          props.onSessionsTabChange,\r\n          props.visibleColumns,\r\n          totalSessions,\r\n          props.onClearSessions,\r\n        )}\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Session Detail Panel (when selected) or Empty State -->\r\n    ${\r\n      primarySelectedEntry\r\n        ? renderSessionDetailPanel(\r\n            primarySelectedEntry,\r\n            props.timeSeries,\r\n            props.timeSeriesLoading,\r\n            props.timeSeriesMode,\r\n            props.onTimeSeriesModeChange,\r\n            props.timeSeriesBreakdownMode,\r\n            props.onTimeSeriesBreakdownChange,\r\n            props.startDate,\r\n            props.endDate,\r\n            props.selectedDays,\r\n            props.sessionLogs,\r\n            props.sessionLogsLoading,\r\n            props.sessionLogsExpanded,\r\n            props.onToggleSessionLogsExpanded,\r\n            {\r\n              roles: props.logFilterRoles,\r\n              tools: props.logFilterTools,\r\n              hasTools: props.logFilterHasTools,\r\n              query: props.logFilterQuery,\r\n            },\r\n            props.onLogFilterRolesChange,\r\n            props.onLogFilterToolsChange,\r\n            props.onLogFilterHasToolsChange,\r\n            props.onLogFilterQueryChange,\r\n            props.onLogFilterClear,\r\n            props.contextExpanded,\r\n            props.onToggleContextExpanded,\r\n            props.onClearSessions,\r\n          )\r\n        : renderEmptyDetailState()\r\n    }\r\n  `;\r\n}\r\n\r\n// Exposed for Playwright/Vitest browser unit tests.\r\n","import { html, nothing } from \"lit\";\r\nimport type { AppViewState } from \"./app-view-state.ts\";\r\nimport type { UsageState } from \"./controllers/usage.ts\";\r\nimport { parseAgentSessionKey } from \"../../../src/routing/session-key.js\";\r\nimport { refreshChatAvatar } from \"./app-chat.ts\";\r\nimport { renderChatControls, renderTab, renderThemeToggle, renderLanguageToggle } from \"./app-render.helpers.ts\";\r\nimport { loadAgentFileContent, loadAgentFiles, saveAgentFile } from \"./controllers/agent-files.ts\";\r\nimport { loadAgentIdentities, loadAgentIdentity } from \"./controllers/agent-identity.ts\";\r\nimport { loadAgentSkills } from \"./controllers/agent-skills.ts\";\r\nimport { loadAgents } from \"./controllers/agents.ts\";\r\nimport { loadChannels } from \"./controllers/channels.ts\";\r\nimport { loadChatHistory } from \"./controllers/chat.ts\";\r\nimport {\r\n  applyConfig,\r\n  loadConfig,\r\n  runUpdate,\r\n  saveConfig,\r\n  updateConfigFormValue,\r\n  removeConfigFormValue,\r\n} from \"./controllers/config.ts\";\r\nimport {\r\n  loadCronRuns,\r\n  toggleCronJob,\r\n  runCronJob,\r\n  removeCronJob,\r\n  addCronJob,\r\n} from \"./controllers/cron.ts\";\r\nimport { loadDebug, callDebugMethod } from \"./controllers/debug.ts\";\r\nimport {\r\n  approveDevicePairing,\r\n  loadDevices,\r\n  rejectDevicePairing,\r\n  revokeDeviceToken,\r\n  rotateDeviceToken,\r\n} from \"./controllers/devices.ts\";\r\nimport {\r\n  loadExecApprovals,\r\n  removeExecApprovalsFormValue,\r\n  saveExecApprovals,\r\n  updateExecApprovalsFormValue,\r\n} from \"./controllers/exec-approvals.ts\";\r\nimport { loadLogs } from \"./controllers/logs.ts\";\r\nimport { loadNodes } from \"./controllers/nodes.ts\";\r\nimport { loadPresence } from \"./controllers/presence.ts\";\r\nimport { deleteSession, loadSessions, patchSession } from \"./controllers/sessions.ts\";\r\nimport {\r\n  installSkill,\r\n  loadSkills,\r\n  saveSkillApiKey,\r\n  updateSkillEdit,\r\n  updateSkillEnabled,\r\n} from \"./controllers/skills.ts\";\r\nimport { loadUsage, loadSessionTimeSeries, loadSessionLogs } from \"./controllers/usage.ts\";\r\nimport { icons } from \"./icons.ts\";\r\nimport { T } from \"../i18n.ts\";\r\nimport { normalizeBasePath, TAB_GROUPS, subtitleForTab, titleForTab } from \"./navigation.ts\";\r\n\r\n// Module-scope debounce for usage date changes (avoids type-unsafe hacks on state object)\r\nlet usageDateDebounceTimeout: number | null = null;\r\nconst debouncedLoadUsage = (state: UsageState) => {\r\n  if (usageDateDebounceTimeout) {\r\n    clearTimeout(usageDateDebounceTimeout);\r\n  }\r\n  usageDateDebounceTimeout = window.setTimeout(() => void loadUsage(state), 400);\r\n};\r\nimport { renderAgents } from \"./views/agents.ts\";\r\nimport { renderChannels } from \"./views/channels.ts\";\r\nimport { renderChat } from \"./views/chat.ts\";\r\nimport { renderConfig } from \"./views/config.ts\";\r\nimport { renderCron } from \"./views/cron.ts\";\r\nimport { renderDebug } from \"./views/debug.ts\";\r\nimport { renderExecApprovalPrompt } from \"./views/exec-approval.ts\";\r\nimport { renderGatewayUrlConfirmation } from \"./views/gateway-url-confirmation.ts\";\r\nimport { renderInstances } from \"./views/instances.ts\";\r\nimport { renderLogs } from \"./views/logs.ts\";\r\nimport { renderNodes } from \"./views/nodes.ts\";\r\nimport { renderOverview } from \"./views/overview.ts\";\r\nimport { renderSessions } from \"./views/sessions.ts\";\r\nimport { renderSkills } from \"./views/skills.ts\";\r\nimport { renderUsage } from \"./views/usage.ts\";\r\n\r\nconst AVATAR_DATA_RE = /^data:/i;\r\nconst AVATAR_HTTP_RE = /^https?:\\/\\//i;\r\n\r\nfunction resolveAssistantAvatarUrl(state: AppViewState): string | undefined {\r\n  const list = state.agentsList?.agents ?? [];\r\n  const parsed = parseAgentSessionKey(state.sessionKey);\r\n  const agentId = parsed?.agentId ?? state.agentsList?.defaultId ?? \"main\";\r\n  const agent = list.find((entry) => entry.id === agentId);\r\n  const identity = agent?.identity;\r\n  const candidate = identity?.avatarUrl ?? identity?.avatar;\r\n  if (!candidate) {\r\n    return undefined;\r\n  }\r\n  if (AVATAR_DATA_RE.test(candidate) || AVATAR_HTTP_RE.test(candidate)) {\r\n    return candidate;\r\n  }\r\n  return identity?.avatarUrl;\r\n}\r\n\r\nexport function renderApp(state: AppViewState) {\r\n  const presenceCount = state.presenceEntries.length;\r\n  const sessionsCount = state.sessionsResult?.count ?? null;\r\n  const cronNext = state.cronStatus?.nextWakeAtMs ?? null;\r\n  const chatDisabledReason = state.connected ? null : \"Disconnected from gateway.\";\r\n  const isChat = state.tab === \"chat\";\r\n  const chatFocus = isChat && (state.settings.chatFocusMode || state.onboarding);\r\n  const showThinking = state.onboarding ? false : state.settings.chatShowThinking;\r\n  const assistantAvatarUrl = resolveAssistantAvatarUrl(state);\r\n  const chatAvatarUrl = state.chatAvatarUrl ?? assistantAvatarUrl ?? null;\r\n  const configValue =\r\n    state.configForm ?? (state.configSnapshot?.config as Record<string, unknown> | null);\r\n  const basePath = normalizeBasePath(state.basePath ?? \"\");\r\n  const resolvedAgentId =\r\n    state.agentsSelectedId ??\r\n    state.agentsList?.defaultId ??\r\n    state.agentsList?.agents?.[0]?.id ??\r\n    null;\r\n\r\n  return html`\r\n    <div class=\"shell ${isChat ? \"shell--chat\" : \"\"} ${chatFocus ? \"shell--chat-focus\" : \"\"} ${state.settings.navCollapsed ? \"shell--nav-collapsed\" : \"\"} ${state.onboarding ? \"shell--onboarding\" : \"\"}\">\r\n      <header class=\"topbar\">\r\n        <div class=\"topbar-left\">\r\n          <button\r\n            class=\"nav-collapse-toggle\"\r\n            @click=${() =>\r\n              state.applySettings({\r\n                ...state.settings,\r\n                navCollapsed: !state.settings.navCollapsed,\r\n              })}\r\n            title=\"${state.settings.navCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\"\r\n            aria-label=\"${state.settings.navCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\"\r\n          >\r\n            <span class=\"nav-collapse-toggle__icon\">${icons.menu}</span>\r\n          </button>\r\n          <div class=\"brand\">\r\n            <div class=\"brand-logo\">\r\n              <img src=${basePath ? `${basePath}/favicon.svg` : \"/favicon.svg\"} alt=\"OpenClaw\" />\r\n            </div>\r\n            <div class=\"brand-text\">\r\n              <div class=\"brand-title\">OPENCLAW</div>\r\n              <div class=\"brand-sub\">Gateway Dashboard</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"topbar-status\">\r\n          <div class=\"pill\">\r\n            <span class=\"statusDot ${state.connected ? \"ok\" : \"\"}\"></span>\r\n            <span>Health</span>\r\n            <span class=\"mono\">${state.connected ? \"OK\" : \"Offline\"}</span>\r\n          </div>\r\n          ${renderThemeToggle(state)}\r\n          ${renderLanguageToggle()}\r\n        </div>\r\n      </header>\r\n      <aside class=\"nav ${state.settings.navCollapsed ? \"nav--collapsed\" : \"\"}\">\r\n        ${TAB_GROUPS.map((group) => {\r\n          const isGroupCollapsed = state.settings.navGroupsCollapsed[group.label] ?? false;\r\n          const hasActiveTab = group.tabs.some((tab) => tab === state.tab);\r\n          return html`\r\n            <div class=\"nav-group ${isGroupCollapsed && !hasActiveTab ? \"nav-group--collapsed\" : \"\"}\">\r\n              <button\r\n                class=\"nav-label\"\r\n                @click=${() => {\r\n                  const next = { ...state.settings.navGroupsCollapsed };\r\n                  next[group.label] = !isGroupCollapsed;\r\n                  state.applySettings({\r\n                    ...state.settings,\r\n                    navGroupsCollapsed: next,\r\n                  });\r\n                }}\r\n                aria-expanded=${!isGroupCollapsed}\r\n              >\r\n                <span class=\"nav-label__text\">${group.label}</span>\r\n                <span class=\"nav-label__chevron\">${isGroupCollapsed ? \"+\" : \"−\"}</span>\r\n              </button>\r\n              <div class=\"nav-group__items\">\r\n                ${group.tabs.map((tab) => renderTab(state, tab))}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })}\r\n        <div class=\"nav-group nav-group--links\">\r\n          <div class=\"nav-label nav-label--static\">\r\n            <span class=\"nav-label__text\">${T(\"Resources\")}</span>\r\n          </div>\r\n          <div class=\"nav-group__items\">\r\n            <a\r\n              class=\"nav-item nav-item--external\"\r\n              href=\"https://docs.openclaw.ai\"\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              title=\"Docs (opens in new tab)\"\r\n            >\r\n              <span class=\"nav-item__icon\" aria-hidden=\"true\">${icons.book}</span>\r\n              <span class=\"nav-item__text\">${T(\"Docs\")}</span>\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </aside>\r\n      <main class=\"content ${isChat ? \"content--chat\" : \"\"}\">\r\n        <section class=\"content-header\">\r\n          <div>\r\n            ${state.tab === \"usage\" ? nothing : html`<div class=\"page-title\">${titleForTab(state.tab)}</div>`}\r\n            ${state.tab === \"usage\" ? nothing : html`<div class=\"page-sub\">${subtitleForTab(state.tab)}</div>`}\r\n          </div>\r\n          <div class=\"page-meta\">\r\n            ${state.lastError ? html`<div class=\"pill danger\">${state.lastError}</div>` : nothing}\r\n            ${isChat ? renderChatControls(state) : nothing}\r\n            ${renderLanguageToggle()}\r\n          </div>\r\n        </section>\r\n\r\n        ${\r\n          state.tab === \"overview\"\r\n            ? renderOverview({\r\n                connected: state.connected,\r\n                hello: state.hello,\r\n                settings: state.settings,\r\n                password: state.password,\r\n                lastError: state.lastError,\r\n                presenceCount,\r\n                sessionsCount,\r\n                cronEnabled: state.cronStatus?.enabled ?? null,\r\n                cronNext,\r\n                lastChannelsRefresh: state.channelsLastSuccess,\r\n                onSettingsChange: (next) => state.applySettings(next),\r\n                onPasswordChange: (next) => (state.password = next),\r\n                onSessionKeyChange: (next) => {\r\n                  state.sessionKey = next;\r\n                  state.chatMessage = \"\";\r\n                  state.resetToolStream();\r\n                  state.applySettings({\r\n                    ...state.settings,\r\n                    sessionKey: next,\r\n                    lastActiveSessionKey: next,\r\n                  });\r\n                  void state.loadAssistantIdentity();\r\n                },\r\n                onConnect: () => state.connect(),\r\n                onRefresh: () => state.loadOverview(),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"channels\"\r\n            ? renderChannels({\r\n                connected: state.connected,\r\n                loading: state.channelsLoading,\r\n                snapshot: state.channelsSnapshot,\r\n                lastError: state.channelsError,\r\n                lastSuccessAt: state.channelsLastSuccess,\r\n                whatsappMessage: state.whatsappLoginMessage,\r\n                whatsappQrDataUrl: state.whatsappLoginQrDataUrl,\r\n                whatsappConnected: state.whatsappLoginConnected,\r\n                whatsappBusy: state.whatsappBusy,\r\n                configSchema: state.configSchema,\r\n                configSchemaLoading: state.configSchemaLoading,\r\n                configForm: state.configForm,\r\n                configUiHints: state.configUiHints,\r\n                configSaving: state.configSaving,\r\n                configFormDirty: state.configFormDirty,\r\n                nostrProfileFormState: state.nostrProfileFormState,\r\n                nostrProfileAccountId: state.nostrProfileAccountId,\r\n                onRefresh: (probe) => loadChannels(state, probe),\r\n                onWhatsAppStart: (force) => state.handleWhatsAppStart(force),\r\n                onWhatsAppWait: () => state.handleWhatsAppWait(),\r\n                onWhatsAppLogout: () => state.handleWhatsAppLogout(),\r\n                onConfigPatch: (path, value) => updateConfigFormValue(state, path, value),\r\n                onConfigSave: () => state.handleChannelConfigSave(),\r\n                onConfigReload: () => state.handleChannelConfigReload(),\r\n                onNostrProfileEdit: (accountId, profile) =>\r\n                  state.handleNostrProfileEdit(accountId, profile),\r\n                onNostrProfileCancel: () => state.handleNostrProfileCancel(),\r\n                onNostrProfileFieldChange: (field, value) =>\r\n                  state.handleNostrProfileFieldChange(field, value),\r\n                onNostrProfileSave: () => state.handleNostrProfileSave(),\r\n                onNostrProfileImport: () => state.handleNostrProfileImport(),\r\n                onNostrProfileToggleAdvanced: () => state.handleNostrProfileToggleAdvanced(),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"instances\"\r\n            ? renderInstances({\r\n                loading: state.presenceLoading,\r\n                entries: state.presenceEntries,\r\n                lastError: state.presenceError,\r\n                statusMessage: state.presenceStatus,\r\n                onRefresh: () => loadPresence(state),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"sessions\"\r\n            ? renderSessions({\r\n                loading: state.sessionsLoading,\r\n                result: state.sessionsResult,\r\n                error: state.sessionsError,\r\n                activeMinutes: state.sessionsFilterActive,\r\n                limit: state.sessionsFilterLimit,\r\n                includeGlobal: state.sessionsIncludeGlobal,\r\n                includeUnknown: state.sessionsIncludeUnknown,\r\n                basePath: state.basePath,\r\n                onFiltersChange: (next) => {\r\n                  state.sessionsFilterActive = next.activeMinutes;\r\n                  state.sessionsFilterLimit = next.limit;\r\n                  state.sessionsIncludeGlobal = next.includeGlobal;\r\n                  state.sessionsIncludeUnknown = next.includeUnknown;\r\n                },\r\n                onRefresh: () => loadSessions(state),\r\n                onPatch: (key, patch) => patchSession(state, key, patch),\r\n                onDelete: (key) => deleteSession(state, key),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"usage\"\r\n            ? renderUsage({\r\n                loading: state.usageLoading,\r\n                error: state.usageError,\r\n                startDate: state.usageStartDate,\r\n                endDate: state.usageEndDate,\r\n                sessions: state.usageResult?.sessions ?? [],\r\n                sessionsLimitReached: (state.usageResult?.sessions?.length ?? 0) >= 1000,\r\n                totals: state.usageResult?.totals ?? null,\r\n                aggregates: state.usageResult?.aggregates ?? null,\r\n                costDaily: state.usageCostSummary?.daily ?? [],\r\n                selectedSessions: state.usageSelectedSessions,\r\n                selectedDays: state.usageSelectedDays,\r\n                selectedHours: state.usageSelectedHours,\r\n                chartMode: state.usageChartMode,\r\n                dailyChartMode: state.usageDailyChartMode,\r\n                timeSeriesMode: state.usageTimeSeriesMode,\r\n                timeSeriesBreakdownMode: state.usageTimeSeriesBreakdownMode,\r\n                timeSeries: state.usageTimeSeries,\r\n                timeSeriesLoading: state.usageTimeSeriesLoading,\r\n                sessionLogs: state.usageSessionLogs,\r\n                sessionLogsLoading: state.usageSessionLogsLoading,\r\n                sessionLogsExpanded: state.usageSessionLogsExpanded,\r\n                logFilterRoles: state.usageLogFilterRoles,\r\n                logFilterTools: state.usageLogFilterTools,\r\n                logFilterHasTools: state.usageLogFilterHasTools,\r\n                logFilterQuery: state.usageLogFilterQuery,\r\n                query: state.usageQuery,\r\n                queryDraft: state.usageQueryDraft,\r\n                sessionSort: state.usageSessionSort,\r\n                sessionSortDir: state.usageSessionSortDir,\r\n                recentSessions: state.usageRecentSessions,\r\n                sessionsTab: state.usageSessionsTab,\r\n                visibleColumns:\r\n                  state.usageVisibleColumns as import(\"./views/usage.ts\").UsageColumnId[],\r\n                timeZone: state.usageTimeZone,\r\n                contextExpanded: state.usageContextExpanded,\r\n                headerPinned: state.usageHeaderPinned,\r\n                onStartDateChange: (date) => {\r\n                  state.usageStartDate = date;\r\n                  state.usageSelectedDays = [];\r\n                  state.usageSelectedHours = [];\r\n                  state.usageSelectedSessions = [];\r\n                  debouncedLoadUsage(state);\r\n                },\r\n                onEndDateChange: (date) => {\r\n                  state.usageEndDate = date;\r\n                  state.usageSelectedDays = [];\r\n                  state.usageSelectedHours = [];\r\n                  state.usageSelectedSessions = [];\r\n                  debouncedLoadUsage(state);\r\n                },\r\n                onRefresh: () => loadUsage(state),\r\n                onTimeZoneChange: (zone) => {\r\n                  state.usageTimeZone = zone;\r\n                },\r\n                onToggleContextExpanded: () => {\r\n                  state.usageContextExpanded = !state.usageContextExpanded;\r\n                },\r\n                onToggleSessionLogsExpanded: () => {\r\n                  state.usageSessionLogsExpanded = !state.usageSessionLogsExpanded;\r\n                },\r\n                onLogFilterRolesChange: (next) => {\r\n                  state.usageLogFilterRoles = next;\r\n                },\r\n                onLogFilterToolsChange: (next) => {\r\n                  state.usageLogFilterTools = next;\r\n                },\r\n                onLogFilterHasToolsChange: (next) => {\r\n                  state.usageLogFilterHasTools = next;\r\n                },\r\n                onLogFilterQueryChange: (next) => {\r\n                  state.usageLogFilterQuery = next;\r\n                },\r\n                onLogFilterClear: () => {\r\n                  state.usageLogFilterRoles = [];\r\n                  state.usageLogFilterTools = [];\r\n                  state.usageLogFilterHasTools = false;\r\n                  state.usageLogFilterQuery = \"\";\r\n                },\r\n                onToggleHeaderPinned: () => {\r\n                  state.usageHeaderPinned = !state.usageHeaderPinned;\r\n                },\r\n                onSelectHour: (hour, shiftKey) => {\r\n                  if (shiftKey && state.usageSelectedHours.length > 0) {\r\n                    const allHours = Array.from({ length: 24 }, (_, i) => i);\r\n                    const lastSelected =\r\n                      state.usageSelectedHours[state.usageSelectedHours.length - 1];\r\n                    const lastIdx = allHours.indexOf(lastSelected);\r\n                    const thisIdx = allHours.indexOf(hour);\r\n                    if (lastIdx !== -1 && thisIdx !== -1) {\r\n                      const [start, end] =\r\n                        lastIdx < thisIdx ? [lastIdx, thisIdx] : [thisIdx, lastIdx];\r\n                      const range = allHours.slice(start, end + 1);\r\n                      state.usageSelectedHours = [\r\n                        ...new Set([...state.usageSelectedHours, ...range]),\r\n                      ];\r\n                    }\r\n                  } else {\r\n                    if (state.usageSelectedHours.includes(hour)) {\r\n                      state.usageSelectedHours = state.usageSelectedHours.filter((h) => h !== hour);\r\n                    } else {\r\n                      state.usageSelectedHours = [...state.usageSelectedHours, hour];\r\n                    }\r\n                  }\r\n                },\r\n                onQueryDraftChange: (query) => {\r\n                  state.usageQueryDraft = query;\r\n                  if (state.usageQueryDebounceTimer) {\r\n                    window.clearTimeout(state.usageQueryDebounceTimer);\r\n                  }\r\n                  state.usageQueryDebounceTimer = window.setTimeout(() => {\r\n                    state.usageQuery = state.usageQueryDraft;\r\n                    state.usageQueryDebounceTimer = null;\r\n                  }, 250);\r\n                },\r\n                onApplyQuery: () => {\r\n                  if (state.usageQueryDebounceTimer) {\r\n                    window.clearTimeout(state.usageQueryDebounceTimer);\r\n                    state.usageQueryDebounceTimer = null;\r\n                  }\r\n                  state.usageQuery = state.usageQueryDraft;\r\n                },\r\n                onClearQuery: () => {\r\n                  if (state.usageQueryDebounceTimer) {\r\n                    window.clearTimeout(state.usageQueryDebounceTimer);\r\n                    state.usageQueryDebounceTimer = null;\r\n                  }\r\n                  state.usageQueryDraft = \"\";\r\n                  state.usageQuery = \"\";\r\n                },\r\n                onSessionSortChange: (sort) => {\r\n                  state.usageSessionSort = sort;\r\n                },\r\n                onSessionSortDirChange: (dir) => {\r\n                  state.usageSessionSortDir = dir;\r\n                },\r\n                onSessionsTabChange: (tab) => {\r\n                  state.usageSessionsTab = tab;\r\n                },\r\n                onToggleColumn: (column) => {\r\n                  if (state.usageVisibleColumns.includes(column)) {\r\n                    state.usageVisibleColumns = state.usageVisibleColumns.filter(\r\n                      (entry) => entry !== column,\r\n                    );\r\n                  } else {\r\n                    state.usageVisibleColumns = [...state.usageVisibleColumns, column];\r\n                  }\r\n                },\r\n                onSelectSession: (key, shiftKey) => {\r\n                  state.usageTimeSeries = null;\r\n                  state.usageSessionLogs = null;\r\n                  state.usageRecentSessions = [\r\n                    key,\r\n                    ...state.usageRecentSessions.filter((entry) => entry !== key),\r\n                  ].slice(0, 8);\r\n\r\n                  if (shiftKey && state.usageSelectedSessions.length > 0) {\r\n                    // Shift-click: select range from last selected to this session\r\n                    // Sort sessions same way as displayed (by tokens or cost descending)\r\n                    const isTokenMode = state.usageChartMode === \"tokens\";\r\n                    const sortedSessions = [...(state.usageResult?.sessions ?? [])].toSorted(\r\n                      (a, b) => {\r\n                        const valA = isTokenMode\r\n                          ? (a.usage?.totalTokens ?? 0)\r\n                          : (a.usage?.totalCost ?? 0);\r\n                        const valB = isTokenMode\r\n                          ? (b.usage?.totalTokens ?? 0)\r\n                          : (b.usage?.totalCost ?? 0);\r\n                        return valB - valA;\r\n                      },\r\n                    );\r\n                    const allKeys = sortedSessions.map((s) => s.key);\r\n                    const lastSelected =\r\n                      state.usageSelectedSessions[state.usageSelectedSessions.length - 1];\r\n                    const lastIdx = allKeys.indexOf(lastSelected);\r\n                    const thisIdx = allKeys.indexOf(key);\r\n                    if (lastIdx !== -1 && thisIdx !== -1) {\r\n                      const [start, end] =\r\n                        lastIdx < thisIdx ? [lastIdx, thisIdx] : [thisIdx, lastIdx];\r\n                      const range = allKeys.slice(start, end + 1);\r\n                      const newSelection = [...new Set([...state.usageSelectedSessions, ...range])];\r\n                      state.usageSelectedSessions = newSelection;\r\n                    }\r\n                  } else {\r\n                    // Regular click: focus a single session (so details always open).\r\n                    // Click the focused session again to clear selection.\r\n                    if (\r\n                      state.usageSelectedSessions.length === 1 &&\r\n                      state.usageSelectedSessions[0] === key\r\n                    ) {\r\n                      state.usageSelectedSessions = [];\r\n                    } else {\r\n                      state.usageSelectedSessions = [key];\r\n                    }\r\n                  }\r\n\r\n                  // Load timeseries/logs only if exactly one session selected\r\n                  if (state.usageSelectedSessions.length === 1) {\r\n                    void loadSessionTimeSeries(state, state.usageSelectedSessions[0]);\r\n                    void loadSessionLogs(state, state.usageSelectedSessions[0]);\r\n                  }\r\n                },\r\n                onSelectDay: (day, shiftKey) => {\r\n                  if (shiftKey && state.usageSelectedDays.length > 0) {\r\n                    // Shift-click: select range from last selected to this day\r\n                    const allDays = (state.usageCostSummary?.daily ?? []).map((d) => d.date);\r\n                    const lastSelected =\r\n                      state.usageSelectedDays[state.usageSelectedDays.length - 1];\r\n                    const lastIdx = allDays.indexOf(lastSelected);\r\n                    const thisIdx = allDays.indexOf(day);\r\n                    if (lastIdx !== -1 && thisIdx !== -1) {\r\n                      const [start, end] =\r\n                        lastIdx < thisIdx ? [lastIdx, thisIdx] : [thisIdx, lastIdx];\r\n                      const range = allDays.slice(start, end + 1);\r\n                      // Merge with existing selection\r\n                      const newSelection = [...new Set([...state.usageSelectedDays, ...range])];\r\n                      state.usageSelectedDays = newSelection;\r\n                    }\r\n                  } else {\r\n                    // Regular click: toggle single day\r\n                    if (state.usageSelectedDays.includes(day)) {\r\n                      state.usageSelectedDays = state.usageSelectedDays.filter((d) => d !== day);\r\n                    } else {\r\n                      state.usageSelectedDays = [day];\r\n                    }\r\n                  }\r\n                },\r\n                onChartModeChange: (mode) => {\r\n                  state.usageChartMode = mode;\r\n                },\r\n                onDailyChartModeChange: (mode) => {\r\n                  state.usageDailyChartMode = mode;\r\n                },\r\n                onTimeSeriesModeChange: (mode) => {\r\n                  state.usageTimeSeriesMode = mode;\r\n                },\r\n                onTimeSeriesBreakdownChange: (mode) => {\r\n                  state.usageTimeSeriesBreakdownMode = mode;\r\n                },\r\n                onClearDays: () => {\r\n                  state.usageSelectedDays = [];\r\n                },\r\n                onClearHours: () => {\r\n                  state.usageSelectedHours = [];\r\n                },\r\n                onClearSessions: () => {\r\n                  state.usageSelectedSessions = [];\r\n                  state.usageTimeSeries = null;\r\n                  state.usageSessionLogs = null;\r\n                },\r\n                onClearFilters: () => {\r\n                  state.usageSelectedDays = [];\r\n                  state.usageSelectedHours = [];\r\n                  state.usageSelectedSessions = [];\r\n                  state.usageTimeSeries = null;\r\n                  state.usageSessionLogs = null;\r\n                },\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"cron\"\r\n            ? renderCron({\r\n                basePath: state.basePath,\r\n                loading: state.cronLoading,\r\n                status: state.cronStatus,\r\n                jobs: state.cronJobs,\r\n                error: state.cronError,\r\n                busy: state.cronBusy,\r\n                form: state.cronForm,\r\n                channels: state.channelsSnapshot?.channelMeta?.length\r\n                  ? state.channelsSnapshot.channelMeta.map((entry) => entry.id)\r\n                  : (state.channelsSnapshot?.channelOrder ?? []),\r\n                channelLabels: state.channelsSnapshot?.channelLabels ?? {},\r\n                channelMeta: state.channelsSnapshot?.channelMeta ?? [],\r\n                runsJobId: state.cronRunsJobId,\r\n                runs: state.cronRuns,\r\n                onFormChange: (patch) => (state.cronForm = { ...state.cronForm, ...patch }),\r\n                onRefresh: () => state.loadCron(),\r\n                onAdd: () => addCronJob(state),\r\n                onToggle: (job, enabled) => toggleCronJob(state, job, enabled),\r\n                onRun: (job) => runCronJob(state, job),\r\n                onRemove: (job) => removeCronJob(state, job),\r\n                onLoadRuns: (jobId) => loadCronRuns(state, jobId),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"agents\"\r\n            ? renderAgents({\r\n                loading: state.agentsLoading,\r\n                error: state.agentsError,\r\n                agentsList: state.agentsList,\r\n                selectedAgentId: resolvedAgentId,\r\n                activePanel: state.agentsPanel,\r\n                configForm: configValue,\r\n                configLoading: state.configLoading,\r\n                configSaving: state.configSaving,\r\n                configDirty: state.configFormDirty,\r\n                channelsLoading: state.channelsLoading,\r\n                channelsError: state.channelsError,\r\n                channelsSnapshot: state.channelsSnapshot,\r\n                channelsLastSuccess: state.channelsLastSuccess,\r\n                cronLoading: state.cronLoading,\r\n                cronStatus: state.cronStatus,\r\n                cronJobs: state.cronJobs,\r\n                cronError: state.cronError,\r\n                agentFilesLoading: state.agentFilesLoading,\r\n                agentFilesError: state.agentFilesError,\r\n                agentFilesList: state.agentFilesList,\r\n                agentFileActive: state.agentFileActive,\r\n                agentFileContents: state.agentFileContents,\r\n                agentFileDrafts: state.agentFileDrafts,\r\n                agentFileSaving: state.agentFileSaving,\r\n                agentIdentityLoading: state.agentIdentityLoading,\r\n                agentIdentityError: state.agentIdentityError,\r\n                agentIdentityById: state.agentIdentityById,\r\n                agentSkillsLoading: state.agentSkillsLoading,\r\n                agentSkillsReport: state.agentSkillsReport,\r\n                agentSkillsError: state.agentSkillsError,\r\n                agentSkillsAgentId: state.agentSkillsAgentId,\r\n                skillsFilter: state.skillsFilter,\r\n                onRefresh: async () => {\r\n                  await loadAgents(state);\r\n                  const agentIds = state.agentsList?.agents?.map((entry) => entry.id) ?? [];\r\n                  if (agentIds.length > 0) {\r\n                    void loadAgentIdentities(state, agentIds);\r\n                  }\r\n                },\r\n                onSelectAgent: (agentId) => {\r\n                  if (state.agentsSelectedId === agentId) {\r\n                    return;\r\n                  }\r\n                  state.agentsSelectedId = agentId;\r\n                  state.agentFilesList = null;\r\n                  state.agentFilesError = null;\r\n                  state.agentFilesLoading = false;\r\n                  state.agentFileActive = null;\r\n                  state.agentFileContents = {};\r\n                  state.agentFileDrafts = {};\r\n                  state.agentSkillsReport = null;\r\n                  state.agentSkillsError = null;\r\n                  state.agentSkillsAgentId = null;\r\n                  void loadAgentIdentity(state, agentId);\r\n                  if (state.agentsPanel === \"files\") {\r\n                    void loadAgentFiles(state, agentId);\r\n                  }\r\n                  if (state.agentsPanel === \"skills\") {\r\n                    void loadAgentSkills(state, agentId);\r\n                  }\r\n                },\r\n                onSelectPanel: (panel) => {\r\n                  state.agentsPanel = panel;\r\n                  if (panel === \"files\" && resolvedAgentId) {\r\n                    if (state.agentFilesList?.agentId !== resolvedAgentId) {\r\n                      state.agentFilesList = null;\r\n                      state.agentFilesError = null;\r\n                      state.agentFileActive = null;\r\n                      state.agentFileContents = {};\r\n                      state.agentFileDrafts = {};\r\n                      void loadAgentFiles(state, resolvedAgentId);\r\n                    }\r\n                  }\r\n                  if (panel === \"skills\") {\r\n                    if (resolvedAgentId) {\r\n                      void loadAgentSkills(state, resolvedAgentId);\r\n                    }\r\n                  }\r\n                  if (panel === \"channels\") {\r\n                    void loadChannels(state, false);\r\n                  }\r\n                  if (panel === \"cron\") {\r\n                    void state.loadCron();\r\n                  }\r\n                },\r\n                onLoadFiles: (agentId) => loadAgentFiles(state, agentId),\r\n                onSelectFile: (name) => {\r\n                  state.agentFileActive = name;\r\n                  if (!resolvedAgentId) {\r\n                    return;\r\n                  }\r\n                  void loadAgentFileContent(state, resolvedAgentId, name);\r\n                },\r\n                onFileDraftChange: (name, content) => {\r\n                  state.agentFileDrafts = { ...state.agentFileDrafts, [name]: content };\r\n                },\r\n                onFileReset: (name) => {\r\n                  const base = state.agentFileContents[name] ?? \"\";\r\n                  state.agentFileDrafts = { ...state.agentFileDrafts, [name]: base };\r\n                },\r\n                onFileSave: (name) => {\r\n                  if (!resolvedAgentId) {\r\n                    return;\r\n                  }\r\n                  const content =\r\n                    state.agentFileDrafts[name] ?? state.agentFileContents[name] ?? \"\";\r\n                  void saveAgentFile(state, resolvedAgentId, name, content);\r\n                },\r\n                onToolsProfileChange: (agentId, profile, clearAllow) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  const basePath = [\"agents\", \"list\", index, \"tools\"];\r\n                  if (profile) {\r\n                    updateConfigFormValue(state, [...basePath, \"profile\"], profile);\r\n                  } else {\r\n                    removeConfigFormValue(state, [...basePath, \"profile\"]);\r\n                  }\r\n                  if (clearAllow) {\r\n                    removeConfigFormValue(state, [...basePath, \"allow\"]);\r\n                  }\r\n                },\r\n                onToolsOverridesChange: (agentId, alsoAllow, deny) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  const basePath = [\"agents\", \"list\", index, \"tools\"];\r\n                  if (alsoAllow.length > 0) {\r\n                    updateConfigFormValue(state, [...basePath, \"alsoAllow\"], alsoAllow);\r\n                  } else {\r\n                    removeConfigFormValue(state, [...basePath, \"alsoAllow\"]);\r\n                  }\r\n                  if (deny.length > 0) {\r\n                    updateConfigFormValue(state, [...basePath, \"deny\"], deny);\r\n                  } else {\r\n                    removeConfigFormValue(state, [...basePath, \"deny\"]);\r\n                  }\r\n                },\r\n                onConfigReload: () => loadConfig(state),\r\n                onConfigSave: () => saveConfig(state),\r\n                onChannelsRefresh: () => loadChannels(state, false),\r\n                onCronRefresh: () => state.loadCron(),\r\n                onSkillsFilterChange: (next) => (state.skillsFilter = next),\r\n                onSkillsRefresh: () => {\r\n                  if (resolvedAgentId) {\r\n                    void loadAgentSkills(state, resolvedAgentId);\r\n                  }\r\n                },\r\n                onAgentSkillToggle: (agentId, skillName, enabled) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  const entry = list[index] as { skills?: unknown };\r\n                  const normalizedSkill = skillName.trim();\r\n                  if (!normalizedSkill) {\r\n                    return;\r\n                  }\r\n                  const allSkills =\r\n                    state.agentSkillsReport?.skills?.map((skill) => skill.name).filter(Boolean) ??\r\n                    [];\r\n                  const existing = Array.isArray(entry.skills)\r\n                    ? entry.skills.map((name) => String(name).trim()).filter(Boolean)\r\n                    : undefined;\r\n                  const base = existing ?? allSkills;\r\n                  const next = new Set(base);\r\n                  if (enabled) {\r\n                    next.add(normalizedSkill);\r\n                  } else {\r\n                    next.delete(normalizedSkill);\r\n                  }\r\n                  updateConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"], [...next]);\r\n                },\r\n                onAgentSkillsClear: (agentId) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  removeConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"]);\r\n                },\r\n                onAgentSkillsDisableAll: (agentId) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  updateConfigFormValue(state, [\"agents\", \"list\", index, \"skills\"], []);\r\n                },\r\n                onModelChange: (agentId, modelId) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  const basePath = [\"agents\", \"list\", index, \"model\"];\r\n                  if (!modelId) {\r\n                    removeConfigFormValue(state, basePath);\r\n                    return;\r\n                  }\r\n                  const entry = list[index] as { model?: unknown };\r\n                  const existing = entry?.model;\r\n                  if (existing && typeof existing === \"object\" && !Array.isArray(existing)) {\r\n                    const fallbacks = (existing as { fallbacks?: unknown }).fallbacks;\r\n                    const next = {\r\n                      primary: modelId,\r\n                      ...(Array.isArray(fallbacks) ? { fallbacks } : {}),\r\n                    };\r\n                    updateConfigFormValue(state, basePath, next);\r\n                  } else {\r\n                    updateConfigFormValue(state, basePath, modelId);\r\n                  }\r\n                },\r\n                onModelFallbacksChange: (agentId, fallbacks) => {\r\n                  if (!configValue) {\r\n                    return;\r\n                  }\r\n                  const list = (configValue as { agents?: { list?: unknown[] } }).agents?.list;\r\n                  if (!Array.isArray(list)) {\r\n                    return;\r\n                  }\r\n                  const index = list.findIndex(\r\n                    (entry) =>\r\n                      entry &&\r\n                      typeof entry === \"object\" &&\r\n                      \"id\" in entry &&\r\n                      (entry as { id?: string }).id === agentId,\r\n                  );\r\n                  if (index < 0) {\r\n                    return;\r\n                  }\r\n                  const basePath = [\"agents\", \"list\", index, \"model\"];\r\n                  const entry = list[index] as { model?: unknown };\r\n                  const normalized = fallbacks.map((name) => name.trim()).filter(Boolean);\r\n                  const existing = entry.model;\r\n                  const resolvePrimary = () => {\r\n                    if (typeof existing === \"string\") {\r\n                      return existing.trim() || null;\r\n                    }\r\n                    if (existing && typeof existing === \"object\" && !Array.isArray(existing)) {\r\n                      const primary = (existing as { primary?: unknown }).primary;\r\n                      if (typeof primary === \"string\") {\r\n                        const trimmed = primary.trim();\r\n                        return trimmed || null;\r\n                      }\r\n                    }\r\n                    return null;\r\n                  };\r\n                  const primary = resolvePrimary();\r\n                  if (normalized.length === 0) {\r\n                    if (primary) {\r\n                      updateConfigFormValue(state, basePath, primary);\r\n                    } else {\r\n                      removeConfigFormValue(state, basePath);\r\n                    }\r\n                    return;\r\n                  }\r\n                  const next = primary\r\n                    ? { primary, fallbacks: normalized }\r\n                    : { fallbacks: normalized };\r\n                  updateConfigFormValue(state, basePath, next);\r\n                },\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"skills\"\r\n            ? renderSkills({\r\n                loading: state.skillsLoading,\r\n                report: state.skillsReport,\r\n                error: state.skillsError,\r\n                filter: state.skillsFilter,\r\n                edits: state.skillEdits,\r\n                messages: state.skillMessages,\r\n                busyKey: state.skillsBusyKey,\r\n                onFilterChange: (next) => (state.skillsFilter = next),\r\n                onRefresh: () => loadSkills(state, { clearMessages: true }),\r\n                onToggle: (key, enabled) => updateSkillEnabled(state, key, enabled),\r\n                onEdit: (key, value) => updateSkillEdit(state, key, value),\r\n                onSaveKey: (key) => saveSkillApiKey(state, key),\r\n                onInstall: (skillKey, name, installId) =>\r\n                  installSkill(state, skillKey, name, installId),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"nodes\"\r\n            ? renderNodes({\r\n                loading: state.nodesLoading,\r\n                nodes: state.nodes,\r\n                devicesLoading: state.devicesLoading,\r\n                devicesError: state.devicesError,\r\n                devicesList: state.devicesList,\r\n                configForm:\r\n                  state.configForm ??\r\n                  (state.configSnapshot?.config as Record<string, unknown> | null),\r\n                configLoading: state.configLoading,\r\n                configSaving: state.configSaving,\r\n                configDirty: state.configFormDirty,\r\n                configFormMode: state.configFormMode,\r\n                execApprovalsLoading: state.execApprovalsLoading,\r\n                execApprovalsSaving: state.execApprovalsSaving,\r\n                execApprovalsDirty: state.execApprovalsDirty,\r\n                execApprovalsSnapshot: state.execApprovalsSnapshot,\r\n                execApprovalsForm: state.execApprovalsForm,\r\n                execApprovalsSelectedAgent: state.execApprovalsSelectedAgent,\r\n                execApprovalsTarget: state.execApprovalsTarget,\r\n                execApprovalsTargetNodeId: state.execApprovalsTargetNodeId,\r\n                onRefresh: () => loadNodes(state),\r\n                onDevicesRefresh: () => loadDevices(state),\r\n                onDeviceApprove: (requestId) => approveDevicePairing(state, requestId),\r\n                onDeviceReject: (requestId) => rejectDevicePairing(state, requestId),\r\n                onDeviceRotate: (deviceId, role, scopes) =>\r\n                  rotateDeviceToken(state, { deviceId, role, scopes }),\r\n                onDeviceRevoke: (deviceId, role) => revokeDeviceToken(state, { deviceId, role }),\r\n                onLoadConfig: () => loadConfig(state),\r\n                onLoadExecApprovals: () => {\r\n                  const target =\r\n                    state.execApprovalsTarget === \"node\" && state.execApprovalsTargetNodeId\r\n                      ? { kind: \"node\" as const, nodeId: state.execApprovalsTargetNodeId }\r\n                      : { kind: \"gateway\" as const };\r\n                  return loadExecApprovals(state, target);\r\n                },\r\n                onBindDefault: (nodeId) => {\r\n                  if (nodeId) {\r\n                    updateConfigFormValue(state, [\"tools\", \"exec\", \"node\"], nodeId);\r\n                  } else {\r\n                    removeConfigFormValue(state, [\"tools\", \"exec\", \"node\"]);\r\n                  }\r\n                },\r\n                onBindAgent: (agentIndex, nodeId) => {\r\n                  const basePath = [\"agents\", \"list\", agentIndex, \"tools\", \"exec\", \"node\"];\r\n                  if (nodeId) {\r\n                    updateConfigFormValue(state, basePath, nodeId);\r\n                  } else {\r\n                    removeConfigFormValue(state, basePath);\r\n                  }\r\n                },\r\n                onSaveBindings: () => saveConfig(state),\r\n                onExecApprovalsTargetChange: (kind, nodeId) => {\r\n                  state.execApprovalsTarget = kind;\r\n                  state.execApprovalsTargetNodeId = nodeId;\r\n                  state.execApprovalsSnapshot = null;\r\n                  state.execApprovalsForm = null;\r\n                  state.execApprovalsDirty = false;\r\n                  state.execApprovalsSelectedAgent = null;\r\n                },\r\n                onExecApprovalsSelectAgent: (agentId) => {\r\n                  state.execApprovalsSelectedAgent = agentId;\r\n                },\r\n                onExecApprovalsPatch: (path, value) =>\r\n                  updateExecApprovalsFormValue(state, path, value),\r\n                onExecApprovalsRemove: (path) => removeExecApprovalsFormValue(state, path),\r\n                onSaveExecApprovals: () => {\r\n                  const target =\r\n                    state.execApprovalsTarget === \"node\" && state.execApprovalsTargetNodeId\r\n                      ? { kind: \"node\" as const, nodeId: state.execApprovalsTargetNodeId }\r\n                      : { kind: \"gateway\" as const };\r\n                  return saveExecApprovals(state, target);\r\n                },\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"chat\"\r\n            ? renderChat({\r\n                sessionKey: state.sessionKey,\r\n                onSessionKeyChange: (next) => {\r\n                  state.sessionKey = next;\r\n                  state.chatMessage = \"\";\r\n                  state.chatAttachments = [];\r\n                  state.chatStream = null;\r\n                  state.chatStreamStartedAt = null;\r\n                  state.chatRunId = null;\r\n                  state.chatQueue = [];\r\n                  state.resetToolStream();\r\n                  state.resetChatScroll();\r\n                  state.applySettings({\r\n                    ...state.settings,\r\n                    sessionKey: next,\r\n                    lastActiveSessionKey: next,\r\n                  });\r\n                  void state.loadAssistantIdentity();\r\n                  void loadChatHistory(state);\r\n                  void refreshChatAvatar(state);\r\n                },\r\n                thinkingLevel: state.chatThinkingLevel,\r\n                showThinking,\r\n                loading: state.chatLoading,\r\n                sending: state.chatSending,\r\n                compactionStatus: state.compactionStatus,\r\n                assistantAvatarUrl: chatAvatarUrl,\r\n                messages: state.chatMessages,\r\n                toolMessages: state.chatToolMessages,\r\n                stream: state.chatStream,\r\n                streamStartedAt: state.chatStreamStartedAt,\r\n                draft: state.chatMessage,\r\n                queue: state.chatQueue,\r\n                connected: state.connected,\r\n                canSend: state.connected,\r\n                disabledReason: chatDisabledReason,\r\n                error: state.lastError,\r\n                sessions: state.sessionsResult,\r\n                focusMode: chatFocus,\r\n                onRefresh: () => {\r\n                  state.resetToolStream();\r\n                  return Promise.all([loadChatHistory(state), refreshChatAvatar(state)]);\r\n                },\r\n                onToggleFocusMode: () => {\r\n                  if (state.onboarding) {\r\n                    return;\r\n                  }\r\n                  state.applySettings({\r\n                    ...state.settings,\r\n                    chatFocusMode: !state.settings.chatFocusMode,\r\n                  });\r\n                },\r\n                onChatScroll: (event) => state.handleChatScroll(event),\r\n                onDraftChange: (next) => (state.chatMessage = next),\r\n                attachments: state.chatAttachments,\r\n                onAttachmentsChange: (next) => (state.chatAttachments = next),\r\n                onSend: () => state.handleSendChat(),\r\n                canAbort: Boolean(state.chatRunId),\r\n                onAbort: () => void state.handleAbortChat(),\r\n                onQueueRemove: (id) => state.removeQueuedMessage(id),\r\n                onNewSession: () => state.handleSendChat(\"/new\", { restoreDraft: true }),\r\n                showNewMessages: state.chatNewMessagesBelow && !state.chatManualRefreshInFlight,\r\n                onScrollToBottom: () => state.scrollToBottom(),\r\n                // Sidebar props for tool output viewing\r\n                sidebarOpen: state.sidebarOpen,\r\n                sidebarContent: state.sidebarContent,\r\n                sidebarError: state.sidebarError,\r\n                splitRatio: state.splitRatio,\r\n                onOpenSidebar: (content: string) => state.handleOpenSidebar(content),\r\n                onCloseSidebar: () => state.handleCloseSidebar(),\r\n                onSplitRatioChange: (ratio: number) => state.handleSplitRatioChange(ratio),\r\n                assistantName: state.assistantName,\r\n                assistantAvatar: state.assistantAvatar,\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"config\"\r\n            ? renderConfig({\r\n                raw: state.configRaw,\r\n                originalRaw: state.configRawOriginal,\r\n                valid: state.configValid,\r\n                issues: state.configIssues,\r\n                loading: state.configLoading,\r\n                saving: state.configSaving,\r\n                applying: state.configApplying,\r\n                updating: state.updateRunning,\r\n                connected: state.connected,\r\n                schema: state.configSchema,\r\n                schemaLoading: state.configSchemaLoading,\r\n                uiHints: state.configUiHints,\r\n                formMode: state.configFormMode,\r\n                formValue: state.configForm,\r\n                originalValue: state.configFormOriginal,\r\n                searchQuery: state.configSearchQuery,\r\n                activeSection: state.configActiveSection,\r\n                activeSubsection: state.configActiveSubsection,\r\n                onRawChange: (next) => {\r\n                  state.configRaw = next;\r\n                },\r\n                onFormModeChange: (mode) => (state.configFormMode = mode),\r\n                onFormPatch: (path, value) => updateConfigFormValue(state, path, value),\r\n                onSearchChange: (query) => (state.configSearchQuery = query),\r\n                onSectionChange: (section) => {\r\n                  state.configActiveSection = section;\r\n                  state.configActiveSubsection = null;\r\n                },\r\n                onSubsectionChange: (section) => (state.configActiveSubsection = section),\r\n                onReload: () => loadConfig(state),\r\n                onSave: () => saveConfig(state),\r\n                onApply: () => applyConfig(state),\r\n                onUpdate: () => runUpdate(state),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"debug\"\r\n            ? renderDebug({\r\n                loading: state.debugLoading,\r\n                status: state.debugStatus,\r\n                health: state.debugHealth,\r\n                models: state.debugModels,\r\n                heartbeat: state.debugHeartbeat,\r\n                eventLog: state.eventLog,\r\n                callMethod: state.debugCallMethod,\r\n                callParams: state.debugCallParams,\r\n                callResult: state.debugCallResult,\r\n                callError: state.debugCallError,\r\n                onCallMethodChange: (next) => (state.debugCallMethod = next),\r\n                onCallParamsChange: (next) => (state.debugCallParams = next),\r\n                onRefresh: () => loadDebug(state),\r\n                onCall: () => callDebugMethod(state),\r\n              })\r\n            : nothing\r\n        }\r\n\r\n        ${\r\n          state.tab === \"logs\"\r\n            ? renderLogs({\r\n                loading: state.logsLoading,\r\n                error: state.logsError,\r\n                file: state.logsFile,\r\n                entries: state.logsEntries,\r\n                filterText: state.logsFilterText,\r\n                levelFilters: state.logsLevelFilters,\r\n                autoFollow: state.logsAutoFollow,\r\n                truncated: state.logsTruncated,\r\n                onFilterTextChange: (next) => (state.logsFilterText = next),\r\n                onLevelToggle: (level, enabled) => {\r\n                  state.logsLevelFilters = { ...state.logsLevelFilters, [level]: enabled };\r\n                },\r\n                onToggleAutoFollow: (next) => (state.logsAutoFollow = next),\r\n                onRefresh: () => loadLogs(state, { reset: true }),\r\n                onExport: (lines, label) => state.exportLogs(lines, label),\r\n                onScroll: (event) => state.handleLogsScroll(event),\r\n              })\r\n            : nothing\r\n        }\r\n      </main>\r\n      ${renderExecApprovalPrompt(state)}\r\n      ${renderGatewayUrlConfirmation(state)}\r\n    </div>\r\n  `;\r\n}\r\n","import { LitElement } from \"lit\";\r\nimport { customElement, state } from \"lit/decorators.js\";\r\nimport type { EventLogEntry } from \"./app-events.ts\";\r\nimport type { AppViewState } from \"./app-view-state.ts\";\r\nimport type { DevicePairingList } from \"./controllers/devices.ts\";\r\nimport type { ExecApprovalRequest } from \"./controllers/exec-approval.ts\";\r\nimport type { ExecApprovalsFile, ExecApprovalsSnapshot } from \"./controllers/exec-approvals.ts\";\r\nimport type { SkillMessage } from \"./controllers/skills.ts\";\r\nimport type { GatewayBrowserClient, GatewayHelloOk } from \"./gateway.ts\";\r\nimport type { Tab } from \"./navigation.ts\";\r\nimport type { ResolvedTheme, ThemeMode } from \"./theme.ts\";\r\nimport type {\r\n  AgentsListResult,\r\n  AgentsFilesListResult,\r\n  AgentIdentityResult,\r\n  ConfigSnapshot,\r\n  ConfigUiHints,\r\n  CronJob,\r\n  CronRunLogEntry,\r\n  CronStatus,\r\n  HealthSnapshot,\r\n  LogEntry,\r\n  LogLevel,\r\n  PresenceEntry,\r\n  ChannelsStatusSnapshot,\r\n  SessionsListResult,\r\n  SkillStatusReport,\r\n  StatusSummary,\r\n  NostrProfile,\r\n} from \"./types.ts\";\r\nimport type { NostrProfileFormState } from \"./views/channels.nostr-profile-form.ts\";\r\nimport {\r\n  handleChannelConfigReload as handleChannelConfigReloadInternal,\r\n  handleChannelConfigSave as handleChannelConfigSaveInternal,\r\n  handleNostrProfileCancel as handleNostrProfileCancelInternal,\r\n  handleNostrProfileEdit as handleNostrProfileEditInternal,\r\n  handleNostrProfileFieldChange as handleNostrProfileFieldChangeInternal,\r\n  handleNostrProfileImport as handleNostrProfileImportInternal,\r\n  handleNostrProfileSave as handleNostrProfileSaveInternal,\r\n  handleNostrProfileToggleAdvanced as handleNostrProfileToggleAdvancedInternal,\r\n  handleWhatsAppLogout as handleWhatsAppLogoutInternal,\r\n  handleWhatsAppStart as handleWhatsAppStartInternal,\r\n  handleWhatsAppWait as handleWhatsAppWaitInternal,\r\n} from \"./app-channels.ts\";\r\nimport {\r\n  handleAbortChat as handleAbortChatInternal,\r\n  handleSendChat as handleSendChatInternal,\r\n  removeQueuedMessage as removeQueuedMessageInternal,\r\n} from \"./app-chat.ts\";\r\nimport { DEFAULT_CRON_FORM, DEFAULT_LOG_LEVEL_FILTERS } from \"./app-defaults.ts\";\r\nimport { connectGateway as connectGatewayInternal } from \"./app-gateway.ts\";\r\nimport {\r\n  handleConnected,\r\n  handleDisconnected,\r\n  handleFirstUpdated,\r\n  handleUpdated,\r\n} from \"./app-lifecycle.ts\";\r\nimport { renderApp } from \"./app-render.ts\";\r\nimport {\r\n  exportLogs as exportLogsInternal,\r\n  handleChatScroll as handleChatScrollInternal,\r\n  handleLogsScroll as handleLogsScrollInternal,\r\n  resetChatScroll as resetChatScrollInternal,\r\n  scheduleChatScroll as scheduleChatScrollInternal,\r\n} from \"./app-scroll.ts\";\r\nimport {\r\n  applySettings as applySettingsInternal,\r\n  loadCron as loadCronInternal,\r\n  loadOverview as loadOverviewInternal,\r\n  setTab as setTabInternal,\r\n  setTheme as setThemeInternal,\r\n  onPopState as onPopStateInternal,\r\n} from \"./app-settings.ts\";\r\nimport {\r\n  resetToolStream as resetToolStreamInternal,\r\n  type ToolStreamEntry,\r\n  type CompactionStatus,\r\n} from \"./app-tool-stream.ts\";\r\nimport { resolveInjectedAssistantIdentity } from \"./assistant-identity.ts\";\r\nimport { loadAssistantIdentity as loadAssistantIdentityInternal } from \"./controllers/assistant-identity.ts\";\r\nimport { loadSettings, type UiSettings } from \"./storage.ts\";\r\nimport { type ChatAttachment, type ChatQueueItem, type CronFormState } from \"./ui-types.ts\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __OPENCLAW_CONTROL_UI_BASE_PATH__?: string;\r\n  }\r\n}\r\n\r\nconst injectedAssistantIdentity = resolveInjectedAssistantIdentity();\r\n\r\nfunction resolveOnboardingMode(): boolean {\r\n  if (!window.location.search) {\r\n    return false;\r\n  }\r\n  const params = new URLSearchParams(window.location.search);\r\n  const raw = params.get(\"onboarding\");\r\n  if (!raw) {\r\n    return false;\r\n  }\r\n  const normalized = raw.trim().toLowerCase();\r\n  return normalized === \"1\" || normalized === \"true\" || normalized === \"yes\" || normalized === \"on\";\r\n}\r\n\r\n@customElement(\"openclaw-app\")\r\nexport class OpenClawApp extends LitElement {\r\n  @state() settings: UiSettings = loadSettings();\r\n  @state() password = \"\";\r\n  @state() tab: Tab = \"chat\";\r\n  @state() onboarding = resolveOnboardingMode();\r\n  @state() connected = false;\r\n  @state() theme: ThemeMode = this.settings.theme ?? \"system\";\r\n  @state() themeResolved: ResolvedTheme = \"dark\";\r\n  @state() hello: GatewayHelloOk | null = null;\r\n  @state() lastError: string | null = null;\r\n  @state() eventLog: EventLogEntry[] = [];\r\n  private eventLogBuffer: EventLogEntry[] = [];\r\n  private toolStreamSyncTimer: number | null = null;\r\n  private sidebarCloseTimer: number | null = null;\r\n\r\n  @state() assistantName = injectedAssistantIdentity.name;\r\n  @state() assistantAvatar = injectedAssistantIdentity.avatar;\r\n  @state() assistantAgentId = injectedAssistantIdentity.agentId ?? null;\r\n\r\n  @state() sessionKey = this.settings.sessionKey;\r\n  @state() chatLoading = false;\r\n  @state() chatSending = false;\r\n  @state() chatMessage = \"\";\r\n  @state() chatMessages: unknown[] = [];\r\n  @state() chatToolMessages: unknown[] = [];\r\n  @state() chatStream: string | null = null;\r\n  @state() chatStreamStartedAt: number | null = null;\r\n  @state() chatRunId: string | null = null;\r\n  @state() compactionStatus: CompactionStatus | null = null;\r\n  @state() chatAvatarUrl: string | null = null;\r\n  @state() chatThinkingLevel: string | null = null;\r\n  @state() chatQueue: ChatQueueItem[] = [];\r\n  @state() chatAttachments: ChatAttachment[] = [];\r\n  @state() chatManualRefreshInFlight = false;\r\n  // Sidebar state for tool output viewing\r\n  @state() sidebarOpen = false;\r\n  @state() sidebarContent: string | null = null;\r\n  @state() sidebarError: string | null = null;\r\n  @state() splitRatio = this.settings.splitRatio;\r\n\r\n  @state() nodesLoading = false;\r\n  @state() nodes: Array<Record<string, unknown>> = [];\r\n  @state() devicesLoading = false;\r\n  @state() devicesError: string | null = null;\r\n  @state() devicesList: DevicePairingList | null = null;\r\n  @state() execApprovalsLoading = false;\r\n  @state() execApprovalsSaving = false;\r\n  @state() execApprovalsDirty = false;\r\n  @state() execApprovalsSnapshot: ExecApprovalsSnapshot | null = null;\r\n  @state() execApprovalsForm: ExecApprovalsFile | null = null;\r\n  @state() execApprovalsSelectedAgent: string | null = null;\r\n  @state() execApprovalsTarget: \"gateway\" | \"node\" = \"gateway\";\r\n  @state() execApprovalsTargetNodeId: string | null = null;\r\n  @state() execApprovalQueue: ExecApprovalRequest[] = [];\r\n  @state() execApprovalBusy = false;\r\n  @state() execApprovalError: string | null = null;\r\n  @state() pendingGatewayUrl: string | null = null;\r\n\r\n  @state() configLoading = false;\r\n  @state() configRaw = \"{\\n}\\n\";\r\n  @state() configRawOriginal = \"\";\r\n  @state() configValid: boolean | null = null;\r\n  @state() configIssues: unknown[] = [];\r\n  @state() configSaving = false;\r\n  @state() configApplying = false;\r\n  @state() updateRunning = false;\r\n  @state() applySessionKey = this.settings.lastActiveSessionKey;\r\n  @state() configSnapshot: ConfigSnapshot | null = null;\r\n  @state() configSchema: unknown = null;\r\n  @state() configSchemaVersion: string | null = null;\r\n  @state() configSchemaLoading = false;\r\n  @state() configUiHints: ConfigUiHints = {};\r\n  @state() configForm: Record<string, unknown> | null = null;\r\n  @state() configFormOriginal: Record<string, unknown> | null = null;\r\n  @state() configFormDirty = false;\r\n  @state() configFormMode: \"form\" | \"raw\" = \"form\";\r\n  @state() configSearchQuery = \"\";\r\n  @state() configActiveSection: string | null = null;\r\n  @state() configActiveSubsection: string | null = null;\r\n\r\n  @state() channelsLoading = false;\r\n  @state() channelsSnapshot: ChannelsStatusSnapshot | null = null;\r\n  @state() channelsError: string | null = null;\r\n  @state() channelsLastSuccess: number | null = null;\r\n  @state() whatsappLoginMessage: string | null = null;\r\n  @state() whatsappLoginQrDataUrl: string | null = null;\r\n  @state() whatsappLoginConnected: boolean | null = null;\r\n  @state() whatsappBusy = false;\r\n  @state() nostrProfileFormState: NostrProfileFormState | null = null;\r\n  @state() nostrProfileAccountId: string | null = null;\r\n\r\n  @state() presenceLoading = false;\r\n  @state() presenceEntries: PresenceEntry[] = [];\r\n  @state() presenceError: string | null = null;\r\n  @state() presenceStatus: string | null = null;\r\n\r\n  @state() agentsLoading = false;\r\n  @state() agentsList: AgentsListResult | null = null;\r\n  @state() agentsError: string | null = null;\r\n  @state() agentsSelectedId: string | null = null;\r\n  @state() agentsPanel: \"overview\" | \"files\" | \"tools\" | \"skills\" | \"channels\" | \"cron\" =\r\n    \"overview\";\r\n  @state() agentFilesLoading = false;\r\n  @state() agentFilesError: string | null = null;\r\n  @state() agentFilesList: AgentsFilesListResult | null = null;\r\n  @state() agentFileContents: Record<string, string> = {};\r\n  @state() agentFileDrafts: Record<string, string> = {};\r\n  @state() agentFileActive: string | null = null;\r\n  @state() agentFileSaving = false;\r\n  @state() agentIdentityLoading = false;\r\n  @state() agentIdentityError: string | null = null;\r\n  @state() agentIdentityById: Record<string, AgentIdentityResult> = {};\r\n  @state() agentSkillsLoading = false;\r\n  @state() agentSkillsError: string | null = null;\r\n  @state() agentSkillsReport: SkillStatusReport | null = null;\r\n  @state() agentSkillsAgentId: string | null = null;\r\n\r\n  @state() sessionsLoading = false;\r\n  @state() sessionsResult: SessionsListResult | null = null;\r\n  @state() sessionsError: string | null = null;\r\n  @state() sessionsFilterActive = \"\";\r\n  @state() sessionsFilterLimit = \"120\";\r\n  @state() sessionsIncludeGlobal = true;\r\n  @state() sessionsIncludeUnknown = false;\r\n\r\n  @state() usageLoading = false;\r\n  @state() usageResult: import(\"./types.js\").SessionsUsageResult | null = null;\r\n  @state() usageCostSummary: import(\"./types.js\").CostUsageSummary | null = null;\r\n  @state() usageError: string | null = null;\r\n  @state() usageStartDate = (() => {\r\n    const d = new Date();\r\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`;\r\n  })();\r\n  @state() usageEndDate = (() => {\r\n    const d = new Date();\r\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`;\r\n  })();\r\n  @state() usageSelectedSessions: string[] = [];\r\n  @state() usageSelectedDays: string[] = [];\r\n  @state() usageSelectedHours: number[] = [];\r\n  @state() usageChartMode: \"tokens\" | \"cost\" = \"tokens\";\r\n  @state() usageDailyChartMode: \"total\" | \"by-type\" = \"by-type\";\r\n  @state() usageTimeSeriesMode: \"cumulative\" | \"per-turn\" = \"per-turn\";\r\n  @state() usageTimeSeriesBreakdownMode: \"total\" | \"by-type\" = \"by-type\";\r\n  @state() usageTimeSeries: import(\"./types.js\").SessionUsageTimeSeries | null = null;\r\n  @state() usageTimeSeriesLoading = false;\r\n  @state() usageSessionLogs: import(\"./views/usage.js\").SessionLogEntry[] | null = null;\r\n  @state() usageSessionLogsLoading = false;\r\n  @state() usageSessionLogsExpanded = false;\r\n  // Applied query (used to filter the already-loaded sessions list client-side).\r\n  @state() usageQuery = \"\";\r\n  // Draft query text (updates immediately as the user types; applied via debounce or \"Search\").\r\n  @state() usageQueryDraft = \"\";\r\n  @state() usageSessionSort: \"tokens\" | \"cost\" | \"recent\" | \"messages\" | \"errors\" = \"recent\";\r\n  @state() usageSessionSortDir: \"desc\" | \"asc\" = \"desc\";\r\n  @state() usageRecentSessions: string[] = [];\r\n  @state() usageTimeZone: \"local\" | \"utc\" = \"local\";\r\n  @state() usageContextExpanded = false;\r\n  @state() usageHeaderPinned = false;\r\n  @state() usageSessionsTab: \"all\" | \"recent\" = \"all\";\r\n  @state() usageVisibleColumns: string[] = [\r\n    \"channel\",\r\n    \"agent\",\r\n    \"provider\",\r\n    \"model\",\r\n    \"messages\",\r\n    \"tools\",\r\n    \"errors\",\r\n    \"duration\",\r\n  ];\r\n  @state() usageLogFilterRoles: import(\"./views/usage.js\").SessionLogRole[] = [];\r\n  @state() usageLogFilterTools: string[] = [];\r\n  @state() usageLogFilterHasTools = false;\r\n  @state() usageLogFilterQuery = \"\";\r\n\r\n  // Non-reactive (don’t trigger renders just for timer bookkeeping).\r\n  usageQueryDebounceTimer: number | null = null;\r\n\r\n  @state() cronLoading = false;\r\n  @state() cronJobs: CronJob[] = [];\r\n  @state() cronStatus: CronStatus | null = null;\r\n  @state() cronError: string | null = null;\r\n  @state() cronForm: CronFormState = { ...DEFAULT_CRON_FORM };\r\n  @state() cronRunsJobId: string | null = null;\r\n  @state() cronRuns: CronRunLogEntry[] = [];\r\n  @state() cronBusy = false;\r\n\r\n  @state() skillsLoading = false;\r\n  @state() skillsReport: SkillStatusReport | null = null;\r\n  @state() skillsError: string | null = null;\r\n  @state() skillsFilter = \"\";\r\n  @state() skillEdits: Record<string, string> = {};\r\n  @state() skillsBusyKey: string | null = null;\r\n  @state() skillMessages: Record<string, SkillMessage> = {};\r\n\r\n  @state() debugLoading = false;\r\n  @state() debugStatus: StatusSummary | null = null;\r\n  @state() debugHealth: HealthSnapshot | null = null;\r\n  @state() debugModels: unknown[] = [];\r\n  @state() debugHeartbeat: unknown = null;\r\n  @state() debugCallMethod = \"\";\r\n  @state() debugCallParams = \"{}\";\r\n  @state() debugCallResult: string | null = null;\r\n  @state() debugCallError: string | null = null;\r\n\r\n  @state() logsLoading = false;\r\n  @state() logsError: string | null = null;\r\n  @state() logsFile: string | null = null;\r\n  @state() logsEntries: LogEntry[] = [];\r\n  @state() logsFilterText = \"\";\r\n  @state() logsLevelFilters: Record<LogLevel, boolean> = {\r\n    ...DEFAULT_LOG_LEVEL_FILTERS,\r\n  };\r\n  @state() logsAutoFollow = true;\r\n  @state() logsTruncated = false;\r\n  @state() logsCursor: number | null = null;\r\n  @state() logsLastFetchAt: number | null = null;\r\n  @state() logsLimit = 500;\r\n  @state() logsMaxBytes = 250_000;\r\n  @state() logsAtBottom = true;\r\n\r\n  client: GatewayBrowserClient | null = null;\r\n  private chatScrollFrame: number | null = null;\r\n  private chatScrollTimeout: number | null = null;\r\n  private chatHasAutoScrolled = false;\r\n  private chatUserNearBottom = true;\r\n  @state() chatNewMessagesBelow = false;\r\n  private nodesPollInterval: number | null = null;\r\n  private logsPollInterval: number | null = null;\r\n  private debugPollInterval: number | null = null;\r\n  private logsScrollFrame: number | null = null;\r\n  private toolStreamById = new Map<string, ToolStreamEntry>();\r\n  private toolStreamOrder: string[] = [];\r\n  refreshSessionsAfterChat = new Set<string>();\r\n  basePath = \"\";\r\n  private popStateHandler = () =>\r\n    onPopStateInternal(this as unknown as Parameters<typeof onPopStateInternal>[0]);\r\n  private themeMedia: MediaQueryList | null = null;\r\n  private themeMediaHandler: ((event: MediaQueryListEvent) => void) | null = null;\r\n  private topbarObserver: ResizeObserver | null = null;\r\n\r\n  createRenderRoot() {\r\n    return this;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    handleConnected(this as unknown as Parameters<typeof handleConnected>[0]);\r\n  }\r\n\r\n  protected firstUpdated() {\r\n    handleFirstUpdated(this as unknown as Parameters<typeof handleFirstUpdated>[0]);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    handleDisconnected(this as unknown as Parameters<typeof handleDisconnected>[0]);\r\n    super.disconnectedCallback();\r\n  }\r\n\r\n  protected updated(changed: Map<PropertyKey, unknown>) {\r\n    handleUpdated(this as unknown as Parameters<typeof handleUpdated>[0], changed);\r\n  }\r\n\r\n  connect() {\r\n    connectGatewayInternal(this as unknown as Parameters<typeof connectGatewayInternal>[0]);\r\n  }\r\n\r\n  handleChatScroll(event: Event) {\r\n    handleChatScrollInternal(\r\n      this as unknown as Parameters<typeof handleChatScrollInternal>[0],\r\n      event,\r\n    );\r\n  }\r\n\r\n  handleLogsScroll(event: Event) {\r\n    handleLogsScrollInternal(\r\n      this as unknown as Parameters<typeof handleLogsScrollInternal>[0],\r\n      event,\r\n    );\r\n  }\r\n\r\n  exportLogs(lines: string[], label: string) {\r\n    exportLogsInternal(lines, label);\r\n  }\r\n\r\n  resetToolStream() {\r\n    resetToolStreamInternal(this as unknown as Parameters<typeof resetToolStreamInternal>[0]);\r\n  }\r\n\r\n  resetChatScroll() {\r\n    resetChatScrollInternal(this as unknown as Parameters<typeof resetChatScrollInternal>[0]);\r\n  }\r\n\r\n  scrollToBottom(opts?: { smooth?: boolean }) {\r\n    resetChatScrollInternal(this as unknown as Parameters<typeof resetChatScrollInternal>[0]);\r\n    scheduleChatScrollInternal(\r\n      this as unknown as Parameters<typeof scheduleChatScrollInternal>[0],\r\n      true,\r\n      Boolean(opts?.smooth),\r\n    );\r\n  }\r\n\r\n  async loadAssistantIdentity() {\r\n    await loadAssistantIdentityInternal(this);\r\n  }\r\n\r\n  applySettings(next: UiSettings) {\r\n    applySettingsInternal(this as unknown as Parameters<typeof applySettingsInternal>[0], next);\r\n  }\r\n\r\n  setTab(next: Tab) {\r\n    setTabInternal(this as unknown as Parameters<typeof setTabInternal>[0], next);\r\n  }\r\n\r\n  setTheme(next: ThemeMode, context?: Parameters<typeof setThemeInternal>[2]) {\r\n    setThemeInternal(this as unknown as Parameters<typeof setThemeInternal>[0], next, context);\r\n  }\r\n\r\n  async loadOverview() {\r\n    await loadOverviewInternal(this as unknown as Parameters<typeof loadOverviewInternal>[0]);\r\n  }\r\n\r\n  async loadCron() {\r\n    await loadCronInternal(this as unknown as Parameters<typeof loadCronInternal>[0]);\r\n  }\r\n\r\n  async handleAbortChat() {\r\n    await handleAbortChatInternal(this as unknown as Parameters<typeof handleAbortChatInternal>[0]);\r\n  }\r\n\r\n  removeQueuedMessage(id: string) {\r\n    removeQueuedMessageInternal(\r\n      this as unknown as Parameters<typeof removeQueuedMessageInternal>[0],\r\n      id,\r\n    );\r\n  }\r\n\r\n  async handleSendChat(\r\n    messageOverride?: string,\r\n    opts?: Parameters<typeof handleSendChatInternal>[2],\r\n  ) {\r\n    await handleSendChatInternal(\r\n      this as unknown as Parameters<typeof handleSendChatInternal>[0],\r\n      messageOverride,\r\n      opts,\r\n    );\r\n  }\r\n\r\n  async handleWhatsAppStart(force: boolean) {\r\n    await handleWhatsAppStartInternal(this, force);\r\n  }\r\n\r\n  async handleWhatsAppWait() {\r\n    await handleWhatsAppWaitInternal(this);\r\n  }\r\n\r\n  async handleWhatsAppLogout() {\r\n    await handleWhatsAppLogoutInternal(this);\r\n  }\r\n\r\n  async handleChannelConfigSave() {\r\n    await handleChannelConfigSaveInternal(this);\r\n  }\r\n\r\n  async handleChannelConfigReload() {\r\n    await handleChannelConfigReloadInternal(this);\r\n  }\r\n\r\n  handleNostrProfileEdit(accountId: string, profile: NostrProfile | null) {\r\n    handleNostrProfileEditInternal(this, accountId, profile);\r\n  }\r\n\r\n  handleNostrProfileCancel() {\r\n    handleNostrProfileCancelInternal(this);\r\n  }\r\n\r\n  handleNostrProfileFieldChange(field: keyof NostrProfile, value: string) {\r\n    handleNostrProfileFieldChangeInternal(this, field, value);\r\n  }\r\n\r\n  async handleNostrProfileSave() {\r\n    await handleNostrProfileSaveInternal(this);\r\n  }\r\n\r\n  async handleNostrProfileImport() {\r\n    await handleNostrProfileImportInternal(this);\r\n  }\r\n\r\n  handleNostrProfileToggleAdvanced() {\r\n    handleNostrProfileToggleAdvancedInternal(this);\r\n  }\r\n\r\n  async handleExecApprovalDecision(decision: \"allow-once\" | \"allow-always\" | \"deny\") {\r\n    const active = this.execApprovalQueue[0];\r\n    if (!active || !this.client || this.execApprovalBusy) {\r\n      return;\r\n    }\r\n    this.execApprovalBusy = true;\r\n    this.execApprovalError = null;\r\n    try {\r\n      await this.client.request(\"exec.approval.resolve\", {\r\n        id: active.id,\r\n        decision,\r\n      });\r\n      this.execApprovalQueue = this.execApprovalQueue.filter((entry) => entry.id !== active.id);\r\n    } catch (err) {\r\n      this.execApprovalError = `Exec approval failed: ${String(err)}`;\r\n    } finally {\r\n      this.execApprovalBusy = false;\r\n    }\r\n  }\r\n\r\n  handleGatewayUrlConfirm() {\r\n    const nextGatewayUrl = this.pendingGatewayUrl;\r\n    if (!nextGatewayUrl) {\r\n      return;\r\n    }\r\n    this.pendingGatewayUrl = null;\r\n    applySettingsInternal(this as unknown as Parameters<typeof applySettingsInternal>[0], {\r\n      ...this.settings,\r\n      gatewayUrl: nextGatewayUrl,\r\n    });\r\n    this.connect();\r\n  }\r\n\r\n  handleGatewayUrlCancel() {\r\n    this.pendingGatewayUrl = null;\r\n  }\r\n\r\n  // Sidebar handlers for tool output viewing\r\n  handleOpenSidebar(content: string) {\r\n    if (this.sidebarCloseTimer != null) {\r\n      window.clearTimeout(this.sidebarCloseTimer);\r\n      this.sidebarCloseTimer = null;\r\n    }\r\n    this.sidebarContent = content;\r\n    this.sidebarError = null;\r\n    this.sidebarOpen = true;\r\n  }\r\n\r\n  handleCloseSidebar() {\r\n    this.sidebarOpen = false;\r\n    // Clear content after transition\r\n    if (this.sidebarCloseTimer != null) {\r\n      window.clearTimeout(this.sidebarCloseTimer);\r\n    }\r\n    this.sidebarCloseTimer = window.setTimeout(() => {\r\n      if (this.sidebarOpen) {\r\n        return;\r\n      }\r\n      this.sidebarContent = null;\r\n      this.sidebarError = null;\r\n      this.sidebarCloseTimer = null;\r\n    }, 200);\r\n  }\r\n\r\n  handleSplitRatioChange(ratio: number) {\r\n    const newRatio = Math.max(0.4, Math.min(0.7, ratio));\r\n    this.splitRatio = newRatio;\r\n    this.applySettings({ ...this.settings, splitRatio: newRatio });\r\n  }\r\n\r\n  render() {\r\n    return renderApp(this as unknown as AppViewState);\r\n  }\r\n}\r\n"],"names":["t","e","s","o","n$5","r","n","i","S","c","h","a","l","p","d","u","f","b","y$2","y","v","_","m","g","$","x","w","E","A","C","P","V","N","I","L","z","H","M","R","k","Z","H$1","L$2","z$1","Z$1","j","B","D","loadChannels","state","probe","res","err","startWhatsAppLogin","force","waitWhatsAppLogin","logoutWhatsApp","schemaType","schema","defaultValue","pathKey","path","segment","hintForPath","hints","key","direct","segments","hintKey","hint","hintSegments","match","humanize","raw","coerceNumberString","value","integer","trimmed","parsed","coerceBooleanString","coerceFormValues","next","type","variants","variant","variantType","coerced","obj","props","additional","result","val","propSchema","tuple","item","itemsSchema","cloneConfigObject","serializeConfigForm","form","setPathValue","current","nextKey","record","lastKey","removePathValue","loadConfig","applyConfigSnapshot","loadConfigSchema","applyConfigSchema","snapshot","rawFromSnapshot","asJsonSchema","serializeFormForSubmit","saveConfig","baseHash","applyConfig","runUpdate","updateConfigFormValue","base","removeConfigFormValue","isFormDirty","values","original","renderNostrProfileForm","params","callbacks","accountId","isDirty","renderField","field","label","opts","placeholder","maxLength","help","error","inputId","html","target","nothing","renderPicturePreview","picture","img","createNostrProfileFormState","profile","handleWhatsAppStart","host","handleWhatsAppWait","handleWhatsAppLogout","handleChannelConfigSave","handleChannelConfigReload","parseValidationErrors","details","errors","entry","rawField","rest","message","resolveNostrAccountId","buildNostrProfileUrl","suffix","resolveGatewayHttpAuthHeader","deviceToken","token","password","buildGatewayHttpHeaders","authorization","handleNostrProfileEdit","handleNostrProfileCancel","handleNostrProfileFieldChange","handleNostrProfileToggleAdvanced","handleNostrProfileSave","response","data","errorMessage","handleNostrProfileImport","merged","nextValues","showAdvanced","parseAgentSessionKey","sessionKey","parts","agentId","NEAR_BOTTOM_THRESHOLD","scheduleChatScroll","smooth","pickScrollTarget","container","overflowY","distanceFromBottom","effectiveForce","smoothEnabled","scrollTop","retryDelay","latest","latestDistanceFromBottom","scheduleLogsScroll","handleChatScroll","event","handleLogsScroll","resetChatScroll","exportLogs","lines","blob","url","anchor","stamp","observeTopbar","topbar","update","height","loadDebug","status","health","models","heartbeat","modelPayload","callDebugMethod","LOG_BUFFER_LIMIT","LEVELS","parseMaybeJsonString","normalizeLevel","lowered","parseLogLine","line","meta","time","level","contextCandidate","contextObj","subsystem","loadLogs","payload","entries","shouldReset","loadNodes","startNodesPolling","stopNodesPolling","startLogsPolling","stopLogsPolling","startDebugPolling","stopDebugPolling","loadAgentIdentity","loadAgentIdentities","agentIds","missing","id","loadAgentSkills","loadAgents","selected","known","formatDurationCompact","ms","options","sep","totalSeconds","hours","minutes","seconds","days","remainingHours","formatDurationHuman","fallback","sec","min","hr","formatRelativeTimestamp","timestampMs","diff","absDiff","isPast","day","QUICK_TAG_RE","FINAL_TAG_RE","THINKING_TAG_RE","findCodeRegions","text","regions","fencedRe","start","inlineRe","end","isInsideCode","pos","applyTrim","mode","stripReasoningTagsFromText","cleaned","finalMatches","preCodeRegions","codeRegions","lastIndex","inThinking","idx","isClose","formatMs","formatList","clampText","max","truncateText","toNumber","stripThinkingTags","loadCronStatus","loadCronJobs","buildCronSchedule","amount","unit","expr","buildCronPayload","timeoutSeconds","addCronJob","schedule","delivery","job","toggleCronJob","enabled","runCronJob","loadCronRuns","removeCronJob","jobId","STORAGE_KEY","normalizeRole","role","normalizeScopes","scopes","out","scope","readStore","writeStore","store","loadDeviceAuthToken","storeDeviceAuthToken","existing","clearDeviceAuthToken","ed25519_CURVE","Gx","Gy","_a","_d","L2","captureTrace","args","isBig","isStr","isBytes","abytes","length","title","bytes","len","needsLen","prefix","ofLen","got","u8n","u8fr","buf","padh","pad","bytesToHex","_ch","ch","hexToBytes","hex","hl","al","array","ai","hi","n1","n2","cr","subtle","concatBytes","arrs","sum","randomBytes","big","assertRange","msg","modN","invert","num","md","q","callHash","name","fn","hashes","apoint","Point","B256","X","Y","T","zip215","normed","lastByte","bytesToNumLE","y2","isValid","uvRatio","isXOdd","isLastByteOdd","X2","Y2","Z2","Z4","aX2","left","right","XY","ZT","other","X1","Y1","Z1","X1Z2","X2Z1","Y1Z2","Y2Z1","x1y1","G","F","X3","Y3","T3","Z3","T1","T2","safe","wNAF","scalar","iz","numTo32bLE","pow2","power","pow_2_252_3","b2","b4","b5","b10","b20","b40","b80","b160","b240","b250","RM1","v3","v7","pow","vx2","root1","root2","useRoot1","useRoot2","noRoot","modL_LE","hash","sha512a","sha512s","hash2extK","hashed","head","point","pointBytes","getExtendedPublicKeyAsync","secretKey","getExtendedPublicKey","getPublicKeyAsync","hashFinishA","_sign","rBytes","signAsync","randomSecretKey","seed","utils","W","scalarBits","pwindows","pwindowSize","precompute","points","Gpows","ctneg","cnd","comp","pow_2_w","maxNum","mask","shiftBy","wbits","off","offF","offP","isEven","isNeg","base64UrlEncode","binary","byte","base64UrlDecode","input","normalized","padded","fingerprintPublicKey","publicKey","generateIdentity","privateKey","loadOrCreateDeviceIdentity","derivedId","updated","identity","stored","signDevicePayload","privateKeyBase64Url","sig","loadDevices","approveDevicePairing","requestId","rejectDevicePairing","rotateDeviceToken","revokeDeviceToken","resolveExecApprovalsRpc","nodeId","resolveExecApprovalsSaveRpc","loadExecApprovals","rpc","applyExecApprovalsSnapshot","saveExecApprovals","file","updateExecApprovalsFormValue","removeExecApprovalsFormValue","loadPresence","loadSessions","overrides","includeGlobal","includeUnknown","activeMinutes","limit","patchSession","patch","deleteSession","setSkillMessage","getErrorMessage","loadSkills","updateSkillEdit","skillKey","updateSkillEnabled","saveSkillApiKey","apiKey","installSkill","installId","zhCN","enUS","TRANSLATIONS","DEFAULT_LANGUAGE","loadSavedLanguage","saveLanguage","lang","detectLanguage","saved","manualLanguage","getLanguage","setLanguage","toggleLanguage","newLang","isZh","isEn","dict","TAB_GROUPS","TAB_PATHS","PATH_TO_TAB","tab","normalizeBasePath","basePath","normalizePath","pathForTab","tabFromPath","pathname","inferBasePathFromPathname","candidate","iconForTab","titleForTab","subtitleForTab","KEY","loadSettings","defaults","saveSettings","clamp01","hasReducedMotionPreference","cleanupThemeTransition","root","startThemeTransition","nextTheme","applyTheme","context","currentTheme","documentReference","document_","prefersReducedMotion","xPercent","yPercent","rect","transition","getSystemTheme","resolveTheme","applySettings","applyResolvedTheme","setLastActiveSessionKey","applySettingsFromUrl","hashParams","tokenRaw","passwordRaw","sessionRaw","gatewayUrlRaw","shouldCleanUrl","session","gatewayUrl","nextHash","setTab","refreshActiveTab","syncUrlWithTab","setTheme","loadOverview","loadChannelsTab","loadCron","refreshChat","inferBasePath","configured","syncThemeWithSettings","resolved","attachThemeListener","detachThemeListener","syncTabWithLocation","replace","setTabFromRoute","onPopState","targetPath","currentPath","syncUrlWithSessionKey","TOOL_STREAM_LIMIT","TOOL_STREAM_THROTTLE_MS","TOOL_OUTPUT_CHAR_LIMIT","extractToolOutputText","content","part","formatToolOutput","contentText","truncated","buildToolStreamMessage","trimToolStream","overflow","removed","syncToolStreamMessages","flushToolStreamSync","scheduleToolStreamSync","resetToolStream","COMPACTION_TOAST_DURATION_MS","handleCompactionEvent","phase","handleAgentEvent","toolCallId","output","now","ENVELOPE_PREFIX","ENVELOPE_CHANNELS","textCache","thinkingCache","looksLikeEnvelopeHeader","header","stripEnvelope","extractText","joined","extractTextCached","extractThinking","rawText","extractRawText","extracted","extractThinkingCached","formatReasoningMarkdown","warnedWeakCrypto","uuidFromBytes","weakRandomBytes","warnWeakCryptoOnce","generateUUID","cryptoLike","loadChatHistory","dataUrlToBase64","dataUrl","sendChatMessage","attachments","hasAttachments","contentBlocks","att","runId","apiAttachments","abortChatRun","handleChatEvent","CHAT_SESSIONS_ACTIVE_MINUTES","isChatBusy","isChatStopCommand","isChatResetCommand","handleAbortChat","enqueueChatMessage","refreshSessions","sendChatMessageNow","ok","flushChatQueue","removeQueuedMessage","handleSendChat","messageOverride","previousDraft","attachmentsToSend","refreshChatAvatar","flushChatQueueForEvent","resolveAgentIdForSession","buildAvatarMetaUrl","encoded","avatarUrl","DEFAULT_LOG_LEVEL_FILTERS","DEFAULT_CRON_FORM","MAX_ASSISTANT_NAME","MAX_ASSISTANT_AVATAR","DEFAULT_ASSISTANT_NAME","coerceIdentityValue","normalizeAssistantIdentity","avatar","resolveInjectedAssistantIdentity","loadAssistantIdentity","isRecord","parseExecApprovalRequested","request","command","createdAtMs","expiresAtMs","parseExecApprovalResolved","pruneExecApprovalQueue","queue","addExecApproval","removeExecApproval","buildDeviceAuthPayload","version","GATEWAY_CLIENT_IDS","GATEWAY_CLIENT_NAMES","GATEWAY_CLIENT_MODES","CONNECT_FAILED_CLOSE_CODE","GatewayBrowserClient","ev","reason","delay","isSecureContext","deviceIdentity","canFallbackToShared","authToken","storedToken","auth","device","signedAtMs","nonce","signature","hello","frame","evt","seq","pending","method","resolve","reject","normalizeSessionKeyForDefaults","mainSessionKey","mainKey","defaultAgentId","applySessionDefaults","resolvedSessionKey","resolvedSettingsSessionKey","resolvedLastActiveSessionKey","nextSessionKey","nextSettings","shouldUpdateSettings","connectGateway","applySnapshot","code","handleGatewayEvent","expected","received","handleGatewayEventUnsafe","handleConnected","handleFirstUpdated","handleDisconnected","handleUpdated","changed","forcedByTab","forcedByLoad","i$1","icons","renderTab","href","renderChatControls","resolveMainSessionKey","sessionOptions","resolveSessionOptions","disableThinkingToggle","disableFocusToggle","showThinking","focusActive","refreshIcon","focusIcon","repeat","app","sessions","row","resolveSessionDisplayName","displayName","seen","resolvedMain","resolvedCurrent","THEME_ORDER","renderThemeToggle","index","renderMonitorIcon","renderSunIcon","renderMoonIcon","renderLanguageToggle","currentLang","mergeFileEntry","list","nextFiles","loadAgentFiles","loadAgentFileContent","previousBase","currentDraft","preserveDraft","saveAgentFile","loadUsage","startDate","endDate","sessionsRes","costRes","loadSessionTimeSeries","loadSessionLogs","TOOL_NAME_ALIASES","TOOL_GROUPS","TOOL_PROFILES","normalizeToolName","normalizeToolList","expandToolGroups","expanded","group","resolveToolProfilePolicy","formatPresenceSummary","ip","formatPresenceAge","ts","formatNextRun","formatSessionTokens","total","ctx","formatEventPayload","formatCronState","last","formatCronSchedule","atMs","formatCronPayload","TOOL_SECTIONS","PROFILE_OPTIONS","normalizeAgentLabel","agent","isLikelyEmoji","hasNonAscii","resolveAgentEmoji","agentIdentity","identityEmoji","agentEmoji","identityAvatar","agentBadgeText","defaultId","formatBytes","units","size","unitIndex","resolveAgentConfig","config","cfg","buildAgentContext","configForm","agentFilesList","workspace","modelLabel","resolveModelLabel","identityName","skillFilter","skillCount","model","primary","fallbackCount","normalizeModelValue","resolveModelPrimary","resolveModelFallbacks","fallbacks","parseFallbackList","resolveConfiguredModels","modelId","modelRaw","alias","buildModelOptions","hasCurrent","option","compilePattern","pattern","escaped","compilePatterns","patterns","matchesAny","isAllowedByPolicy","policy","deny","allow","matchesList","renderAgents","agents","selectedId","selectedAgent","badge","emoji","renderAgentHeader","renderAgentTabs","panel","renderAgentOverview","renderAgentFiles","renderAgentTools","renderAgentSkills","renderAgentChannels","renderAgentCron","subtitle","active","onSelect","agentIdentityLoading","agentIdentityError","configLoading","configSaving","configDirty","onConfigReload","onConfigSave","onModelChange","onModelFallbacksChange","defaultModel","modelPrimary","defaultPrimary","effectivePrimary","modelFallbacks","fallbackText","identityStatus","isDefault","renderAgentContextCard","resolveChannelLabel","resolveChannelEntries","ids","ordered","CHANNEL_EXTRA_FIELDS","resolveChannelConfigValue","channelId","fromChannels","formatChannelExtraValue","resolveChannelExtras","summarizeChannelAccounts","accounts","connected","account","probeOk","lastSuccessLabel","summary","extras","extra","jobs","files","activeEntry","baseContent","draft","renderAgentFileRow","agentTools","globalTools","profileSource","hasAgentAllow","hasGlobalAllow","editable","alsoAllow","basePolicy","toolIds","section","tool","resolveAllowed","toolId","baseAllowed","extraAllowed","denied","enabledCount","updateTool","nextEnabled","nextAllow","nextDeny","updateAll","allowed","SKILL_SOURCE_GROUPS","groupSkills","skills","groups","def","builtInGroup","skill","allowlist","allowSet","usingAllowlist","reportReady","rawSkills","filter","filtered","totalCount","renderAgentSkillGroup","collapsedByDefault","renderAgentSkillRow","reasons","META_KEYS","isAnySchema","jsonValue","renderNode","unsupported","disabled","onPatch","showLabel","rawLabel","nonNull","extractLiteral","literals","allLiterals","resolvedValue","lit","renderSelect","primitiveTypes","normalizedTypes","hasString","hasNumber","renderTextInput","opt","renderObject","renderArray","displayValue","renderNumberInput","inputType","isSensitive","numValue","currentIndex","unset","sorted","orderA","orderB","reserved","allowExtra","propKey","node","renderMapField","arr","reservedKeys","anySchema","entryValue","valuePath","sectionIcons","SECTION_LABELS","getSectionLabel","getSectionDescription","SECTION_META","getSectionIcon","matchesSearch","query","description","schemaMatches","items","unions","renderConfigForm","properties","searchQuery","activeSection","activeSubsection","filteredEntries","subsectionContext","sectionSchema","sectionKey","subsectionKey","rawDescription","sectionValue","scopedValue","fallbackLabel","fallbackDesc","normalizeEnum","nullable","enumValues","analyzeConfigSchema","normalizeSchemaNode","pathLabel","union","normalizeUnion","enumNullable","normalizedProps","remaining","unique","resolveSchemaNode","resolveChannelValue","EXTRA_CHANNEL_FIELDS","formatExtraValue","renderExtraChannelFields","renderChannelConfigForm","analysis","configValue","renderChannelConfigSection","renderDiscordCard","discord","accountCountLabel","renderGoogleChatCard","googleChat","renderIMessageCard","imessage","truncatePubkey","pubkey","renderNostrCard","nostr","nostrAccounts","profileFormState","profileFormCallbacks","onEditProfile","primaryAccount","summaryConfigured","summaryRunning","summaryPublicKey","summaryLastStartAt","summaryLastError","hasMultipleAccounts","showingForm","renderAccountCard","renderProfileSection","about","nip05","hasAnyProfileData","channelEnabled","channels","channelStatus","running","accountActive","getChannelAccountCount","channelAccounts","renderChannelAccountCount","count","renderSignalCard","signal","renderSlackCard","slack","renderTelegramCard","telegram","telegramAccounts","botUsername","renderWhatsAppCard","whatsapp","renderChannels","googlechat","orderedChannels","resolveChannelOrder","channel","renderChannel","showForm","renderGenericChannelCard","lastError","renderGenericAccount","resolveChannelMetaMap","RECENT_ACTIVITY_THRESHOLD_MS","hasRecentActivity","deriveRunningStatus","deriveConnectedStatus","runningStatus","connectedStatus","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","freeze","seal","create","apply","construct","func","thisArg","_len","_key","Func","_len2","_key2","arrayForEach","unapply","arrayLastIndexOf","arrayPop","arrayPush","arraySplice","stringToLowerCase","stringToString","stringMatch","stringReplace","stringIndexOf","stringTrim","objectHasOwnProperty","regExpTest","typeErrorCreate","unconstruct","_len3","_key3","_len4","_key4","addToSet","set","transformCaseFunc","element","lcElement","cleanArray","clone","object","newObject","property","lookupGetter","prop","desc","fallbackValue","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","NODE_TYPE","getGlobal","_createTrustedTypesPolicy","trustedTypes","purifyHostElement","ATTR_NAME","policyName","scriptUrl","_createHooksMap","createDOMPurify","window","DOMPurify","document","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","Element","NodeFilter","NamedNodeMap","HTMLFormElement","DOMParser","ElementPrototype","cloneNode","remove","getNextSibling","getChildNodes","getParentNode","template","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","IS_ALLOWED_URI$1","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","CUSTOM_ELEMENT_HANDLING","FORBID_TAGS","FORBID_ATTR","EXTRA_ELEMENT_HANDLING","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","SANITIZE_NAMED_PROPS_PREFIX","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","DEFAULT_PARSER_MEDIA_TYPE","CONFIG","formElement","isRegexOrFunction","testValue","_parseConfig","ALL_SVG_TAGS","ALL_MATHML_TAGS","_checkValidNamespace","parent","tagName","parentTagName","_forceRemove","_removeAttribute","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","body","_createNodeIterator","_isClobbered","_isNode","_executeHooks","currentNode","hook","_sanitizeElements","_isBasicCustomElement","parentNode","childNodes","childCount","childClone","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","attributes","hookEvent","attr","namespaceURI","attrValue","initValue","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","importedNode","returnNode","nodeIterator","serializedHTML","tag","entryPoint","hookFunction","purify","Re","Te","Oe","we","ye","re","se","Pe","Q","Se","$e","_e","Le","ie","Me","U","te","ze","Ce","Ae","Ie","oe","Ee","K","ae","Be","le","De","qe","ue","ve","Ge","He","pe","Ze","Ne","ce","Qe","Fe","je","Ue","Ke","We","Xe","Je","Ve","Ye","et","he","ke","tt","ne","nt","rt","st","de","O","J","ge","fe","me","it","ee","xe","be","marked","allowedTags","allowedAttrs","hooksInstalled","MARKDOWN_CHAR_LIMIT","MARKDOWN_PARSE_LIMIT","MARKDOWN_CACHE_LIMIT","MARKDOWN_CACHE_MAX_CHARS","markdownCache","getCachedMarkdown","cached","setCachedMarkdown","oldest","installHooks","toSanitizedMarkdownHtml","markdown","escapeHtml","sanitized","rendered","htmlEscapeRenderer","RTL_CHAR_REGEX","detectTextDirection","skipPattern","char","COPIED_FOR_MS","ERROR_FOR_MS","COPY_LABEL","COPIED_LABEL","ERROR_LABEL","copyTextToClipboard","setButtonLabel","button","createCopyButton","idleLabel","btn","copied","renderCopyAsMarkdownButton","normalizeMessage","hasToolId","contentRaw","contentItems","hasToolContent","hasToolName","timestamp","normalizeRoleForGrouping","lower","isToolResultMessage","TOOL_DISPLAY_CONFIG","rawConfig","FALLBACK","TOOL_MAP","defaultTitle","normalizeVerb","coerceDisplayValue","firstLine","preview","lookupValueByPath","resolveDetailFromKeys","keys","display","resolveReadDetail","offset","resolveWriteDetail","resolveActionSpec","spec","action","resolveToolDisplay","icon","actionRaw","actionSpec","verb","detail","detailKeys","shortenHomeInString","formatToolDetail","TOOL_INLINE_THRESHOLD","PREVIEW_MAX_LINES","PREVIEW_MAX_CHARS","formatToolOutputForSidebar","getTruncatedPreview","allLines","extractToolCards","normalizeContent","cards","kind","coerceArgs","extractToolText","card","renderToolCardSidebar","onOpenSidebar","hasText","canClick","handleClick","info","isShort","showCollapsed","showInline","isEmpty","extractImages","images","block","source","mediaType","imageUrl","renderReadingIndicatorGroup","assistant","renderAvatar","renderStreamingGroup","startedAt","renderGroupedMessage","renderMessageGroup","normalizedRole","assistantName","who","roleClass","assistantAvatar","initial","className","isAvatarUrl","renderMessageImages","isToolResult","toolCards","hasToolCards","hasImages","extractedText","extractedThinking","markdownBase","reasoningMarkdown","canCopyMarkdown","bubbleClasses","unsafeHTML","renderMarkdownSidebar","ResizableDivider","LitElement","containerWidth","deltaRatio","newRatio","css","__decorateClass","customElement","adjustTextareaHeight","el","renderCompactionIndicator","generateAttachmentId","handlePaste","imageItems","reader","newAttachment","renderAttachmentPreview","renderChat","canCompose","isBusy","canAbort","reasoningLevel","showReasoning","assistantIdentity","composePlaceholder","splitRatio","sidebarOpen","thread","buildChatItems","ref","CHAT_HISTORY_RENDER_LIMIT","groupMessages","currentGroup","history","tools","historyStart","marker","messageKey","messageId","sidebarIcons","SECTIONS","ALL_SUBSECTION","resolveSectionMeta","resolveSubsections","uiHints","subKey","order","computeDiff","changes","compare","orig","curr","origObj","currObj","allKeys","truncateValue","maxLen","str","renderConfig","validity","formUnsafe","schemaProps","availableSections","knownKeys","extraSections","allSections","activeSectionSchema","activeSectionMeta","subsections","allowSubnav","isAllSubsection","effectiveSubsection","hasRawChanges","hasChanges","canSaveForm","canSave","canApply","canUpdate","change","buildChannelOptions","renderCron","channelOptions","selectedRunTitle","orderedRuns","renderScheduleFields","renderJob","renderRun","itemClass","renderJobPayload","renderJobState","deliveryTarget","formatStateRelative","statusClass","nextRunAtMs","lastRunAtMs","chatUrl","renderDebug","securitySummary","critical","warn","securityTone","securityLabel","formatRemaining","renderMetaRow","renderExecApprovalPrompt","remainingMs","queueCount","renderGatewayUrlConfirmation","pendingGatewayUrl","renderInstances","renderEntry","lastInput","roles","scopesLabel","formatTime","date","matchesFilter","needle","renderLogs","levelFiltered","exportLabel","renderNodes","bindingState","resolveBindingsState","approvalsState","resolveExecApprovalsState","renderExecApprovals","renderBindings","renderDevices","paired","req","renderPendingDevice","renderPairedDevice","age","repair","tokens","renderTokenRow","deviceId","when","EXEC_APPROVALS_DEFAULT_SCOPE","SECURITY_OPTIONS","ASK_OPTIONS","nodes","resolveExecNodes","defaultBinding","resolveAgentBindings","ready","normalizeSecurity","normalizeAsk","resolveExecApprovalsDefaults","resolveConfigAgents","agentsNode","resolveExecApprovalsAgents","configAgents","approvalsAgents","aLabel","bLabel","resolveExecApprovalsScope","targetNodes","resolveExecApprovalsNodes","targetNodeId","selectedScope","supportsBinding","renderAgentBinding","targetReady","renderExecApprovalsTarget","renderExecApprovalsTabs","renderExecApprovalsPolicy","renderExecApprovalsAllowlist","hasNodes","nodeValue","first","isDefaults","agentSecurity","agentAsk","agentAskFallback","securityValue","askValue","askFallbackValue","autoOverride","autoEffective","autoIsDefault","allowlistPath","renderAllowlistEntry","lastUsed","lastCommand","lastPath","bindingValue","cmd","fallbackAgent","exec","execEntry","binding","caps","commands","renderOverview","uptime","tick","authHint","hasToken","hasPassword","insecureContextHint","THINK_LEVELS","BINARY_THINK_LEVELS","VERBOSE_LEVELS","REASONING_LEVELS","normalizeProviderId","provider","isBinaryThinkingProvider","resolveThinkLevelOptions","withCurrentOption","withCurrentLabeledOption","resolveThinkLevelDisplay","isBinary","resolveThinkLevelPatchValue","renderSessions","rows","renderRow","onDelete","rawThinking","isBinaryThinking","thinking","thinkLevels","verbose","verboseLevels","reasoning","reasoningLevels","showDisplayName","canLink","renderSkills","renderSkill","busy","canInstall","showBundledBadge","QUERY_KEYS","normalizeQueryText","globToRegex","parseQueryNumber","multiplier","extractQueryTerms","getSessionText","getSessionProviders","providers","getSessionModels","getSessionTools","matchesUsageQuery","term","regex","threshold","filterSessionsByQuery","terms","warnings","normalizedKey","parseToolSummary","toolCounts","nonToolLines","sortedTools","totalCalls","usageStylesString","CHARS_PER_TOKEN","charsToTokens","chars","formatTokens","formatHourLabel","hour","buildPeakErrorHours","timeZone","hourErrors","hourMsgs","usage","startMs","endMs","totalMinutes","cursor","getZonedHour","nextHour","setToHourEnd","nextMs","share","msgs","rate","WEEKDAYS","zone","getZonedWeekday","buildUsageMosaicStats","hourTotals","weekdayTotals","totalTokens","hasData","weekday","weekdayLabels","renderUsageMosaic","selectedHours","onSelectHour","stats","maxHour","maxWeekday","intensity","bg","border","formatCost","decimals","formatIsoDate","parseYmdDate","dateStr","formatDayLabel","formatFullDate","downloadTextFile","filename","csvEscape","toCsvRow","emptyUsageTotals","mergeUsageTotals","buildAggregatesFromSessions","messages","toolMap","modelMap","providerMap","agentMap","channelMap","dailyMap","dailyLatencyMap","modelDailyMap","latencyTotals","modelKey","modelExisting","providerKey","providerExisting","avgMs","minMs","maxMs","p95Ms","totals","daily","buildUsageInsightStats","aggregates","durationSumMs","durationCount","duration","avgDurationMs","throughputTokensPerMin","throughputCostPerMin","errorRate","peakErrorDay","buildSessionsCsv","buildDailyCsv","buildQuerySuggestions","lastToken","rawKey","rawValue","suggestions","addValues","applySuggestionToQuery","suggestion","addQueryToken","tokenKey","removeQueryToken","setQueryTokensForKey","pct","getCostBreakdown","totalCost","renderFilterChips","selectedDays","selectedSessions","onClearDays","onClearHours","onClearSessions","onClearFilters","selectedSession","sessionsLabel","sessionsFullName","daysLabel","hoursLabel","renderDailyChartCompact","chartMode","dailyChartMode","onDailyChartModeChange","onSelectDay","isTokenMode","maxValue","barMaxWidth","showTotals","heightPct","isSelected","shortLabel","labelStyle","breakdownLines","totalLabel","seg","renderCostBreakdownCompact","breakdown","tokenPcts","renderInsightList","emptyLabel","renderPeakErrorList","renderUsageInsights","showCostHint","errorHours","sessionCount","totalSessions","avgTokens","avgCost","cacheBase","cacheHitRate","cacheHitLabel","errorRatePct","throughputLabel","throughputCostLabel","avgDurationLabel","cacheHint","errorHint","throughputHint","tokensHint","costHint","errorDays","_rate","topModels","topProviders","topTools","topAgents","topChannels","renderSessionsCard","sessionSort","sessionSortDir","recentSessions","sessionsTab","onSelectSession","onSessionSortChange","onSessionSortDirChange","onSessionsTabChange","visibleColumns","showColumn","formatSessionListLabel","copySessionName","buildSessionMeta","getSessionValue","filteredDays","sortedSessions","sortedWithDir","totalValue","avgValue","totalErrors","selectedSet","selectedEntries","selectedCount","sessionMap","recentEntries","displayLabel","renderEmptyDetailState","renderSessionSummary","formatTs","badges","toolItems","modelItems","renderSessionDetailPanel","timeSeries","timeSeriesLoading","timeSeriesMode","onTimeSeriesModeChange","timeSeriesBreakdownMode","onTimeSeriesBreakdownChange","sessionLogs","sessionLogsLoading","sessionLogsExpanded","onToggleSessionLogsExpanded","logFilters","onLogFilterRolesChange","onLogFilterToolsChange","onLogFilterHasToolsChange","onLogFilterQueryChange","onLogFilterClear","contextExpanded","onToggleContextExpanded","onClose","renderTimeSeriesCompact","renderSessionLogsCompact","renderContextPanel","loading","onModeChange","breakdownMode","onBreakdownChange","startTs","endTs","cumTokens","cumCost","sumOutput","sumInput","sumCacheRead","sumCacheWrite","width","padding","chartWidth","chartHeight","isCumulative","breakdownByType","totalTypeTokens","barTotals","barWidth","barGap","barHeight","tooltipLines","tooltip","yCursor","segHeight","contextWeight","onToggleExpanded","systemTokens","skillsTokens","toolsTokens","filesTokens","totalContextTokens","contextPct","inputTokens","skillsList","toolsList","filesList","defaultLimit","showAll","skillsTop","toolsTop","filesTop","hasMore","more","logs","expandedAll","onToggleExpandedAll","filters","onFilterRolesChange","onFilterToolsChange","onFilterHasToolsChange","onFilterQueryChange","onFilterClear","normalizedQuery","log","toolInfo","cleanContent","toolOptions","displayedCount","roleSelected","toolSelected","roleLabel","renderUsage","hasQuery","hasDraftQuery","valA","dayFilteredSessions","sessionDate","sessionTouchesHours","hourFilteredSessions","queryResult","filteredSessions","queryWarnings","querySuggestions","queryTerms","selectedValuesFor","agentOptions","providerOptions","modelOptions","primarySelectedEntry","computeSessionTotals","acc","computeDailyTotals","displayTotals","displaySessionCount","selectedSessionEntries","aggregateSessions","activeAggregates","filteredDaily","allActivityDates","insightStats","hasMissingCost","datePresets","applyPreset","renderFilterSelect","allSelected","onClick","checked","exportStamp","preset","usageDateDebounceTimeout","debouncedLoadUsage","AVATAR_DATA_RE","AVATAR_HTTP_RE","resolveAssistantAvatarUrl","renderApp","presenceCount","sessionsCount","cronNext","chatDisabledReason","isChat","chatFocus","assistantAvatarUrl","chatAvatarUrl","resolvedAgentId","isGroupCollapsed","hasActiveTab","shiftKey","allHours","lastSelected","lastIdx","thisIdx","range","sort","dir","column","newSelection","allDays","clearAllow","skillName","normalizedSkill","allSkills","agentIndex","ratio","injectedAssistantIdentity","resolveOnboardingMode","OpenClawApp","onPopStateInternal","connectGatewayInternal","handleChatScrollInternal","handleLogsScrollInternal","exportLogsInternal","resetToolStreamInternal","resetChatScrollInternal","scheduleChatScrollInternal","loadAssistantIdentityInternal","applySettingsInternal","setTabInternal","setThemeInternal","loadOverviewInternal","loadCronInternal","handleAbortChatInternal","removeQueuedMessageInternal","handleSendChatInternal","handleWhatsAppStartInternal","handleWhatsAppWaitInternal","handleWhatsAppLogoutInternal","handleChannelConfigSaveInternal","handleChannelConfigReloadInternal","handleNostrProfileEditInternal","handleNostrProfileCancelInternal","handleNostrProfileFieldChangeInternal","handleNostrProfileSaveInternal","handleNostrProfileImportInternal","handleNostrProfileToggleAdvancedInternal","decision","nextGatewayUrl"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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","x_google_ignoreList":[0,1,2,3,4,5,6,29,58,59,60,82,83,84,85,86]}